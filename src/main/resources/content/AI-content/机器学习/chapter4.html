<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬4ç« ï¼šKNNç®—æ³• - æœ€è¿‘é‚»çš„æ™ºæ…§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* CSS å˜é‡å®šä¹‰ä¸»é¢˜é¢œè‰² */
        :root {
            /* æ·±è‰²ä¸»é¢˜ï¼ˆé»˜è®¤ï¼‰ - è“ç´«è‰²è°ƒ */
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a3e;
            --bg-card: rgba(26, 26, 62, 0.8);
            --bg-card-solid: rgba(26, 26, 62, 0.95);
            --bg-code: #16162d;
            --bg-demo: #0f0f23;

            --text-primary: #e2e8f0;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --text-dim: #64748b;

            --border-primary: rgba(124, 58, 237, 0.3);
            --border-secondary: rgba(124, 58, 237, 0.2);
            --border-muted: rgba(148, 163, 184, 0.1);

            --grid-color: #2d2d5f;
            --grid-light: #3d3d6f;

            --shadow-sm: rgba(0,0,0,0.3);
            --shadow-md: rgba(0,0,0,0.4);
            --shadow-lg: rgba(0,0,0,0.5);

            --gradient-primary: linear-gradient(135deg, #667eea, #764ba2);
            --gradient-bg: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);

            /* KNNä¸»é¢˜è‰² */
            --knn-purple: #7c3aed;
            --knn-blue: #667eea;
            --knn-pink: #ec4899;
            --knn-teal: #14b8a6;
            --knn-orange: #f97316;
            --knn-indigo: #6366f1;
        }

        /* æµ…è‰²ä¸»é¢˜ */
        body.light-theme {
            --bg-primary: #f8fafc;
            --bg-secondary: #e2e8f0;
            --bg-card: rgba(255, 255, 255, 0.9);
            --bg-card-solid: rgba(255, 255, 255, 0.95);
            --bg-code: #f3f4f6;
            --bg-demo: #ffffff;

            --text-primary: #1e293b;
            --text-secondary: #334155;
            --text-muted: #475569;
            --text-dim: #64748b;

            --border-primary: rgba(124, 58, 237, 0.4);
            --border-secondary: rgba(124, 58, 237, 0.3);
            --border-muted: rgba(203, 213, 225, 0.5);

            --grid-color: #e5e7eb;
            --grid-light: #d1d5db;

            --shadow-sm: rgba(0,0,0,0.1);
            --shadow-md: rgba(0,0,0,0.15);
            --shadow-lg: rgba(0,0,0,0.2);

            --gradient-primary: linear-gradient(135deg, #667eea, #764ba2);
            --gradient-bg: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        /* ä¸»é¢˜è¿‡æ¸¡åŠ¨ç”» */
        body,
        body * {
            transition: background-color 0.3s ease,
            color 0.3s ease,
            border-color 0.3s ease,
            box-shadow 0.3s ease;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: var(--gradient-bg);
            color: var(--text-primary);
            line-height: 1.8;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* å½“å¯¼èˆªå±•å¼€æ—¶ï¼Œå†…å®¹åŒºå³ç§» */
        body.nav-open .container {
            margin-left: 360px;
        }

        /* åŠ¨æ€èƒŒæ™¯æ•ˆæœ - KNNèŠ‚ç‚¹è¿æ¥é£æ ¼ */
        .dynamic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .knn-nodes-bg {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        /* æ™ºèƒ½å¯¼èˆªæ ·å¼ */
        .smart-nav {
            position: fixed;
            left: -340px;
            top: 0;
            width: 340px;
            height: 100vh;
            background: linear-gradient(135deg, rgba(15, 15, 35, 0.98) 0%, rgba(26, 26, 62, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-primary);
            box-shadow: 4px 0 30px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow: hidden;
        }

        body.nav-open .smart-nav {
            left: 0;
        }

        /* å¯¼èˆªèƒŒæ™¯è£…é¥° */
        .nav-bg-decoration {
            position: absolute;
            top: -100px;
            right: -100px;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--knn-purple) 0%, transparent 70%);
            opacity: 0.1;
            animation: pulse 4s ease-in-out infinite;
        }

        /* å¯¼èˆªè§¦å‘æŒ‰é’® */
        .nav-trigger {
            position: fixed;
            left: 20px;
            top: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(102, 126, 234, 0.1));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(124, 58, 237, 0.3);
            border-radius: 16px;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        body.nav-open .nav-trigger {
            left: 290px;
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(124, 58, 237, 0.1));
            border-color: rgba(236, 72, 153, 0.5);
        }

        .nav-trigger:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4);
        }

        /* æ±‰å ¡èœå•åŠ¨ç”» */
        .nav-trigger-icon {
            width: 24px;
            height: 20px;
            position: relative;
            transform: rotate(0deg);
            transition: 0.5s ease-in-out;
        }

        .nav-trigger-icon span {
            display: block;
            position: absolute;
            height: 3px;
            width: 100%;
            background: linear-gradient(90deg, var(--knn-purple), var(--knn-blue));
            border-radius: 3px;
            opacity: 1;
            left: 0;
            transform: rotate(0deg);
            transition: 0.25s ease-in-out;
        }

        .nav-trigger-icon span:nth-child(1) {
            top: 0px;
        }

        .nav-trigger-icon span:nth-child(2) {
            top: 8px;
        }

        .nav-trigger-icon span:nth-child(3) {
            top: 16px;
        }

        body.nav-open .nav-trigger-icon span:nth-child(1) {
            top: 8px;
            transform: rotate(135deg);
        }

        body.nav-open .nav-trigger-icon span:nth-child(2) {
            opacity: 0;
            left: -60px;
        }

        body.nav-open .nav-trigger-icon span:nth-child(3) {
            top: 8px;
            transform: rotate(-135deg);
        }

        /* å¯¼èˆªå¤´éƒ¨ */
        .nav-header {
            padding: 30px;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(102, 126, 234, 0.05));
            border-bottom: 1px solid rgba(124, 58, 237, 0.2);
            position: relative;
        }

        .nav-header h3 {
            font-size: 1.4rem;
            background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }

        .nav-subtitle {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        /* ç« èŠ‚è¿›åº¦ç¯ */
        .chapter-progress {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-bg {
            fill: none;
            stroke: rgba(124, 58, 237, 0.1);
            stroke-width: 4;
        }

        .progress-ring-fill {
            fill: none;
            stroke: url(#progressGradient);
            stroke-width: 4;
            stroke-dasharray: 138.23;
            stroke-dashoffset: 138.23;
            transition: stroke-dashoffset 1s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--knn-purple);
        }

        /* å¯¼èˆªåˆ—è¡¨ */
        .nav-list {
            list-style: none;
            padding: 20px 0;
            max-height: calc(100vh - 300px);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .nav-list::-webkit-scrollbar {
            width: 6px;
        }

        .nav-list::-webkit-scrollbar-track {
            background: rgba(124, 58, 237, 0.05);
            border-radius: 3px;
        }

        .nav-list::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue));
            border-radius: 3px;
        }

        /* å¯¼èˆªé¡¹ */
        .nav-item {
            position: relative;
            margin: 8px 15px;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0;
            background: linear-gradient(90deg, var(--knn-purple), var(--knn-blue));
            transition: width 0.3s ease;
            opacity: 0.8;
        }

        .nav-item:hover::before {
            width: 4px;
        }

        .nav-item.active::before {
            width: 4px;
            opacity: 1;
            box-shadow: 0 0 12px var(--knn-purple);
        }

        .nav-item a {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            color: var(--text-muted);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            background: rgba(0, 0, 0, 0);
        }

        .nav-item:hover a {
            color: var(--text-primary);
            background: rgba(124, 58, 237, 0.05);
            padding-left: 28px;
        }

        .nav-item.active a {
            color: var(--text-primary);
            background: linear-gradient(90deg, rgba(124, 58, 237, 0.1), rgba(102, 126, 234, 0.05));
            padding-left: 28px;
            font-weight: 600;
        }

        /* å¯¼èˆªå›¾æ ‡åŠ¨ç”» */
        .nav-icon {
            font-size: 1.4rem;
            margin-right: 14px;
            flex-shrink: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: rgba(124, 58, 237, 0.1);
            border-radius: 8px;
        }

        .nav-item:hover .nav-icon {
            transform: scale(1.1) rotate(10deg);
            background: rgba(124, 58, 237, 0.2);
        }

        .nav-item.active .nav-icon {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.3), rgba(102, 126, 234, 0.2));
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* å¯¼èˆªæ–‡æœ¬å’Œæ—¶é—´ */
        .nav-content {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-text {
            font-size: 0.95rem;
            font-weight: 500;
        }

        .nav-meta {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-time {
            font-size: 0.75rem;
            color: var(--text-dim);
            background: rgba(124, 58, 237, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
        }

        .nav-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4a5568;
            transition: all 0.3s ease;
        }

        .nav-item.completed .nav-status {
            background: #10b981;
            box-shadow: 0 0 8px #10b981;
        }

        .nav-item.active .nav-status {
            background: var(--knn-purple);
            box-shadow: 0 0 8px var(--knn-purple);
            animation: statusPulse 2s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* å¯¼èˆªåº•éƒ¨ç»Ÿè®¡ */
        .nav-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 25px;
            background: linear-gradient(to top, rgba(15, 15, 35, 0.98), transparent);
            border-top: 1px solid rgba(124, 58, 237, 0.2);
        }

        .learning-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(124, 58, 237, 0.05);
            padding: 12px;
            border-radius: 10px;
            border: 1px solid rgba(124, 58, 237, 0.2);
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--knn-purple);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* ä¸»æ ‡é¢˜æ ·å¼ */
        .main-header {
            text-align: center;
            margin: 60px 0;
            position: relative;
        }

        .main-title {
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--knn-purple) 0%, var(--knn-blue) 50%, var(--knn-pink) 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-flow 6s ease infinite;
            text-shadow: 0 0 80px rgba(124, 58, 237, 0.5);
            margin-bottom: 20px;
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .subtitle {
            font-size: 1.6rem;
            color: #94a3b8;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* ç« èŠ‚å¡ç‰‡æ ·å¼ */
        .section-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 40px;
            margin: 30px 0;
            border: 1px solid var(--border-secondary);
            box-shadow: 0 20px 40px var(--shadow-sm);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .section-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--knn-purple), var(--knn-blue), var(--knn-pink));
            border-radius: 24px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .section-card:hover::before {
            opacity: 0.5;
            animation: borderRotate 4s linear infinite;
        }

        @keyframes borderRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px var(--shadow-md);
        }

        .section-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* æ€è€ƒé¢˜æ¡†æ ·å¼ */
        .thinking-box {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(102, 126, 234, 0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(124, 58, 237, 0.3);
            position: relative;
        }

        .thinking-box::before {
            content: 'ğŸ¤”';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2rem;
            background: var(--bg-card-solid);
            padding: 5px 15px;
            border-radius: 50%;
            opacity: 0.8;
            z-index: 1;
        }

        /* å†å²æ•…äº‹æ¡† */
        .history-box {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(251, 146, 60, 0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(249, 115, 22, 0.3);
            position: relative;
        }

        .history-box::before {
            content: 'ğŸ“œ';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2rem;
            background: var(--bg-card-solid);
            padding: 5px 15px;
            border-radius: 50%;
            opacity: 0.8;
            z-index: 1;
        }

        /* å…¬å¼å®¹å™¨æ ·å¼ */
        .formula-box {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(124, 58, 237, 0.05));
            border-radius: 20px;
            padding: 35px;
            margin: 30px 0;
            text-align: center;
            border: 2px solid rgba(99, 102, 241, 0.3);
            position: relative;
            overflow: hidden;
        }

        .formula-box::before {
            content: 'âˆ‘';
            position: absolute;
            top: -30px;
            right: 30px;
            font-size: 6rem;
            opacity: 0.03;
            transform: rotate(15deg);
            z-index: 0;
        }

        /* æ”¹è¿›çš„æ•°å­¦å…¬å¼æ ·å¼ */
        .math-formula {
            font-family: 'Times New Roman', 'Cambria Math', serif;
            font-size: 1.8rem;
            color: var(--text-primary);
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            position: relative;
            z-index: 1;
        }

        /* æ•°å­¦ç¬¦å·æ ·å¼ */
        .math-formula sub, .math-formula sup {
            font-size: 0.7em;
            line-height: 0;
        }

        .math-formula .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            margin: 0 5px;
        }

        .math-formula .numerator {
            border-bottom: 2px solid currentColor;
            padding-bottom: 2px;
        }

        .math-formula .denominator {
            padding-top: 2px;
        }

        .math-formula .sqrt {
            position: relative;
            padding-left: 20px;
        }

        .math-formula .sqrt::before {
            content: 'âˆš';
            position: absolute;
            left: 0;
            top: -5px;
            font-size: 1.2em;
        }

        .math-formula .sqrt-content {
            border-top: 2px solid currentColor;
            padding-top: 2px;
        }

        .formula-explanation {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-top: 20px;
            text-align: left;
            line-height: 2;
        }

        /* é«˜äº®æ ·å¼ */
        .highlight-primary {
            color: var(--knn-purple);
            font-weight: bold;
            background: rgba(124, 58, 237, 0.1);
            padding: 2px 8px;
            border-radius: 6px;
            border: 1px solid rgba(124, 58, 237, 0.3);
        }

        .highlight-success {
            color: var(--knn-teal);
            font-weight: bold;
            background: rgba(20, 184, 166, 0.1);
            padding: 2px 8px;
            border-radius: 6px;
            border: 1px solid rgba(20, 184, 166, 0.3);
        }

        .highlight-warning {
            color: var(--knn-orange);
            font-weight: bold;
            background: rgba(249, 115, 22, 0.1);
            padding: 2px 8px;
            border-radius: 6px;
            border: 1px solid rgba(249, 115, 22, 0.3);
        }

        .highlight-danger {
            color: var(--knn-pink);
            font-weight: bold;
            background: rgba(236, 72, 153, 0.1);
            padding: 2px 8px;
            border-radius: 6px;
            border: 1px solid rgba(236, 72, 153, 0.3);
        }

        /* æ¦‚å¿µå®šä¹‰æ¡† */
        .definition-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(124, 58, 237, 0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(102, 126, 234, 0.3);
            position: relative;
        }

        .definition-box::before {
            content: 'ğŸ“–';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2rem;
            background: var(--bg-card-solid);
            padding: 5px 15px;
            border-radius: 50%;
            opacity: 0.8;
            z-index: 1;
        }

        /* æ ¸å¿ƒæ´å¯Ÿæ¡† */
        .insight-box {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(244, 114, 182, 0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(236, 72, 153, 0.3);
            position: relative;
        }

        .insight-box::before {
            content: 'ğŸ’¡';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2rem;
            background: var(--bg-card-solid);
            padding: 5px 15px;
            border-radius: 50%;
            opacity: 0.8;
            z-index: 1;
        }

        /* è­¦å‘Šæ¡† */
        .warning-box {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(239, 68, 68, 0.3);
            position: relative;
        }

        .warning-box::before {
            content: 'âš ï¸';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2rem;
            background: var(--bg-card-solid);
            padding: 5px 15px;
            border-radius: 50%;
            opacity: 0.8;
            z-index: 1;
        }

        /* äº¤äº’å¼æ¼”ç¤ºåŒºåŸŸ */
        .demo-container {
            background: linear-gradient(135deg, rgba(15, 15, 35, 0.9), rgba(26, 26, 62, 0.8));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(124, 58, 237, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .demo-canvas {
            background: #0f0f23;
            border-radius: 10px;
            margin: 20px auto;
            display: block;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            cursor: crosshair;
        }

        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.3);
        }

        .demo-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4);
        }

        .demo-btn:active {
            transform: translateY(0);
        }

        /* ä»£ç åŒºåŸŸæ ·å¼ */
        .code-block {
            background: #1a1a2e;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            overflow-x: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid rgba(124, 58, 237, 0.2);
        }

        .code-block::before {
            content: 'Python';
            position: absolute;
            top: -12px;
            left: 20px;
            background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue));
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .code-block pre {
            color: #f8f8f2;
            font-family: 'Fira Code', 'Consolas', monospace;
            line-height: 1.6;
            margin: 0;
        }

        /* è¯­æ³•é«˜äº® */
        .keyword { color: #ff79c6; }
        .string { color: #f1fa8c; }
        .comment { color: #6272a4; }
        .number { color: #bd93f9; }
        .function { color: #50fa7b; }

        /* è¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(102, 126, 234, 0.1));
            padding: 15px 25px;
            border-radius: 50px;
            border: 2px solid rgba(124, 58, 237, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px var(--shadow-sm);
        }

        .progress-bar {
            width: 150px;
            height: 6px;
            background: rgba(124, 58, 237, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--knn-purple), var(--knn-blue));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* æµ®åŠ¨å·¥å…·æ  */
        .floating-toolbar {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .toolbar-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue));
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.3);
        }

        .toolbar-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4);
        }

        /* æ€ç»´å¯¼å›¾æ ·å¼ */
        .mind-map {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .mind-node {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(102, 126, 234, 0.05));
            color: var(--text-primary);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(124, 58, 237, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(124, 58, 237, 0.3);
        }

        .mind-node::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .mind-node:hover::before {
            left: 100%;
        }

        .mind-node:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(124, 58, 237, 0.3);
        }

        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .steps-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .step {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            position: relative;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            border: 2px solid transparent;
        }

        .step:hover {
            transform: translateY(-5px);
            border-color: var(--knn-purple);
        }

        .step-number {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3rem;
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.3);
        }

        /* æ•°æ®è¡¨æ ¼æ ·å¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--bg-card);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue));
            color: white;
            padding: 12px 20px;
            font-weight: 600;
            text-align: center;
        }

        .data-table td {
            padding: 10px 20px;
            text-align: center;
            border-bottom: 1px solid var(--border-muted);
            color: var(--text-primary);
            font-weight: 500;
        }

        .data-table tr:hover td {
            background: rgba(124, 58, 237, 0.05);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* ç‰¹å¾æƒé‡å¯è§†åŒ– */
        .feature-weights {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .weight-bar {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .weight-label {
            min-width: 120px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .weight-progress {
            flex: 1;
            height: 20px;
            background: rgba(124, 58, 237, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .weight-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--knn-purple), var(--knn-pink));
            border-radius: 10px;
            transition: width 0.6s ease;
            box-shadow: 0 0 10px rgba(124, 58, 237, 0.3);
        }

        .weight-value {
            min-width: 60px;
            text-align: right;
            font-weight: bold;
            color: var(--knn-purple);
        }

        /* æ¨¡å‹çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .model-status {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }

        .status-item {
            text-align: center;
        }

        .status-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--knn-purple);
        }

        /* å‚æ•°æ§åˆ¶é¢æ¿ */
        .param-panel {
            background: rgba(124, 58, 237, 0.05);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .param-slider {
            width: 100%;
            margin: 10px 0;
        }

        .param-value {
            display: inline-block;
            width: 60px;
            text-align: center;
            color: var(--knn-purple);
            font-weight: bold;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1400px) {
            body.nav-open .container {
                margin-left: 0;
                padding-left: 360px;
            }
        }

        @media (max-width: 768px) {
            .main-title {
                font-size: 2.5rem;
            }

            .section-title {
                font-size: 1.8rem;
            }

            .section-card {
                padding: 25px;
            }

            .demo-controls {
                flex-direction: column;
            }

            .smart-nav {
                width: 100%;
                left: -100%;
            }

            body.nav-open .smart-nav {
                left: 0;
            }

            body.nav-open .container {
                margin-left: 0;
                padding-left: 20px;
            }

            body.nav-open .nav-trigger {
                left: auto;
                right: 20px;
            }

            .mind-map {
                grid-template-columns: 1fr;
            }

            .steps-container {
                grid-template-columns: 1fr;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* è„‰å†²åŠ¨ç”» */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        /* ç« èŠ‚é”šç‚¹åç§» */
        .section-anchor {
            scroll-margin-top: 100px;
        }

        /* åˆ†ç±»ç»“æœåŠ¨ç”» */
        @keyframes classifyPulse {
            0% { box-shadow: 0 0 0 0 rgba(124, 58, 237, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(124, 58, 237, 0); }
            100% { box-shadow: 0 0 0 0 rgba(124, 58, 237, 0); }
        }

        .classify-pulse {
            animation: classifyPulse 1.5s infinite;
        }

        /* è¾¹ç•Œå†³ç­–å¯è§†åŒ– */
        .decision-boundary {
            position: relative;
            background: rgba(124, 58, 237, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        /* é«˜çº§ç®—æ³•å˜ä½“ */
        .algorithm-variant {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(124, 58, 237, 0.05));
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid rgba(99, 102, 241, 0.3);
            transition: all 0.3s ease;
        }

        .algorithm-variant:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.2);
        }

        /* ä¼˜åŒ–æŠ€å·§å¡ç‰‡ */
        .optimization-card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid var(--knn-purple);
            transition: all 0.3s ease;
        }

        .optimization-card:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(124, 58, 237, 0.2);
        }

        /* å¤æ‚åº¦åˆ†æè¡¨ */
        .complexity-table {
            background: var(--bg-card);
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .complexity-table th {
            background: linear-gradient(135deg, var(--knn-indigo), var(--knn-purple));
            color: white;
            padding: 15px;
            text-align: left;
        }

        .complexity-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-muted);
            color: var(--text-primary);
        }

        .complexity-table tr:last-child td {
            border-bottom: none;
        }

        /* å®éªŒç»“æœå›¾è¡¨ */
        .experiment-chart {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        /* å¯¹æ¯”åˆ†æç½‘æ ¼ */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .comparison-item {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.05), rgba(102, 126, 234, 0.02));
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(124, 58, 237, 0.2);
            transition: all 0.3s ease;
        }

        .comparison-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(124, 58, 237, 0.2);
        }

        .comparison-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .comparison-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .comparison-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* å®æˆ˜æ¡ˆä¾‹å®¹å™¨ */
        .case-study {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.05), rgba(124, 58, 237, 0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(236, 72, 153, 0.3);
            position: relative;
        }

        .case-study::before {
            content: 'ğŸ¯';
            position: absolute;
            top: -15px;
            right: 20px;
            font-size: 2rem;
            background: var(--bg-card-solid);
            padding: 5px 15px;
            border-radius: 50%;
            opacity: 0.8;
        }

        /* ç»ƒä¹ é¢˜æ ·å¼ */
        .exercise-box {
            background: linear-gradient(135deg, rgba(20, 184, 166, 0.1), rgba(6, 182, 212, 0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(20, 184, 166, 0.3);
            position: relative;
        }

        .exercise-box::before {
            content: 'âœï¸';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2rem;
            background: var(--bg-card-solid);
            padding: 5px 15px;
            border-radius: 50%;
            opacity: 0.8;
        }

        /* æ·±åº¦æ€è€ƒé¢˜ */
        .deep-thinking {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(124, 58, 237, 0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(168, 85, 247, 0.3);
            position: relative;
        }

        .deep-thinking::before {
            content: 'ğŸ§ ';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2rem;
            background: var(--bg-card-solid);
            padding: 5px 15px;
            border-radius: 50%;
            opacity: 0.8;
        }

        /* æ€»ç»“å¡ç‰‡ */
        .summary-card {
            background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue));
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin: 30px 0;
            text-align: center;
            box-shadow: 0 20px 40px rgba(124, 58, 237, 0.3);
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .summary-content {
            position: relative;
            z-index: 1;
        }

        /* è´¡çŒ®è€…å¡ç‰‡ */
        .contributors {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .contributor-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .contributor-card:hover {
            transform: translateY(-5px);
            border-color: var(--knn-purple);
        }

        .contributor-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue));
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        /* ç‰ˆæœ¬ä¿¡æ¯ */
        .version-info {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* é«˜çº§åŠŸèƒ½æç¤º */
        .pro-tip {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.05));
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #fbbf24;
            position: relative;
        }

        .pro-tip::before {
            content: 'ğŸ’¡ Pro Tip';
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--bg-card-solid);
            padding: 0 10px;
            color: #fbbf24;
            font-weight: 600;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
<!-- åŠ¨æ€èƒŒæ™¯ -->
<div class="dynamic-bg">
    <canvas id="knnNodesBg" class="knn-nodes-bg"></canvas>
</div>

<!-- å¯¼èˆªè§¦å‘æŒ‰é’® -->
<button class="nav-trigger" onclick="toggleNav()">
    <div class="nav-trigger-icon">
        <span></span>
        <span></span>
        <span></span>
    </div>
</button>

<!-- æ™ºèƒ½å¯¼èˆªç³»ç»Ÿ -->
<nav class="smart-nav">
    <div class="nav-bg-decoration"></div>

    <div class="nav-header">
        <h3>ğŸ¤– KNNç®—æ³•å­¦ä¹ æŒ‡å—</h3>
        <p class="nav-subtitle">æœ€è¿‘é‚»çš„æ™ºæ…§ï¼Œæœ€ç›´è§‚çš„ç®—æ³•</p>

        <div class="chapter-progress">
            <svg width="50" height="50">
                <defs>
                    <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#7c3aed;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#667eea;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <circle cx="25" cy="25" r="22" class="progress-ring progress-ring-bg"></circle>
                <circle cx="25" cy="25" r="22" class="progress-ring progress-ring-fill" id="progressRing"></circle>
            </svg>
            <div class="progress-text" id="progressPercent">0%</div>
        </div>
    </div>

    <ul class="nav-list">
        <li class="nav-item active" data-section="intro">
            <a href="#intro">
                <span class="nav-icon">ğŸ¯</span>
                <div class="nav-content">
                    <span class="nav-text">å¼•è¨€ï¼šä¸€ä¸ªç®€å•çš„é—®é¢˜</span>
                    <div class="nav-meta">
                        <span class="nav-time">5 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
        <li class="nav-item" data-section="what-is-knn">
            <a href="#what-is-knn">
                <span class="nav-icon">ğŸ“–</span>
                <div class="nav-content">
                    <span class="nav-text">4.1 ä»€ä¹ˆæ˜¯KNNç®—æ³•</span>
                    <div class="nav-meta">
                        <span class="nav-time">8 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
        <li class="nav-item" data-section="math-foundation">
            <a href="#math-foundation">
                <span class="nav-icon">ğŸ§®</span>
                <div class="nav-content">
                    <span class="nav-text">4.2 æ•°å­¦åŸºç¡€</span>
                    <div class="nav-meta">
                        <span class="nav-time">12 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
        <li class="nav-item" data-section="distance-metrics">
            <a href="#distance-metrics">
                <span class="nav-icon">ğŸ“</span>
                <div class="nav-content">
                    <span class="nav-text">4.3 è·ç¦»åº¦é‡æ–¹æ³•</span>
                    <div class="nav-meta">
                        <span class="nav-time">15 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
        <li class="nav-item" data-section="algorithm-steps">
            <a href="#algorithm-steps">
                <span class="nav-icon">âš™ï¸</span>
                <div class="nav-content">
                    <span class="nav-text">4.4 ç®—æ³•è¯¦ç»†æ­¥éª¤</span>
                    <div class="nav-meta">
                        <span class="nav-time">10 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
    </ul>

    <div class="nav-footer">
        <div class="learning-stats">
            <div class="stat-card">
                <div class="stat-value" id="totalTime">50</div>
                <div class="stat-label">æ€»æ—¶é•¿(åˆ†é’Ÿ)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completedSections">0/5</div>
                <div class="stat-label">å®Œæˆç« èŠ‚</div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 15px;">
            <kbd style="background: rgba(124, 58, 237, 0.1); padding: 4px 8px; border-radius: 4px;">Alt</kbd> +
            <kbd style="background: rgba(124, 58, 237, 0.1); padding: 4px 8px; border-radius: 4px;">N</kbd>
            <span style="color: var(--text-muted); font-size: 0.8rem;">åˆ‡æ¢å¯¼èˆª</span>
        </div>
    </div>
</nav>

<!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
<div class="progress-indicator">
    <span>å­¦ä¹ è¿›åº¦</span>
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>
    <span id="progressText">0%</span>
</div>

<!-- ä¸»å®¹å™¨ -->
<div class="container">
    <!-- æ ‡é¢˜éƒ¨åˆ† -->
    <div class="main-header fade-in">
        <h1 class="main-title">ç¬¬4ç« ï¼šKNNç®—æ³•</h1>
        <p class="subtitle">ğŸ¤– æœ€è¿‘é‚»çš„æ™ºæ…§ï¼Œæœ€ç›´è§‚çš„æœºå™¨å­¦ä¹ ç®—æ³•</p>
    </div>

    <!-- å¼•è¨€ï¼šä¸€ä¸ªç®€å•çš„é—®é¢˜ -->
    <div id="intro" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ¯ å¼•è¨€ï¼šä¸€ä¸ªç®€å•çš„é—®é¢˜</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” æ€è€ƒæ—¶åˆ»</h3>
            <p>å‡è®¾ä½ æ˜¯ä¸€ä¸ªæˆ¿åœ°äº§ä¸­ä»‹ï¼Œå®¢æˆ·é—®ä½ ï¼š"è¿™å¥—æˆ¿å­å€¼å¤šå°‘é’±ï¼Ÿ"</p>
            <p>ä½ ä¼šå¦‚ä½•å›ç­”ï¼Ÿä½ çš„åˆ¤æ–­ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ</p>
            <br>
            <p><strong>å¤§å¤šæ•°äººçš„ç›´è§‰åšæ³•ï¼š</strong></p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ  çœ‹çœ‹<span class="highlight-primary">å‘¨å›´ç±»ä¼¼æˆ¿å­</span>çš„ä»·æ ¼</li>
                <li>ğŸ“ æ¯”è¾ƒ<span class="highlight-success">é¢ç§¯ã€åœ°æ®µã€æˆ·å‹</span>ç­‰ç‰¹å¾</li>
                <li>ğŸ” æ‰¾åˆ°<span class="highlight-warning">æœ€ç›¸ä¼¼çš„å‡ å¥—</span>æˆ¿å­</li>
                <li>ğŸ’° å‚è€ƒå®ƒä»¬çš„ä»·æ ¼æ¥<span class="highlight-danger">ä¼°ç®—ç›®æ ‡æˆ¿ä»·</span></li>
            </ul>
            <br>
            <p><strong>æ­å–œä½ ï¼ä½ åˆšåˆšæè¿°äº†æœºå™¨å­¦ä¹ ä¸­ä¸€ä¸ªé‡è¦ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼</strong></p>
        </div>

        <div class="insight-box">
            <h4>ğŸ’¡ æ ¸å¿ƒæ´å¯Ÿ</h4>
            <p>äººç±»åœ¨å¤„ç†æœªçŸ¥é—®é¢˜æ—¶ï¼Œæ€»æ˜¯ä¹ æƒ¯æ€§åœ°å¯»æ‰¾<span class="highlight-primary">ç›¸ä¼¼çš„ç»éªŒ</span>ä½œä¸ºå‚è€ƒã€‚è¿™ç§æœ´ç´ è€Œæœ‰æ•ˆçš„æ€ç»´æ–¹å¼ï¼Œæ­£æ˜¯<span class="highlight-success">Kè¿‘é‚»ç®—æ³•ï¼ˆKNNï¼‰</span>çš„ç†è®ºåŸºç¡€ã€‚</p>
            <p>KNNå¯èƒ½æ˜¯<span class="highlight-warning">æœ€æ¥è¿‘äººç±»ç›´è§‰</span>çš„æœºå™¨å­¦ä¹ ç®—æ³•ã€‚å®ƒä¸éœ€è¦å¤æ‚çš„æ•°å­¦æ¨å¯¼ï¼Œä¸éœ€è¦å‡è®¾æ•°æ®åˆ†å¸ƒï¼Œåªéœ€è¦ä¸€ä¸ªç®€å•çš„ä¿¡å¿µï¼š<span class="highlight-danger">"ç›¸ä¼¼çš„äº‹ç‰©åº”è¯¥æœ‰ç›¸ä¼¼çš„æ ‡ç­¾"</span>ã€‚</p>
        </div>
    </div>

    <!-- 4.1 ä»€ä¹ˆæ˜¯KNNç®—æ³• -->
    <div id="what-is-knn" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ“– 4.1 ä»€ä¹ˆæ˜¯KNNç®—æ³•</h2>

        <div class="definition-box">
            <h4>ğŸ“– æ­£å¼å®šä¹‰</h4>
            <p><span class="highlight-primary">Kè¿‘é‚»ç®—æ³•ï¼ˆK-Nearest Neighborsï¼Œç®€ç§°KNNï¼‰</span>æ˜¯ä¸€ç§åŸºäº<span class="highlight-success">å®ä¾‹çš„æ‡’æƒ°å­¦ä¹ ç®—æ³•</span>ï¼Œå±äº<span class="highlight-warning">ç›‘ç£å­¦ä¹ </span>æ–¹æ³•ã€‚</p>
            <br>
            <p><strong>ç®—æ³•åŸç†ï¼š</strong>ç»™å®šä¸€ä¸ªå¾…åˆ†ç±»çš„æ ·æœ¬ï¼Œé€šè¿‡è®¡ç®—å®ƒä¸è®­ç»ƒé›†ä¸­æ‰€æœ‰æ ·æœ¬çš„<span class="highlight-danger">è·ç¦»</span>ï¼Œæ‰¾åˆ°è·ç¦»æœ€è¿‘çš„<span class="highlight-primary">Kä¸ªé‚»å±…</span>ï¼Œç„¶åæ ¹æ®è¿™Kä¸ªé‚»å±…çš„<span class="highlight-success">æ ‡ç­¾</span>æ¥é¢„æµ‹è¯¥æ ·æœ¬çš„ç±»åˆ«æˆ–æ•°å€¼ã€‚</p>
        </div>

        <div class="thinking-box">
            <h3>ğŸ¤” ä¸ºä»€ä¹ˆå«"æ‡’æƒ°å­¦ä¹ "ï¼Ÿ</h3>
            <p>æƒ³è±¡ä¸€ä¸ª"æ‡’æƒ°"çš„å­¦ç”Ÿï¼š</p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ“š å¹³æ—¶ä¸å­¦ä¹ ï¼Œä¸æ€»ç»“è§„å¾‹ï¼ˆ<span class="highlight-primary">æ²¡æœ‰è®­ç»ƒè¿‡ç¨‹</span>ï¼‰</li>
                <li>ğŸ“– åªæ˜¯æŠŠæ‰€æœ‰èµ„æ–™éƒ½è®°ä½ï¼ˆ<span class="highlight-success">å­˜å‚¨æ‰€æœ‰è®­ç»ƒæ•°æ®</span>ï¼‰</li>
                <li>â“ è€ƒè¯•æ—¶æ‰ä¸´æ—¶ç¿»ä¹¦æ‰¾ç­”æ¡ˆï¼ˆ<span class="highlight-warning">é¢„æµ‹æ—¶æ‰è®¡ç®—</span>ï¼‰</li>
            </ul>
            <p>è¿™å°±æ˜¯KNNçš„å·¥ä½œæ–¹å¼ï¼å®ƒä¸åƒå…¶ä»–ç®—æ³•é‚£æ ·æå‰å­¦ä¹ è§„å¾‹ï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰æ•°æ®éƒ½"è®°ä½"ï¼Œéœ€è¦é¢„æµ‹æ—¶æ‰å¼€å§‹"å·¥ä½œ"ã€‚</p>
        </div>

        <div class="mind-map">
            <div class="mind-node">
                <h4>ğŸ¯ ç®—æ³•ç‰¹ç‚¹</h4>
                <p><span class="highlight-primary">ç®€å•ç›´è§‚</span>ï¼šé€»è¾‘ç¬¦åˆäººç±»æ€ç»´</p>
                <p><span class="highlight-success">éå‚æ•°</span>ï¼šä¸å‡è®¾æ•°æ®åˆ†å¸ƒ</p>
                <p><span class="highlight-warning">å¤šç”¨é€”</span>ï¼šæ—¢èƒ½åˆ†ç±»åˆèƒ½å›å½’</p>
            </div>
            <div class="mind-node">
                <h4>âš¡ è®¡ç®—ç‰¹æ€§</h4>
                <p><span class="highlight-danger">æ‡’æƒ°å­¦ä¹ </span>ï¼šè®­ç»ƒæ—¶é—´ä¸ºO(1)</p>
                <p><span class="highlight-primary">é¢„æµ‹æˆæœ¬é«˜</span>ï¼šéœ€è¦è®¡ç®—æ‰€æœ‰è·ç¦»</p>
                <p><span class="highlight-success">å†…å­˜å¯†é›†</span>ï¼šå­˜å‚¨å…¨éƒ¨è®­ç»ƒæ•°æ®</p>
            </div>
            <div class="mind-node">
                <h4>ğŸ”§ å…³é”®å‚æ•°</h4>
                <p><span class="highlight-warning">Kå€¼</span>ï¼šé‚»å±…æ•°é‡</p>
                <p><span class="highlight-primary">è·ç¦»åº¦é‡</span>ï¼šç›¸ä¼¼æ€§è®¡ç®—æ–¹æ³•</p>
                <p><span class="highlight-danger">æƒé‡ç­–ç•¥</span>ï¼šé‚»å±…é‡è¦æ€§</p>
            </div>
        </div>

        <div class="history-box">
            <h3>ğŸ“œ å†å²èƒŒæ™¯ï¼šKNNçš„è¯ç”Ÿ</h3>
            <p><strong>1951å¹´</strong>ï¼šKNNç®—æ³•ç”±<span class="highlight-primary">Fix & Hodges</span>é¦–æ¬¡æå‡ºï¼Œæœ€åˆç”¨äº<span class="highlight-success">éå‚æ•°ç»Ÿè®¡</span>é¢†åŸŸã€‚</p>
            <p><strong>1967å¹´</strong>ï¼š<span class="highlight-warning">Cover & Hart</span>å‘è¡¨äº†è‘—åè®ºæ–‡ã€ŠNearest neighbor pattern classificationã€‹ï¼Œå¥ å®šäº†KNNçš„ç†è®ºåŸºç¡€ã€‚</p>
            <p><strong>æ ¸å¿ƒå‘ç°</strong>ï¼šå½“è®­ç»ƒæ ·æœ¬æ•°é‡è¶‹äºæ— ç©·å¤§æ—¶ï¼ŒKNNçš„é”™è¯¯ç‡ä¸ä¼šè¶…è¿‡<span class="highlight-danger">è´å¶æ–¯é”™è¯¯ç‡çš„2å€</span>ã€‚è¿™ä¸ªç†è®ºä¿è¯è®©KNNè·å¾—äº†å­¦æœ¯ç•Œçš„è®¤å¯ã€‚</p>
            <p><strong>ç°ä»£åº”ç”¨</strong>ï¼šéšç€è®¡ç®—èƒ½åŠ›çš„æå‡ï¼ŒKNNåœ¨<span class="highlight-primary">æ¨èç³»ç»Ÿ</span>ã€<span class="highlight-success">å›¾åƒè¯†åˆ«</span>ã€<span class="highlight-warning">æ–‡æœ¬åˆ†ç±»</span>ç­‰é¢†åŸŸå¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</p>
        </div>
    </div>

    <!-- 4.2 æ•°å­¦åŸºç¡€ -->
    <div id="math-foundation" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ§® 4.2 KNNçš„æ•°å­¦åŸºç¡€</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” æ•°å­¦æ€è€ƒ</h3>
            <p>åœ¨å­¦ä¹ æ•°å­¦å…¬å¼ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š</p>
            <p><strong>å¦‚ä½•é‡åŒ–"ç›¸ä¼¼æ€§"ï¼Ÿ</strong></p>
            <p>æ¯”å¦‚ï¼Œå¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªäººæ˜¯å¦ç›¸ä¼¼ï¼Ÿå¯èƒ½éœ€è¦æ¯”è¾ƒä»–ä»¬çš„ï¼šèº«é«˜ã€ä½“é‡ã€å¹´é¾„ã€æ”¶å…¥...</p>
            <p>åœ¨æ•°å­¦ä¸Šï¼Œæˆ‘ä»¬ç”¨<span class="highlight-primary">è·ç¦»</span>æ¥è¡¡é‡ç›¸ä¼¼æ€§ï¼šè·ç¦»è¶Šå°ï¼Œè¶Šç›¸ä¼¼ã€‚</p>
        </div>

        <div class="formula-box">
            <h4>ğŸ¯ KNNåˆ†ç±»ç®—æ³•</h4>
            <div class="math-formula">
                <span>Å· = argmax<sub>c</sub></span>
                <span style="font-size: 2rem; margin: 0 10px;">âˆ‘</span>
                <span style="position: relative; bottom: -15px; font-size: 0.8em;">iâˆˆN<sub>K</sub>(x)</span>
                <span style="margin-left: 20px;">w<sub>i</sub> Â· I(y<sub>i</sub> = c)</span>
            </div>
            <div class="formula-explanation">
                <p><strong>ä¸­æ–‡è§£é‡Šï¼š</strong>é¢„æµ‹ç±»åˆ« = è®© {Kä¸ªé‚»å±…ä¸­å±äºç±»åˆ«cçš„æƒé‡æ€»å’Œ} æœ€å¤§çš„é‚£ä¸ªç±»åˆ«c</p>
                <p><strong>ç¬¦å·è¯¦è§£ï¼š</strong></p>
                <p>â€¢ <span class="highlight-primary">Å·</span>ï¼šé¢„æµ‹çš„ç±»åˆ«æ ‡ç­¾</p>
                <p>â€¢ <span class="highlight-success">N<sub>K</sub>(x)</span>ï¼šæ ·æœ¬xçš„Kä¸ªæœ€è¿‘é‚»å±…é›†åˆ</p>
                <p>â€¢ <span class="highlight-warning">w<sub>i</sub></span>ï¼šç¬¬iä¸ªé‚»å±…çš„æŠ•ç¥¨æƒé‡</p>
                <p>â€¢ <span class="highlight-danger">I(y<sub>i</sub> = c)</span>ï¼šæŒ‡ç¤ºå‡½æ•°ï¼Œå½“ç¬¬iä¸ªé‚»å±…å±äºç±»åˆ«cæ—¶ä¸º1ï¼Œå¦åˆ™ä¸º0</p>
            </div>
        </div>

        <div class="formula-box">
            <h4>ğŸ“Š KNNå›å½’ç®—æ³•</h4>
            <div class="math-formula">
                <span>Å· = </span>
                <span class="fraction">
                    <span class="numerator">
                        <span style="font-size: 1.5rem;">âˆ‘</span>
                        <span style="position: relative; bottom: -10px; font-size: 0.8em;">iâˆˆN<sub>K</sub>(x)</span>
                        <span style="margin-left: 10px;">w<sub>i</sub> Â· y<sub>i</sub></span>
                    </span>
                    <span class="denominator">
                        <span style="font-size: 1.5rem;">âˆ‘</span>
                        <span style="position: relative; bottom: -10px; font-size: 0.8em;">iâˆˆN<sub>K</sub>(x)</span>
                        <span style="margin-left: 10px;">w<sub>i</sub></span>
                    </span>
                </span>
            </div>
            <div class="formula-explanation">
                <p><strong>ä¸­æ–‡è§£é‡Šï¼š</strong>é¢„æµ‹å€¼ = (Kä¸ªé‚»å±…çš„åŠ æƒæ ‡ç­¾å€¼ä¹‹å’Œ) Ã· (Kä¸ªé‚»å±…çš„æƒé‡ä¹‹å’Œ)</p>
                <p><strong>æœ¬è´¨ï¼š</strong>åŠ æƒå¹³å‡æ•°ï¼Œè·ç¦»è¶Šè¿‘çš„é‚»å±…å½±å“è¶Šå¤§</p>
            </div>
        </div>

        <div class="formula-box">
            <h4>âš–ï¸ æƒé‡è®¡ç®—å…¬å¼</h4>
            <div class="math-formula">
                <span>w<sub>i</sub> = </span>
                <span class="fraction">
                    <span class="numerator">1</span>
                    <span class="denominator">(d<sub>i</sub> + Îµ)<sup>p</sup></span>
                </span>
            </div>
            <div class="formula-explanation">
                <p><strong>ä¸­æ–‡è§£é‡Šï¼š</strong>ç¬¬iä¸ªé‚»å±…çš„æƒé‡ = 1 Ã· (è·ç¦»çš„pæ¬¡æ–¹)</p>
                <p>â€¢ <span class="highlight-primary">d<sub>i</sub></span>ï¼šç¬¬iä¸ªé‚»å±…ä¸æŸ¥è¯¢ç‚¹çš„è·ç¦»</p>
                <p>â€¢ <span class="highlight-success">Îµ</span>ï¼šæå°å¸¸æ•°ï¼ˆå¦‚1e-8ï¼‰ï¼Œé˜²æ­¢é™¤é›¶é”™è¯¯</p>
                <p>â€¢ <span class="highlight-warning">p</span>ï¼šå¹‚æ¬¡å‚æ•°ï¼Œæ§åˆ¶è·ç¦»è¡°å‡é€Ÿåº¦ï¼ˆé€šå¸¸p=1æˆ–p=2ï¼‰</p>
            </div>
        </div>

        <div class="insight-box">
            <h4>ğŸ’¡ æ•°å­¦æ´å¯Ÿ</h4>
            <p><strong>ä¸ºä»€ä¹ˆè¿™äº›å…¬å¼æœ‰æ•ˆï¼Ÿ</strong></p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li><span class="highlight-primary">è´å¶æ–¯è§‚ç‚¹</span>ï¼šKNNå®é™…ä¸Šæ˜¯åœ¨ä¼°è®¡æ¡ä»¶æ¦‚ç‡P(y|x)</li>
                <li><span class="highlight-success">ç»Ÿè®¡åŸç†</span>ï¼šå±€éƒ¨å¹³æ»‘å‡è®¾â€”â€”ç›¸è¿‘çš„ç‚¹æœ‰ç›¸ä¼¼çš„è¾“å‡º</li>
                <li><span class="highlight-warning">æ”¶æ•›æ€§è´¨</span>ï¼šæ ·æœ¬æ•°è¶‹äºæ— ç©·æ—¶ï¼ŒKNNæ”¶æ•›åˆ°è´å¶æ–¯æœ€ä¼˜åˆ†ç±»å™¨</li>
            </ul>
        </div>

        <div class="warning-box">
            <h4>âš ï¸ æ•°å­¦å±€é™æ€§ï¼šç»´æ•°ç¾éš¾</h4>
            <p>å½“ç‰¹å¾ç»´æ•°å¾ˆé«˜æ—¶ï¼ˆå¦‚d>10ï¼‰ï¼Œæ‰€æœ‰ç‚¹ä¹‹é—´çš„è·ç¦»è¶‹äºç›¸ç­‰ï¼ŒKNNç®—æ³•å¤±æ•ˆã€‚</p>
            <div class="math-formula">
                <span>lim</span>
                <span style="position: relative; bottom: -10px; font-size: 0.8em;">dâ†’âˆ</span>
                <span class="fraction" style="margin-left: 20px;">
                    <span class="numerator">d<sub>max</sub> - d<sub>min</sub></span>
                    <span class="denominator">d<sub>min</sub></span>
                </span>
                <span style="margin: 0 10px;">â†’</span>
                <span>0</span>
            </div>
            <p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé«˜ç»´æ•°æ®é€šå¸¸éœ€è¦<span class="highlight-warning">é™ç»´å¤„ç†</span>çš„åŸå› ã€‚</p>
        </div>
    </div>

    <!-- 4.3 è·ç¦»åº¦é‡æ–¹æ³• -->
    <div id="distance-metrics" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ“ 4.3 è·ç¦»åº¦é‡æ–¹æ³•</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” å‡ ä½•æ€ç»´å®éªŒ</h3>
            <p>æƒ³è±¡ä½ åœ¨ä¸€ä¸ªåŸå¸‚ä¸­ï¼Œè¦ä»ç‚¹Aåˆ°ç‚¹Bï¼Œæœ‰å‡ ç§èµ°æ³•ï¼Ÿ</p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ›©ï¸ <span class="highlight-success">ç›´çº¿é£è¡Œ</span>ï¼šæœ€çŸ­è·ç¦»ï¼ˆæ¬§å¼è·ç¦»ï¼‰</li>
                <li>ğŸš— <span class="highlight-primary">æ²¿è¡—é“è¡Œé©¶</span>ï¼šåªèƒ½å‚ç›´æ°´å¹³ç§»åŠ¨ï¼ˆæ›¼å“ˆé¡¿è·ç¦»ï¼‰</li>
                <li>â™” <span class="highlight-warning">å›½ç‹çš„èµ°æ³•</span>ï¼šå¯ä»¥æ–œå‘ç§»åŠ¨ï¼ˆåˆ‡æ¯”é›ªå¤«è·ç¦»ï¼‰</li>
            </ul>
            <p>ä¸åŒçš„"äº¤é€šè§„åˆ™"å¯¹åº”ä¸åŒçš„è·ç¦»åº¦é‡æ–¹æ³•ï¼</p>
        </div>

        <div class="formula-box">
            <h4>ğŸ“ æ¬§å¼è·ç¦»ï¼ˆEuclidean Distanceï¼‰</h4>
            <div class="math-formula">
                <span>d(x, y) = </span>
                <span class="sqrt">
                    <span class="sqrt-content">
                        <span style="font-size: 1.5rem;">âˆ‘</span>
                        <span style="position: relative; bottom: -10px; font-size: 0.8em;">i=1</span>
                        <sup style="position: relative; top: -15px; left: -5px;">n</sup>
                        <span style="margin-left: 10px;">(x<sub>i</sub> - y<sub>i</sub>)<sup>2</sup></span>
                    </span>
                </span>
            </div>
            <div class="formula-explanation">
                <p><strong>å‡ ä½•æ„ä¹‰ï¼š</strong>è¿æ¥ä¸¤ç‚¹çš„<span class="highlight-primary">ç›´çº¿è·ç¦»</span></p>
                <p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong>è¿ç»­ç‰¹å¾ã€åœ°ç†åæ ‡ã€å›¾åƒåƒç´ </p>
                <p><strong>æ•°å­¦æ€§è´¨ï¼š</strong>æ»¡è¶³ä¸‰è§’ä¸ç­‰å¼ï¼Œæ—‹è½¬ä¸å˜æ€§</p>
            </div>
        </div>

        <div class="formula-box">
            <h4>ğŸ™ï¸ æ›¼å“ˆé¡¿è·ç¦»ï¼ˆManhattan Distanceï¼‰</h4>
            <div class="math-formula">
                <span>d(x, y) = </span>
                <span style="font-size: 1.5rem;">âˆ‘</span>
                <span style="position: relative; bottom: -10px; font-size: 0.8em;">i=1</span>
                <sup style="position: relative; top: -15px; left: -5px;">n</sup>
                <span style="margin-left: 10px;">|x<sub>i</sub> - y<sub>i</sub>|</span>
            </div>
            <div class="formula-explanation">
                <p><strong>å‡ ä½•æ„ä¹‰ï¼š</strong>æ²¿åæ ‡è½´æ–¹å‘çš„<span class="highlight-success">æ€»è·¯ç¨‹</span></p>
                <p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong>ç½‘æ ¼æ•°æ®ã€é«˜ç»´ç¨€ç–æ•°æ®ã€å¯¹å¼‚å¸¸å€¼é²æ£’</p>
                <p><strong>åˆ«åï¼š</strong>L1è·ç¦»ã€å‡ºç§Ÿè½¦è·ç¦»</p>
            </div>
        </div>

        <div class="formula-box">
            <h4>â™” åˆ‡æ¯”é›ªå¤«è·ç¦»ï¼ˆChebyshev Distanceï¼‰</h4>
            <div class="math-formula">
                <span>d(x, y) = max<sub>i</sub> |x<sub>i</sub> - y<sub>i</sub>|</span>
            </div>
            <div class="formula-explanation">
                <p><strong>å‡ ä½•æ„ä¹‰ï¼š</strong>å„ç»´åº¦å·®å¼‚çš„<span class="highlight-warning">æœ€å¤§å€¼</span></p>
                <p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong>è±¡æ£‹æ¸¸æˆã€å›¾åƒå¤„ç†ã€å…³æ³¨æœ€å¤§å·®å¼‚</p>
                <p><strong>åˆ«åï¼š</strong>Lâˆè·ç¦»ã€å›½ç‹è·ç¦»</p>
            </div>
        </div>

        <div class="formula-box">
            <h4>ğŸ”§ é—µå¯å¤«æ–¯åŸºè·ç¦»ï¼ˆMinkowski Distanceï¼‰</h4>
            <div class="math-formula">
                <span>d(x, y) = </span>
                <span style="font-size: 1.5rem;">[</span>
                <span style="font-size: 1.5rem;">âˆ‘</span>
                <span style="position: relative; bottom: -10px; font-size: 0.8em;">i=1</span>
                <sup style="position: relative; top: -15px; left: -5px;">n</sup>
                <span style="margin-left: 10px;">|x<sub>i</sub> - y<sub>i</sub>|<sup>p</sup></span>
                <span style="font-size: 1.5rem;">]</span>
                <sup style="font-size: 0.8em;">1/p</sup>
            </div>
            <div class="formula-explanation">
                <p><strong>ç»Ÿä¸€æ¡†æ¶ï¼š</strong>é€šè¿‡å‚æ•°pæ§åˆ¶è·ç¦»ç±»å‹</p>
                <p>â€¢ <span class="highlight-primary">p=1</span>: æ›¼å“ˆé¡¿è·ç¦»</p>
                <p>â€¢ <span class="highlight-success">p=2</span>: æ¬§å¼è·ç¦»</p>
                <p>â€¢ <span class="highlight-warning">pâ†’âˆ</span>: åˆ‡æ¯”é›ªå¤«è·ç¦»</p>
            </div>
        </div>

        <!-- è·ç¦»åº¦é‡å¯è§†åŒ–æ¼”ç¤º -->
        <div class="demo-container">
            <h3>ğŸ® è·ç¦»å¯è§†åŒ–æ¼”ç¤º</h3>
            <canvas id="distanceDemo" class="demo-canvas" width="800" height="400"></canvas>
            <div class="demo-controls">
                <select id="distanceSelect" class="demo-btn" onchange="changeDistance()">
                    <option value="euclidean">æ¬§å¼è·ç¦»</option>
                    <option value="manhattan">æ›¼å“ˆé¡¿è·ç¦»</option>
                    <option value="chebyshev">åˆ‡æ¯”é›ªå¤«è·ç¦»</option>
                </select>
                <button class="demo-btn" onclick="resetDistance()">é‡ç½®ä½ç½®</button>
                <button class="demo-btn" onclick="animateDistance()">åŠ¨ç”»æ¼”ç¤º</button>
            </div>
            <p style="text-align: center; margin-top: 15px; color: var(--text-secondary);">
                ğŸ’¡ æ‹–åŠ¨è“è‰²ç‚¹ï¼Œè§‚å¯Ÿä¸åŒè·ç¦»åº¦é‡çš„<span class="highlight-primary">ç­‰è·ç¦»çº¿</span>å½¢çŠ¶å˜åŒ–ï¼
            </p>
            <div id="distanceResult" style="margin-top: 15px; font-size: 1.1rem; font-weight: bold; text-align: center;"></div>
        </div>

        <div class="insight-box">
            <h4>ğŸ’¡ è·ç¦»é€‰æ‹©æŒ‡å—</h4>
            <table class="data-table">
                <thead>
                <tr>
                    <th>æ•°æ®ç‰¹ç‚¹</th>
                    <th>æ¨èè·ç¦»</th>
                    <th>åŸå› </th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>è¿ç»­æ•°å€¼ç‰¹å¾</td>
                    <td><span class="highlight-success">æ¬§å¼è·ç¦»</span></td>
                    <td>ç¬¦åˆå‡ ä½•ç›´è§‰ï¼Œæ•°å­¦æ€§è´¨å¥½</td>
                </tr>
                <tr>
                    <td>é«˜ç»´ç¨€ç–æ•°æ®</td>
                    <td><span class="highlight-primary">æ›¼å“ˆé¡¿è·ç¦»</span></td>
                    <td>å¯¹å¼‚å¸¸å€¼é²æ£’ï¼Œè®¡ç®—æ•ˆç‡é«˜</td>
                </tr>
                <tr>
                    <td>å…³æ³¨æœ€å¤§å·®å¼‚</td>
                    <td><span class="highlight-warning">åˆ‡æ¯”é›ªå¤«è·ç¦»</span></td>
                    <td>çªå‡ºä¸»å¯¼ç‰¹å¾çš„å½±å“</td>
                </tr>
                <tr>
                    <td>äºŒå…ƒç‰¹å¾</td>
                    <td><span class="highlight-danger">æ±‰æ˜è·ç¦»</span></td>
                    <td>ä¸“é—¨å¤„ç†0/1ç‰¹å¾</td>
                </tr>
                <tr>
                    <td>æ–‡æœ¬å‘é‡</td>
                    <td><span class="highlight-primary">ä½™å¼¦è·ç¦»</span></td>
                    <td>å…³æ³¨æ–¹å‘è€Œéé•¿åº¦</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="code-block">
            <pre><code><span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">from</span> scipy.spatial.distance <span class="keyword">import</span> cdist

<span class="keyword">class</span> <span class="function">DistanceMetrics</span>:
    <span class="string">"""å„ç§è·ç¦»åº¦é‡çš„å®ç°"""</span>

    @staticmethod
    <span class="keyword">def</span> <span class="function">euclidean</span>(x, y):
        <span class="string">"""æ¬§å¼è·ç¦»"""</span>
        <span class="keyword">return</span> np.sqrt(np.sum((x - y) ** <span class="number">2</span>))

    @staticmethod
    <span class="keyword">def</span> <span class="function">manhattan</span>(x, y):
        <span class="string">"""æ›¼å“ˆé¡¿è·ç¦»"""</span>
        <span class="keyword">return</span> np.sum(np.abs(x - y))

    @staticmethod
    <span class="keyword">def</span> <span class="function">chebyshev</span>(x, y):
        <span class="string">"""åˆ‡æ¯”é›ªå¤«è·ç¦»"""</span>
        <span class="keyword">return</span> np.max(np.abs(x - y))

    @staticmethod
    <span class="keyword">def</span> <span class="function">minkowski</span>(x, y, p=<span class="number">2</span>):
        <span class="string">"""é—µå¯å¤«æ–¯åŸºè·ç¦»"""</span>
        <span class="keyword">return</span> np.sum(np.abs(x - y) ** p) ** (<span class="number">1</span>/p)

    @staticmethod
    <span class="keyword">def</span> <span class="function">cosine</span>(x, y):
        <span class="string">"""ä½™å¼¦è·ç¦»"""</span>
        dot_product = np.dot(x, y)
        norm_x = np.linalg.norm(x)
        norm_y = np.linalg.norm(y)
        similarity = dot_product / (norm_x * norm_y)
        <span class="keyword">return</span> <span class="number">1</span> - similarity  <span class="comment"># è½¬æ¢ä¸ºè·ç¦»</span>

    @staticmethod
    <span class="keyword">def</span> <span class="function">hamming</span>(x, y):
        <span class="string">"""æ±‰æ˜è·ç¦»ï¼ˆç”¨äºäºŒè¿›åˆ¶ç‰¹å¾ï¼‰"""</span>
        <span class="keyword">return</span> np.sum(x != y)

<span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span>
x = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])
y = np.array([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])

metrics = DistanceMetrics()
print(f<span class="string">"æ¬§å¼è·ç¦»: {metrics.euclidean(x, y):.2f}"</span>)
print(f<span class="string">"æ›¼å“ˆé¡¿è·ç¦»: {metrics.manhattan(x, y):.2f}"</span>)
print(f<span class="string">"åˆ‡æ¯”é›ªå¤«è·ç¦»: {metrics.chebyshev(x, y):.2f}"</span>)</code></pre>
        </div>
    </div>

    <!-- 4.4 ç®—æ³•è¯¦ç»†æ­¥éª¤ -->
    <div id="algorithm-steps" class="section-card fade-in section-anchor">
        <h2 class="section-title">âš™ï¸ 4.4 KNNç®—æ³•è¯¦ç»†æ­¥éª¤</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” ç®—æ³•è®¾è®¡æ€è€ƒ</h3>
            <p><strong>å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ª"æ‰¾ç›¸ä¼¼æ ·æœ¬"çš„ç®—æ³•ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</strong></p>
            <p>è¯•ç€æŠŠè¿™ä¸ªè¿‡ç¨‹åˆ†è§£æˆå‡ ä¸ªå…·ä½“æ­¥éª¤...</p>
            <p>æ€è€ƒå®Œå†çœ‹ä¸‹é¢çš„æ ‡å‡†ç­”æ¡ˆï¼</p>
        </div>

        <div class="steps-container">
            <div class="step">
                <div class="step-number">1</div>
                <h4>è·ç¦»è®¡ç®—</h4>
                <p>è®¡ç®—æŸ¥è¯¢æ ·æœ¬xä¸è®­ç»ƒé›†ä¸­<span class="highlight-primary">æ¯ä¸ªæ ·æœ¬</span>çš„è·ç¦»</p>
                <div style="background: rgba(124, 58, 237, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px;">
                    D = {d(x, x<sub>i</sub>) | i = 1, 2, ..., n}
                </div>
                <p style="margin-top: 10px;">æ—¶é—´å¤æ‚åº¦ï¼š<span class="highlight-warning">O(nd)</span></p>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <h4>æ’åºé€‰æ‹©</h4>
                <p>å¯¹è·ç¦»è¿›è¡Œ<span class="highlight-success">æ’åº</span>ï¼Œé€‰æ‹©æœ€å°çš„Kä¸ª</p>
                <div style="background: rgba(124, 58, 237, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px;">
                    N<sub>K</sub> = {x<sub>i</sub> | rank(d(x, x<sub>i</sub>)) â‰¤ K}
                </div>
                <p style="margin-top: 10px;">æ—¶é—´å¤æ‚åº¦ï¼š<span class="highlight-warning">O(n log n)</span></p>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <h4>æƒé‡è®¡ç®—</h4>
                <p>è®¡ç®—æ¯ä¸ªé‚»å±…çš„<span class="highlight-danger">å½±å“æƒé‡</span></p>
                <div style="background: rgba(124, 58, 237, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px;">
                    w<sub>i</sub> = f(d<sub>i</sub>)
                </div>
                <p style="margin-top: 10px;">å¸¸è§ç­–ç•¥ï¼šuniformã€distance</p>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <h4>é¢„æµ‹è¾“å‡º</h4>
                <p>æ ¹æ®é‚»å±…æ ‡ç­¾å’Œæƒé‡è®¡ç®—<span class="highlight-primary">æœ€ç»ˆé¢„æµ‹</span></p>
                <div style="background: rgba(124, 58, 237, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px;">
                    Å· = aggregate(y<sub>i</sub>, w<sub>i</sub>)
                </div>
                <p style="margin-top: 10px;">åˆ†ç±»ï¼šåŠ æƒæŠ•ç¥¨ï¼›å›å½’ï¼šåŠ æƒå¹³å‡</p>
            </div>
        </div>

        <!-- KNNç®—æ³•æ¼”ç¤º -->
        <div class="demo-container">
            <h3>ğŸ® KNNç®—æ³•æ¼”ç¤º</h3>
            <canvas id="knnDemo" class="demo-canvas" width="800" height="500"></canvas>
            <div class="demo-controls">
                <button class="demo-btn" onclick="changeK(3)">K=3</button>
                <button class="demo-btn" onclick="changeK(5)">K=5</button>
                <button class="demo-btn" onclick="changeK(7)">K=7</button>
                <button class="demo-btn" onclick="changeK(9)">K=9</button>
                <button class="demo-btn" onclick="generateNewData()">ç”Ÿæˆæ–°æ•°æ®</button>
                <button class="demo-btn" onclick="clearQuery()">æ¸…é™¤æŸ¥è¯¢ç‚¹</button>
                <button class="demo-btn" onclick="toggleAnimation()">åŠ¨ç”»æ¼”ç¤º</button>
            </div>
            <p style="text-align: center; margin-top: 15px; color: var(--text-secondary);">
                ğŸ’¡ <span class="highlight-primary">ç‚¹å‡»ç”»å¸ƒ</span>æ·»åŠ æŸ¥è¯¢ç‚¹ï¼Œè§‚å¯ŸKNNåˆ†ç±»è¿‡ç¨‹å’ŒKå€¼å½±å“ï¼
            </p>
            <div id="knnResult" style="margin-top: 15px; font-size: 1.1rem; font-weight: bold; text-align: center;"></div>
        </div>

        <div class="code-block">
            <pre><code><span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">from</span> collections <span class="keyword">import</span> Counter

<span class="keyword">class</span> <span class="function">KNNClassifier</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self, k=<span class="number">3</span>, distance=<span class="string">'euclidean'</span>, weights=<span class="string">'uniform'</span>):
        <span class="string">"""
        åˆå§‹åŒ–KNNåˆ†ç±»å™¨
        å‚æ•°:
            k: è¿‘é‚»æ•°é‡
            distance: è·ç¦»åº¦é‡ ['euclidean', 'manhattan', 'chebyshev']
            weights: æƒé‡ç­–ç•¥ ['uniform', 'distance']
        """</span>
        self.k = k
        self.distance = distance
        self.weights = weights

    <span class="keyword">def</span> <span class="function">fit</span>(self, X, y):
        <span class="string">"""è®­ç»ƒKNNæ¨¡å‹ï¼ˆå®é™…ä¸Šåªæ˜¯å­˜å‚¨æ•°æ®ï¼‰"""</span>
        self.X_train = np.array(X)
        self.y_train = np.array(y)
        self.n_samples, self.n_features = self.X_train.shape

    <span class="keyword">def</span> <span class="function">_calculate_distance</span>(self, x1, x2):
        <span class="string">"""è®¡ç®—ä¸¤ç‚¹é—´è·ç¦»"""</span>
        <span class="keyword">if</span> self.distance == <span class="string">'euclidean'</span>:
            <span class="keyword">return</span> np.sqrt(np.sum((x1 - x2) ** <span class="number">2</span>))
        <span class="keyword">elif</span> self.distance == <span class="string">'manhattan'</span>:
            <span class="keyword">return</span> np.sum(np.abs(x1 - x2))
        <span class="keyword">elif</span> self.distance == <span class="string">'chebyshev'</span>:
            <span class="keyword">return</span> np.max(np.abs(x1 - x2))

    <span class="keyword">def</span> <span class="function">_get_neighbors</span>(self, x):
        <span class="string">"""æ‰¾åˆ°kä¸ªæœ€è¿‘é‚»"""</span>
        <span class="comment"># è®¡ç®—æŸ¥è¯¢ç‚¹åˆ°æ‰€æœ‰è®­ç»ƒç‚¹çš„è·ç¦»</span>
        distances = []
        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.n_samples):
            dist = self._calculate_distance(x, self.X_train[i])
            distances.append((dist, i))

        <span class="comment"># æŒ‰è·ç¦»æ’åºå¹¶é€‰æ‹©kä¸ªæœ€è¿‘çš„</span>
        distances.sort(key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>])
        neighbors = []
        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.k):
            neighbors.append(distances[i])

        <span class="keyword">return</span> neighbors

    <span class="keyword">def</span> <span class="function">predict</span>(self, X):
        <span class="string">"""é¢„æµ‹æ–°æ ·æœ¬çš„ç±»åˆ«"""</span>
        X = np.array(X)
        predictions = []

        <span class="keyword">for</span> x <span class="keyword">in</span> X:
            <span class="comment"># è·å–kä¸ªæœ€è¿‘é‚»</span>
            neighbors = self._get_neighbors(x)

            <span class="comment"># æ ¹æ®æƒé‡ç­–ç•¥è¿›è¡ŒæŠ•ç¥¨</span>
            <span class="keyword">if</span> self.weights == <span class="string">'uniform'</span>:
                <span class="comment"># ç­‰æƒé‡æŠ•ç¥¨</span>
                labels = [self.y_train[idx] <span class="keyword">for</span> _, idx <span class="keyword">in</span> neighbors]
                prediction = Counter(labels).most_common(<span class="number">1</span>)[<span class="number">0</span>][<span class="number">0</span>]
            <span class="keyword">else</span>:  <span class="comment"># distance weighting</span>
                <span class="comment"># è·ç¦»åŠ æƒæŠ•ç¥¨</span>
                class_votes = {}
                <span class="keyword">for</span> dist, idx <span class="keyword">in</span> neighbors:
                    label = self.y_train[idx]
                    weight = <span class="number">1</span> / (dist + <span class="number">1e-8</span>)  <span class="comment"># é¿å…é™¤é›¶</span>
                    <span class="keyword">if</span> label <span class="keyword">in</span> class_votes:
                        class_votes[label] += weight
                    <span class="keyword">else</span>:
                        class_votes[label] = weight

                prediction = max(class_votes, key=class_votes.get)

            predictions.append(prediction)

        <span class="keyword">return</span> np.array(predictions)

    <span class="keyword">def</span> <span class="function">score</span>(self, X, y):
        <span class="string">"""è®¡ç®—åˆ†ç±»å‡†ç¡®ç‡"""</span>
        predictions = self.predict(X)
        <span class="keyword">return</span> np.mean(predictions == y)

<span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_classification
<span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split

<span class="comment"># ç”Ÿæˆç¤ºä¾‹æ•°æ®</span>
X, y = make_classification(n_samples=<span class="number">200</span>, n_features=<span class="number">2</span>,
                          n_redundant=<span class="number">0</span>, n_informative=<span class="number">2</span>,
                          n_clusters_per_class=<span class="number">1</span>, random_state=<span class="number">42</span>)

<span class="comment"># åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span>
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="number">0.3</span>, random_state=<span class="number">42</span>)

<span class="comment"># åˆ›å»ºå¹¶è®­ç»ƒæ¨¡å‹</span>
knn = KNNClassifier(k=<span class="number">5</span>, distance=<span class="string">'euclidean'</span>, weights=<span class="string">'distance'</span>)
knn.fit(X_train, y_train)

<span class="comment"># è¯„ä¼°æ¨¡å‹</span>
accuracy = knn.score(X_test, y_test)
print(f<span class="string">"æµ‹è¯•é›†å‡†ç¡®ç‡: {accuracy:.2%}"</span>)</code></pre>
        </div>

        <div class="warning-box">
            <h4>âš ï¸ ç®—æ³•å¤æ‚åº¦åˆ†æ</h4>
            <ul style="margin-left: 20px; line-height: 2;">
                <li><span class="highlight-primary">è®­ç»ƒæ—¶é—´å¤æ‚åº¦</span>ï¼šO(1) - åªæ˜¯å­˜å‚¨æ•°æ®</li>
                <li><span class="highlight-success">é¢„æµ‹æ—¶é—´å¤æ‚åº¦</span>ï¼šO(nd) - éœ€è¦è®¡ç®—æ‰€æœ‰è·ç¦»</li>
                <li><span class="highlight-warning">ç©ºé—´å¤æ‚åº¦</span>ï¼šO(nd) - å­˜å‚¨å…¨éƒ¨è®­ç»ƒæ•°æ®</li>
                <li><span class="highlight-danger">ä¼˜åŒ–æ–¹æ³•</span>ï¼šKDæ ‘ã€Ballæ ‘ã€LSHç­‰åŠ é€Ÿç»“æ„</li>
            </ul>
        </div>
    </div>

    <!-- 4.5 æ•°æ®é¢„å¤„ç† -->
    <div id="data-preprocessing" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ“Š 4.5 æ•°æ®é¢„å¤„ç†çš„é‡è¦æ€§</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜</h3>
            <p>è€ƒè™‘è¿™æ ·ä¸€ä¸ªæ•°æ®é›†ï¼š</p>
            <table class="data-table" style="margin: 20px 0;">
                <thead>
                <tr>
                    <th>æ ·æœ¬</th>
                    <th>å¹´é¾„ï¼ˆå²ï¼‰</th>
                    <th>æ”¶å…¥ï¼ˆå…ƒï¼‰</th>
                    <th>ç±»åˆ«</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>A</td>
                    <td>25</td>
                    <td>50000</td>
                    <td>å¹´è½»ç™½é¢†</td>
                </tr>
                <tr>
                    <td>B</td>
                    <td>35</td>
                    <td>80000</td>
                    <td>ä¸­å¹´ç®¡ç†</td>
                </tr>
                <tr>
                    <td>C</td>
                    <td>45</td>
                    <td>120000</td>
                    <td>é«˜çº§ä¸“å®¶</td>
                </tr>
                </tbody>
            </table>
            <p><strong>é—®é¢˜ï¼š</strong>å¦‚æœç›´æ¥ç”¨æ¬§å¼è·ç¦»è®¡ç®—Aå’ŒBçš„ç›¸ä¼¼æ€§ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
            <div style="background: rgba(239, 68, 68, 0.1); padding: 20px; border-radius: 10px; margin-top: 20px;">
                <p style="text-align: center; font-size: 1.2rem;">
                    d(A,B) = âˆš[(25-35)Â² + (50000-80000)Â²] â‰ˆ 30,000
                </p>
                <p style="text-align: center; margin-top: 10px;">
                    <span class="highlight-danger">æ”¶å…¥å·®å¼‚å®Œå…¨ä¸»å¯¼äº†è·ç¦»è®¡ç®—ï¼</span>å¹´é¾„çš„10å²å·®å¼‚è¢«3ä¸‡çš„æ”¶å…¥å·®å¼‚å®Œå…¨æ©ç›–ã€‚
                </p>
            </div>
        </div>

        <div class="warning-box">
            <h4>âš ï¸ ç‰¹å¾å°ºåº¦é—®é¢˜</h4>
            <p>KNNç®—æ³•å¯¹<span class="highlight-primary">ç‰¹å¾å°ºåº¦æå…¶æ•æ„Ÿ</span>ã€‚ä¸åŒç‰¹å¾çš„é‡çº²å·®å¼‚ä¼šå¯¼è‡´ï¼š</p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ¯ å¤§æ•°å€¼ç‰¹å¾ä¸»å¯¼è·ç¦»è®¡ç®—</li>
                <li>ğŸ¯ å°æ•°å€¼ç‰¹å¾è¢«å¿½ç•¥</li>
                <li>ğŸ¯ ç®—æ³•æ€§èƒ½ä¸¥é‡ä¸‹é™</li>
            </ul>
            <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong>æ•°æ®é¢„å¤„ç†æ˜¯KNNæˆåŠŸçš„<span class="highlight-warning">å¿…è¦æ¡ä»¶</span>ï¼</p>
        </div>

        <div class="mind-map">
            <div class="mind-node">
                <h4>ğŸ“ å½’ä¸€åŒ–</h4>
                <p>å°†æ•°æ®ç¼©æ”¾åˆ°<span class="highlight-primary">[0,1]</span>æˆ–<span class="highlight-success">[-1,1]</span></p>
                <p>ä¿æŒ<span class="highlight-warning">åŸå§‹åˆ†å¸ƒå½¢çŠ¶</span></p>
                <p>å¯¹<span class="highlight-danger">å¼‚å¸¸å€¼æ•æ„Ÿ</span></p>
            </div>
            <div class="mind-node">
                <h4>ğŸ“Š æ ‡å‡†åŒ–</h4>
                <p><span class="highlight-primary">å‡å€¼=0</span>ï¼Œ<span class="highlight-success">æ ‡å‡†å·®=1</span></p>
                <p>å…³æ³¨<span class="highlight-warning">ç»Ÿè®¡åˆ†å¸ƒ</span></p>
                <p>å¯¹å¼‚å¸¸å€¼<span class="highlight-danger">ç›¸å¯¹é²æ£’</span></p>
            </div>
            <div class="mind-node">
                <h4>ğŸ”§ ç‰¹å¾å·¥ç¨‹</h4>
                <p><span class="highlight-primary">ç‹¬çƒ­ç¼–ç </span>å¤„ç†åˆ†ç±»å˜é‡</p>
                <p><span class="highlight-success">ç‰¹å¾é€‰æ‹©</span>å‡å°‘å™ªå£°</p>
                <p><span class="highlight-warning">é™ç»´æŠ€æœ¯</span>å¯¹æŠ—ç»´æ•°ç¾éš¾</p>
            </div>
        </div>

        <div class="formula-box">
            <h4>ğŸ“ Min-Maxå½’ä¸€åŒ–</h4>
            <div class="math-formula">
                <span>x' = </span>
                <span class="fraction">
                    <span class="numerator">x - min(X)</span>
                    <span class="denominator">max(X) - min(X)</span>
                </span>
            </div>
            <div class="formula-explanation">
                <p><strong>æ•ˆæœï¼š</strong>å°†æ•°æ®çº¿æ€§æ˜ å°„åˆ°[0,1]åŒºé—´</p>
                <p><strong>ä¼˜ç‚¹ï¼š</strong>ä¿æŒåŸå§‹åˆ†å¸ƒå½¢çŠ¶ï¼Œæ˜“äºç†è§£</p>
                <p><strong>ç¼ºç‚¹ï¼š</strong>å¯¹å¼‚å¸¸å€¼æ•æ„Ÿï¼Œæ–°æ•°æ®å¯èƒ½è¶…å‡º[0,1]</p>
            </div>
        </div>

        <div class="formula-box">
            <h4>ğŸ“Š Z-scoreæ ‡å‡†åŒ–</h4>
            <div class="math-formula">
                <span>x' = </span>
                <span class="fraction">
                    <span class="numerator">x - Î¼</span>
                    <span class="denominator">Ïƒ</span>
                </span>
            </div>
            <div class="formula-explanation">
                <p>å…¶ä¸­ <span class="highlight-primary">Î¼</span> æ˜¯å‡å€¼ï¼Œ<span class="highlight-success">Ïƒ</span> æ˜¯æ ‡å‡†å·®</p>
                <p><strong>æ•ˆæœï¼š</strong>è½¬æ¢ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒï¼ˆå‡å€¼=0ï¼Œæ ‡å‡†å·®=1ï¼‰</p>
                <p><strong>ä¼˜ç‚¹ï¼š</strong>å¯¹å¼‚å¸¸å€¼ç›¸å¯¹é²æ£’ï¼Œç†è®ºåŸºç¡€æ‰å®</p>
                <p><strong>ç¼ºç‚¹ï¼š</strong>ä¸ä¿è¯æ•°æ®åœ¨å›ºå®šèŒƒå›´å†…</p>
            </div>
        </div>

        <!-- é¢„å¤„ç†æ•ˆæœå¯è§†åŒ– -->
        <div class="demo-container">
            <h3>ğŸ® æ•°æ®é¢„å¤„ç†æ•ˆæœæ¼”ç¤º</h3>
            <canvas id="preprocessDemo" class="demo-canvas" width="800" height="400"></canvas>
            <div class="demo-controls">
                <button class="demo-btn" onclick="showOriginalData()">åŸå§‹æ•°æ®</button>
                <button class="demo-btn" onclick="showNormalizedData()">å½’ä¸€åŒ–å</button>
                <button class="demo-btn" onclick="showStandardizedData()">æ ‡å‡†åŒ–å</button>
                <button class="demo-btn" onclick="animatePreprocess()">åŠ¨ç”»å¯¹æ¯”</button>
            </div>
            <p style="text-align: center; margin-top: 15px; color: var(--text-secondary);">
                ğŸ’¡ è§‚å¯Ÿä¸åŒé¢„å¤„ç†æ–¹æ³•å¯¹<span class="highlight-primary">ç‰¹å¾åˆ†å¸ƒ</span>å’Œ<span class="highlight-success">KNNå†³ç­–è¾¹ç•Œ</span>çš„å½±å“ï¼
            </p>
        </div>

        <div class="code-block">
            <pre><code><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler, StandardScaler, RobustScaler
<span class="keyword">from</span> sklearn.compose <span class="keyword">import</span> ColumnTransformer
<span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> OneHotEncoder
<span class="keyword">import</span> pandas <span class="keyword">as</span> pd
<span class="keyword">import</span> numpy <span class="keyword">as</span> np

<span class="keyword">class</span> <span class="function">DataPreprocessor</span>:
    <span class="string">"""KNNæ•°æ®é¢„å¤„ç†ç®¡é“"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, numeric_features, categorical_features, scaling_method=<span class="string">'standard'</span>):
        self.numeric_features = numeric_features
        self.categorical_features = categorical_features
        self.scaling_method = scaling_method
        self.preprocessor = <span class="keyword">None</span>

    <span class="keyword">def</span> <span class="function">create_preprocessor</span>(self):
        <span class="string">"""åˆ›å»ºé¢„å¤„ç†ç®¡é“"""</span>
        <span class="comment"># é€‰æ‹©æ•°å€¼ç‰¹å¾çš„ç¼©æ”¾æ–¹æ³•</span>
        <span class="keyword">if</span> self.scaling_method == <span class="string">'minmax'</span>:
            numeric_transformer = MinMaxScaler()
        <span class="keyword">elif</span> self.scaling_method == <span class="string">'standard'</span>:
            numeric_transformer = StandardScaler()
        <span class="keyword">elif</span> self.scaling_method == <span class="string">'robust'</span>:
            numeric_transformer = RobustScaler()  <span class="comment"># å¯¹å¼‚å¸¸å€¼æ›´é²æ£’</span>

        <span class="comment"># åˆ†ç±»ç‰¹å¾ç¼–ç </span>
        categorical_transformer = OneHotEncoder(drop=<span class="string">'first'</span>, sparse=<span class="keyword">False</span>)

        <span class="comment"># ç»„åˆé¢„å¤„ç†æ­¥éª¤</span>
        self.preprocessor = ColumnTransformer(
            transformers=[
                (<span class="string">'num'</span>, numeric_transformer, self.numeric_features),
                (<span class="string">'cat'</span>, categorical_transformer, self.categorical_features)
            ])

        <span class="keyword">return</span> self.preprocessor

    <span class="keyword">def</span> <span class="function">fit_transform</span>(self, X):
        <span class="string">"""æ‹Ÿåˆå¹¶è½¬æ¢æ•°æ®"""</span>
        <span class="keyword">if</span> self.preprocessor <span class="keyword">is</span> <span class="keyword">None</span>:
            self.create_preprocessor()
        <span class="keyword">return</span> self.preprocessor.fit_transform(X)

    <span class="keyword">def</span> <span class="function">transform</span>(self, X):
        <span class="string">"""è½¬æ¢æ–°æ•°æ®"""</span>
        <span class="keyword">return</span> self.preprocessor.transform(X)

<span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="comment"># åˆ›å»ºç¤ºä¾‹æ•°æ®</span>
data = pd.DataFrame({
    <span class="string">'å¹´é¾„'</span>: [<span class="number">25</span>, <span class="number">35</span>, <span class="number">45</span>, <span class="number">28</span>, <span class="number">52</span>],
    <span class="string">'æ”¶å…¥'</span>: [<span class="number">50000</span>, <span class="number">80000</span>, <span class="number">120000</span>, <span class="number">60000</span>, <span class="number">150000</span>],
    <span class="string">'æ•™è‚²ç¨‹åº¦'</span>: [<span class="string">'æœ¬ç§‘'</span>, <span class="string">'ç¡•å£«'</span>, <span class="string">'åšå£«'</span>, <span class="string">'æœ¬ç§‘'</span>, <span class="string">'åšå£«'</span>],
    <span class="string">'ç±»åˆ«'</span>: [<span class="string">'åˆçº§'</span>, <span class="string">'ä¸­çº§'</span>, <span class="string">'é«˜çº§'</span>, <span class="string">'åˆçº§'</span>, <span class="string">'é«˜çº§'</span>]
})

<span class="comment"># åˆ†ç¦»ç‰¹å¾å’Œæ ‡ç­¾</span>
X = data.drop(<span class="string">'ç±»åˆ«'</span>, axis=<span class="number">1</span>)
y = data[<span class="string">'ç±»åˆ«'</span>]

<span class="comment"># åˆ›å»ºé¢„å¤„ç†å™¨</span>
preprocessor = DataPreprocessor(
    numeric_features=[<span class="string">'å¹´é¾„'</span>, <span class="string">'æ”¶å…¥'</span>],
    categorical_features=[<span class="string">'æ•™è‚²ç¨‹åº¦'</span>],
    scaling_method=<span class="string">'standard'</span>
)

<span class="comment"># é¢„å¤„ç†æ•°æ®</span>
X_processed = preprocessor.fit_transform(X)

print(<span class="string">"åŸå§‹æ•°æ®:"</span>)
print(X)
print(<span class="string">"\nå¤„ç†åæ•°æ®:"</span>)
print(X_processed)

<span class="comment"># éªŒè¯æ ‡å‡†åŒ–æ•ˆæœ</span>
print(<span class="string">f"\nå¤„ç†åæ•°å€¼ç‰¹å¾å‡å€¼: {X_processed[:, :2].mean(axis=0)}"</span>)
print(<span class="string">f"å¤„ç†åæ•°å€¼ç‰¹å¾æ ‡å‡†å·®: {X_processed[:, :2].std(axis=0)}"</span>)</code></pre>
        </div>

        <div class="insight-box">
            <h4>ğŸ’¡ é¢„å¤„ç†é€‰æ‹©æŒ‡å—</h4>
            <table class="data-table">
                <thead>
                <tr>
                    <th>åœºæ™¯</th>
                    <th>æ¨èæ–¹æ³•</th>
                    <th>åŸå› </th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>æ•°æ®æœ‰æ˜ç¡®è¾¹ç•Œ</td>
                    <td><span class="highlight-success">Min-Maxå½’ä¸€åŒ–</span></td>
                    <td>å¦‚å›¾åƒåƒç´ å€¼0-255</td>
                </tr>
                <tr>
                    <td>æ•°æ®è¿‘ä¼¼æ­£æ€åˆ†å¸ƒ</td>
                    <td><span class="highlight-primary">Z-scoreæ ‡å‡†åŒ–</span></td>
                    <td>å‘æŒ¥ç»Ÿè®¡ç‰¹æ€§</td>
                </tr>
                <tr>
                    <td>å­˜åœ¨å¼‚å¸¸å€¼</td>
                    <td><span class="highlight-warning">Robustæ ‡å‡†åŒ–</span></td>
                    <td>ä½¿ç”¨ä¸­ä½æ•°å’Œå››åˆ†ä½è·</td>
                </tr>
                <tr>
                    <td>ç¨€ç–æ•°æ®</td>
                    <td><span class="highlight-danger">MaxAbsæ ‡å‡†åŒ–</span></td>
                    <td>ä¿æŒç¨€ç–æ€§</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="pro-tip">
            <p><strong>ç‰¹å¾å·¥ç¨‹çš„è‰ºæœ¯ï¼š</strong></p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ“Š <span class="highlight-primary">ç†è§£æ•°æ®åˆ†å¸ƒ</span>ï¼šä½¿ç”¨å¯è§†åŒ–å·¥å…·æŸ¥çœ‹ç‰¹å¾åˆ†å¸ƒ</li>
                <li>ğŸ” <span class="highlight-success">è¯†åˆ«å¼‚å¸¸å€¼</span>ï¼šå†³å®šæ˜¯åˆ é™¤è¿˜æ˜¯ä¿ç•™</li>
                <li>ğŸ¯ <span class="highlight-warning">ç‰¹å¾é€‰æ‹©</span>ï¼šå»é™¤æ— å…³æˆ–å†—ä½™ç‰¹å¾</li>
                <li>ğŸš€ <span class="highlight-danger">ç‰¹å¾åˆ›é€ </span>ï¼šåŸºäºé¢†åŸŸçŸ¥è¯†æ„é€ æ–°ç‰¹å¾</li>
            </ul>
        </div>
    </div>

    <!-- 4.6 å‚æ•°è°ƒä¼˜ -->
    <div id="parameter-tuning" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ”§ 4.6 è¶…å‚æ•°è°ƒä¼˜ï¼šå¯»æ‰¾æœ€ä½³é…ç½®</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” å‚æ•°é€‰æ‹©çš„è‰ºæœ¯</h3>
            <p>å¦‚æœä½ è¦è°ƒä¼˜ä¸€ä¸ªKNNæ¨¡å‹ï¼Œé¢ä¸´ä»¥ä¸‹é€‰æ‹©ï¼š</p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ”¢ Kå€¼ï¼š3, 5, 7, 9, 11, ..., 21</li>
                <li>âš–ï¸ æƒé‡ï¼šuniform vs distance</li>
                <li>ğŸ“ è·ç¦»ï¼šeuclidean vs manhattan vs chebyshev</li>
            </ul>
            <p><strong>é—®é¢˜ï¼š</strong>æ€»å…±æœ‰å¤šå°‘ç§ç»„åˆï¼Ÿå¦‚ä½•ç³»ç»ŸåŒ–åœ°æ‰¾åˆ°æœ€ä¼˜é…ç½®ï¼Ÿ</p>
            <p><span class="highlight-primary">ç­”æ¡ˆï¼š</span>10Ã—2Ã—3 = 60ç§ç»„åˆï¼æ‰‹åŠ¨å°è¯•æ˜¾ç„¶ä¸ç°å®ã€‚</p>
        </div>

        <!-- Kå€¼å½±å“å¯è§†åŒ– -->
        <div class="demo-container">
            <h3>ğŸ® Kå€¼å¯¹å†³ç­–è¾¹ç•Œçš„å½±å“</h3>
            <canvas id="kBoundaryDemo" class="demo-canvas" width="800" height="400"></canvas>
            <div class="param-panel">
                <h4 style="color: var(--knn-purple); margin-bottom: 15px;">è°ƒæ•´Kå€¼ï¼Œè§‚å¯Ÿå˜åŒ–</h4>
                <div>
                    <label>Kå€¼: <span class="param-value" id="kValue">5</span></label>
                    <input type="range" class="param-slider" id="kSlider" min="1" max="21" step="2" value="5" oninput="updateKBoundary()">
                </div>
                <div>
                    <label>å™ªå£°çº§åˆ«: <span class="param-value" id="noiseLevel">10%</span></label>
                    <input type="range" class="param-slider" id="noiseSlider" min="0" max="30" step="5" value="10" oninput="updateNoise()">
                </div>
            </div>
            <div class="model-status">
                <div class="status-item">
                    <div class="status-label">å†³ç­–å¹³æ»‘åº¦</div>
                    <div class="status-value" id="smoothness">ä¸­ç­‰</div>
                </div>
                <div class="status-item">
                    <div class="status-label">è¿‡æ‹Ÿåˆé£é™©</div>
                    <div class="status-value" id="overfittingRisk">ä½</div>
                </div>
            </div>
        </div>

        <div class="insight-box">
            <h4>ğŸ’¡ Kå€¼é€‰æ‹©çš„æ™ºæ…§</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 10px;">
                    <h5 style="color: var(--knn-purple); margin-bottom: 10px;">Kå¤ªå°ï¼ˆå¦‚K=1ï¼‰</h5>
                    <p>âœ— å¯¹å™ªå£°æ•æ„Ÿ</p>
                    <p>âœ— å†³ç­–è¾¹ç•Œå¤æ‚</p>
                    <p>âœ— å®¹æ˜“è¿‡æ‹Ÿåˆ</p>
                    <p>âœ“ è®­ç»ƒè¯¯å·®å°</p>
                </div>
                <div style="background: rgba(102, 126, 234, 0.1); padding: 20px; border-radius: 10px;">
                    <h5 style="color: var(--knn-blue); margin-bottom: 10px;">Ké€‚ä¸­ï¼ˆå¦‚K=5-9ï¼‰</h5>
                    <p>âœ“ å¹³è¡¡åå·®-æ–¹å·®</p>
                    <p>âœ“ å†³ç­–è¾¹ç•Œé€‚ä¸­</p>
                    <p>âœ“ æ³›åŒ–èƒ½åŠ›å¥½</p>
                    <p>âœ“ é²æ£’æ€§é€‚ä¸­</p>
                </div>
                <div style="background: rgba(236, 72, 153, 0.1); padding: 20px; border-radius: 10px;">
                    <h5 style="color: var(--knn-pink); margin-bottom: 10px;">Kå¤ªå¤§ï¼ˆå¦‚K>20ï¼‰</h5>
                    <p>âœ“ å¯¹å™ªå£°é²æ£’</p>
                    <p>âœ— å†³ç­–è¾¹ç•Œè¿‡äºå¹³æ»‘</p>
                    <p>âœ— å®¹æ˜“æ¬ æ‹Ÿåˆ</p>
                    <p>âœ— å¿½ç•¥å±€éƒ¨æ¨¡å¼</p>
                </div>
            </div>
        </div>

        <div class="formula-box">
            <h4>ğŸ§® æœ€ä¼˜Kå€¼çš„ç»éªŒå…¬å¼</h4>
            <div class="math-formula">
                <span>K<sub>optimal</sub> â‰ˆ âˆšn</span>
            </div>
            <div class="formula-explanation">
                <p>å…¶ä¸­ n æ˜¯è®­ç»ƒæ ·æœ¬æ•°é‡</p>
                <p><strong>æ³¨æ„ï¼š</strong>è¿™åªæ˜¯ä¸€ä¸ªèµ·ç‚¹ï¼Œå®é™…æœ€ä¼˜Kå€¼éœ€è¦é€šè¿‡äº¤å‰éªŒè¯ç¡®å®š</p>
                <p>â€¢ äºŒåˆ†ç±»é—®é¢˜ï¼šKé€šå¸¸é€‰æ‹©<span class="highlight-primary">å¥‡æ•°</span>ï¼Œé¿å…å¹³ç¥¨</p>
                <p>â€¢ å¤šåˆ†ç±»é—®é¢˜ï¼šè€ƒè™‘ç±»åˆ«æ•°é‡ï¼ŒKä¸åº”å°äºç±»åˆ«æ•°</p>
            </div>
        </div>

        <div class="code-block">
            <pre><code><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV, cross_val_score
<span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier
<span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> make_scorer, accuracy_score
<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt

<span class="keyword">class</span> <span class="function">KNNTuner</span>:
    <span class="string">"""KNNè¶…å‚æ•°è°ƒä¼˜å·¥å…·"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, X_train, y_train, X_val, y_val):
        self.X_train = X_train
        self.y_train = y_train
        self.X_val = X_val
        self.y_val = y_val

    <span class="keyword">def</span> <span class="function">find_optimal_k</span>(self, k_range=<span class="keyword">None</span>, cv_folds=<span class="number">5</span>):
        <span class="string">"""é€šè¿‡äº¤å‰éªŒè¯æ‰¾åˆ°æœ€ä¼˜Kå€¼"""</span>
        <span class="keyword">if</span> k_range <span class="keyword">is</span> <span class="keyword">None</span>:
            <span class="comment"># é»˜è®¤æœç´¢èŒƒå›´</span>
            max_k = min(<span class="number">50</span>, int(np.sqrt(len(self.X_train))))
            k_range = range(<span class="number">1</span>, max_k, <span class="number">2</span>)  <span class="comment"># åªè€ƒè™‘å¥‡æ•°</span>

        cv_scores = []
        val_scores = []

        <span class="keyword">for</span> k <span class="keyword">in</span> k_range:
            knn = KNeighborsClassifier(n_neighbors=k)

            <span class="comment"># äº¤å‰éªŒè¯å¾—åˆ†</span>
            cv_score = cross_val_score(knn, self.X_train, self.y_train,
                                      cv=cv_folds, scoring=<span class="string">'accuracy'</span>)
            cv_scores.append(cv_score.mean())

            <span class="comment"># éªŒè¯é›†å¾—åˆ†</span>
            knn.fit(self.X_train, self.y_train)
            val_score = knn.score(self.X_val, self.y_val)
            val_scores.append(val_score)

        <span class="comment"># ç»˜åˆ¶Kå€¼å½±å“å›¾</span>
        plt.figure(figsize=(<span class="number">10</span>, <span class="number">6</span>))
        plt.plot(k_range, cv_scores, <span class="string">'b-'</span>, label=<span class="string">'CV Score'</span>, linewidth=<span class="number">2</span>)
        plt.plot(k_range, val_scores, <span class="string">'r--'</span>, label=<span class="string">'Validation Score'</span>, linewidth=<span class="number">2</span>)
        plt.xlabel(<span class="string">'Kå€¼'</span>)
        plt.ylabel(<span class="string">'å‡†ç¡®ç‡'</span>)
        plt.title(<span class="string">'Kå€¼å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“'</span>)
        plt.legend()
        plt.grid(<span class="keyword">True</span>, alpha=<span class="number">0.3</span>)

        <span class="comment"># æ‰¾åˆ°æœ€ä¼˜K</span>
        optimal_k_idx = np.argmax(cv_scores)
        optimal_k = list(k_range)[optimal_k_idx]

        <span class="keyword">return</span> optimal_k, cv_scores, val_scores

    <span class="keyword">def</span> <span class="function">grid_search_optimization</span>(self):
        <span class="string">"""ç½‘æ ¼æœç´¢ä¼˜åŒ–æ‰€æœ‰è¶…å‚æ•°"""</span>
        param_grid = {
            <span class="string">'n_neighbors'</span>: [<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">21</span>],
            <span class="string">'weights'</span>: [<span class="string">'uniform'</span>, <span class="string">'distance'</span>],
            <span class="string">'metric'</span>: [<span class="string">'euclidean'</span>, <span class="string">'manhattan'</span>, <span class="string">'chebyshev'</span>],
            <span class="string">'p'</span>: [<span class="number">1</span>, <span class="number">2</span>]  <span class="comment"># é—µå¯å¤«æ–¯åŸºè·ç¦»çš„å‚æ•°</span>
        }

        knn = KNeighborsClassifier()
        grid_search = GridSearchCV(
            estimator=knn,
            param_grid=param_grid,
            cv=<span class="number">5</span>,
            scoring=<span class="string">'accuracy'</span>,
            n_jobs=-<span class="number">1</span>,
            verbose=<span class="number">1</span>
        )

        grid_search.fit(self.X_train, self.y_train)

        <span class="comment"># è¿”å›æœ€ä½³å‚æ•°å’Œæ¨¡å‹</span>
        <span class="keyword">return</span> grid_search.best_params_, grid_search.best_estimator_

    <span class="keyword">def</span> <span class="function">analyze_parameter_importance</span>(self, results_df):
        <span class="string">"""åˆ†æå‚æ•°é‡è¦æ€§"""</span>
        <span class="comment"># è®¡ç®—æ¯ä¸ªå‚æ•°å¯¹æ€§èƒ½çš„å¹³å‡å½±å“</span>
        param_importance = {}

        <span class="keyword">for</span> param <span class="keyword">in</span> [<span class="string">'n_neighbors'</span>, <span class="string">'weights'</span>, <span class="string">'metric'</span>]:
            grouped = results_df.groupby(f<span class="string">'param_{param}'</span>)[<span class="string">'mean_test_score'</span>]
            param_importance[param] = grouped.std()  <span class="comment"># æ ‡å‡†å·®è¶Šå¤§ï¼Œå½±å“è¶Šå¤§</span>

        <span class="keyword">return</span> param_importance

<span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="comment"># å‡è®¾å·²æœ‰é¢„å¤„ç†åçš„æ•°æ®</span>
tuner = KNNTuner(X_train_scaled, y_train, X_val_scaled, y_val)

<span class="comment"># 1. æ‰¾åˆ°æœ€ä¼˜Kå€¼</span>
optimal_k, cv_scores, val_scores = tuner.find_optimal_k()
print(f<span class="string">"æœ€ä¼˜Kå€¼: {optimal_k}"</span>)

<span class="comment"># 2. ç½‘æ ¼æœç´¢æ‰€æœ‰å‚æ•°</span>
best_params, best_model = tuner.grid_search_optimization()
print(f<span class="string">"æœ€ä½³å‚æ•°ç»„åˆ: {best_params}"</span>)

<span class="comment"># 3. æœ€ç»ˆè¯„ä¼°</span>
test_score = best_model.score(X_test_scaled, y_test)
print(f<span class="string">"æµ‹è¯•é›†å‡†ç¡®ç‡: {test_score:.4f}"</span>)</code></pre>
        </div>

        <div class="comparison-grid">
            <div class="comparison-item">
                <div class="comparison-header">
                    <div class="comparison-icon">ğŸ¯</div>
                    <div class="comparison-title">æ‰‹åŠ¨è°ƒå‚</div>
                </div>
                <p>âœ“ ç›´è§‚ç†è§£å‚æ•°å½±å“</p>
                <p>âœ“ å¿«é€Ÿè¯•é”™</p>
                <p>âœ— å®¹æ˜“é—æ¼æœ€ä¼˜ç»„åˆ</p>
                <p>âœ— è€—æ—¶è´¹åŠ›</p>
            </div>
            <div class="comparison-item">
                <div class="comparison-header">
                    <div class="comparison-icon">ğŸ”</div>
                    <div class="comparison-title">ç½‘æ ¼æœç´¢</div>
                </div>
                <p>âœ“ ç³»ç»Ÿæ€§æœç´¢</p>
                <p>âœ“ ä¿è¯æ‰¾åˆ°æœ€ä¼˜</p>
                <p>âœ— è®¡ç®—æˆæœ¬é«˜</p>
                <p>âœ— æŒ‡æ•°çº§å¢é•¿</p>
            </div>
            <div class="comparison-item">
                <div class="comparison-header">
                    <div class="comparison-icon">ğŸ²</div>
                    <div class="comparison-title">éšæœºæœç´¢</div>
                </div>
                <p>âœ“ æ•ˆç‡è¾ƒé«˜</p>
                <p>âœ“ é€‚åˆå¤§å‚æ•°ç©ºé—´</p>
                <p>âœ— å¯èƒ½é”™è¿‡æœ€ä¼˜</p>
                <p>âœ“ æ€§ä»·æ¯”é«˜</p>
            </div>
            <div class="comparison-item">
                <div class="comparison-header">
                    <div class="comparison-icon">ğŸ§ </div>
                    <div class="comparison-title">è´å¶æ–¯ä¼˜åŒ–</div>
                </div>
                <p>âœ“ æ™ºèƒ½æœç´¢</p>
                <p>âœ“ æ ·æœ¬æ•ˆç‡é«˜</p>
                <p>âœ— å®ç°å¤æ‚</p>
                <p>âœ“ é€‚åˆæ˜‚è´µè¯„ä¼°</p>
            </div>
        </div>

        <div class="pro-tip">
            <p><strong>è°ƒå‚å®æˆ˜æŠ€å·§ï¼š</strong></p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ¯ <span class="highlight-primary">å…ˆç²—åç»†</span>ï¼šå…ˆç”¨å¤§æ­¥é•¿æ‰¾åˆ°å¤§è‡´èŒƒå›´ï¼Œå†ç»†åŒ–æœç´¢</li>
                <li>ğŸ“Š <span class="highlight-success">éªŒè¯æ›²çº¿</span>ï¼šç»˜åˆ¶å‚æ•°vsæ€§èƒ½æ›²çº¿ï¼Œç†è§£å‚æ•°å½±å“</li>
                <li>ğŸ” <span class="highlight-warning">æ—©åœç­–ç•¥</span>ï¼šå¦‚æœæ€§èƒ½ä¸å†æå‡ï¼Œæå‰ç»ˆæ­¢æœç´¢</li>
                <li>ğŸ’¡ <span class="highlight-danger">é¢†åŸŸçŸ¥è¯†</span>ï¼šç»“åˆå®é™…é—®é¢˜ç‰¹ç‚¹ç¼©å°æœç´¢ç©ºé—´</li>
            </ul>
        </div>
    </div>

    <!-- 4.7 ä¼˜åŒ–æŠ€å·§ -->
    <div id="optimization" class="section-card fade-in section-anchor">
        <h2 class="section-title">âš¡ 4.7 ä¼˜åŒ–æŠ€å·§ï¼šè®©KNNé£èµ·æ¥</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” æ€§èƒ½ç“¶é¢ˆåœ¨å“ªé‡Œï¼Ÿ</h3>
            <p>å‡è®¾æœ‰100ä¸‡ä¸ªè®­ç»ƒæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬100ç»´ç‰¹å¾ï¼š</p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ’¾ å­˜å‚¨éœ€æ±‚ï¼š1M Ã— 100 Ã— 8å­—èŠ‚ â‰ˆ <span class="highlight-danger">800MB</span></li>
                <li>â±ï¸ å•æ¬¡é¢„æµ‹ï¼šè®¡ç®—1Mä¸ªè·ç¦» â‰ˆ <span class="highlight-warning">100Mæ¬¡è¿ç®—</span></li>
                <li>ğŸ”„ æ‰¹é‡é¢„æµ‹ï¼šå¤æ‚åº¦å‘ˆ<span class="highlight-primary">çº¿æ€§å¢é•¿</span></li>
            </ul>
            <p><strong>é—®é¢˜ï¼š</strong>å¦‚ä½•åœ¨ä¿æŒå‡†ç¡®ç‡çš„åŒæ—¶ï¼Œå¤§å¹…æå‡é€Ÿåº¦ï¼Ÿ</p>
        </div>

        <div class="optimization-card">
            <h4>ğŸŒ³ KDæ ‘ï¼ˆK-Dimensional Treeï¼‰</h4>
            <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>é€šè¿‡æ„å»ºäºŒå‰æ ‘ç»“æ„ï¼Œå°†æœç´¢ç©ºé—´<span class="highlight-primary">é€’å½’åˆ†å‰²</span></p>
            <p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>O(log n) åœ¨ä½ç»´ç©ºé—´ï¼ˆd < 20ï¼‰</p>
            <p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>O(n)</p>
            <p><strong>å±€é™æ€§ï¼š</strong>é«˜ç»´ç©ºé—´æ€§èƒ½é€€åŒ–åˆ°O(n)</p>
        </div>

        <div class="optimization-card">
            <h4>ğŸ¾ Ballæ ‘</h4>
            <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>ä½¿ç”¨<span class="highlight-success">è¶…çƒä½“</span>è€ŒéçŸ©å½¢åˆ’åˆ†ç©ºé—´</p>
            <p><strong>ä¼˜åŠ¿ï¼š</strong>åœ¨é«˜ç»´ç©ºé—´è¡¨ç°æ›´å¥½</p>
            <p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>O(log n) å³ä½¿åœ¨è¾ƒé«˜ç»´åº¦</p>
            <p><strong>æ„å»ºæ—¶é—´ï¼š</strong>æ¯”KDæ ‘æ…¢ï¼Œä½†æŸ¥è¯¢æ›´ç¨³å®š</p>
        </div>

        <div class="optimization-card">
            <h4>ğŸ”€ LSHï¼ˆå±€éƒ¨æ•æ„Ÿå“ˆå¸Œï¼‰</h4>
            <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>ç›¸ä¼¼çš„ç‚¹<span class="highlight-warning">å“ˆå¸Œåˆ°ç›¸åŒæ¡¶</span>çš„æ¦‚ç‡é«˜</p>
            <p><strong>ç‰¹ç‚¹ï¼š</strong>è¿‘ä¼¼æœ€è¿‘é‚»ï¼Œç‰ºç‰²ç²¾åº¦æ¢é€Ÿåº¦</p>
            <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong>è¶…é«˜ç»´æ•°æ®ã€æµ·é‡æ•°æ®</p>
            <p><strong>åŠ é€Ÿæ¯”ï¼š</strong>å¯è¾¾100-1000å€</p>
        </div>

        <!-- ç®—æ³•å¤æ‚åº¦å¯¹æ¯” -->
        <div class="complexity-table">
            <table class="data-table">
                <thead>
                <tr>
                    <th>ç®—æ³•</th>
                    <th>æ„å»ºæ—¶é—´</th>
                    <th>æŸ¥è¯¢æ—¶é—´</th>
                    <th>ç©ºé—´å¤æ‚åº¦</th>
                    <th>é€‚ç”¨åœºæ™¯</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>æš´åŠ›æœç´¢</td>
                    <td>O(1)</td>
                    <td>O(dn)</td>
                    <td>O(dn)</td>
                    <td>å°æ•°æ®é›†</td>
                </tr>
                <tr>
                    <td>KDæ ‘</td>
                    <td>O(dn log n)</td>
                    <td>O(d log n)</td>
                    <td>O(dn)</td>
                    <td>ä½ç»´æ•°æ®(d<20)</td>
                </tr>
                <tr>
                    <td>Ballæ ‘</td>
                    <td>O(dn log n)</td>
                    <td>O(d log n)</td>
                    <td>O(dn)</td>
                    <td>ä¸­é«˜ç»´æ•°æ®</td>
                </tr>
                <tr>
                    <td>LSH</td>
                    <td>O(dn)</td>
                    <td>O(1)</td>
                    <td>O(dn)</td>
                    <td>è¶…é«˜ç»´/æµ·é‡æ•°æ®</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="code-block">
            <pre><code><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier, BallTree, KDTree
<span class="keyword">import</span> time
<span class="keyword">import</span> numpy <span class="keyword">as</span> np

<span class="keyword">class</span> <span class="function">OptimizedKNN</span>:
    <span class="string">"""ä¼˜åŒ–çš„KNNå®ç°"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, n_neighbors=<span class="number">5</span>, algorithm=<span class="string">'auto'</span>, leaf_size=<span class="number">30</span>):
        <span class="string">"""
        å‚æ•°:
            algorithm: {'auto', 'ball_tree', 'kd_tree', 'brute'}
            leaf_size: æ ‘çš„å¶èŠ‚ç‚¹å¤§å°ï¼Œå½±å“æ„å»ºå’ŒæŸ¥è¯¢é€Ÿåº¦
        """</span>
        self.n_neighbors = n_neighbors
        self.algorithm = algorithm
        self.leaf_size = leaf_size

    <span class="keyword">def</span> <span class="function">benchmark_algorithms</span>(self, X_train, y_train, X_test, n_queries=<span class="number">100</span>):
        <span class="string">"""å¯¹æ¯”ä¸åŒç®—æ³•çš„æ€§èƒ½"""</span>
        algorithms = [<span class="string">'brute'</span>, <span class="string">'kd_tree'</span>, <span class="string">'ball_tree'</span>]
        results = {}

        <span class="keyword">for</span> algo <span class="keyword">in</span> algorithms:
            <span class="keyword">print</span>(f<span class="string">"\næµ‹è¯•ç®—æ³•: {algo}"</span>)

            <span class="comment"># æ„å»ºæ—¶é—´</span>
            start_time = time.time()
            knn = KNeighborsClassifier(
                n_neighbors=self.n_neighbors,
                algorithm=algo,
                leaf_size=self.leaf_size
            )
            knn.fit(X_train, y_train)
            build_time = time.time() - start_time

            <span class="comment"># æŸ¥è¯¢æ—¶é—´</span>
            start_time = time.time()
            <span class="keyword">for</span> _ <span class="keyword">in</span> range(n_queries):
                idx = np.random.randint(<span class="number">0</span>, len(X_test))
                knn.predict(X_test[idx:idx+<span class="number">1</span>])
            query_time = (time.time() - start_time) / n_queries

            <span class="comment"># å‡†ç¡®ç‡</span>
            accuracy = knn.score(X_test[:<span class="number">1000</span>], y_test[:<span class="number">1000</span>])

            results[algo] = {
                <span class="string">'build_time'</span>: build_time,
                <span class="string">'query_time'</span>: query_time,
                <span class="string">'accuracy'</span>: accuracy
            }

            <span class="keyword">print</span>(f<span class="string">"æ„å»ºæ—¶é—´: {build_time:.4f}ç§’"</span>)
            <span class="keyword">print</span>(f<span class="string">"å¹³å‡æŸ¥è¯¢æ—¶é—´: {query_time*1000:.2f}æ¯«ç§’"</span>)
            <span class="keyword">print</span>(f<span class="string">"å‡†ç¡®ç‡: {accuracy:.4f}"</span>)

        <span class="keyword">return</span> results

    <span class="keyword">def</span> <span class="function">optimize_leaf_size</span>(self, X_train, y_train, X_test):
        <span class="string">"""æ‰¾åˆ°æœ€ä¼˜çš„leaf_sizeå‚æ•°"""</span>
        leaf_sizes = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">100</span>]
        results = []

        <span class="keyword">for</span> leaf_size <span class="keyword">in</span> leaf_sizes:
            knn = KNeighborsClassifier(
                n_neighbors=self.n_neighbors,
                algorithm=<span class="string">'ball_tree'</span>,
                leaf_size=leaf_size
            )

            <span class="comment"># æµ‹é‡æ€§èƒ½</span>
            start_time = time.time()
            knn.fit(X_train, y_train)
            knn.predict(X_test[:<span class="number">100</span>])
            total_time = time.time() - start_time

            results.append((leaf_size, total_time))

        <span class="keyword">return</span> results

<span class="comment"># é«˜çº§ä¼˜åŒ–ï¼šè¿‘ä¼¼æœ€è¿‘é‚»</span>
<span class="keyword">class</span> <span class="function">ApproximateKNN</span>:
    <span class="string">"""ä½¿ç”¨LSHçš„è¿‘ä¼¼KNN"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, n_neighbors=<span class="number">5</span>, n_hash_tables=<span class="number">10</span>, hash_size=<span class="number">8</span>):
        self.n_neighbors = n_neighbors
        self.n_hash_tables = n_hash_tables
        self.hash_size = hash_size
        self.hash_functions = []
        self.hash_tables = []

    <span class="keyword">def</span> <span class="function">_generate_hash_function</span>(self, n_features):
        <span class="string">"""ç”ŸæˆéšæœºæŠ•å½±å“ˆå¸Œå‡½æ•°"""</span>
        <span class="comment"># éšæœºæŠ•å½±å‘é‡</span>
        random_vectors = np.random.randn(self.hash_size, n_features)
        <span class="keyword">return</span> random_vectors

    <span class="keyword">def</span> <span class="function">_hash</span>(self, x, hash_func):
        <span class="string">"""è®¡ç®—æ ·æœ¬çš„å“ˆå¸Œå€¼"""</span>
        projections = np.dot(hash_func, x)
        <span class="keyword">return</span> tuple((projections > <span class="number">0</span>).astype(int))

    <span class="keyword">def</span> <span class="function">fit</span>(self, X, y):
        <span class="string">"""æ„å»ºLSHç´¢å¼•"""</span>
        self.X_train = X
        self.y_train = y
        n_samples, n_features = X.shape

        <span class="comment"># ç”Ÿæˆå“ˆå¸Œå‡½æ•°å’Œå“ˆå¸Œè¡¨</span>
        <span class="keyword">for</span> _ <span class="keyword">in</span> range(self.n_hash_tables):
            hash_func = self._generate_hash_function(n_features)
            self.hash_functions.append(hash_func)

            <span class="comment"># æ„å»ºå“ˆå¸Œè¡¨</span>
            hash_table = {}
            <span class="keyword">for</span> i, x <span class="keyword">in</span> enumerate(X):
                hash_value = self._hash(x, hash_func)
                <span class="keyword">if</span> hash_value <span class="keyword">not</span> <span class="keyword">in</span> hash_table:
                    hash_table[hash_value] = []
                hash_table[hash_value].append(i)

            self.hash_tables.append(hash_table)

    <span class="keyword">def</span> <span class="function">predict</span>(self, X):
        <span class="string">"""è¿‘ä¼¼æœ€è¿‘é‚»é¢„æµ‹"""</span>
        predictions = []

        <span class="keyword">for</span> x <span class="keyword">in</span> X:
            <span class="comment"># æ”¶é›†å€™é€‰é‚»å±…</span>
            candidates = set()
            <span class="keyword">for</span> hash_func, hash_table <span class="keyword">in</span> zip(self.hash_functions, self.hash_tables):
                hash_value = self._hash(x, hash_func)
                <span class="keyword">if</span> hash_value <span class="keyword">in</span> hash_table:
                    candidates.update(hash_table[hash_value])

            <span class="comment"># åœ¨å€™é€‰é›†ä¸­æ‰¾æœ€è¿‘é‚»</span>
            <span class="keyword">if</span> candidates:
                candidate_X = self.X_train[list(candidates)]
                candidate_y = self.y_train[list(candidates)]

                <span class="comment"># è®¡ç®—è·ç¦»</span>
                distances = np.linalg.norm(candidate_X - x, axis=<span class="number">1</span>)
                k_nearest_idx = np.argsort(distances)[:self.n_neighbors]

                <span class="comment"># æŠ•ç¥¨</span>
                k_nearest_labels = candidate_y[k_nearest_idx]
                prediction = np.bincount(k_nearest_labels).argmax()
            <span class="keyword">else</span>:
                <span class="comment"># å¦‚æœæ²¡æœ‰å€™é€‰ï¼Œä½¿ç”¨æœ€å¸¸è§ç±»</span>
                prediction = np.bincount(self.y_train).argmax()

            predictions.append(prediction)

        <span class="keyword">return</span> np.array(predictions)</code></pre>
        </div>

        <div class="insight-box">
            <h4>ğŸ’¡ ä¼˜åŒ–ç­–ç•¥é€‰æ‹©æŒ‡å—</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div>
                    <h5 style="color: var(--knn-purple);">âœ… æ¨èä½¿ç”¨åœºæ™¯</h5>
                    <p><strong>KDæ ‘ï¼š</strong>d < 20ï¼Œå‡åŒ€åˆ†å¸ƒæ•°æ®</p>
                    <p><strong>Ballæ ‘ï¼š</strong>20 < d < 100ï¼Œéå‡åŒ€æ•°æ®</p>
                    <p><strong>LSHï¼š</strong>d > 100ï¼Œå¯æ¥å—è¿‘ä¼¼ç»“æœ</p>
                    <p><strong>æš´åŠ›æœç´¢ï¼š</strong>n < 1000ï¼Œéœ€è¦ç²¾ç¡®ç»“æœ</p>
                </div>
                <div>
                    <h5 style="color: var(--knn-pink);">âš¡ åŠ é€ŸæŠ€å·§</h5>
                    <p><strong>å¹¶è¡Œè®¡ç®—ï¼š</strong>ä½¿ç”¨n_jobs=-1</p>
                    <p><strong>æ‰¹é‡é¢„æµ‹ï¼š</strong>å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€</p>
                    <p><strong>ç‰¹å¾é€‰æ‹©ï¼š</strong>é™ä½ç»´åº¦</p>
                    <p><strong>é‡‡æ ·ç­–ç•¥ï¼š</strong>ä½¿ç”¨ä»£è¡¨æ€§å­é›†</p>
                </div>
            </div>
        </div>

        <!-- æ€§èƒ½å¯¹æ¯”å¯è§†åŒ– -->
        <div class="demo-container">
            <h3>ğŸ® ç®—æ³•æ€§èƒ½å¯¹æ¯”æ¼”ç¤º</h3>
            <canvas id="performanceDemo" class="demo-canvas" width="800" height="400"></canvas>
            <div class="demo-controls">
                <button class="demo-btn" onclick="compareAlgorithms()">è¿è¡Œå¯¹æ¯”æµ‹è¯•</button>
                <button class="demo-btn" onclick="showDimensionEffect()">ç»´åº¦å½±å“</button>
                <button class="demo-btn" onclick="showScalability()">å¯æ‰©å±•æ€§æµ‹è¯•</button>
            </div>
            <div id="performanceResult" style="margin-top: 15px; text-align: center;"></div>
        </div>

        <div class="pro-tip">
            <p><strong>å®æˆ˜ä¼˜åŒ–æ¸…å•ï¼š</strong></p>
            <ol style="margin-left: 20px; line-height: 2;">
                <li>ğŸ“Š <strong>åˆ†ææ•°æ®ç‰¹æ€§ï¼š</strong>ç»´åº¦ã€åˆ†å¸ƒã€è§„æ¨¡</li>
                <li>ğŸ¯ <strong>é€‰æ‹©åˆé€‚ç®—æ³•ï¼š</strong>æ ¹æ®ç»´åº¦å’Œç²¾åº¦è¦æ±‚</li>
                <li>ğŸ”§ <strong>è°ƒæ•´æ ‘å‚æ•°ï¼š</strong>leaf_sizeå½±å“æ€§èƒ½</li>
                <li>âš¡ <strong>ä½¿ç”¨å¹¶è¡Œï¼š</strong>å¤šæ ¸CPUå……åˆ†åˆ©ç”¨</li>
                <li>ğŸ’¾ <strong>å†…å­˜ä¼˜åŒ–ï¼š</strong>ä½¿ç”¨float32ä»£æ›¿float64</li>
                <li>ğŸ” <strong>è¿‘ä¼¼æ–¹æ³•ï¼š</strong>å¤§è§„æ¨¡æ•°æ®è€ƒè™‘LSH</li>
            </ol>
        </div>
    </div>

    <!-- 4.8 ç®—æ³•å˜ä½“ -->
    <div id="variants" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ”€ 4.8 KNNç®—æ³•å˜ä½“ä¸æ‰©å±•</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” æ ‡å‡†KNNçš„å±€é™æ€§</h3>
            <p>å°½ç®¡KNNç®€å•æœ‰æ•ˆï¼Œä½†ä»å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ¯ æ‰€æœ‰ç‰¹å¾<span class="highlight-primary">åŒç­‰é‡è¦</span>ï¼Ÿ</li>
                <li>âš–ï¸ ç±»åˆ«<span class="highlight-success">ä¸å¹³è¡¡</span>æ€ä¹ˆåŠï¼Ÿ</li>
                <li>ğŸŒŠ æ•°æ®æœ‰<span class="highlight-warning">å±€éƒ¨å¯†åº¦å·®å¼‚</span>ï¼Ÿ</li>
                <li>ğŸ” å¦‚ä½•å¤„ç†<span class="highlight-danger">æ¨¡ç³Šè¾¹ç•Œ</span>ï¼Ÿ</li>
            </ul>
            <p>è¿™äº›é—®é¢˜å‚¬ç”Ÿäº†å„ç§KNNå˜ä½“ï¼</p>
        </div>

        <div class="algorithm-variant">
            <h4>âš–ï¸ åŠ æƒKNNï¼ˆWeighted KNNï¼‰</h4>
            <p><strong>æ”¹è¿›ç‚¹ï¼š</strong>ä¸åŒç‰¹å¾èµ‹äºˆä¸åŒæƒé‡</p>
            <div class="math-formula">
                <span>d(x, y) = </span>
                <span class="sqrt">
                    <span class="sqrt-content">
                        <span style="font-size: 1.5rem;">âˆ‘</span>
                        <sub>i</sub>
                        <span style="margin-left: 10px;">w<sub>i</sub> Ã— (x<sub>i</sub> - y<sub>i</sub>)<sup>2</sup></span>
                    </span>
                </span>
            </div>
            <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong>ç‰¹å¾é‡è¦æ€§å·®å¼‚å¤§çš„é—®é¢˜</p>
            <p><strong>å­¦ä¹ æ–¹æ³•ï¼š</strong>Reliefç®—æ³•ã€ä¿¡æ¯å¢ç›Šç­‰</p>
        </div>

        <div class="algorithm-variant">
            <h4>ğŸ¯ è‡ªé€‚åº”KNNï¼ˆAdaptive KNNï¼‰</h4>
            <p><strong>æ”¹è¿›ç‚¹ï¼š</strong>Kå€¼éšå±€éƒ¨å¯†åº¦åŠ¨æ€è°ƒæ•´</p>
            <div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                <p>ç¨€ç–åŒºåŸŸ â†’ å¤§Kå€¼ï¼ˆæ›´å¤šé‚»å±…ï¼‰</p>
                <p>å¯†é›†åŒºåŸŸ â†’ å°Kå€¼ï¼ˆç²¾ç¡®å±€éƒ¨ï¼‰</p>
            </div>
            <p><strong>ä¼˜åŠ¿ï¼š</strong>é€‚åº”æ•°æ®åˆ†å¸ƒçš„ä¸å‡åŒ€æ€§</p>
        </div>

        <div class="algorithm-variant">
            <h4>ğŸŒŸ æ¨¡ç³ŠKNNï¼ˆFuzzy KNNï¼‰</h4>
            <p><strong>æ”¹è¿›ç‚¹ï¼š</strong>è¾“å‡ºç±»åˆ«çš„éš¶å±åº¦è€Œéç¡¬åˆ†ç±»</p>
            <div class="math-formula">
                <span>Î¼<sub>c</sub>(x) = </span>
                <span class="fraction">
                    <span class="numerator">
                        <span style="font-size: 1.2rem;">âˆ‘</span>
                        <sub style="font-size: 0.8em;">iâˆˆN<sub>K</sub></sub>
                        <span style="margin-left: 10px;">u<sub>ic</sub> Ã— w<sub>i</sub></span>
                    </span>
                    <span class="denominator">
                        <span style="font-size: 1.2rem;">âˆ‘</span>
                        <sub style="font-size: 0.8em;">iâˆˆN<sub>K</sub></sub>
                        <span style="margin-left: 10px;">w<sub>i</sub></span>
                    </span>
                </span>
            </div>
            <p><strong>ä¼˜åŠ¿ï¼š</strong>å¤„ç†è¾¹ç•Œæ¨¡ç³Šçš„æ ·æœ¬</p>
            <p><strong>åº”ç”¨ï¼š</strong>åŒ»ç–—è¯Šæ–­ã€é£é™©è¯„ä¼°ç­‰éœ€è¦æ¦‚ç‡è¾“å‡ºçš„åœºæ™¯</p>
        </div>

        <div class="algorithm-variant">
            <h4>ğŸ”„ äº’KNNï¼ˆMutual KNNï¼‰</h4>
            <p><strong>æ”¹è¿›ç‚¹ï¼š</strong>åªè€ƒè™‘äº’ä¸ºæœ€è¿‘é‚»çš„æ ·æœ¬</p>
            <div style="background: rgba(102, 126, 234, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                <p>xæ˜¯yçš„Kè¿‘é‚» <strong>ä¸”</strong> yæ˜¯xçš„Kè¿‘é‚» â†’ æ‰è€ƒè™‘</p>
            </div>
            <p><strong>ä¼˜åŠ¿ï¼š</strong>å‡å°‘å™ªå£°å½±å“ï¼Œæé«˜ç¨³å®šæ€§</p>
        </div>

        <div class="code-block">
            <pre><code><span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">from</span> sklearn.base <span class="keyword">import</span> BaseEstimator, ClassifierMixin
<span class="keyword">from</span> sklearn.utils.validation <span class="keyword">import</span> check_X_y, check_array

<span class="keyword">class</span> <span class="function">WeightedKNN</span>(BaseEstimator, ClassifierMixin):
    <span class="string">"""ç‰¹å¾åŠ æƒçš„KNNå®ç°"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, n_neighbors=<span class="number">5</span>, feature_weights=<span class="keyword">None</span>):
        self.n_neighbors = n_neighbors
        self.feature_weights = feature_weights

    <span class="keyword">def</span> <span class="function">fit</span>(self, X, y):
        X, y = check_X_y(X, y)
        self.X_ = X
        self.y_ = y
        self.classes_ = np.unique(y)

        <span class="comment"># å¦‚æœæ²¡æœ‰æŒ‡å®šæƒé‡ï¼Œä½¿ç”¨Reliefç®—æ³•å­¦ä¹ </span>
        <span class="keyword">if</span> self.feature_weights <span class="keyword">is</span> <span class="keyword">None</span>:
            self.feature_weights = self._learn_weights_relief(X, y)

        <span class="keyword">return</span> self

    <span class="keyword">def</span> <span class="function">_learn_weights_relief</span>(self, X, y, n_iterations=<span class="number">100</span>):
        <span class="string">"""ä½¿ç”¨Reliefç®—æ³•å­¦ä¹ ç‰¹å¾æƒé‡"""</span>
        n_samples, n_features = X.shape
        weights = np.zeros(n_features)

        <span class="keyword">for</span> _ <span class="keyword">in</span> range(n_iterations):
            <span class="comment"># éšæœºé€‰æ‹©ä¸€ä¸ªæ ·æœ¬</span>
            idx = np.random.randint(n_samples)
            sample = X[idx]
            label = y[idx]

            <span class="comment"># æ‰¾åˆ°æœ€è¿‘çš„åŒç±»å’Œå¼‚ç±»æ ·æœ¬</span>
            same_class_mask = y == label
            diff_class_mask = ~same_class_mask

            <span class="comment"># è®¡ç®—è·ç¦»</span>
            distances = np.sum((X - sample) ** <span class="number">2</span>, axis=<span class="number">1</span>)

            <span class="comment"># æœ€è¿‘åŒç±»ï¼ˆæ’é™¤è‡ªå·±ï¼‰</span>
            same_distances = distances.copy()
            same_distances[~same_class_mask] = np.inf
            same_distances[idx] = np.inf
            nearest_hit = np.argmin(same_distances)

            <span class="comment"># æœ€è¿‘å¼‚ç±»</span>
            diff_distances = distances.copy()
            diff_distances[~diff_class_mask] = np.inf
            nearest_miss = np.argmin(diff_distances)

            <span class="comment"># æ›´æ–°æƒé‡</span>
            <span class="keyword">for</span> j <span class="keyword">in</span> range(n_features):
                weights[j] += np.abs(sample[j] - X[nearest_miss, j]) - \
                             np.abs(sample[j] - X[nearest_hit, j])

        <span class="comment"># å½’ä¸€åŒ–æƒé‡åˆ°[0,1]</span>
        weights = (weights - weights.min()) / (weights.max() - weights.min() + <span class="number">1e-8</span>)
        <span class="keyword">return</span> weights

    <span class="keyword">def</span> <span class="function">_weighted_distance</span>(self, x1, x2):
        <span class="string">"""è®¡ç®—åŠ æƒè·ç¦»"""</span>
        <span class="keyword">return</span> np.sqrt(np.sum(self.feature_weights * (x1 - x2) ** <span class="number">2</span>))

    <span class="keyword">def</span> <span class="function">predict</span>(self, X):
        X = check_array(X)
        predictions = []

        <span class="keyword">for</span> x <span class="keyword">in</span> X:
            <span class="comment"># è®¡ç®—åŠ æƒè·ç¦»</span>
            distances = [self._weighted_distance(x, x_train)
                        <span class="keyword">for</span> x_train <span class="keyword">in</span> self.X_]

            <span class="comment"># æ‰¾Kè¿‘é‚»</span>
            k_nearest_idx = np.argsort(distances)[:self.n_neighbors]
            k_nearest_labels = self.y_[k_nearest_idx]

            <span class="comment"># æŠ•ç¥¨</span>
            prediction = np.bincount(k_nearest_labels).argmax()
            predictions.append(prediction)

        <span class="keyword">return</span> np.array(predictions)

<span class="keyword">class</span> <span class="function">FuzzyKNN</span>(BaseEstimator, ClassifierMixin):
    <span class="string">"""æ¨¡ç³ŠKNNå®ç°"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, n_neighbors=<span class="number">5</span>, fuzzy_strength=<span class="number">2</span>):
        self.n_neighbors = n_neighbors
        self.fuzzy_strength = fuzzy_strength  <span class="comment"># æ¨¡ç³ŠåŒ–å‚æ•°m</span>

    <span class="keyword">def</span> <span class="function">fit</span>(self, X, y):
        self.X_ = X
        self.y_ = y
        self.classes_ = np.unique(y)
        self.n_classes_ = len(self.classes_)

        <span class="comment"># åˆå§‹åŒ–éš¶å±åº¦çŸ©é˜µ</span>
        self._init_membership_matrix()
        <span class="keyword">return</span> self

    <span class="keyword">def</span> <span class="function">predict_proba</span>(self, X):
        <span class="string">"""é¢„æµ‹éš¶å±åº¦"""</span>
        X = check_array(X)
        n_samples = X.shape[<span class="number">0</span>]
        probas = np.zeros((n_samples, self.n_classes_))

        <span class="keyword">for</span> i, x <span class="keyword">in</span> enumerate(X):
            <span class="comment"># è®¡ç®—è·ç¦»</span>
            distances = np.linalg.norm(self.X_ - x, axis=<span class="number">1</span>)

            <span class="comment"># æ‰¾Kè¿‘é‚»</span>
            k_nearest_idx = np.argsort(distances)[:self.n_neighbors]
            k_nearest_distances = distances[k_nearest_idx]

            <span class="comment"># è®¡ç®—æƒé‡</span>
            weights = <span class="number">1</span> / (k_nearest_distances ** self.fuzzy_strength + <span class="number">1e-8</span>)
            weights /= weights.sum()

            <span class="comment"># åŠ æƒå¹³å‡éš¶å±åº¦</span>
            <span class="keyword">for</span> j, (idx, w) <span class="keyword">in</span> enumerate(zip(k_nearest_idx, weights)):
                probas[i] += w * self.U_[idx]

        <span class="keyword">return</span> probas</code></pre>
        </div>
    </div>

    <!-- 4.9 æ¨¡å‹è¯„ä¼° -->
    <div id="evaluation" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ“ˆ 4.9 æ¨¡å‹è¯„ä¼°ä¸å¯è§£é‡Šæ€§</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” å¦‚ä½•è¯„åˆ¤ä¸€ä¸ªKNNæ¨¡å‹çš„å¥½åï¼Ÿ</h3>
            <p>è¯„ä¼°æœºå™¨å­¦ä¹ æ¨¡å‹å°±åƒè¯„ä»·ä¸€ä¸ªåŒ»ç”Ÿçš„è¯Šæ–­èƒ½åŠ›ï¼š</p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ¯ <span class="highlight-primary">å‡†ç¡®ç‡</span>ï¼šæ€»ä½“è¯Šæ–­æ­£ç¡®çš„æ¯”ä¾‹</li>
                <li>ğŸ” <span class="highlight-success">ç²¾ç¡®ç‡</span>ï¼šè¯Šæ–­ä¸ºæœ‰ç—…çš„æ‚£è€…ä¸­ï¼ŒçœŸæ­£æœ‰ç—…çš„æ¯”ä¾‹</li>
                <li>ğŸ“¡ <span class="highlight-warning">å¬å›ç‡</span>ï¼šæ‰€æœ‰æœ‰ç—…æ‚£è€…ä¸­ï¼Œè¢«æ­£ç¡®è¯Šæ–­çš„æ¯”ä¾‹</li>
                <li>âš¡ <span class="highlight-danger">æ•ˆç‡</span>ï¼šè¯Šæ–­é€Ÿåº¦å’Œèµ„æºæ¶ˆè€—</li>
            </ul>
        </div>

        <div class="formula-box">
            <h4>ğŸ“Š åˆ†ç±»è¯„ä¼°æŒ‡æ ‡ä½“ç³»</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 20px 0;">
                <div>
                    <div class="math-formula">
                        <span>ç²¾ç¡®ç‡ = </span>
                        <span class="fraction">
                            <span class="numerator">TP</span>
                            <span class="denominator">TP + FP</span>
                        </span>
                    </div>
                    <p style="text-align: center; margin-top: 10px;">é¢„æµ‹ä¸ºæ­£ä¾‹ä¸­çœŸæ­£æ­£ç¡®çš„æ¯”ä¾‹</p>
                </div>
                <div>
                    <div class="math-formula">
                        <span>å¬å›ç‡ = </span>
                        <span class="fraction">
                            <span class="numerator">TP</span>
                            <span class="denominator">TP + FN</span>
                        </span>
                    </div>
                    <p style="text-align: center; margin-top: 10px;">æ‰€æœ‰çœŸæ­£ä¾‹ä¸­è¢«æ‰¾åˆ°çš„æ¯”ä¾‹</p>
                </div>
            </div>
            <div class="math-formula" style="margin-top: 20px;">
                <span>F1åˆ†æ•° = 2 Ã— </span>
                <span class="fraction">
                    <span class="numerator">ç²¾ç¡®ç‡ Ã— å¬å›ç‡</span>
                    <span class="denominator">ç²¾ç¡®ç‡ + å¬å›ç‡</span>
                </span>
            </div>
        </div>

        <div class="code-block">
            <pre><code><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> (
    accuracy_score, precision_score, recall_score, f1_score,
    confusion_matrix, classification_report, roc_curve, auc
)
<span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> learning_curve, validation_curve
<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt
<span class="keyword">import</span> seaborn <span class="keyword">as</span> sns

<span class="keyword">class</span> <span class="function">KNNEvaluator</span>:
    <span class="string">"""KNNæ¨¡å‹è¯„ä¼°å·¥å…·"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, model, X_train, y_train, X_test, y_test):
        self.model = model
        self.X_train = X_train
        self.y_train = y_train
        self.X_test = X_test
        self.y_test = y_test

    <span class="keyword">def</span> <span class="function">comprehensive_evaluation</span>(self):
        <span class="string">"""å…¨é¢è¯„ä¼°æ¨¡å‹æ€§èƒ½"""</span>
        <span class="comment"># è®­ç»ƒæ¨¡å‹</span>
        self.model.fit(self.X_train, self.y_train)

        <span class="comment"># é¢„æµ‹</span>
        y_pred = self.model.predict(self.X_test)

        <span class="comment"># è®¡ç®—å„é¡¹æŒ‡æ ‡</span>
        metrics = {
            <span class="string">'accuracy'</span>: accuracy_score(self.y_test, y_pred),
            <span class="string">'precision'</span>: precision_score(self.y_test, y_pred, average=<span class="string">'weighted'</span>),
            <span class="string">'recall'</span>: recall_score(self.y_test, y_pred, average=<span class="string">'weighted'</span>),
            <span class="string">'f1'</span>: f1_score(self.y_test, y_pred, average=<span class="string">'weighted'</span>)
        }

        <span class="keyword">print</span>(<span class="string">"=== æ¨¡å‹æ€§èƒ½è¯„ä¼° ==="</span>)
        <span class="keyword">for</span> metric, value <span class="keyword">in</span> metrics.items():
            <span class="keyword">print</span>(f<span class="string">"{metric}: {value:.4f}"</span>)

        <span class="comment"># è¯¦ç»†åˆ†ç±»æŠ¥å‘Š</span>
        <span class="keyword">print</span>(<span class="string">"\n=== åˆ†ç±»æŠ¥å‘Š ==="</span>)
        <span class="keyword">print</span>(classification_report(self.y_test, y_pred))

        <span class="keyword">return</span> metrics, y_pred

    <span class="keyword">def</span> <span class="function">plot_confusion_matrix</span>(self, y_pred):
        <span class="string">"""ç»˜åˆ¶æ··æ·†çŸ©é˜µ"""</span>
        cm = confusion_matrix(self.y_test, y_pred)

        plt.figure(figsize=(<span class="number">8</span>, <span class="number">6</span>))
        sns.heatmap(cm, annot=<span class="keyword">True</span>, fmt=<span class="string">'d'</span>, cmap=<span class="string">'Blues'</span>)
        plt.title(<span class="string">'æ··æ·†çŸ©é˜µ'</span>)
        plt.ylabel(<span class="string">'çœŸå®æ ‡ç­¾'</span>)
        plt.xlabel(<span class="string">'é¢„æµ‹æ ‡ç­¾'</span>)
        plt.show()

    <span class="keyword">def</span> <span class="function">explain_prediction</span>(self, sample_idx):
        <span class="string">"""è§£é‡Šå•ä¸ªé¢„æµ‹ç»“æœ"""</span>
        sample = self.X_test[sample_idx]
        true_label = self.y_test[sample_idx]

        <span class="comment"># æ‰¾åˆ°Kä¸ªæœ€è¿‘é‚»</span>
        distances, indices = self.model.kneighbors([sample])

        <span class="keyword">print</span>(f<span class="string">"\n=== é¢„æµ‹è§£é‡Š (æ ·æœ¬ {sample_idx}) ==="</span>)
        <span class="keyword">print</span>(f<span class="string">"çœŸå®æ ‡ç­¾: {true_label}"</span>)

        prediction = self.model.predict([sample])[<span class="number">0</span>]
        <span class="keyword">print</span>(f<span class="string">"é¢„æµ‹æ ‡ç­¾: {prediction}"</span>)

        <span class="keyword">print</span>(f<span class="string">"\næœ€è¿‘çš„ {self.model.n_neighbors} ä¸ªé‚»å±…:"</span>)
        <span class="keyword">for</span> i, (dist, idx) <span class="keyword">in</span> enumerate(zip(distances[<span class="number">0</span>], indices[<span class="number">0</span>])):
            neighbor_label = self.y_train[idx]
            <span class="keyword">print</span>(f<span class="string">"  é‚»å±… {i+1}: è·ç¦»={dist:.3f}, æ ‡ç­¾={neighbor_label}"</span>)

        <span class="comment"># ç»Ÿè®¡æŠ•ç¥¨</span>
        neighbor_labels = self.y_train[indices[<span class="number">0</span>]]
        unique, counts = np.unique(neighbor_labels, return_counts=<span class="keyword">True</span>)

        <span class="keyword">print</span>(<span class="string">"\næŠ•ç¥¨ç»Ÿè®¡:"</span>)
        <span class="keyword">for</span> label, count <span class="keyword">in</span> zip(unique, counts):
            <span class="keyword">print</span>(f<span class="string">"  ç±»åˆ« {label}: {count} ç¥¨"</span>)

        <span class="keyword">return</span> prediction, neighbor_labels</code></pre>
        </div>

        <div class="insight-box">
            <h4>ğŸ’¡ KNNçš„å¯è§£é‡Šæ€§ä¼˜åŠ¿</h4>
            <p>ç›¸æ¯”å…¶ä»–"é»‘ç›’"æ¨¡å‹ï¼ŒKNNæä¾›äº†<span class="highlight-primary">å¤©ç„¶çš„å¯è§£é‡Šæ€§</span>ï¼š</p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ” <span class="highlight-success">é€æ˜åº¦é«˜</span>ï¼šå¯ä»¥æŸ¥çœ‹å…·ä½“çš„é‚»å±…</li>
                <li>ğŸ“Š <span class="highlight-warning">ç›´è§‚ç†è§£</span>ï¼šåŸºäºç›¸ä¼¼æ¡ˆä¾‹çš„æ¨ç†</li>
                <li>ğŸ¯ <span class="highlight-danger">å¯è¿½æº¯æ€§</span>ï¼šèƒ½å¤Ÿè§£é‡Šæ¯ä¸ªé¢„æµ‹</li>
                <li>ğŸ’¡ <span class="highlight-primary">ç½®ä¿¡åº¦é‡åŒ–</span>ï¼šé€šè¿‡é‚»å±…åˆ†å¸ƒè¯„ä¼°</li>
            </ul>
        </div>
    </div>

    <!-- 4.10 ç®—æ³•å¯¹æ¯” -->
    <div id="comparison" class="section-card fade-in section-anchor">
        <h2 class="section-title">âš–ï¸ 4.10 KNNä¸å…¶ä»–ç®—æ³•å¯¹æ¯”</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” ä»€ä¹ˆæ—¶å€™é€‰æ‹©KNNï¼Ÿ</h3>
            <p>æ¯ä¸ªç®—æ³•éƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯ï¼Œå¦‚ä½•é€‰æ‹©åˆé€‚çš„ç®—æ³•ï¼Ÿ</p>
            <p>è®©æˆ‘ä»¬é€šè¿‡å¯¹æ¯”æ¥ç†è§£KNNçš„ç‹¬ç‰¹ä»·å€¼ï¼</p>
        </div>

        <table class="data-table">
            <thead>
            <tr>
                <th>ç‰¹æ€§</th>
                <th>KNN</th>
                <th>å†³ç­–æ ‘</th>
                <th>SVM</th>
                <th>ç¥ç»ç½‘ç»œ</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><strong>å­¦ä¹ æ–¹å¼</strong></td>
                <td><span class="highlight-primary">æ‡’æƒ°å­¦ä¹ </span></td>
                <td>è´ªå¿ƒåˆ†å‰²</td>
                <td>æœ€å¤§é—´éš”</td>
                <td>åå‘ä¼ æ’­</td>
            </tr>
            <tr>
                <td><strong>å†³ç­–è¾¹ç•Œ</strong></td>
                <td><span class="highlight-success">å±€éƒ¨éçº¿æ€§</span></td>
                <td>è½´å¹³è¡Œåˆ†å‰²</td>
                <td>å…¨å±€æœ€ä¼˜</td>
                <td>é«˜åº¦éçº¿æ€§</td>
            </tr>
            <tr>
                <td><strong>è®­ç»ƒé€Ÿåº¦</strong></td>
                <td><span class="highlight-warning">O(1) æå¿«</span></td>
                <td>O(n log n)</td>
                <td>O(nÂ²~nÂ³)</td>
                <td>O(nÃ—epochs)</td>
            </tr>
            <tr>
                <td><strong>é¢„æµ‹é€Ÿåº¦</strong></td>
                <td><span class="highlight-danger">O(n) æ…¢</span></td>
                <td>O(log d) å¿«</td>
                <td>O(nsv) ä¸­ç­‰</td>
                <td>O(1) å¿«</td>
            </tr>
            <tr>
                <td><strong>å¯è§£é‡Šæ€§</strong></td>
                <td><span class="highlight-primary">â˜…â˜…â˜…â˜…â˜…</span></td>
                <td>â˜…â˜…â˜…â˜…â˜†</td>
                <td>â˜…â˜…â˜†â˜†â˜†</td>
                <td>â˜…â˜†â˜†â˜†â˜†</td>
            </tr>
            <tr>
                <td><strong>å‚æ•°è°ƒä¼˜</strong></td>
                <td><span class="highlight-success">ç®€å•(Kå€¼)</span></td>
                <td>ä¸­ç­‰</td>
                <td>å¤æ‚(C,Î³)</td>
                <td>å¾ˆå¤æ‚</td>
            </tr>
            <tr>
                <td><strong>æ•°æ®è¦æ±‚</strong></td>
                <td>ä¸­ç­‰</td>
                <td>å°‘é‡å³å¯</td>
                <td>ä¸­ç­‰</td>
                <td>å¤§é‡æ•°æ®</td>
            </tr>
            <tr>
                <td><strong>å™ªå£°é²æ£’æ€§</strong></td>
                <td><span class="highlight-warning">è¾ƒå·®(K=1æ—¶)</span></td>
                <td>ä¸­ç­‰</td>
                <td>è¾ƒå¥½</td>
                <td>è¾ƒå¥½</td>
            </tr>
            </tbody>
        </table>

        <div class="comparison-grid" style="margin-top: 30px;">
            <div class="comparison-item">
                <div class="comparison-header">
                    <div class="comparison-icon">âœ…</div>
                    <div class="comparison-title">KNNçš„ä¼˜åŠ¿åœºæ™¯</div>
                </div>
                <p>ğŸ“Š <strong>ä½ç»´æ•°æ®</strong>ï¼ˆd < 20ï¼‰</p>
                <p>ğŸ¯ <strong>å±€éƒ¨æ¨¡å¼æ˜æ˜¾</strong></p>
                <p>ğŸ’¡ <strong>éœ€è¦å¯è§£é‡Šæ€§</strong></p>
                <p>ğŸ”„ <strong>æ•°æ®åŠ¨æ€æ›´æ–°</strong></p>
                <p>ğŸ“ˆ <strong>éçº¿æ€§è¾¹ç•Œ</strong></p>
            </div>
            <div class="comparison-item">
                <div class="comparison-header">
                    <div class="comparison-icon">âŒ</div>
                    <div class="comparison-title">ä¸é€‚åˆKNNçš„åœºæ™¯</div>
                </div>
                <p>ğŸ“ <strong>é«˜ç»´ç¨€ç–æ•°æ®</strong></p>
                <p>ğŸ’¾ <strong>æµ·é‡æ•°æ®é›†</strong></p>
                <p>âš¡ <strong>å®æ—¶é¢„æµ‹éœ€æ±‚</strong></p>
                <p>ğŸ² <strong>å™ªå£°æ•°æ®å¤š</strong></p>
                <p>ğŸ“± <strong>ç§»åŠ¨ç«¯éƒ¨ç½²</strong></p>
            </div>
        </div>

        <!-- ç®—æ³•é€‰æ‹©å†³ç­–æ ‘ -->
        <div class="decision-boundary">
            <h4 style="text-align: center; color: var(--knn-purple); margin-bottom: 20px;">ğŸ¯ ç®—æ³•é€‰æ‹©å†³ç­–æŒ‡å—</h4>
            <div style="background: var(--bg-card); padding: 30px; border-radius: 15px;">
                <pre style="color: var(--text-primary); font-family: monospace; line-height: 2;">
æ•°æ®é›†è§„æ¨¡ï¼Ÿ
â”œâ”€ å°ï¼ˆ<1000æ ·æœ¬ï¼‰
â”‚  â””â”€ éœ€è¦å¯è§£é‡Šæ€§ï¼Ÿ
â”‚     â”œâ”€ æ˜¯ â†’ <span class="highlight-primary">KNN</span> æˆ– å†³ç­–æ ‘
â”‚     â””â”€ å¦ â†’ SVM
â”œâ”€ ä¸­ï¼ˆ1000-10000ï¼‰
â”‚  â””â”€ ç‰¹å¾ç»´åº¦ï¼Ÿ
â”‚     â”œâ”€ ä½ï¼ˆ<20ï¼‰ â†’ <span class="highlight-primary">KNN</span>
â”‚     â””â”€ é«˜ï¼ˆ>20ï¼‰ â†’ SVM æˆ– éšæœºæ£®æ—
â””â”€ å¤§ï¼ˆ>10000ï¼‰
   â””â”€ è®¡ç®—èµ„æºå……è¶³ï¼Ÿ
      â”œâ”€ æ˜¯ â†’ ç¥ç»ç½‘ç»œ
      â””â”€ å¦ â†’ éœ€è¦è¿‘ä¼¼ï¼Ÿ
         â”œâ”€ æ˜¯ â†’ <span class="highlight-warning">è¿‘ä¼¼KNN</span>ï¼ˆLSHï¼‰
         â””â”€ å¦ â†’ çº¿æ€§æ¨¡å‹
                </pre>
            </div>
        </div>
    </div>

    <!-- 4.11 å®æˆ˜æ¡ˆä¾‹ -->
    <div id="practice" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ’» 4.11 å®æˆ˜æ¡ˆä¾‹ï¼šæ‰‹å†™æ•°å­—è¯†åˆ«</h2>

        <div class="case-study">
            <h3>ğŸ¯ é¡¹ç›®èƒŒæ™¯</h3>
            <p>æ‰‹å†™æ•°å­—è¯†åˆ«æ˜¯è®¡ç®—æœºè§†è§‰çš„ç»å…¸é—®é¢˜ï¼Œå¹¿æ³›åº”ç”¨äºï¼š</p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ“® é‚®æ”¿ç¼–ç è¯†åˆ«</li>
                <li>ğŸ¦ é“¶è¡Œæ”¯ç¥¨å¤„ç†</li>
                <li>ğŸ“ è¡¨å•æ•°å­—åŒ–</li>
                <li>ğŸ“± æ‰‹å†™è¾“å…¥æ³•</li>
            </ul>
            <p>æˆ‘ä»¬å°†ä½¿ç”¨KNNåœ¨MNISTæ•°æ®é›†ä¸Šå®ç°ä¸€ä¸ªå®Œæ•´çš„æ‰‹å†™æ•°å­—è¯†åˆ«ç³»ç»Ÿã€‚</p>
        </div>

        <div class="code-block">
            <pre><code><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_digits
<span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split, GridSearchCV
<span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler
<span class="keyword">from</span> sklearn.decomposition <span class="keyword">import</span> PCA
<span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report, confusion_matrix
<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt
<span class="keyword">import</span> numpy <span class="keyword">as</span> np

<span class="keyword">class</span> <span class="function">HandwritingRecognizer</span>:
    <span class="string">"""æ‰‹å†™æ•°å­—è¯†åˆ«ç³»ç»Ÿ"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self):
        self.scaler = StandardScaler()
        self.pca = PCA(n_components=<span class="number">0.95</span>)  <span class="comment"># ä¿ç•™95%çš„æ–¹å·®</span>
        self.knn = <span class="keyword">None</span>
        self.best_params = <span class="keyword">None</span>

    <span class="keyword">def</span> <span class="function">load_and_prepare_data</span>(self):
        <span class="string">"""åŠ è½½å¹¶å‡†å¤‡æ•°æ®"""</span>
        <span class="comment"># åŠ è½½æ•°æ®</span>
        digits = load_digits()
        X, y = digits.data, digits.target

        <span class="keyword">print</span>(f<span class="string">"æ•°æ®é›†å½¢çŠ¶: {X.shape}"</span>)
        <span class="keyword">print</span>(f<span class="string">"ç±»åˆ«æ•°é‡: {len(np.unique(y))}"</span>)

        <span class="comment"># å¯è§†åŒ–ä¸€äº›æ ·æœ¬</span>
        self._visualize_samples(digits.images[:<span class="number">10</span>], y[:<span class="number">10</span>])

        <span class="comment"># åˆ’åˆ†æ•°æ®é›†</span>
        X_train, X_test, y_train, y_test = train_test_split(
            X, y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>, stratify=y
        )

        <span class="keyword">return</span> X_train, X_test, y_train, y_test

    <span class="keyword">def</span> <span class="function">_visualize_samples</span>(self, images, labels):
        <span class="string">"""å¯è§†åŒ–æ‰‹å†™æ•°å­—æ ·æœ¬"""</span>
        fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">5</span>, figsize=(<span class="number">12</span>, <span class="number">5</span>))
        axes = axes.ravel()

        <span class="keyword">for</span> i, (image, label) <span class="keyword">in</span> enumerate(zip(images, labels)):
            axes[i].imshow(image, cmap=<span class="string">'gray'</span>)
            axes[i].set_title(f<span class="string">'æ ‡ç­¾: {label}'</span>)
            axes[i].axis(<span class="string">'off'</span>)

        plt.suptitle(<span class="string">'æ‰‹å†™æ•°å­—æ ·æœ¬'</span>)
        plt.tight_layout()
        plt.show()

    <span class="keyword">def</span> <span class="function">preprocess_data</span>(self, X_train, X_test):
        <span class="string">"""æ•°æ®é¢„å¤„ç†"""</span>
        <span class="comment"># æ ‡å‡†åŒ–</span>
        X_train_scaled = self.scaler.fit_transform(X_train)
        X_test_scaled = self.scaler.transform(X_test)

        <span class="comment"># PCAé™ç»´</span>
        X_train_pca = self.pca.fit_transform(X_train_scaled)
        X_test_pca = self.pca.transform(X_test_scaled)

        <span class="keyword">print</span>(f<span class="string">"\nPCAé™ç»´åçš„ç‰¹å¾æ•°: {X_train_pca.shape[1]}"</span>)
        <span class="keyword">print</span>(f<span class="string">"è§£é‡Šæ–¹å·®æ¯”: {self.pca.explained_variance_ratio_.sum():.4f}"</span>)

        <span class="keyword">return</span> X_train_pca, X_test_pca

    <span class="keyword">def</span> <span class="function">optimize_hyperparameters</span>(self, X_train, y_train):
        <span class="string">"""è¶…å‚æ•°ä¼˜åŒ–"""</span>
        <span class="keyword">print</span>(<span class="string">"\nå¼€å§‹è¶…å‚æ•°ä¼˜åŒ–..."</span>)

        param_grid = {
            <span class="string">'n_neighbors'</span>: [<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>],
            <span class="string">'weights'</span>: [<span class="string">'uniform'</span>, <span class="string">'distance'</span>],
            <span class="string">'metric'</span>: [<span class="string">'euclidean'</span>, <span class="string">'manhattan'</span>]
        }

        knn = KNeighborsClassifier()
        grid_search = GridSearchCV(
            knn, param_grid, cv=<span class="number">5</span>,
            scoring=<span class="string">'accuracy'</span>, n_jobs=-<span class="number">1</span>, verbose=<span class="number">1</span>
        )

        grid_search.fit(X_train, y_train)

        self.best_params = grid_search.best_params_
        self.knn = grid_search.best_estimator_

        <span class="keyword">print</span>(f<span class="string">"\næœ€ä½³å‚æ•°: {self.best_params}"</span>)
        <span class="keyword">print</span>(f<span class="string">"äº¤å‰éªŒè¯æœ€ä½³åˆ†æ•°: {grid_search.best_score_:.4f}"</span>)

        <span class="keyword">return</span> self.knn

    <span class="keyword">def</span> <span class="function">evaluate_model</span>(self, X_test, y_test):
        <span class="string">"""è¯„ä¼°æ¨¡å‹æ€§èƒ½"""</span>
        y_pred = self.knn.predict(X_test)
        accuracy = self.knn.score(X_test, y_test)

        <span class="keyword">print</span>(f<span class="string">"\næµ‹è¯•é›†å‡†ç¡®ç‡: {accuracy:.4f}"</span>)

        <span class="comment"># è¯¦ç»†åˆ†ç±»æŠ¥å‘Š</span>
        <span class="keyword">print</span>(<span class="string">"\nåˆ†ç±»æŠ¥å‘Š:"</span>)
        <span class="keyword">print</span>(classification_report(y_test, y_pred))

        <span class="comment"># æ··æ·†çŸ©é˜µ</span>
        self._plot_confusion_matrix(y_test, y_pred)

        <span class="comment"># é”™è¯¯æ¡ˆä¾‹åˆ†æ</span>
        self._analyze_errors(X_test, y_test, y_pred)</code></pre>
        </div>

        <!-- å®æˆ˜ç»“æœå±•ç¤º -->
        <div class="experiment-chart">
            <h4 class="chart-title">ğŸ¯ æ¨¡å‹æ€§èƒ½è¡¨ç°</h4>
            <div class="result-card" style="margin-top: 20px;">
                <h5 style="color: var(--knn-purple);">å…³é”®æ€§èƒ½æŒ‡æ ‡</h5>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: 20px;">
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; color: var(--knn-purple); font-weight: bold;">97.2%</div>
                        <div style="color: var(--text-muted);">å‡†ç¡®ç‡</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; color: var(--knn-blue); font-weight: bold;">0.03s</div>
                        <div style="color: var(--text-muted);">å•å¼ é¢„æµ‹æ—¶é—´</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; color: var(--knn-pink); font-weight: bold;">30</div>
                        <div style="color: var(--text-muted);">PCAç»´åº¦</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; color: var(--knn-orange); font-weight: bold;">K=5</div>
                        <div style="color: var(--text-muted);">æœ€ä¼˜é‚»å±…æ•°</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="insight-box">
            <h4>ğŸ’¡ å®æˆ˜ç»éªŒæ€»ç»“</h4>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ“Š <span class="highlight-primary">æ•°æ®é¢„å¤„ç†æ˜¯å…³é”®</span>ï¼šæ ‡å‡†åŒ–+PCAå¤§å¹…æå‡æ€§èƒ½</li>
                <li>ğŸ”§ <span class="highlight-success">å‚æ•°ä¼˜åŒ–å¾ˆé‡è¦</span>ï¼šK=5åœ¨è¯¥æ•°æ®é›†ä¸Šè¡¨ç°æœ€ä½³</li>
                <li>ğŸ“ˆ <span class="highlight-warning">é”™è¯¯åˆ†ææœ‰ä»·å€¼</span>ï¼šæ˜“æ··æ·†çš„æ•°å­—å¯¹ï¼ˆå¦‚4å’Œ9ï¼‰</li>
                <li>âš¡ <span class="highlight-danger">æƒè¡¡ç²¾åº¦ä¸é€Ÿåº¦</span>ï¼šPCAé™ç»´å¹³è¡¡äº†ä¸¤è€…</li>
            </ul>
        </div>
    </div>

    <!-- 4.12 é«˜çº§åº”ç”¨ -->
    <div id="advanced" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸš€ 4.12 é«˜çº§åº”ç”¨ä¸å‰æ²¿è¿›å±•</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” KNNçš„æœªæ¥åœ¨å“ªé‡Œï¼Ÿ</h3>
            <p>è™½ç„¶KNNæ˜¯ä¸€ä¸ª"å¤è€"çš„ç®—æ³•ï¼Œä½†åœ¨ç°ä»£æœºå™¨å­¦ä¹ ä¸­ä»æœ‰é‡è¦åœ°ä½ï¼š</p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ” ä¸æ·±åº¦å­¦ä¹ ç»“åˆçš„<span class="highlight-primary">åº¦é‡å­¦ä¹ </span></li>
                <li>ğŸŒ å¤§è§„æ¨¡åˆ†å¸ƒå¼<span class="highlight-success">è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢</span></li>
                <li>ğŸ¯ å¤šæ¨¡æ€æ•°æ®çš„<span class="highlight-warning">è·¨åŸŸæ£€ç´¢</span></li>
                <li>ğŸ¤– å¯è§£é‡ŠAIä¸­çš„<span class="highlight-danger">æ¡ˆä¾‹æ¨ç†</span></li>
            </ul>
        </div>

        <div class="algorithm-variant">
            <h4>ğŸ§  æ·±åº¦KNNï¼ˆDeep KNNï¼‰</h4>
            <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>ä½¿ç”¨æ·±åº¦å­¦ä¹ æå–ç‰¹å¾ï¼ŒKNNè¿›è¡Œåˆ†ç±»</p>
            <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 10px; margin: 15px 0;">
                <p>1. é¢„è®­ç»ƒCNNæå–ç‰¹å¾</p>
                <p>2. ç‰¹å¾ç©ºé—´ä¸­åº”ç”¨KNN</p>
                <p>3. ç»“åˆæ·±åº¦ç‰¹å¾å’Œå¯è§£é‡Šæ€§</p>
            </div>
            <p><strong>åº”ç”¨ï¼š</strong>å›¾åƒæ£€ç´¢ã€äººè„¸è¯†åˆ«ã€å¼‚å¸¸æ£€æµ‹</p>
        </div>

        <div class="algorithm-variant">
            <h4>ğŸŒ åˆ†å¸ƒå¼KNN</h4>
            <p><strong>æŒ‘æˆ˜ï¼š</strong>å¦‚ä½•åœ¨TBçº§æ•°æ®ä¸Šå¿«é€Ÿæ‰¾åˆ°æœ€è¿‘é‚»ï¼Ÿ</p>
            <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
            <ul style="margin-left: 20px;">
                <li>MapReduceæ¡†æ¶å¹¶è¡Œè®¡ç®—</li>
                <li>åˆ†å¸ƒå¼å“ˆå¸Œè¡¨ï¼ˆDHTï¼‰</li>
                <li>å‘é‡æ•°æ®åº“ï¼ˆMilvusã€Faissï¼‰</li>
            </ul>
        </div>

        <div class="code-block">
            <pre><code><span class="keyword">import</span> torch
<span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn
<span class="keyword">import</span> torchvision.models <span class="keyword">as</span> models
<span class="keyword">import</span> numpy <span class="keyword">as</span> np

<span class="keyword">class</span> <span class="function">DeepKNN</span>:
    <span class="string">"""æ·±åº¦ç‰¹å¾æå– + KNNåˆ†ç±»"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, backbone=<span class="string">'resnet50'</span>, n_neighbors=<span class="number">5</span>):
        <span class="comment"># åŠ è½½é¢„è®­ç»ƒæ¨¡å‹</span>
        <span class="keyword">if</span> backbone == <span class="string">'resnet50'</span>:
            self.feature_extractor = models.resnet50(pretrained=<span class="keyword">True</span>)
            <span class="comment"># ç§»é™¤æœ€åçš„åˆ†ç±»å±‚</span>
            self.feature_extractor = nn.Sequential(
                *list(self.feature_extractor.children())[:-<span class="number">1</span>]
            )
            self.feature_dim = <span class="number">2048</span>

        self.feature_extractor.eval()
        self.n_neighbors = n_neighbors
        self.feature_database = <span class="keyword">None</span>
        self.label_database = <span class="keyword">None</span>

    <span class="keyword">def</span> <span class="function">extract_features</span>(self, images):
        <span class="string">"""æå–æ·±åº¦ç‰¹å¾"""</span>
        <span class="keyword">with</span> torch.no_grad():
            features = self.feature_extractor(images)
            features = features.view(features.size(<span class="number">0</span>), -<span class="number">1</span>)
        <span class="keyword">return</span> features.numpy()

    <span class="keyword">def</span> <span class="function">fit</span>(self, train_loader):
        <span class="string">"""æ„å»ºç‰¹å¾æ•°æ®åº“"""</span>
        all_features = []
        all_labels = []

        <span class="keyword">for</span> images, labels <span class="keyword">in</span> train_loader:
            features = self.extract_features(images)
            all_features.append(features)
            all_labels.extend(labels.numpy())

        self.feature_database = np.vstack(all_features)
        self.label_database = np.array(all_labels)

        <span class="comment"># ä½¿ç”¨Faissæ„å»ºç´¢å¼•ï¼ˆå¯é€‰ï¼‰</span>
        <span class="keyword">try</span>:
            <span class="keyword">import</span> faiss
            self.index = faiss.IndexFlatL2(self.feature_dim)
            self.index.add(self.feature_database)
            self.use_faiss = <span class="keyword">True</span>
        <span class="keyword">except</span>:
            self.use_faiss = <span class="keyword">False</span>

    <span class="keyword">def</span> <span class="function">predict</span>(self, images):
        <span class="string">"""ä½¿ç”¨KNNé¢„æµ‹"""</span>
        features = self.extract_features(images)

        <span class="keyword">if</span> self.use_faiss:
            <span class="comment"># ä½¿ç”¨FaissåŠ é€Ÿæœç´¢</span>
            distances, indices = self.index.search(features, self.n_neighbors)
        <span class="keyword">else</span>:
            <span class="comment"># æš´åŠ›æœç´¢</span>
            <span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> NearestNeighbors
            nbrs = NearestNeighbors(n_neighbors=self.n_neighbors)
            nbrs.fit(self.feature_database)
            distances, indices = nbrs.kneighbors(features)

        <span class="comment"># æŠ•ç¥¨é¢„æµ‹</span>
        predictions = []
        <span class="keyword">for</span> idx <span class="keyword">in</span> indices:
            neighbor_labels = self.label_database[idx]
            pred = np.bincount(neighbor_labels).argmax()
            predictions.append(pred)

        <span class="keyword">return</span> np.array(predictions)</code></pre>
        </div>

        <div class="deep-thinking">
            <h3>ğŸ§  æ·±åº¦æ€è€ƒï¼šKNNçš„å“²å­¦æ„ä¹‰</h3>
            <p><strong>1. ç›¸ä¼¼æ€§çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
            <p>KNNå‡è®¾ç›¸ä¼¼çš„äº‹ç‰©æœ‰ç›¸ä¼¼çš„å±æ€§ï¼Œä½†"ç›¸ä¼¼"æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ·±åˆ»çš„å“²å­¦é—®é¢˜ã€‚åœ¨ä¸åŒçš„æ–‡åŒ–ã€è¯­å¢ƒä¸‹ï¼Œç›¸ä¼¼æ€§çš„å®šä¹‰å¯èƒ½å®Œå…¨ä¸åŒã€‚</p>

            <p><strong>2. å±€éƒ¨æ€§åŸç†çš„æ™®é€‚æ€§</strong></p>
            <p>KNNä½“ç°äº†å±€éƒ¨æ€§åŸç†â€”â€”ç©ºé—´ä¸­ç›¸è¿‘çš„ç‚¹å¾€å¾€å±äºåŒä¸€ç±»ã€‚è¿™ä¸ªåŸç†åœ¨ç‰©ç†ä¸–ç•Œæ™®éå­˜åœ¨ï¼Œä½†åœ¨é«˜ç»´æŠ½è±¡ç©ºé—´æ˜¯å¦ä»ç„¶æˆç«‹ï¼Ÿ</p>

            <p><strong>3. è®°å¿†ä¸æ³›åŒ–çš„å¹³è¡¡</strong></p>
            <p>KNNå®Œå…¨"è®°ä½"è®­ç»ƒæ•°æ®ï¼Œè¿™æ˜¯ä¼˜åŠ¿è¿˜æ˜¯åŠ£åŠ¿ï¼Ÿäººç±»çš„å­¦ä¹ ä¹Ÿæ˜¯åœ¨è®°å¿†å…·ä½“æ¡ˆä¾‹å’ŒæŠ½è±¡æ³›åŒ–ä¹‹é—´å¯»æ‰¾å¹³è¡¡ã€‚</p>
        </div>

        <div class="pro-tip">
            <p><strong>å‰æ²¿ç ”ç©¶æ–¹å‘ï¼š</strong></p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ”¬ <span class="highlight-primary">åº¦é‡å­¦ä¹ </span>ï¼šè‡ªåŠ¨å­¦ä¹ æœ€ä¼˜è·ç¦»åº¦é‡</li>
                <li>ğŸŒ <span class="highlight-success">å›¾ç¥ç»ç½‘ç»œä¸­çš„KNN</span>ï¼šæ„å»ºåŠ¨æ€é‚»å±…å›¾</li>
                <li>ğŸ¤– <span class="highlight-warning">æŒç»­å­¦ä¹ </span>ï¼šå¢é‡å¼æ›´æ–°KNNæ¨¡å‹</li>
                <li>ğŸ¯ <span class="highlight-danger">å¯¹æŠ—é²æ£’æ€§</span>ï¼šæé«˜KNNæŠ—æ”»å‡»èƒ½åŠ›</li>
            </ul>
        </div>
    </div>

    <!-- 4.13 æ€»ç»“ä¸å±•æœ› -->
    <div id="summary" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ“ 4.13 æ€»ç»“ä¸å±•æœ›</h2>

        <div class="thinking-box">
            <h3>ğŸ¤” å›åˆ°æœ€åˆçš„é—®é¢˜</h3>
            <p>è¿˜è®°å¾—æˆ‘ä»¬å¼€å¤´çš„æˆ¿ä»·è¯„ä¼°é—®é¢˜å—ï¼Ÿç°åœ¨ä½ å·²ç»å­¦å®Œäº†KNNç®—æ³•ï¼Œè®©æˆ‘ä»¬é‡æ–°æ€è€ƒï¼š</p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>ğŸ  <span class="highlight-primary">ç›¸ä¼¼æˆ¿å­</span> = æœ€è¿‘é‚»å±…</li>
                <li>ğŸ“ <span class="highlight-success">ç‰¹å¾æ¯”è¾ƒ</span> = è·ç¦»è®¡ç®—</li>
                <li>ğŸ” <span class="highlight-warning">é€‰æ‹©å‡ å¥—</span> = Kå€¼é€‰æ‹©</li>
                <li>ğŸ’° <span class="highlight-danger">å‚è€ƒå®šä»·</span> = åŠ æƒå¹³å‡/æŠ•ç¥¨</li>
            </ul>
            <p><strong>ç°åœ¨çš„ä½ ï¼Œæ˜¯å¦èƒ½æ›´æ·±åˆ»åœ°ç†è§£KNNçš„æœ¬è´¨ï¼Ÿ</strong></p>
        </div>

        <div class="mind-map">
            <div class="mind-node">
                <h4>ğŸ§  æ ¸å¿ƒæ€æƒ³</h4>
                <p><span class="highlight-primary">"è¿‘æœ±è€…èµ¤ï¼Œè¿‘å¢¨è€…é»‘"</span></p>
                <p>ç›¸ä¼¼æ ·æœ¬åº”æœ‰ç›¸ä¼¼æ ‡ç­¾</p>
                <p>åŸºäºæ¡ˆä¾‹çš„æ¨ç†</p>
            </div>
            <div class="mind-node">
                <h4>ğŸ” ç®—æ³•æœ¬è´¨</h4>
                <p><span class="highlight-success">æ‡’æƒ°å­¦ä¹ </span>ï¼šå­˜å‚¨æ‰€æœ‰æ•°æ®</p>
                <p><span class="highlight-warning">éå‚æ•°åŒ–</span>ï¼šä¸å‡è®¾åˆ†å¸ƒ</p>
                <p><span class="highlight-danger">å±€éƒ¨å»ºæ¨¡</span>ï¼šå…³æ³¨é‚»åŸŸ</p>
            </div>
            <div class="mind-node">
                <h4>âš™ï¸ å…³é”®è¦ç´ </h4>
                <p><span class="highlight-danger">Kå€¼</span>ï¼šé‚»å±…æ•°é‡</p>
                <p><span class="highlight-primary">è·ç¦»</span>ï¼šç›¸ä¼¼æ€§åº¦é‡</p>
                <p><span class="highlight-success">æƒé‡</span>ï¼šå½±å“ç¨‹åº¦</p>
            </div>
            <div class="mind-node">
                <h4>ğŸ“Š å®è·µè¦ç‚¹</h4>
                <p><span class="highlight-success">æ•°æ®é¢„å¤„ç†</span>ï¼šå¿…ä¸å¯å°‘</p>
                <p><span class="highlight-warning">å‚æ•°è°ƒä¼˜</span>ï¼šç½‘æ ¼æœç´¢</p>
                <p><span class="highlight-danger">å¯è§£é‡Šæ€§</span>ï¼šå¤©ç„¶ä¼˜åŠ¿</p>
            </div>
        </div>

        <!-- çŸ¥è¯†æ€»ç»“è¡¨ -->
        <div class="summary-card">
            <div class="summary-content">
                <h3 style="font-size: 2rem; margin-bottom: 30px;">ğŸ¯ KNNç®—æ³•çŸ¥è¯†å›¾è°±</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px;">
                    <div>
                        <h4 style="color: #fbbf24; margin-bottom: 15px;">ç†è®ºåŸºç¡€</h4>
                        <p>âœ“ å®ä¾‹å­¦ä¹ ç†è®º</p>
                        <p>âœ“ è´å¶æ–¯å†³ç­–ç†è®º</p>
                        <p>âœ“ Cover-Hartå®šç†</p>
                        <p>âœ“ ç»´æ•°ç¾éš¾</p>
                    </div>
                    <div>
                        <h4 style="color: #10b981; margin-bottom: 15px;">æ ¸å¿ƒæŠ€æœ¯</h4>
                        <p>âœ“ è·ç¦»åº¦é‡æ–¹æ³•</p>
                        <p>âœ“ åŠ é€Ÿæ•°æ®ç»“æ„</p>
                        <p>âœ“ ç‰¹å¾å·¥ç¨‹</p>
                        <p>âœ“ å‚æ•°ä¼˜åŒ–</p>
                    </div>
                    <div>
                        <h4 style="color: #ec4899; margin-bottom: 15px;">åº”ç”¨é¢†åŸŸ</h4>
                        <p>âœ“ æ¨èç³»ç»Ÿ</p>
                        <p>âœ“ å›¾åƒè¯†åˆ«</p>
                        <p>âœ“ å¼‚å¸¸æ£€æµ‹</p>
                        <p>âœ“ æ–‡æœ¬åˆ†ç±»</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="exercise-box">
            <h3>âœï¸ ç»ƒä¹ ä¸æ€è€ƒ</h3>
            <ol style="margin-left: 20px; line-height: 2.5;">
                <li><strong>ç®—æ³•ç†è§£ï¼š</strong>ä¸ºä»€ä¹ˆè¯´KNNæ˜¯"æœ€ç¬¦åˆäººç±»ç›´è§‰"çš„ç®—æ³•ï¼Ÿ</li>
                <li><strong>å‚æ•°å½±å“ï¼š</strong>Kå€¼ä»1å¢åŠ åˆ°nï¼ˆæ ·æœ¬æ€»æ•°ï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œå†³ç­–è¾¹ç•Œå¦‚ä½•å˜åŒ–ï¼Ÿ</li>
                <li><strong>è·ç¦»é€‰æ‹©ï¼š</strong>å¯¹äºæ–‡æœ¬æ•°æ®ï¼Œä¸ºä»€ä¹ˆä½™å¼¦è·ç¦»æ¯”æ¬§å¼è·ç¦»æ›´åˆé€‚ï¼Ÿ</li>
                <li><strong>ä¼˜åŒ–æ€è€ƒï¼š</strong>å¦‚æœè¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šéƒ¨ç½²KNNï¼Œä½ ä¼šå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</li>
                <li><strong>ç®—æ³•æ”¹è¿›ï¼š</strong>è®¾è®¡ä¸€ä¸ªè‡ªé€‚åº”Kå€¼çš„KNNå˜ä½“ï¼ŒKéšæ•°æ®å¯†åº¦å˜åŒ–ã€‚</li>
                <li><strong>å®é™…åº”ç”¨ï¼š</strong>ç”¨KNNå®ç°ä¸€ä¸ªç®€å•çš„éŸ³ä¹æ¨èç³»ç»Ÿã€‚</li>
            </ol>
        </div>

        <div class="deep-thinking">
            <h3>ğŸ§  æ·±å…¥æ€è€ƒ</h3>
            <p><strong>KNN vs äººç±»è®¤çŸ¥ï¼š</strong></p>
            <p>äººç±»åœ¨åšå†³ç­–æ—¶ï¼ŒçœŸçš„æ˜¯ç®€å•åœ°å‚è€ƒ"æœ€è¿‘çš„Kä¸ªæ¡ˆä¾‹"å—ï¼Ÿè¿˜æ˜¯æœ‰æ›´å¤æ‚çš„æœºåˆ¶ï¼Ÿ</p>
            <ul style="margin-left: 20px; line-height: 2; margin-top: 15px;">
                <li>äººç±»ä¼šæ ¹æ®æƒ…å¢ƒ<span class="highlight-primary">åŠ¨æ€è°ƒæ•´Kå€¼</span></li>
                <li>ä¸åŒç‰¹å¾çš„<span class="highlight-success">é‡è¦æ€§ä¼šå˜åŒ–</span></li>
                <li>ä¼šè€ƒè™‘<span class="highlight-warning">æ—¶é—´å› ç´ </span>ï¼ˆæœ€è¿‘çš„ç»éªŒæ›´é‡è¦ï¼‰</li>
                <li>æœ‰<span class="highlight-danger">æŠ½è±¡å’Œæ³›åŒ–</span>çš„èƒ½åŠ›</li>
            </ul>
            <p style="margin-top: 20px;">è¿™äº›å·®å¼‚å¯å‘æˆ‘ä»¬ï¼šæœºå™¨å­¦ä¹ ä¸æ˜¯ç®€å•åœ°æ¨¡ä»¿äººç±»ï¼Œè€Œæ˜¯ç”¨æ•°å­¦æ–¹æ³•å®ç°æ™ºèƒ½è¡Œä¸ºã€‚</p>
        </div>

        <div style="text-align: center; margin: 50px 0;">
            <div style="background: linear-gradient(135deg, var(--knn-purple), var(--knn-blue)); color: white; padding: 40px; border-radius: 20px; display: inline-block; box-shadow: 0 20px 40px rgba(124, 58, 237, 0.3); max-width: 800px;">
                <h3 style="font-size: 2.5rem; margin-bottom: 20px;">ğŸ‰ æ­å–œå®ŒæˆKNNç®—æ³•å­¦ä¹ ï¼</h3>
                <p style="font-size: 1.2rem; line-height: 1.8; margin-bottom: 30px;">
                    ä»åŸºç¡€æ¦‚å¿µåˆ°å®æˆ˜åº”ç”¨ï¼Œä»æ•°å­¦åŸç†åˆ°ä»£ç å®ç°<br>
                    ä½ å·²ç»å…¨é¢æŒæ¡äº†è¿™ä¸ªæœ€ç›´è§‚çš„æœºå™¨å­¦ä¹ ç®—æ³•<br>
                    KNNçš„ç®€å•ä¸­è•´å«ç€æ·±åˆ»çš„æ™ºæ…§
                </p>
                <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <button class="demo-btn" onclick="downloadNotes()" style="background: rgba(255,255,255,0.2); padding: 15px 30px; font-size: 1rem;">
                        ğŸ“¥ ä¸‹è½½å­¦ä¹ ç¬”è®°
                    </button>
                    <button class="demo-btn" onclick="startQuiz()" style="background: rgba(255,255,255,0.2); padding: 15px 30px; font-size: 1rem;">
                        ğŸ§  å¼€å§‹çŸ¥è¯†æµ‹éªŒ
                    </button>
                    <button class="demo-btn" onclick="shareProgress()" style="background: rgba(255,255,255,0.2); padding: 15px 30px; font-size: 1rem;">
                        ğŸ“¤ åˆ†äº«å­¦ä¹ æˆæœ
                    </button>
                </div>
            </div>
        </div>

        <div class="version-info">
            <p>ç¬¬4ç«  KNNç®—æ³• | ç‰ˆæœ¬ 2.0 | æœ€åæ›´æ–°ï¼š2024</p>
            <p>ä¸‹ä¸€ç« é¢„å‘Šï¼šå†³ç­–æ ‘ - å¦‚ä½•è®©æœºå™¨å­¦ä¼š"å¦‚æœ...é‚£ä¹ˆ..."çš„é€»è¾‘æ¨ç†</p>
        </div>
    </div>
</div>

<!-- æµ®åŠ¨å·¥å…·æ  -->
<div class="floating-toolbar">
    <button class="toolbar-btn theme-toggle-btn" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">
        <span class="theme-icon">ğŸŒ“</span>
    </button>
    <button class="toolbar-btn" onclick="scrollToTop()" title="å›åˆ°é¡¶éƒ¨">
        <span>â¬†ï¸</span>
    </button>
</div>

<script>
    // JavaScriptä»£ç 
    (function() {
        'use strict';

        // ä¸»é¢˜åˆ‡æ¢
        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            const isLight = document.body.classList.contains('light-theme');
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const icon = document.querySelector('.theme-icon');
            const isLight = document.body.classList.contains('light-theme');
            icon.textContent = isLight ? 'ğŸŒ' : 'ğŸŒ“';
        }

        // å¯¼èˆªåˆ‡æ¢
        function toggleNav() {
            document.body.classList.toggle('nav-open');
        }

        // æ»šåŠ¨åˆ°é¡¶éƒ¨
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // è¿›åº¦æ›´æ–°
        function updateProgress() {
            const sections = document.querySelectorAll('.section-card');
            const windowHeight = window.innerHeight;
            const scrollTop = window.scrollY;
            const documentHeight = document.documentElement.scrollHeight;

            let completedSections = 0;
            sections.forEach((section, index) => {
                const rect = section.getBoundingClientRect();
                const sectionCenter = rect.top + rect.height / 2;

                if (sectionCenter < windowHeight * 0.7) {
                    completedSections++;
                    const navItem = document.querySelector(`.nav-item:nth-child(${index + 1})`);
                    if (navItem) {
                        navItem.classList.add('completed');
                    }
                }
            });

            // æ›´æ–°è¿›åº¦
            const progress = Math.min((scrollTop / (documentHeight - windowHeight)) * 100, 100);
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const progressRing = document.getElementById('progressRing');
            const progressPercent = document.getElementById('progressPercent');

            if (progressFill) progressFill.style.width = progress + '%';
            if (progressText) progressText.textContent = Math.round(progress) + '%';
            if (progressPercent) progressPercent.textContent = Math.round(progress) + '%';

            // æ›´æ–°è¿›åº¦ç¯
            if (progressRing) {
                const circumference = 2 * Math.PI * 22;
                const offset = circumference - (progress / 100) * circumference;
                progressRing.style.strokeDashoffset = offset;
            }

            // æ›´æ–°ç»Ÿè®¡
            const completedSectionsEl = document.getElementById('completedSections');
            if (completedSectionsEl) {
                completedSectionsEl.textContent = `${completedSections}/${sections.length}`;
            }
        }

        // é«˜äº®å½“å‰ç« èŠ‚
        function highlightCurrentSection() {
            const sections = document.querySelectorAll('.section-card');
            const navItems = document.querySelectorAll('.nav-item');

            let currentSection = null;
            sections.forEach((section) => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= 100 && rect.bottom > 100) {
                    currentSection = section.id;
                }
            });

            navItems.forEach(item => {
                item.classList.remove('active');
                if (currentSection && item.dataset.section === currentSection) {
                    item.classList.add('active');
                }
            });
        }

        // åŠ¨æ€èƒŒæ™¯åŠ¨ç”»
        function initBackground() {
            const canvas = document.getElementById('knnNodesBg');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const nodes = [];
            const nodeCount = 50;

            // åˆ›å»ºèŠ‚ç‚¹
            for (let i = 0; i < nodeCount; i++) {
                nodes.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    radius: Math.random() * 3 + 1
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // æ›´æ–°å’Œç»˜åˆ¶èŠ‚ç‚¹
                nodes.forEach((node, i) => {
                    // æ›´æ–°ä½ç½®
                    node.x += node.vx;
                    node.y += node.vy;

                    // è¾¹ç•Œåå¼¹
                    if (node.x < 0 || node.x > canvas.width) node.vx *= -1;
                    if (node.y < 0 || node.y > canvas.height) node.vy *= -1;

                    // ç»˜åˆ¶èŠ‚ç‚¹
                    ctx.beginPath();
                    ctx.arc(node.x, node.y, node.radius, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(124, 58, 237, 0.5)';
                    ctx.fill();

                    // è¿æ¥æœ€è¿‘çš„Kä¸ªèŠ‚ç‚¹
                    const k = 3;
                    const distances = nodes.map((other, j) => ({
                        index: j,
                        distance: Math.sqrt(Math.pow(node.x - other.x, 2) + Math.pow(node.y - other.y, 2))
                    }));

                    distances.sort((a, b) => a.distance - b.distance);

                    for (let j = 1; j <= k && j < distances.length; j++) {
                        const other = nodes[distances[j].index];
                        const opacity = Math.max(0, 1 - distances[j].distance / 200);

                        ctx.beginPath();
                        ctx.moveTo(node.x, node.y);
                        ctx.lineTo(other.x, other.y);
                        ctx.strokeStyle = `rgba(102, 126, 234, ${opacity * 0.2})`;
                        ctx.stroke();
                    }
                });

                requestAnimationFrame(animate);
            }

            animate();

            // çª—å£å¤§å°è°ƒæ•´
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }

        // è·ç¦»æ¼”ç¤ºå¯è§†åŒ–
        function initDistanceDemo() {
            const canvas = document.getElementById('distanceDemo');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            let point1 = { x: 200, y: 200 };
            let point2 = { x: 600, y: 200 };
            let selectedPoint = null;
            let distanceType = 'euclidean';

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ç»˜åˆ¶ç½‘æ ¼
                ctx.strokeStyle = 'rgba(124, 58, 237, 0.1)';
                ctx.lineWidth = 1;
                for (let i = 0; i < canvas.width; i += 40) {
                    ctx.beginPath();
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, canvas.height);
                    ctx.stroke();
                }
                for (let i = 0; i < canvas.height; i += 40) {
                    ctx.beginPath();
                    ctx.moveTo(0, i);
                    ctx.lineTo(canvas.width, i);
                    ctx.stroke();
                }

                // ç»˜åˆ¶ç­‰è·ç¦»çº¿
                drawDistanceContours();

                // ç»˜åˆ¶ç‚¹
                drawPoint(point1, '#667eea', 'ç‚¹A');
                drawPoint(point2, '#ec4899', 'ç‚¹B');

                // æ˜¾ç¤ºè·ç¦»
                const distance = calculateDistance(point1, point2, distanceType);
                document.getElementById('distanceResult').innerHTML =
                    `è·ç¦»: <span style="color: var(--knn-purple)">${distance.toFixed(2)}</span>`;
            }

            function drawPoint(point, color, label) {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 10, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();

                ctx.fillStyle = 'white';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(label, point.x, point.y);
            }

            function drawDistanceContours() {
                const distances = [50, 100, 150, 200];

                distances.forEach((d, i) => {
                    ctx.strokeStyle = `rgba(124, 58, 237, ${0.1 + i * 0.05})`;
                    ctx.lineWidth = 2;

                    if (distanceType === 'euclidean') {
                        ctx.beginPath();
                        ctx.arc(point1.x, point1.y, d, 0, Math.PI * 2);
                        ctx.stroke();
                    } else if (distanceType === 'manhattan') {
                        ctx.beginPath();
                        ctx.moveTo(point1.x + d, point1.y);
                        ctx.lineTo(point1.x, point1.y + d);
                        ctx.lineTo(point1.x - d, point1.y);
                        ctx.lineTo(point1.x, point1.y - d);
                        ctx.closePath();
                        ctx.stroke();
                    } else if (distanceType === 'chebyshev') {
                        ctx.strokeRect(point1.x - d, point1.y - d, d * 2, d * 2);
                    }
                });
            }

            function calculateDistance(p1, p2, type) {
                const dx = Math.abs(p1.x - p2.x);
                const dy = Math.abs(p1.y - p2.y);

                switch(type) {
                    case 'euclidean':
                        return Math.sqrt(dx * dx + dy * dy);
                    case 'manhattan':
                        return dx + dy;
                    case 'chebyshev':
                        return Math.max(dx, dy);
                    default:
                        return 0;
                }
            }

            // é¼ æ ‡äº‹ä»¶
            canvas.addEventListener('mousedown', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const d1 = Math.sqrt(Math.pow(x - point1.x, 2) + Math.pow(y - point1.y, 2));
                const d2 = Math.sqrt(Math.pow(x - point2.x, 2) + Math.pow(y - point2.y, 2));

                if (d1 < 20) {
                    selectedPoint = point1;
                } else if (d2 < 20) {
                    selectedPoint = point2;
                }
            });

            canvas.addEventListener('mousemove', (e) => {
                if (selectedPoint) {
                    const rect = canvas.getBoundingClientRect();
                    selectedPoint.x = e.clientX - rect.left;
                    selectedPoint.y = e.clientY - rect.top;
                    draw();
                }
            });

            canvas.addEventListener('mouseup', () => {
                selectedPoint = null;
            });

            // æ§åˆ¶å‡½æ•°
            window.changeDistance = function() {
                distanceType = document.getElementById('distanceSelect').value;
                draw();
            };

            window.resetDistance = function() {
                point1 = { x: 200, y: 200 };
                point2 = { x: 600, y: 200 };
                draw();
            };

            window.animateDistance = function() {
                let angle = 0;
                const radius = 150;
                const centerX = 400;
                const centerY = 200;

                const animate = () => {
                    angle += 0.02;
                    point2.x = centerX + Math.cos(angle) * radius;
                    point2.y = centerY + Math.sin(angle) * radius;
                    draw();

                    if (angle < Math.PI * 2) {
                        requestAnimationFrame(animate);
                    }
                };

                animate();
            };

            draw();
        }

        // KNNç®—æ³•æ¼”ç¤º
        function initKNNDemo() {
            const canvas = document.getElementById('knnDemo');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            let k = 5;
            let queryPoint = null;
            let dataPoints = [];

            // ç”Ÿæˆç¤ºä¾‹æ•°æ®
            function generateData() {
                dataPoints = [];

                // ç”Ÿæˆä¸¤ç±»æ•°æ®
                for (let i = 0; i < 30; i++) {
                    dataPoints.push({
                        x: Math.random() * 300 + 50,
                        y: Math.random() * 200 + 50,
                        class: 0
                    });
                }

                for (let i = 0; i < 30; i++) {
                    dataPoints.push({
                        x: Math.random() * 300 + 450,
                        y: Math.random() * 200 + 250,
                        class: 1
                    });
                }
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ç»˜åˆ¶æ•°æ®ç‚¹
                dataPoints.forEach(point => {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 8, 0, Math.PI * 2);
                    ctx.fillStyle = point.class === 0 ? '#667eea' : '#ec4899';
                    ctx.fill();
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                });

                // å¦‚æœæœ‰æŸ¥è¯¢ç‚¹ï¼Œæ‰§è¡ŒKNN
                if (queryPoint) {
                    performKNN();
                }
            }

            function performKNN() {
                // è®¡ç®—è·ç¦»
                const distances = dataPoints.map(point => ({
                    point: point,
                    distance: Math.sqrt(Math.pow(point.x - queryPoint.x, 2) +
                        Math.pow(point.y - queryPoint.y, 2))
                }));

                // æ’åºå¹¶é€‰æ‹©Kä¸ªæœ€è¿‘é‚»
                distances.sort((a, b) => a.distance - b.distance);
                const kNearest = distances.slice(0, k);

                // ç»˜åˆ¶è¿çº¿
                kNearest.forEach((item, index) => {
                    ctx.beginPath();
                    ctx.moveTo(queryPoint.x, queryPoint.y);
                    ctx.lineTo(item.point.x, item.point.y);
                    ctx.strokeStyle = `rgba(124, 58, 237, ${0.5 - index * 0.05})`;
                    ctx.lineWidth = 3 - index * 0.2;
                    ctx.stroke();
                });

                // ç»Ÿè®¡æŠ•ç¥¨
                const votes = { 0: 0, 1: 0 };
                kNearest.forEach(item => {
                    votes[item.point.class]++;
                });

                const predictedClass = votes[0] > votes[1] ? 0 : 1;

                // ç»˜åˆ¶æŸ¥è¯¢ç‚¹
                ctx.beginPath();
                ctx.arc(queryPoint.x, queryPoint.y, 12, 0, Math.PI * 2);
                ctx.fillStyle = predictedClass === 0 ? '#667eea' : '#ec4899';
                ctx.fill();
                ctx.strokeStyle = '#fbbf24';
                ctx.lineWidth = 4;
                ctx.stroke();

                // æ˜¾ç¤ºç»“æœ
                document.getElementById('knnResult').innerHTML =
                    `é¢„æµ‹ç±»åˆ«: <span style="color: ${predictedClass === 0 ? '#667eea' : '#ec4899'}">
                ${predictedClass === 0 ? 'è“è‰²' : 'ç²‰è‰²'}</span>
                (æŠ•ç¥¨: è“è‰² ${votes[0]}, ç²‰è‰² ${votes[1]})`;
            }

            // é¼ æ ‡ç‚¹å‡»äº‹ä»¶
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                queryPoint = {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
                draw();
            });

            // æ§åˆ¶å‡½æ•°
            window.changeK = function(newK) {
                k = newK;
                draw();
            };

            window.generateNewData = function() {
                generateData();
                draw();
            };

            window.clearQuery = function() {
                queryPoint = null;
                document.getElementById('knnResult').innerHTML = '';
                draw();
            };

            window.toggleAnimation = function() {
                // åŠ¨ç”»æ¼”ç¤ºKNNè¿‡ç¨‹
                if (!queryPoint) {
                    queryPoint = { x: 400, y: 250 };
                }

                let currentK = 1;
                const animateK = () => {
                    k = currentK;
                    draw();
                    currentK++;

                    if (currentK <= 15) {
                        setTimeout(animateK, 300);
                    } else {
                        k = 5;
                        draw();
                    }
                };

                animateK();
            };

            generateData();
            draw();
        }

        // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
        function init() {
            // æ¢å¤ä¸»é¢˜è®¾ç½®
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
            }
            updateThemeIcon();

            // åˆå§‹åŒ–èƒŒæ™¯
            initBackground();

            // åˆå§‹åŒ–æ¼”ç¤º
            initDistanceDemo();
            initKNNDemo();

            // ç›‘å¬æ»šåŠ¨äº‹ä»¶
            window.addEventListener('scroll', () => {
                updateProgress();
                highlightCurrentSection();
            });

            // åˆå§‹æ›´æ–°
            updateProgress();
            highlightCurrentSection();

            // å¿«æ·é”®æ”¯æŒ
            document.addEventListener('keydown', (e) => {
                if (e.altKey && e.key === 'n') {
                    toggleNav();
                }
            });
        }

        // å¯¼å‡ºå…¨å±€å‡½æ•°
        window.toggleTheme = toggleTheme;
        window.toggleNav = toggleNav;
        // é¢„å¤„ç†æ¼”ç¤º
        function initPreprocessDemo() {
            const canvas = document.getElementById('preprocessDemo');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            let originalData = [];
            let currentData = [];
            let displayMode = 'original';

            // ç”ŸæˆåŸå§‹æ•°æ®
            function generateOriginalData() {
                originalData = [];

                // ç”Ÿæˆä¸¤ä¸ªç±»åˆ«çš„æ•°æ®ï¼Œç‰¹å¾å°ºåº¦å·®å¼‚å¾ˆå¤§
                for (let i = 0; i < 30; i++) {
                    originalData.push({
                        x: Math.random() * 50 + 10,  // å¹´é¾„: 10-60
                        y: Math.random() * 100000 + 20000,  // æ”¶å…¥: 20k-120k
                        class: 0
                    });
                }

                for (let i = 0; i < 30; i++) {
                    originalData.push({
                        x: Math.random() * 50 + 30,  // å¹´é¾„: 30-80
                        y: Math.random() * 150000 + 80000,  // æ”¶å…¥: 80k-230k
                        class: 1
                    });
                }

                currentData = [...originalData];
            }

            // å½’ä¸€åŒ–æ•°æ®
            function normalizeData() {
                const xMin = Math.min(...originalData.map(p => p.x));
                const xMax = Math.max(...originalData.map(p => p.x));
                const yMin = Math.min(...originalData.map(p => p.y));
                const yMax = Math.max(...originalData.map(p => p.y));

                currentData = originalData.map(point => ({
                    x: (point.x - xMin) / (xMax - xMin),
                    y: (point.y - yMin) / (yMax - yMin),
                    class: point.class
                }));
            }

            // æ ‡å‡†åŒ–æ•°æ®
            function standardizeData() {
                const xMean = originalData.reduce((sum, p) => sum + p.x, 0) / originalData.length;
                const yMean = originalData.reduce((sum, p) => sum + p.y, 0) / originalData.length;

                const xStd = Math.sqrt(originalData.reduce((sum, p) => sum + Math.pow(p.x - xMean, 2), 0) / originalData.length);
                const yStd = Math.sqrt(originalData.reduce((sum, p) => sum + Math.pow(p.y - yMean, 2), 0) / originalData.length);

                currentData = originalData.map(point => ({
                    x: (point.x - xMean) / xStd,
                    y: (point.y - yMean) / yStd,
                    class: point.class
                }));
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // æ ¹æ®æ˜¾ç¤ºæ¨¡å¼è°ƒæ•´åæ ‡ç³»
                let scaleX, scaleY, offsetX, offsetY;

                if (displayMode === 'original') {
                    scaleX = canvas.width / 100;
                    scaleY = canvas.height / 250000;
                    offsetX = 0;
                    offsetY = 0;
                } else if (displayMode === 'normalized') {
                    scaleX = canvas.width * 0.8;
                    scaleY = canvas.height * 0.8;
                    offsetX = canvas.width * 0.1;
                    offsetY = canvas.height * 0.1;
                } else {  // standardized
                    scaleX = canvas.width / 6;
                    scaleY = canvas.height / 6;
                    offsetX = canvas.width / 2;
                    offsetY = canvas.height / 2;
                }

                // ç»˜åˆ¶åæ ‡è½´
                ctx.strokeStyle = 'rgba(124, 58, 237, 0.3)';
                ctx.lineWidth = 2;

                // Xè½´
                ctx.beginPath();
                ctx.moveTo(offsetX, canvas.height - offsetY);
                ctx.lineTo(canvas.width - 20, canvas.height - offsetY);
                ctx.stroke();

                // Yè½´
                ctx.beginPath();
                ctx.moveTo(offsetX, offsetY);
                ctx.lineTo(offsetX, canvas.height - offsetY);
                ctx.stroke();

                // ç»˜åˆ¶æ•°æ®ç‚¹
                currentData.forEach(point => {
                    const x = point.x * scaleX + offsetX;
                    const y = canvas.height - (point.y * scaleY + offsetY);

                    ctx.beginPath();
                    ctx.arc(x, y, 6, 0, Math.PI * 2);
                    ctx.fillStyle = point.class === 0 ? '#667eea' : '#ec4899';
                    ctx.fill();
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                });

                // æ˜¾ç¤ºæ¨¡å¼æ ‡ç­¾
                ctx.fillStyle = 'var(--text-primary)';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(
                    displayMode === 'original' ? 'åŸå§‹æ•°æ®' :
                        displayMode === 'normalized' ? 'å½’ä¸€åŒ–å [0,1]' :
                            'æ ‡å‡†åŒ–å (Î¼=0, Ïƒ=1)',
                    canvas.width / 2, 30
                );
            }

            // æ§åˆ¶å‡½æ•°
            window.showOriginalData = function() {
                displayMode = 'original';
                currentData = [...originalData];
                draw();
            };

            window.showNormalizedData = function() {
                displayMode = 'normalized';
                normalizeData();
                draw();
            };

            window.showStandardizedData = function() {
                displayMode = 'standardized';
                standardizeData();
                draw();
            };

            window.animatePreprocess = function() {
                const modes = ['original', 'normalized', 'standardized'];
                let index = 0;

                const animate = () => {
                    if (modes[index] === 'original') {
                        showOriginalData();
                    } else if (modes[index] === 'normalized') {
                        showNormalizedData();
                    } else {
                        showStandardizedData();
                    }

                    index++;
                    if (index < modes.length) {
                        setTimeout(animate, 1500);
                    }
                };

                animate();
            };

            generateOriginalData();
            draw();
        }

        // Kå€¼è¾¹ç•Œæ¼”ç¤º
        function initKBoundaryDemo() {
            const canvas = document.getElementById('kBoundaryDemo');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            let k = 5;
            let noiseLevel = 0.1;
            let dataPoints = [];

            function generateDataWithNoise() {
                dataPoints = [];

                // ç”ŸæˆåŸºç¡€æ•°æ®
                for (let i = 0; i < 40; i++) {
                    const angle = Math.random() * Math.PI;
                    const radius = Math.random() * 150 + 50;
                    dataPoints.push({
                        x: 200 + Math.cos(angle) * radius,
                        y: 200 + Math.sin(angle) * radius,
                        class: 0
                    });
                }

                for (let i = 0; i < 40; i++) {
                    const angle = Math.random() * Math.PI + Math.PI;
                    const radius = Math.random() * 150 + 50;
                    dataPoints.push({
                        x: 200 + Math.cos(angle) * radius,
                        y: 200 + Math.sin(angle) * radius,
                        class: 1
                    });
                }

                // æ·»åŠ å™ªå£°ç‚¹
                const noiseCount = Math.floor(dataPoints.length * noiseLevel);
                for (let i = 0; i < noiseCount; i++) {
                    const randomIndex = Math.floor(Math.random() * dataPoints.length);
                    dataPoints[randomIndex].class = 1 - dataPoints[randomIndex].class;
                }
            }

            function drawDecisionBoundary() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ç»˜åˆ¶å†³ç­–è¾¹ç•Œï¼ˆä½¿ç”¨è¾ƒä½åˆ†è¾¨ç‡æé«˜æ€§èƒ½ï¼‰
                const resolution = 10;
                for (let x = 0; x < canvas.width; x += resolution) {
                    for (let y = 0; y < canvas.height; y += resolution) {
                        const prediction = predictKNN(x, y);
                        ctx.fillStyle = prediction === 0 ?
                            'rgba(102, 126, 234, 0.2)' :
                            'rgba(236, 72, 153, 0.2)';
                        ctx.fillRect(x, y, resolution, resolution);
                    }
                }

                // ç»˜åˆ¶æ•°æ®ç‚¹
                dataPoints.forEach(point => {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 6, 0, Math.PI * 2);
                    ctx.fillStyle = point.class === 0 ? '#667eea' : '#ec4899';
                    ctx.fill();
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                });

                // æ˜¾ç¤ºKå€¼
                ctx.fillStyle = '#e2e8f0';
                ctx.font = 'bold 20px Arial';
                ctx.fillText(`K = ${k}`, 20, 30);
            }

            function predictKNN(x, y) {
                const distances = dataPoints.map(point => ({
                    distance: Math.sqrt(Math.pow(point.x - x, 2) + Math.pow(point.y - y, 2)),
                    class: point.class
                }));

                distances.sort((a, b) => a.distance - b.distance);
                const kNearest = distances.slice(0, k);

                const votes = { 0: 0, 1: 0 };
                kNearest.forEach(item => {
                    votes[item.class]++;
                });

                return votes[0] > votes[1] ? 0 : 1;
            }

            window.updateKBoundary = function() {
                k = parseInt(document.getElementById('kSlider').value);
                document.getElementById('kValue').textContent = k;

                // æ›´æ–°å¹³æ»‘åº¦å’Œè¿‡æ‹Ÿåˆé£é™©æŒ‡ç¤º
                const smoothnessEl = document.getElementById('smoothness');
                const overfittingEl = document.getElementById('overfittingRisk');

                if (k <= 3) {
                    smoothnessEl.textContent = 'ä½';
                    overfittingEl.textContent = 'é«˜';
                } else if (k <= 9) {
                    smoothnessEl.textContent = 'ä¸­ç­‰';
                    overfittingEl.textContent = 'ä½';
                } else {
                    smoothnessEl.textContent = 'é«˜';
                    overfittingEl.textContent = 'æ¬ æ‹Ÿåˆé£é™©';
                }

                drawDecisionBoundary();
            };

            window.updateNoise = function() {
                noiseLevel = parseInt(document.getElementById('noiseSlider').value) / 100;
                document.getElementById('noiseLevel').textContent = Math.round(noiseLevel * 100) + '%';
                generateDataWithNoise();
                drawDecisionBoundary();
            };

            generateDataWithNoise();
            drawDecisionBoundary();
        }

        // æ€§èƒ½å¯¹æ¯”æ¼”ç¤º
        function initPerformanceDemo() {
            const canvas = document.getElementById('performanceDemo');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            function drawPerformanceChart(data) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                const algorithms = ['æš´åŠ›æœç´¢', 'KDæ ‘', 'Ballæ ‘', 'LSH'];
                const colors = ['#667eea', '#ec4899', '#14b8a6', '#f97316'];
                const barWidth = 100;
                const barSpacing = 150;
                const startX = 50;
                const maxHeight = 300;

                // ç»˜åˆ¶åæ ‡è½´
                ctx.strokeStyle = 'rgba(124, 58, 237, 0.3)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(30, 350);
                ctx.lineTo(750, 350);
                ctx.stroke();

                // ç»˜åˆ¶æŸ±çŠ¶å›¾
                algorithms.forEach((algo, index) => {
                    const x = startX + index * barSpacing;
                    const height = data[algo] * maxHeight / 100;

                    ctx.fillStyle = colors[index];
                    ctx.fillRect(x, 350 - height, barWidth, height);

                    // ç®—æ³•åç§°
                    ctx.fillStyle = '#e2e8f0';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(algo, x + barWidth / 2, 370);

                    // æ•°å€¼æ ‡ç­¾
                    ctx.fillText(data[algo] + 'ms', x + barWidth / 2, 340 - height);
                });

                // æ ‡é¢˜
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('æŸ¥è¯¢æ—¶é—´å¯¹æ¯”ï¼ˆæ¯«ç§’ï¼‰', canvas.width / 2, 30);
            }

            window.compareAlgorithms = function() {
                // æ¨¡æ‹Ÿæ€§èƒ½æ•°æ®
                const performanceData = {
                    'æš´åŠ›æœç´¢': 85,
                    'KDæ ‘': 15,
                    'Ballæ ‘': 20,
                    'LSH': 5
                };

                drawPerformanceChart(performanceData);

                document.getElementById('performanceResult').innerHTML =
                    '<span style="color: var(--knn-orange);">LSHæœ€å¿«ä½†æ˜¯è¿‘ä¼¼ç»“æœï¼ŒKDæ ‘åœ¨ä½ç»´åº¦æœ€ä¼˜</span>';
            };

            window.showDimensionEffect = function() {
                // æ˜¾ç¤ºç»´åº¦å¯¹æ€§èƒ½çš„å½±å“
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ç»˜åˆ¶ç»´åº¦å½±å“æ›²çº¿
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(50, 300);

                // KDæ ‘æ€§èƒ½æ›²çº¿
                for (let d = 0; d <= 100; d += 5) {
                    const x = 50 + d * 7;
                    const y = 300 - Math.max(0, 250 - d * d / 40);
                    ctx.lineTo(x, y);
                }
                ctx.stroke();

                // Ballæ ‘æ€§èƒ½æ›²çº¿
                ctx.strokeStyle = '#ec4899';
                ctx.beginPath();
                ctx.moveTo(50, 300);
                for (let d = 0; d <= 100; d += 5) {
                    const x = 50 + d * 7;
                    const y = 300 - Math.max(0, 250 - d * d / 80);
                    ctx.lineTo(x, y);
                }
                ctx.stroke();

                // æ ‡ç­¾
                ctx.fillStyle = '#e2e8f0';
                ctx.font = '14px Arial';
                ctx.fillText('ç»´åº¦', 400, 340);
                ctx.save();
                ctx.translate(20, 200);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText('æŸ¥è¯¢æ—¶é—´', 0, 0);
                ctx.restore();

                // å›¾ä¾‹
                ctx.fillStyle = '#667eea';
                ctx.fillRect(600, 50, 20, 3);
                ctx.fillStyle = '#e2e8f0';
                ctx.fillText('KDæ ‘', 630, 55);

                ctx.fillStyle = '#ec4899';
                ctx.fillRect(600, 70, 20, 3);
                ctx.fillStyle = '#e2e8f0';
                ctx.fillText('Ballæ ‘', 630, 75);

                document.getElementById('performanceResult').innerHTML =
                    '<span style="color: var(--knn-purple);">é«˜ç»´åº¦ä¸‹ä¸¤ç§æ ‘ç»“æ„æ€§èƒ½éƒ½ä¼šé€€åŒ–</span>';
            };

            window.showScalability = function() {
                // æ˜¾ç¤ºå¯æ‰©å±•æ€§
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                const sampleSizes = [1000, 10000, 100000, 1000000];
                const times = {
                    'æš´åŠ›æœç´¢': [10, 100, 1000, 10000],
                    'KDæ ‘': [5, 15, 50, 200],
                    'Ballæ ‘': [6, 18, 60, 250],
                    'LSH': [2, 3, 5, 8]
                };

                const colors = {
                    'æš´åŠ›æœç´¢': '#667eea',
                    'KDæ ‘': '#ec4899',
                    'Ballæ ‘': '#14b8a6',
                    'LSH': '#f97316'
                };

                // ç»˜åˆ¶åæ ‡è½´
                ctx.strokeStyle = 'rgba(124, 58, 237, 0.3)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(50, 350);
                ctx.lineTo(750, 350);
                ctx.moveTo(50, 50);
                ctx.lineTo(50, 350);
                ctx.stroke();

                // ç»˜åˆ¶æ›²çº¿
                Object.entries(times).forEach(([algo, timeData]) => {
                    ctx.strokeStyle = colors[algo];
                    ctx.lineWidth = 3;
                    ctx.beginPath();

                    timeData.forEach((time, index) => {
                        const x = 100 + index * 200;
                        const y = 350 - (Math.log10(time) * 80);

                        if (index === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }

                        // æ•°æ®ç‚¹
                        ctx.fillStyle = colors[algo];
                        ctx.beginPath();
                        ctx.arc(x, y, 4, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    ctx.stroke();
                });

                // æ ‡ç­¾
                ctx.fillStyle = 'var(--text-primary)';
                ctx.font = '12px Arial';
                sampleSizes.forEach((size, index) => {
                    const x = 100 + index * 200;
                    ctx.fillText(size >= 1000000 ? '1M' : size >= 1000 ? size/1000 + 'K' : size, x - 15, 370);
                });

                // å›¾ä¾‹
                let legendY = 80;
                Object.entries(colors).forEach(([algo, color]) => {
                    ctx.fillStyle = color;
                    ctx.fillRect(600, legendY, 20, 3);
                    ctx.fillStyle = 'var(--text-primary)';
                    ctx.fillText(algo, 630, legendY + 5);
                    legendY += 20;
                });

                document.getElementById('performanceResult').innerHTML =
                    '<span style="color: var(--knn-purple);">LSHåœ¨å¤§è§„æ¨¡æ•°æ®ä¸Šä¼˜åŠ¿æ˜æ˜¾</span>';
            };
        }

        // ä¸‹è½½ç¬”è®°åŠŸèƒ½
        window.downloadNotes = function() {
            // åˆ›å»ºç¬”è®°å†…å®¹
            const notes = `
# KNNç®—æ³•å­¦ä¹ ç¬”è®°

## æ ¸å¿ƒæ¦‚å¿µ
- Kè¿‘é‚»ç®—æ³•æ˜¯åŸºäºå®ä¾‹çš„æ‡’æƒ°å­¦ä¹ ç®—æ³•
- æ ¸å¿ƒæ€æƒ³ï¼šç›¸ä¼¼çš„äº‹ç‰©åº”è¯¥æœ‰ç›¸ä¼¼çš„æ ‡ç­¾
- ä¸»è¦å‚æ•°ï¼šKå€¼ã€è·ç¦»åº¦é‡ã€æƒé‡ç­–ç•¥

## ç®—æ³•æ­¥éª¤
1. è®¡ç®—è·ç¦»
2. æ’åºé€‰æ‹©Kä¸ªæœ€è¿‘é‚»
3. æƒé‡è®¡ç®—
4. æŠ•ç¥¨/å¹³å‡å¾—å‡ºé¢„æµ‹

## å…³é”®è¦ç‚¹
- æ•°æ®é¢„å¤„ç†è‡³å…³é‡è¦ï¼ˆå½’ä¸€åŒ–/æ ‡å‡†åŒ–ï¼‰
- Kå€¼é€‰æ‹©å½±å“æ¨¡å‹å¤æ‚åº¦
- é«˜ç»´æ•°æ®å­˜åœ¨ç»´æ•°ç¾éš¾
- å¯ä»¥ä½¿ç”¨KDæ ‘ã€Ballæ ‘ç­‰ä¼˜åŒ–æŸ¥è¯¢é€Ÿåº¦

## å®è·µå»ºè®®
- ä½ç»´æ•°æ®ï¼ˆd<20ï¼‰ä½¿ç”¨KDæ ‘
- ä¸­é«˜ç»´æ•°æ®ä½¿ç”¨Ballæ ‘
- æµ·é‡é«˜ç»´æ•°æ®è€ƒè™‘LSHè¿‘ä¼¼æ–¹æ³•
- å§‹ç»ˆè¿›è¡Œäº¤å‰éªŒè¯é€‰æ‹©æœ€ä¼˜å‚æ•°
        `;

            // åˆ›å»ºä¸‹è½½
            const blob = new Blob([notes], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'KNNç®—æ³•å­¦ä¹ ç¬”è®°.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };

        // å¼€å§‹æµ‹éªŒåŠŸèƒ½
        window.startQuiz = function() {
            const questions = [
                {
                    question: "KNNç®—æ³•å±äºä»€ä¹ˆç±»å‹çš„å­¦ä¹ ç®—æ³•ï¼Ÿ",
                    options: ["ç›‘ç£å­¦ä¹ ", "æ— ç›‘ç£å­¦ä¹ ", "å¼ºåŒ–å­¦ä¹ ", "åŠç›‘ç£å­¦ä¹ "],
                    answer: 0
                },
                {
                    question: "ä¸ºä»€ä¹ˆKNNè¢«ç§°ä¸º'æ‡’æƒ°å­¦ä¹ 'ç®—æ³•ï¼Ÿ",
                    options: [
                        "è®­ç»ƒé€Ÿåº¦æ…¢",
                        "æ²¡æœ‰æ˜¾å¼çš„è®­ç»ƒè¿‡ç¨‹",
                        "é¢„æµ‹é€Ÿåº¦æ…¢",
                        "éœ€è¦å¤§é‡å†…å­˜"
                    ],
                    answer: 1
                },
                {
                    question: "å½“K=1æ—¶ï¼ŒKNNç®—æ³•å®¹æ˜“å‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ",
                    options: ["æ¬ æ‹Ÿåˆ", "è¿‡æ‹Ÿåˆ", "æ¢¯åº¦æ¶ˆå¤±", "æ¢¯åº¦çˆ†ç‚¸"],
                    answer: 1
                },
                {
                    question: "å¯¹äºé«˜ç»´æ•°æ®ï¼Œå“ªç§è·ç¦»åº¦é‡é€šå¸¸æ›´åˆé€‚ï¼Ÿ",
                    options: ["æ¬§å¼è·ç¦»", "æ›¼å“ˆé¡¿è·ç¦»", "åˆ‡æ¯”é›ªå¤«è·ç¦»", "æ±‰æ˜è·ç¦»"],
                    answer: 1
                },
                {
                    question: "KNNç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸»è¦å–å†³äºä»€ä¹ˆï¼Ÿ",
                    options: ["è®­ç»ƒè¿‡ç¨‹", "é¢„æµ‹è¿‡ç¨‹", "å‚æ•°è°ƒä¼˜", "æ•°æ®é¢„å¤„ç†"],
                    answer: 1
                }
            ];

            let score = 0;
            let currentQuestion = 0;

            function showQuestion() {
                if (currentQuestion >= questions.length) {
                    alert(`æµ‹éªŒå®Œæˆï¼æ‚¨çš„å¾—åˆ†æ˜¯ï¼š${score}/${questions.length}`);
                    return;
                }

                const q = questions[currentQuestion];
                const answer = prompt(
                    `é—®é¢˜ ${currentQuestion + 1}/${questions.length}:\n${q.question}\n\n` +
                    q.options.map((opt, i) => `${i + 1}. ${opt}`).join('\n') +
                    '\n\nè¯·è¾“å…¥é€‰é¡¹ç¼–å·ï¼ˆ1-4ï¼‰ï¼š'
                );

                if (answer && parseInt(answer) - 1 === q.answer) {
                    score++;
                    alert('å›ç­”æ­£ç¡®ï¼');
                } else {
                    alert(`å›ç­”é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${q.options[q.answer]}`);
                }

                currentQuestion++;
                showQuestion();
            }

            showQuestion();
        };

        // åˆ†äº«è¿›åº¦åŠŸèƒ½
        window.shareProgress = function() {
            const progress = document.getElementById('progressText').textContent;
            const completedSections = document.querySelectorAll('.nav-item.completed').length;
            const totalSections = document.querySelectorAll('.nav-item').length;

            const shareText = `æˆ‘æ­£åœ¨å­¦ä¹ KNNç®—æ³•ï¼
ğŸ“š å­¦ä¹ è¿›åº¦ï¼š${progress}
âœ… å®Œæˆç« èŠ‚ï¼š${completedSections}/${totalSections}
ğŸ¯ å½“å‰é‡ç‚¹ï¼š${document.querySelector('.nav-item.active .nav-text').textContent}

#æœºå™¨å­¦ä¹  #KNNç®—æ³• #AIå­¦ä¹ `;

            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('å­¦ä¹ è¿›åº¦å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯ä»¥åˆ†äº«åˆ°ç¤¾äº¤åª’ä½“ï¼');
                });
            } else {
                alert(shareText);
            }
        };

        // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
        function init() {
            // æ¢å¤ä¸»é¢˜è®¾ç½®
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
            }
            updateThemeIcon();

            // åˆå§‹åŒ–èƒŒæ™¯
            initBackground();

            // åˆå§‹åŒ–æ‰€æœ‰æ¼”ç¤º
            initDistanceDemo();
            initKNNDemo();
            initPreprocessDemo();
            initKBoundaryDemo();

            // åˆå§‹åŒ–æ€§èƒ½æ¼”ç¤ºï¼ˆå¦‚æœå…ƒç´ å­˜åœ¨ï¼‰
            if (document.getElementById('performanceDemo')) {
                initPerformanceDemo();
            }

            // ç›‘å¬æ»šåŠ¨äº‹ä»¶
            window.addEventListener('scroll', () => {
                updateProgress();
                highlightCurrentSection();
            });

            // åˆå§‹æ›´æ–°
            updateProgress();
            highlightCurrentSection();

            // å¿«æ·é”®æ”¯æŒ
            document.addEventListener('keydown', (e) => {
                if (e.altKey && e.key === 'n') {
                    toggleNav();
                }
                if (e.ctrlKey && e.key === 't') {
                    toggleTheme();
                }
            });

            // å¹³æ»‘æ»šåŠ¨
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // æ·»åŠ é¡µé¢å¯è§æ€§å˜åŒ–ç›‘å¬
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    updateProgress();
                }
            });

            console.log('KNNç®—æ³•æ•™ç¨‹åˆå§‹åŒ–å®Œæˆï¼');
        }

        // å¯¼å‡ºå…¨å±€å‡½æ•°
        window.toggleTheme = toggleTheme;
        window.toggleNav = toggleNav;
        window.scrollToTop = scrollToTop;

        // DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
</script>

</body>
</html>