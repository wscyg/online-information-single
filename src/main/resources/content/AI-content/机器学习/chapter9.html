<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬9ç« ï¼šå…¶ä»–ç›‘ç£å­¦ä¹ ç®—æ³• - æœºå™¨å­¦ä¹ çš„ç‘å£«å†›åˆ€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* CSS å˜é‡ç»Ÿä¸€ç®¡ç†ä¸»é¢˜é¢œè‰² */
        :root {
            /* æ·±è‰²ä¸»é¢˜ï¼ˆé»˜è®¤ï¼‰ */
            --bg-primary: #0a0e27;
            --bg-secondary: #151a3a;
            --bg-card: rgba(21, 26, 58, 0.8);
            --bg-card-solid: rgba(21, 26, 58, 0.95);
            --bg-code: #0f1729;

            --text-primary: #e8eaed;
            --text-secondary: #c7d0dc;
            --text-muted: #8b98a8;
            --text-dim: #5f6e82;

            --border-primary: rgba(79, 172, 254, 0.3);
            --border-secondary: rgba(79, 172, 254, 0.2);
            --border-muted: rgba(139, 152, 168, 0.1);

            --shadow-sm: rgba(0,0,0,0.3);
            --shadow-md: rgba(0,0,0,0.4);
            --shadow-lg: rgba(0,0,0,0.5);

            --gradient-primary: linear-gradient(135deg, #4facfe, #00f2fe);
            --gradient-bg: linear-gradient(135deg, #0a0e27 0%, #151a3a 100%);

            /* ç®—æ³•ä¸»é¢˜è‰² */
            --algo-blue: #4facfe;
            --algo-cyan: #00f2fe;
            --algo-purple: #a78bfa;
            --algo-pink: #f472b6;
            --algo-amber: #fbbf24;
            --algo-emerald: #34d399;
            --algo-red: #ef4444;
            --algo-orange: #fb923c;
        }

        /* æµ…è‰²ä¸»é¢˜ */
        body.light-theme {
            --bg-primary: #f9fafb;
            --bg-secondary: #e5e7eb;
            --bg-card: rgba(255, 255, 255, 0.9);
            --bg-card-solid: rgba(255, 255, 255, 0.95);
            --bg-code: #f3f4f6;

            --text-primary: #111827;
            --text-secondary: #374151;
            --text-muted: #4b5563;
            --text-dim: #6b7280;

            --border-primary: rgba(79, 172, 254, 0.4);
            --border-secondary: rgba(79, 172, 254, 0.3);
            --border-muted: rgba(209, 213, 219, 0.5);

            --shadow-sm: rgba(0,0,0,0.1);
            --shadow-md: rgba(0,0,0,0.15);
            --shadow-lg: rgba(0,0,0,0.2);

            --gradient-bg: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%);
        }

        /* å…¨å±€è¿‡æ¸¡åŠ¨ç”» */
        body, body * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: var(--gradient-bg);
            color: var(--text-primary);
            line-height: 1.8;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.nav-open .container {
            margin-left: 360px;
        }

        /* åŠ¨æ€èƒŒæ™¯ç²’å­ç³»ç»Ÿ */
        .dynamic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .particle-system {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        /* æ™ºèƒ½å¯¼èˆªç³»ç»Ÿ */
        .smart-nav {
            position: fixed;
            left: -340px;
            top: 0;
            width: 340px;
            height: 100vh;
            background: linear-gradient(135deg, rgba(10, 14, 39, 0.98) 0%, rgba(21, 26, 58, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-primary);
            box-shadow: 4px 0 30px var(--shadow-lg);
            z-index: 1000;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow: hidden;
        }

        body.nav-open .smart-nav {
            left: 0;
        }

        .nav-bg-decoration {
            position: absolute;
            top: -100px;
            right: -100px;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--algo-blue) 0%, transparent 70%);
            opacity: 0.1;
            animation: pulse 4s ease-in-out infinite;
        }

        /* å¯¼èˆªè§¦å‘æŒ‰é’® */
        .nav-trigger {
            position: fixed;
            left: 20px;
            top: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(79, 172, 254, 0.3);
            border-radius: 16px;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.nav-open .nav-trigger {
            left: 290px;
            background: linear-gradient(135deg, rgba(167, 139, 250, 0.1), rgba(244, 114, 182, 0.1));
            border-color: rgba(167, 139, 250, 0.5);
        }

        .nav-trigger:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        /* æ±‰å ¡èœå•å›¾æ ‡åŠ¨ç”» */
        .nav-trigger-icon {
            width: 24px;
            height: 20px;
            position: relative;
        }

        .nav-trigger-icon span {
            display: block;
            position: absolute;
            height: 3px;
            width: 100%;
            background: linear-gradient(90deg, var(--algo-blue), var(--algo-cyan));
            border-radius: 3px;
            opacity: 1;
            left: 0;
            transition: 0.25s ease-in-out;
        }

        .nav-trigger-icon span:nth-child(1) { top: 0px; }
        .nav-trigger-icon span:nth-child(2) { top: 8px; }
        .nav-trigger-icon span:nth-child(3) { top: 16px; }

        body.nav-open .nav-trigger-icon span:nth-child(1) { top: 8px; transform: rotate(135deg); }
        body.nav-open .nav-trigger-icon span:nth-child(2) { opacity: 0; left: -60px; }
        body.nav-open .nav-trigger-icon span:nth-child(3) { top: 8px; transform: rotate(-135deg); }

        /* å¯¼èˆªå¤´éƒ¨ */
        .nav-header {
            padding: 30px;
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.05));
            border-bottom: 1px solid rgba(79, 172, 254, 0.2);
            position: relative;
        }

        .nav-header h3 {
            font-size: 1.4rem;
            background: linear-gradient(135deg, var(--algo-blue), var(--algo-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }

        .nav-subtitle {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        /* å¯¼èˆªåˆ—è¡¨ */
        .nav-list {
            list-style: none;
            padding: 20px 0;
            max-height: calc(100vh - 300px);
            overflow-y: auto;
        }

        .nav-list::-webkit-scrollbar {
            width: 6px;
        }

        .nav-list::-webkit-scrollbar-track {
            background: rgba(79, 172, 254, 0.05);
            border-radius: 3px;
        }

        .nav-list::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--algo-blue), var(--algo-cyan));
            border-radius: 3px;
        }

        /* å¯¼èˆªé¡¹ä¼˜åŒ– */
        .nav-item {
            position: relative;
            margin: 8px 15px;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0;
            background: linear-gradient(90deg, var(--algo-blue), var(--algo-cyan));
            transition: width 0.3s ease;
            opacity: 0.8;
        }

        .nav-item:hover::before,
        .nav-item.active::before {
            width: 4px;
        }

        .nav-item.active::before {
            opacity: 1;
            box-shadow: 0 0 12px var(--algo-blue);
        }

        .nav-item a {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            color: var(--text-muted);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            background: rgba(0, 0, 0, 0);
        }

        .nav-item:hover a,
        .nav-item.active a {
            color: var(--text-primary);
            padding-left: 28px;
        }

        .nav-item.active a {
            background: linear-gradient(90deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.05));
            font-weight: 600;
        }

        .nav-icon {
            font-size: 1.4rem;
            margin-right: 14px;
            flex-shrink: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: rgba(79, 172, 254, 0.1);
            border-radius: 8px;
        }

        .nav-item:hover .nav-icon {
            transform: scale(1.1) rotate(10deg);
            background: rgba(79, 172, 254, 0.2);
        }

        .nav-item.active .nav-icon {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.3), rgba(0, 242, 254, 0.2));
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .nav-content {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-text {
            font-size: 0.95rem;
            font-weight: 500;
        }

        .nav-meta {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-time {
            font-size: 0.75rem;
            color: var(--text-dim);
            background: rgba(79, 172, 254, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
        }

        .nav-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4a5568;
            transition: all 0.3s ease;
        }

        .nav-item.completed .nav-status {
            background: #34d399;
            box-shadow: 0 0 8px #34d399;
        }

        .nav-item.active .nav-status {
            background: var(--algo-blue);
            box-shadow: 0 0 8px var(--algo-blue);
            animation: statusPulse 2s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ä¸»æ ‡é¢˜æ ·å¼ */
        .main-header {
            text-align: center;
            margin: 60px 0;
            position: relative;
        }

        .main-title {
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--algo-blue) 0%, var(--algo-cyan) 25%, var(--algo-purple) 50%, var(--algo-pink) 75%, var(--algo-amber) 100%);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-flow 8s ease infinite;
            text-shadow: 0 0 80px rgba(79, 172, 254, 0.5);
            margin-bottom: 20px;
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .subtitle {
            font-size: 1.6rem;
            color: var(--text-muted);
            text-shadow: 0 2px 10px var(--shadow-sm);
        }

        /* ç« èŠ‚å¡ç‰‡åŸºç¡€æ ·å¼ */
        .section-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 40px;
            margin: 30px 0;
            border: 1px solid var(--border-secondary);
            box-shadow: 0 20px 40px var(--shadow-sm);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .section-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--algo-blue), var(--algo-cyan), var(--algo-purple), var(--algo-pink));
            border-radius: 24px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .section-card:hover::before {
            opacity: 0.5;
            animation: borderRotate 6s linear infinite;
        }

        @keyframes borderRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px var(--shadow-md);
        }

        .section-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--algo-blue), var(--algo-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* é€šç”¨å†…å®¹æ¡†æ ·å¼ */
        .content-box {
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .story-box {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.05));
            border: 2px solid rgba(79, 172, 254, 0.3);
        }

        .story-box::after {
            content: 'ğŸ“š';
            position: absolute;
            top: -20px;
            right: 20px;
            font-size: 4rem;
            opacity: 0.08;
            z-index: 0;
        }

        .thinking-box {
            background: linear-gradient(135deg, rgba(167, 139, 250, 0.1), rgba(129, 140, 248, 0.05));
            border: 2px solid rgba(167, 139, 250, 0.3);
        }

        .thinking-box::before {
            content: 'ğŸ’­';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2rem;
            background: var(--bg-card-solid);
            padding: 5px 15px;
            border-radius: 50%;
            opacity: 0.3;
            z-index: 1;
        }

        .formula-box {
            background: linear-gradient(135deg, rgba(244, 114, 182, 0.1), rgba(236, 72, 153, 0.05));
            border: 2px solid rgba(244, 114, 182, 0.3);
            text-align: center;
        }

        .formula-box::before {
            content: 'âˆ‘';
            position: absolute;
            top: -30px;
            right: 30px;
            font-size: 6rem;
            opacity: 0.03;
            transform: rotate(15deg);
            z-index: 0;
        }

        .math-formula {
            font-family: 'Times New Roman', serif;
            font-size: 1.8rem;
            color: var(--text-primary);
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* é«˜äº®æ ·å¼ç³»ç»Ÿ */
        .highlight {
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 6px;
            border: 1px solid;
        }

        .highlight-primary {
            color: var(--algo-blue);
            background: rgba(79, 172, 254, 0.1);
            border-color: rgba(79, 172, 254, 0.3);
        }

        .highlight-secondary {
            color: var(--algo-cyan);
            background: rgba(0, 242, 254, 0.1);
            border-color: rgba(0, 242, 254, 0.3);
        }

        .highlight-success {
            color: var(--algo-emerald);
            background: rgba(52, 211, 153, 0.1);
            border-color: rgba(52, 211, 153, 0.3);
        }

        .highlight-warning {
            color: var(--algo-amber);
            background: rgba(251, 191, 36, 0.1);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .highlight-danger {
            color: var(--algo-pink);
            background: rgba(244, 114, 182, 0.1);
            border-color: rgba(244, 114, 182, 0.3);
        }

        /* è¡¨æ ¼æ ·å¼ */
        .data-table {
            margin: 20px auto;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px var(--shadow-sm);
            width: 100%;
        }

        .data-table th {
            background: linear-gradient(135deg, var(--algo-blue), var(--algo-cyan));
            color: white;
            padding: 12px 20px;
            font-weight: 600;
            text-align: left;
        }

        .data-table td {
            padding: 10px 20px;
            border-bottom: 1px solid var(--border-muted);
            color: var(--text-primary);
        }

        .data-table tr:hover td {
            background: rgba(79, 172, 254, 0.05);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* äº¤äº’å¼æ¼”ç¤ºåŒºåŸŸ */
        .demo-container {
            background: linear-gradient(135deg, rgba(10, 14, 39, 0.9), rgba(21, 26, 58, 0.8));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(79, 172, 254, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .demo-canvas {
            background: #0a0e27;
            border-radius: 10px;
            margin: 20px auto;
            display: block;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            cursor: crosshair;
        }

        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, var(--algo-blue), var(--algo-cyan));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
        }

        .demo-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        .demo-btn:active {
            transform: translateY(0);
        }

        .demo-btn.secondary {
            background: linear-gradient(135deg, var(--algo-purple), var(--algo-pink));
            box-shadow: 0 5px 15px rgba(167, 139, 250, 0.3);
        }

        .demo-btn.secondary:hover {
            box-shadow: 0 8px 25px rgba(167, 139, 250, 0.4);
        }

        /* å‚æ•°æ§åˆ¶é¢æ¿ */
        .param-panel {
            background: rgba(79, 172, 254, 0.05);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .param-group {
            margin-bottom: 20px;
        }

        .param-label {
            display: block;
            font-weight: 600;
            color: var(--algo-blue);
            margin-bottom: 10px;
        }

        .param-slider {
            width: 100%;
            margin: 10px 0;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: rgba(79, 172, 254, 0.2);
            border-radius: 4px;
            outline: none;
        }

        .param-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--algo-blue), var(--algo-cyan));
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(79, 172, 254, 0.5);
        }

        .param-value {
            display: inline-block;
            width: 60px;
            text-align: center;
            color: var(--algo-cyan);
            font-weight: bold;
            background: rgba(0, 242, 254, 0.1);
            padding: 4px 8px;
            border-radius: 8px;
            margin-left: 10px;
        }

        /* ç®—æ³•å¡ç‰‡ */
        .algo-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .algo-card {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.05));
            border: 2px solid rgba(79, 172, 254, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .algo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.3);
        }

        .algo-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .algo-label {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--algo-blue);
            margin-bottom: 5px;
        }

        .algo-desc {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* ä»£ç åŒºåŸŸæ ·å¼ */
        .code-block {
            background: #0f1729;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            overflow-x: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid rgba(79, 172, 254, 0.2);
        }

        .code-block::before {
            content: 'Python';
            position: absolute;
            top: -12px;
            left: 20px;
            background: linear-gradient(135deg, var(--algo-blue), var(--algo-cyan));
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .code-block pre {
            color: #f8f8f2;
            font-family: 'Fira Code', 'Consolas', monospace;
            line-height: 1.6;
            margin: 0;
        }

        /* è¯­æ³•é«˜äº® */
        .keyword { color: #ff79c6; }
        .string { color: #f1fa8c; }
        .comment { color: #6272a4; }
        .number { color: #bd93f9; }
        .function { color: #50fa7b; }
        .operator { color: #ff6347; }

        /* è¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(167, 139, 250, 0.1));
            padding: 15px 25px;
            border-radius: 50px;
            border: 2px solid rgba(79, 172, 254, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px var(--shadow-sm);
        }

        .progress-bar {
            width: 150px;
            height: 6px;
            background: rgba(79, 172, 254, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--algo-blue), var(--algo-cyan));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* æµ®åŠ¨å·¥å…·æ  */
        .floating-toolbar {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .toolbar-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--algo-blue), var(--algo-cyan));
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
        }

        .toolbar-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1400px) {
            body.nav-open .container {
                margin-left: 0;
                padding-left: 360px;
            }
        }

        @media (max-width: 768px) {
            .main-title {
                font-size: 2.5rem;
            }

            .section-title {
                font-size: 1.8rem;
            }

            .section-card {
                padding: 25px;
            }

            .demo-controls {
                flex-direction: column;
            }

            .smart-nav {
                width: 100%;
                left: -100%;
            }

            body.nav-open .smart-nav {
                left: 0;
            }

            body.nav-open .container {
                margin-left: 0;
                padding-left: 20px;
            }

            body.nav-open .nav-trigger {
                left: auto;
                right: 20px;
            }

            .data-table {
                font-size: 0.9rem;
            }

            .data-table th,
            .data-table td {
                padding: 10px;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        .section-anchor {
            scroll-margin-top: 100px;
        }

        /* è¯„ä¼°æŒ‡æ ‡å¡ç‰‡ */
        .metric-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .metric-card {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.05));
            border: 2px solid rgba(79, 172, 254, 0.3);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(79, 172, 254, 0.1) 0%, transparent 70%);
            transform: rotate(45deg);
            transition: all 0.5s ease;
            opacity: 0;
        }

        .metric-card:hover::before {
            opacity: 1;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.3);
        }

        .metric-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .metric-name {
            font-size: 1.1rem;
            color: var(--algo-blue);
            font-weight: 600;
            margin-bottom: 10px;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--algo-blue), var(--algo-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-description {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 10px;
        }

        /* å†³ç­–æ ‘èŠ‚ç‚¹æ ·å¼ */
        .tree-node {
            position: absolute;
            width: 120px;
            height: 60px;
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.1));
            border: 2px solid var(--algo-blue);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .tree-node:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.5);
        }

        .tree-node.leaf {
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.2), rgba(34, 197, 94, 0.1));
            border-color: var(--algo-emerald);
        }

        .tree-edge {
            position: absolute;
            height: 2px;
            background: var(--algo-blue);
            transform-origin: left center;
            transition: all 0.3s ease;
        }

        /* SVM æ¼”ç¤ºæ ·å¼ */
        .svm-point {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .svm-point.class1 {
            background: var(--algo-blue);
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
        }

        .svm-point.class2 {
            background: var(--algo-pink);
            box-shadow: 0 0 10px rgba(244, 114, 182, 0.5);
        }

        .svm-point.support {
            border: 3px solid var(--algo-amber);
            box-shadow: 0 0 20px var(--algo-amber);
        }

        .hyperplane {
            position: absolute;
            background: linear-gradient(90deg, transparent, var(--algo-cyan), transparent);
            height: 2px;
            width: 100%;
            transform-origin: center;
        }

        .margin-line {
            position: absolute;
            background: rgba(251, 191, 36, 0.3);
            height: 1px;
            width: 100%;
            transform-origin: center;
            border-top: 2px dashed var(--algo-amber);
        }
    </style>
</head>
<body>
<!-- åŠ¨æ€èƒŒæ™¯ -->
<div class="dynamic-bg">
    <canvas id="particleSystem" class="particle-system"></canvas>
</div>

<!-- å¯¼èˆªè§¦å‘æŒ‰é’® -->
<button class="nav-trigger" onclick="toggleNav()">
    <div class="nav-trigger-icon">
        <span></span>
        <span></span>
        <span></span>
    </div>
</button>

<!-- æ™ºèƒ½å¯¼èˆªç³»ç»Ÿ -->
<nav class="smart-nav">
    <div class="nav-bg-decoration"></div>

    <div class="nav-header">
        <h3>ğŸ› ï¸ ç›‘ç£å­¦ä¹ ç®—æ³•å·¥å…·ç®±</h3>
        <p class="nav-subtitle">æœºå™¨å­¦ä¹ çš„ç‘å£«å†›åˆ€</p>
    </div>

    <ul class="nav-list">
        <li class="nav-item active" data-section="intro">
            <a href="#intro">
                <span class="nav-icon">ğŸš€</span>
                <div class="nav-content">
                    <span class="nav-text">å¼•è¨€ï¼šç®—æ³•çš„ç‘å£«å†›åˆ€</span>
                    <div class="nav-meta">
                        <span class="nav-time">3 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
        <li class="nav-item" data-section="naive-bayes">
            <a href="#naive-bayes">
                <span class="nav-icon">ğŸ²</span>
                <div class="nav-content">
                    <span class="nav-text">9.1 æœ´ç´ è´å¶æ–¯æ³•</span>
                    <div class="nav-meta">
                        <span class="nav-time">8 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
        <li class="nav-item" data-section="decision-tree">
            <a href="#decision-tree">
                <span class="nav-icon">ğŸŒ³</span>
                <div class="nav-content">
                    <span class="nav-text">9.2 å†³ç­–æ ‘</span>
                    <div class="nav-meta">
                        <span class="nav-time">10 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
        <li class="nav-item" data-section="svm">
            <a href="#svm">
                <span class="nav-icon">âš¡</span>
                <div class="nav-content">
                    <span class="nav-text">9.3 æ”¯æŒå‘é‡æœº</span>
                    <div class="nav-meta">
                        <span class="nav-time">12 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
        <li class="nav-item" data-section="ensemble">
            <a href="#ensemble">
                <span class="nav-icon">ğŸŒ²</span>
                <div class="nav-content">
                    <span class="nav-text">9.4 é›†æˆå­¦ä¹ </span>
                    <div class="nav-meta">
                        <span class="nav-time">10 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
        <li class="nav-item" data-section="comparison">
            <a href="#comparison">
                <span class="nav-icon">âš”ï¸</span>
                <div class="nav-content">
                    <span class="nav-text">9.5 ç®—æ³•å¯¹æ¯”ä¸é€‰æ‹©</span>
                    <div class="nav-meta">
                        <span class="nav-time">6 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
        <li class="nav-item" data-section="practice">
            <a href="#practice">
                <span class="nav-icon">ğŸ¯</span>
                <div class="nav-content">
                    <span class="nav-text">9.6 å®æˆ˜ï¼šåƒåœ¾é‚®ä»¶è¿‡æ»¤</span>
                    <div class="nav-meta">
                        <span class="nav-time">12 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
        <li class="nav-item" data-section="summary">
            <a href="#summary">
                <span class="nav-icon">ğŸ“</span>
                <div class="nav-content">
                    <span class="nav-text">9.7 æ€»ç»“ä¸å±•æœ›</span>
                    <div class="nav-meta">
                        <span class="nav-time">3 min</span>
                        <span class="nav-status"></span>
                    </div>
                </div>
            </a>
        </li>
    </ul>
</nav>

<!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
<div class="progress-indicator">
    <span>å­¦ä¹ è¿›åº¦</span>
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>
    <span id="progressText">0%</span>
</div>

<!-- ä¸»å®¹å™¨ -->
<div class="container">
    <!-- æ ‡é¢˜éƒ¨åˆ† -->
    <div class="main-header fade-in">
        <h1 class="main-title">ç¬¬9ç« ï¼šå…¶ä»–ç›‘ç£å­¦ä¹ ç®—æ³•</h1>
        <p class="subtitle">ğŸ› ï¸ æœºå™¨å­¦ä¹ çš„ç‘å£«å†›åˆ€ - æŒæ¡æ›´å¤šå¼ºå¤§å·¥å…·</p>
    </div>

    <!-- å¼•è¨€ï¼šç®—æ³•çš„ç‘å£«å†›åˆ€ -->
    <div id="intro" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸš€ å¼•è¨€ï¼šç®—æ³•çš„ç‘å£«å†›åˆ€</h2>

        <div class="story-box content-box">
            <h3 style="color: #4facfe; margin-bottom: 20px;">ğŸ”ï¸ ç‘å£«å†›åˆ€çš„å¯ç¤º</h3>
            <p style="font-size: 1.1rem; line-height: 1.8;">
                1891å¹´ï¼Œç‘å£«å†›é˜Ÿé¢ä¸´ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼š<br>
                å£«å…µä»¬éœ€è¦æºå¸¦å„ç§å·¥å…·â€”â€”èºä¸åˆ€ä¿®ç†æ­¥æªï¼Œå¼€ç½å™¨æ‰“å¼€ç½å¤´ï¼Œå°åˆ€åˆ‡å‰²...<br>
                ä½†èƒŒåŒ…ç©ºé—´æœ‰é™ï¼Œè£…å¤‡è¶Šå¤šï¼Œè¡Œå†›è¶Šå›°éš¾ã€‚<br><br>

                <strong>å¡å°”Â·åŸƒå°”æ£®çº³</strong>æƒ³åˆ°äº†ä¸€ä¸ªç»å¦™çš„ä¸»æ„ï¼š<br>
                <span class="highlight-primary">ä¸ºä»€ä¹ˆä¸æŠŠæ‰€æœ‰å·¥å…·é›†æˆåˆ°ä¸€æŠŠå°åˆ€é‡Œï¼Ÿ</span><br><br>

                äºæ˜¯ï¼Œä¸–ç•Œä¸Šç¬¬ä¸€æŠŠç‘å£«å†›åˆ€è¯ç”Ÿäº†â€”â€”<br>
                å°å·§ã€ç²¾è‡´ï¼Œå´åŠŸèƒ½å¼ºå¤§ï¼Œæ¯ä¸ªå·¥å…·éƒ½æœ‰å…¶ç‹¬ç‰¹ç”¨é€”ã€‚<br><br>

                ä»Šå¤©ï¼Œæˆ‘ä»¬è¦å­¦ä¹ çš„å°±æ˜¯æœºå™¨å­¦ä¹ ä¸­çš„"ç‘å£«å†›åˆ€"ï¼š<br>
                <span class="highlight-secondary">æœ´ç´ è´å¶æ–¯ã€å†³ç­–æ ‘ã€æ”¯æŒå‘é‡æœºã€é›†æˆå­¦ä¹ </span><br>
                æ¯ç§ç®—æ³•éƒ½åƒå†›åˆ€ä¸Šçš„ä¸€ä¸ªå·¥å…·ï¼Œ<span class="highlight-warning">è§£å†³ç‰¹å®šé—®é¢˜æ—¶æ— å¯æ›¿ä»£</span>ï¼
            </p>
        </div>

        <div class="thinking-box content-box">
            <h3>ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆå¤šç®—æ³•ï¼Ÿ</h3>
            <p style="margin-bottom: 15px;">æƒ³è±¡ä½ æ˜¯ä¸€ä½å¤§å¨ï¼Œé¢å¯¹ä¸åŒçš„é£Ÿæå’Œèœè‚´...</p>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div style="background: rgba(79, 172, 254, 0.1); padding: 15px; border-radius: 10px;">
                    <h4 style="color: #4facfe;">ğŸ³ åªæœ‰ä¸€æŠŠèœåˆ€</h4>
                    <ul style="list-style: none; padding: 0; margin-top: 10px;">
                        <li>â€¢ åˆ‡èœè¿˜è¡Œ</li>
                        <li>â€¢ å‰Šçš®å›°éš¾</li>
                        <li>â€¢ å¼€ç“¶æ— èƒ½ä¸ºåŠ›</li>
                        <li>â€¢ æ…æ‹Œæ›´æ˜¯ä¸å¯èƒ½</li>
                    </ul>
                </div>
                <div style="background: rgba(167, 139, 250, 0.1); padding: 15px; border-radius: 10px;">
                    <h4 style="color: #a78bfa;">ğŸ´ å·¥å…·é½å…¨</h4>
                    <ul style="list-style: none; padding: 0; margin-top: 10px;">
                        <li>â€¢ èœåˆ€åˆ‡èœ</li>
                        <li>â€¢ å‰Šçš®å™¨å‰Šçš®</li>
                        <li>â€¢ å¼€ç“¶å™¨å¼€ç“¶</li>
                        <li>â€¢ æ‰“è›‹å™¨æ…æ‹Œ</li>
                    </ul>
                </div>
            </div>

            <p style="margin-top: 20px; padding: 15px; background: rgba(52, 211, 153, 0.1); border-radius: 10px; border: 1px solid rgba(52, 211, 153, 0.3);">
                ğŸ¯ <strong>æ²¡æœ‰ä¸‡èƒ½çš„ç®—æ³•</strong>ï¼Œä½†æ€»æœ‰ä¸€ç§ç®—æ³•æœ€é€‚åˆä½ çš„é—®é¢˜ï¼
            </p>
        </div>

        <div style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.05)); padding: 25px; border-radius: 15px; margin: 20px 0; border: 2px solid rgba(251, 191, 36, 0.3);">
            <h4 style="color: #fbbf24; margin-bottom: 15px;">ğŸ“Š æœ¬ç« ç®—æ³•ä¸€è§ˆ</h4>

            <div class="algo-results">
                <div class="algo-card">
                    <div class="algo-icon">ğŸ²</div>
                    <div class="algo-label">æœ´ç´ è´å¶æ–¯</div>
                    <div class="algo-desc">æ¦‚ç‡æ¨ç†<br>æ–‡æœ¬åˆ†ç±»åˆ©å™¨</div>
                </div>
                <div class="algo-card">
                    <div class="algo-icon">ğŸŒ³</div>
                    <div class="algo-label">å†³ç­–æ ‘</div>
                    <div class="algo-desc">è§„åˆ™å­¦ä¹ <br>å¯è§£é‡Šæ€§å¼º</div>
                </div>
                <div class="algo-card">
                    <div class="algo-icon">âš¡</div>
                    <div class="algo-label">æ”¯æŒå‘é‡æœº</div>
                    <div class="algo-desc">æœ€å¤§é—´éš”<br>ç†è®ºä¼˜é›…</div>
                </div>
                <div class="algo-card">
                    <div class="algo-icon">ğŸŒ²</div>
                    <div class="algo-label">é›†æˆå­¦ä¹ </div>
                    <div class="algo-desc">ç¾¤ä½“æ™ºæ…§<br>æ€§èƒ½å“è¶Š</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 9.1 æœ´ç´ è´å¶æ–¯æ³• -->
    <div id="naive-bayes" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ² 9.1 æœ´ç´ è´å¶æ–¯æ³•</h2>

        <div class="story-box content-box">
            <h3 style="color: #4facfe;">ğŸ“§ åƒåœ¾é‚®ä»¶çš„"æ¦‚ç‡å¯†ç "</h3>
            <p style="margin-bottom: 20px;">
                2002å¹´ï¼Œ<strong>ä¿ç½—Â·æ ¼é›·å„å§†</strong>å†™äº†ä¸€ç¯‡éœ‡æ’¼ä¸šç•Œçš„æ–‡ç« ï¼š<br>
                ã€Šåƒåœ¾é‚®ä»¶è¿‡æ»¤çš„è´å¶æ–¯æ–¹æ³•ã€‹<br><br>

                ä»–çš„æ´å¯Ÿå¾ˆç®€å•å´å¾ˆæ·±åˆ»ï¼š<br>
                ğŸ’­ åƒåœ¾é‚®ä»¶æ€»æ˜¯åŒ…å«æŸäº›ç‰¹å®šçš„è¯æ±‡â€”â€”"å…è´¹"ã€"ä¸­å¥–"ã€"ç‚¹å‡»è¿™é‡Œ"...<br>
                ğŸ“Š å¦‚æœæˆ‘ä»¬ç»Ÿè®¡è¿™äº›è¯åœ¨åƒåœ¾é‚®ä»¶ä¸­å‡ºç°çš„æ¦‚ç‡...<br>
                ğŸ¯ å°±èƒ½æ ¹æ®é‚®ä»¶å†…å®¹è®¡ç®—å®ƒæ˜¯åƒåœ¾é‚®ä»¶çš„æ¦‚ç‡ï¼<br><br>

                è¿™ä¸ªæƒ³æ³•åŸºäº18ä¸–çºªæ•°å­¦å®¶<span class="highlight-primary">æ‰˜é©¬æ–¯Â·è´å¶æ–¯</span>çš„ç†è®ºï¼Œ<br>
                å´åœ¨21ä¸–çºªæˆä¸ºäº†<span class="highlight-secondary">å¯¹æŠ—åƒåœ¾é‚®ä»¶çš„åˆ©å™¨</span>ï¼
            </p>
        </div>

        <div class="thinking-box content-box">
            <h3>ğŸ§  è´å¶æ–¯å®šç†ï¼šé€†å‘æ€ç»´çš„è‰ºæœ¯</h3>
            <p style="margin-bottom: 20px;">è´å¶æ–¯å®šç†å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•"åå‘æ¨ç†"ï¼š</p>

            <div style="background: rgba(79, 172, 254, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h4 style="color: #4facfe;">ğŸ¥ ä¸€ä¸ªåŒ»å­¦è¯Šæ–­çš„ä¾‹å­</h4>
                <p>æŸç§ç½•è§ç–¾ç—…çš„å‘ç—…ç‡æ˜¯0.1%ï¼ˆå…ˆéªŒæ¦‚ç‡ï¼‰<br>
                    æ£€æµ‹çš„å‡†ç¡®ç‡æ˜¯99%ï¼ˆä¼¼ç„¶æ¦‚ç‡ï¼‰<br>
                    å¦‚æœä½ æ£€æµ‹å‘ˆé˜³æ€§ï¼ŒçœŸæ­£æ‚£ç—…çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ</p>

                <p style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                    ç›´è§‰ï¼š99%ï¼Ÿ<br>
                    <strong>å®é™…ï¼šåªæœ‰9%å·¦å³ï¼</strong><br>
                    å› ä¸ºç–¾ç—…å¤ªç½•è§ï¼Œå³ä½¿æ£€æµ‹å¾ˆå‡†ç¡®ï¼Œè¯¯æŠ¥çš„ç»å¯¹æ•°é‡ä»ç„¶å¾ˆå¤§ã€‚
                </p>
            </div>
        </div>

        <div class="formula-box content-box">
            <h3 style="color: #f472b6; margin-bottom: 20px;">ğŸ“ è´å¶æ–¯å…¬å¼</h3>
            <div class="math-formula">
                P(A|B) = P(B|A) Ã— P(A) / P(B)
            </div>
            <div style="text-align: left; margin: 20px auto; max-width: 600px;">
                <p><strong>P(A|B)</strong>ï¼šåéªŒæ¦‚ç‡ï¼ˆç»™å®šBå‘ç”Ÿæ—¶Açš„æ¦‚ç‡ï¼‰</p>
                <p><strong>P(B|A)</strong>ï¼šä¼¼ç„¶æ¦‚ç‡ï¼ˆç»™å®šAå‘ç”Ÿæ—¶Bçš„æ¦‚ç‡ï¼‰</p>
                <p><strong>P(A)</strong>ï¼šå…ˆéªŒæ¦‚ç‡ï¼ˆAçš„æ¦‚ç‡ï¼‰</p>
                <p><strong>P(B)</strong>ï¼šè¯æ®ï¼ˆBçš„æ¦‚ç‡ï¼‰</p>
            </div>
        </div>

        <!-- æœ´ç´ è´å¶æ–¯äº¤äº’å¼æ¼”ç¤º -->
        <div class="demo-container">
            <h3 style="color: #4facfe; text-align: center; margin-bottom: 20px;">ğŸ® æœ´ç´ è´å¶æ–¯åƒåœ¾é‚®ä»¶åˆ†ç±»å™¨</h3>
            <canvas id="bayesCanvas" class="demo-canvas" width="800" height="400"></canvas>

            <div class="param-panel">
                <div class="param-group">
                    <label class="param-label">è®­ç»ƒæ ·æœ¬æ•°:</label>
                    <input type="range" class="param-slider" id="bayesSamples" min="10" max="200" value="50" onchange="updateBayesDemo()">
                    <span class="param-value" id="bayesSamplesValue">50</span>
                </div>
                <div class="param-group">
                    <label class="param-label">æµ‹è¯•é‚®ä»¶:</label>
                    <input type="text" id="testEmail" placeholder="è¾“å…¥æµ‹è¯•æ–‡æœ¬..." style="padding: 8px; border-radius: 5px; border: 1px solid var(--border-primary); background: var(--bg-secondary); color: var(--text-primary); width: 300px;">
                </div>
            </div>

            <div class="demo-controls">
                <button class="demo-btn" onclick="trainBayes()">ğŸ¯ è®­ç»ƒæ¨¡å‹</button>
                <button class="demo-btn" onclick="testBayes()">ğŸ“§ æµ‹è¯•é‚®ä»¶</button>
                <button class="demo-btn secondary" onclick="showWordProbs()">ğŸ“Š è¯é¢‘ç»Ÿè®¡</button>
                <button class="demo-btn secondary" onclick="animateBayes()">ğŸ¬ æ¨ç†è¿‡ç¨‹</button>
            </div>

            <div class="metric-cards" style="margin-top: 20px;">
                <div class="metric-card">
                    <div class="metric-icon">ğŸ“§</div>
                    <div class="metric-name">åƒåœ¾é‚®ä»¶æ¦‚ç‡</div>
                    <div class="metric-value" id="spamProb">0%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">âœ‰ï¸</div>
                    <div class="metric-name">æ­£å¸¸é‚®ä»¶æ¦‚ç‡</div>
                    <div class="metric-value" id="hamProb">0%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">ğŸ¯</div>
                    <div class="metric-name">åˆ†ç±»ç»“æœ</div>
                    <div class="metric-value" id="classResult">-</div>
                </div>
            </div>
        </div>

        <!-- æœ´ç´ è´å¶æ–¯ä»£ç ç¤ºä¾‹ -->
        <div class="code-block">
            <pre><code><span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict
<span class="keyword">import</span> re

<span class="keyword">class</span> <span class="function">NaiveBayesClassifier</span>:
    <span class="string">"""æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ - ç®€å•è€Œå¼ºå¤§çš„æ¦‚ç‡æ¨ç†"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, alpha=<span class="number">1.0</span>):
        <span class="string">"""
        alpha: æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘å‚æ•°ï¼Œé¿å…æ¦‚ç‡ä¸º0
        """</span>
        self.alpha = alpha
        self.class_prior = {}  <span class="comment"># ç±»çš„å…ˆéªŒæ¦‚ç‡</span>
        self.feature_prob = {}  <span class="comment"># ç‰¹å¾çš„æ¡ä»¶æ¦‚ç‡</span>
        self.classes = []
        self.vocabulary = set()

    <span class="keyword">def</span> <span class="function">tokenize</span>(self, text):
        <span class="string">"""ç®€å•çš„åˆ†è¯å™¨"""</span>
        <span class="comment"># è½¬å°å†™ï¼Œæå–å•è¯</span>
        words = re.findall(r'\b\w+\b', text.lower())
        <span class="keyword">return</span> words

    <span class="keyword">def</span> <span class="function">fit</span>(self, X, y):
        <span class="string">"""è®­ç»ƒæœ´ç´ è´å¶æ–¯æ¨¡å‹"""</span>
        n_samples = len(X)
        self.classes = np.unique(y)
        n_classes = len(self.classes)

        <span class="comment"># åˆå§‹åŒ–</span>
        <span class="keyword">for</span> c <span class="keyword">in</span> self.classes:
            self.feature_prob[c] = defaultdict(<span class="keyword">lambda</span>: <span class="number">0</span>)

        <span class="comment"># ç»Ÿè®¡è¯é¢‘å’Œç±»åˆ«è®¡æ•°</span>
        class_count = defaultdict(<span class="keyword">lambda</span>: <span class="number">0</span>)
        <span class="keyword">for</span> text, label <span class="keyword">in</span> zip(X, y):
            class_count[label] += <span class="number">1</span>
            words = self.tokenize(text)
            <span class="keyword">for</span> word <span class="keyword">in</span> words:
                self.vocabulary.add(word)
                self.feature_prob[label][word] += <span class="number">1</span>

        <span class="comment"># è®¡ç®—å…ˆéªŒæ¦‚ç‡ P(ç±»åˆ«)</span>
        <span class="keyword">for</span> c <span class="keyword">in</span> self.classes:
            self.class_prior[c] = class_count[c] / n_samples

        <span class="comment"># è®¡ç®—æ¡ä»¶æ¦‚ç‡ P(è¯|ç±»åˆ«) with æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘</span>
        <span class="keyword">for</span> c <span class="keyword">in</span> self.classes:
            total_words = sum(self.feature_prob[c].values())
            vocab_size = len(self.vocabulary)

            <span class="keyword">for</span> word <span class="keyword">in</span> self.vocabulary:
                count = self.feature_prob[c][word]
                <span class="comment"># æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘</span>
                self.feature_prob[c][word] = (count + self.alpha) / \
                                           (total_words + self.alpha * vocab_size)

    <span class="keyword">def</span> <span class="function">predict_proba</span>(self, text):
        <span class="string">"""é¢„æµ‹æ–‡æœ¬å±äºå„ç±»åˆ«çš„æ¦‚ç‡"""</span>
        words = self.tokenize(text)
        scores = {}

        <span class="keyword">for</span> c <span class="keyword">in</span> self.classes:
            <span class="comment"># å–å¯¹æ•°é¿å…ä¸‹æº¢</span>
            log_prob = np.log(self.class_prior[c])

            <span class="keyword">for</span> word <span class="keyword">in</span> words:
                <span class="keyword">if</span> word <span class="keyword">in</span> self.vocabulary:
                    log_prob += np.log(self.feature_prob[c].get(word,
                                     self.alpha / (sum(self.feature_prob[c].values()) +
                                     self.alpha * len(self.vocabulary))))

            scores[c] = log_prob

        <span class="comment"># è½¬æ¢å›æ¦‚ç‡</span>
        max_score = max(scores.values())
        exp_scores = {c: np.exp(score - max_score) <span class="keyword">for</span> c, score <span class="keyword">in</span> scores.items()}
        total = sum(exp_scores.values())

        <span class="keyword">return</span> {c: exp_score / total <span class="keyword">for</span> c, exp_score <span class="keyword">in</span> exp_scores.items()}

    <span class="keyword">def</span> <span class="function">predict</span>(self, text):
        <span class="string">"""é¢„æµ‹æ–‡æœ¬çš„ç±»åˆ«"""</span>
        proba = self.predict_proba(text)
        <span class="keyword">return</span> max(proba, key=proba.get)

<span class="comment"># ğŸš€ ä½¿ç”¨ç¤ºä¾‹ï¼šåƒåœ¾é‚®ä»¶åˆ†ç±»</span>
<span class="comment"># è®­ç»ƒæ•°æ®</span>
emails = [
    (<span class="string">"å…è´¹ ä¸­å¥– ç‚¹å‡»è¿™é‡Œ èµ¢å–å¤§å¥–"</span>, <span class="string">"spam"</span>),
    (<span class="string">"æ­å–œæ‚¨ä¸­å¥–äº† è¯·æä¾›é“¶è¡Œè´¦å·"</span>, <span class="string">"spam"</span>),
    (<span class="string">"ä¼šè®®å®‰æ’åœ¨æ˜å¤©ä¸‹åˆä¸‰ç‚¹"</span>, <span class="string">"ham"</span>),
    (<span class="string">"é¡¹ç›®è¿›å±•æŠ¥å‘Šå·²å‘é€"</span>, <span class="string">"ham"</span>),
    (<span class="string">"é™æ—¶ä¼˜æƒ  ç«‹å³è´­ä¹°"</span>, <span class="string">"spam"</span>),
    (<span class="string">"æ˜å¤©çš„ä¼šè®®è®®ç¨‹"</span>, <span class="string">"ham"</span>)
]

X = [email[<span class="number">0</span>] <span class="keyword">for</span> email <span class="keyword">in</span> emails]
y = [email[<span class="number">1</span>] <span class="keyword">for</span> email <span class="keyword">in</span> emails]

<span class="comment"># è®­ç»ƒæ¨¡å‹</span>
nb = NaiveBayesClassifier()
nb.fit(X, y)

<span class="comment"># æµ‹è¯•æ–°é‚®ä»¶</span>
test_email = <span class="string">"æ­å–œæ‚¨è·å¾—å…è´¹å¤§å¥–"</span>
prediction = nb.predict(test_email)
proba = nb.predict_proba(test_email)

print(<span class="string">f"ğŸ“§ é‚®ä»¶å†…å®¹: {test_email}"</span>)
print(<span class="string">f"ğŸ¯ é¢„æµ‹ç»“æœ: {prediction}"</span>)
print(<span class="string">f"ğŸ“Š æ¦‚ç‡åˆ†å¸ƒ: åƒåœ¾é‚®ä»¶={proba['spam']:.2%}, æ­£å¸¸é‚®ä»¶={proba['ham']:.2%}"</span>)</code></pre>
        </div>

        <!-- æœ´ç´ è´å¶æ–¯ä¼˜ç¼ºç‚¹ -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
            <div style="background: rgba(52, 211, 153, 0.1); padding: 25px; border-radius: 15px; border: 2px solid rgba(52, 211, 153, 0.3);">
                <h4 style="color: #34d399; margin-bottom: 15px;">âœ… æœ´ç´ è´å¶æ–¯çš„ä¼˜åŠ¿</h4>
                <ul style="list-style: none; padding: 0;">
                    <li>âš¡ è®­ç»ƒå’Œé¢„æµ‹é€Ÿåº¦æå¿«</li>
                    <li>ğŸ’¾ å†…å­˜å ç”¨å°</li>
                    <li>ğŸ“Š å°æ ·æœ¬ä¸‹è¡¨ç°è‰¯å¥½</li>
                    <li>ğŸ¯ å¯¹ç¼ºå¤±æ•°æ®ä¸æ•æ„Ÿ</li>
                    <li>ğŸ“ å¯å¤„ç†å¤šåˆ†ç±»é—®é¢˜</li>
                </ul>
            </div>
            <div style="background: rgba(244, 114, 182, 0.1); padding: 25px; border-radius: 15px; border: 2px solid rgba(244, 114, 182, 0.3);">
                <h4 style="color: #f472b6; margin-bottom: 15px;">âš ï¸ æœ´ç´ è´å¶æ–¯çš„å±€é™</h4>
                <ul style="list-style: none; padding: 0;">
                    <li>ğŸ¤ ç‰¹å¾ç‹¬ç«‹å‡è®¾å¤ªå¼º</li>
                    <li>ğŸ“‰ å¯¹è¾“å…¥æ•°æ®çš„åˆ†å¸ƒæ•æ„Ÿ</li>
                    <li>ğŸ”¢ éœ€è¦å…ˆéªŒæ¦‚ç‡</li>
                    <li>âŒ æ— æ³•å­¦ä¹ ç‰¹å¾é—´çš„å…³ç³»</li>
                    <li>ğŸ² æ¦‚ç‡ä¼°è®¡å¯èƒ½ä¸å‡†ç¡®</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 9.2 å†³ç­–æ ‘ -->
    <div id="decision-tree" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸŒ³ 9.2 å†³ç­–æ ‘</h2>

        <div class="story-box content-box">
            <h3 style="color: #4facfe;">ğŸ•µï¸ äºŒåä¸ªé—®é¢˜çš„æ¸¸æˆ</h3>
            <p style="margin-bottom: 20px;">
                è¿˜è®°å¾—å°æ—¶å€™ç©çš„"äºŒåä¸ªé—®é¢˜"æ¸¸æˆå—ï¼Ÿ<br><br>

                ä¸€ä¸ªäººå¿ƒé‡Œæƒ³ä¸€ä¸ªä¸œè¥¿ï¼Œå…¶ä»–äººé€šè¿‡é—®æ˜¯/å¦é—®é¢˜æ¥çŒœæµ‹ï¼š<br>
                ğŸ‘¤ "æ˜¯æ´»çš„å—ï¼Ÿ" â€” æ˜¯<br>
                ğŸ‘¤ "æ˜¯åŠ¨ç‰©å—ï¼Ÿ" â€” æ˜¯<br>
                ğŸ‘¤ "æœ‰å››æ¡è…¿å—ï¼Ÿ" â€” æ˜¯<br>
                ğŸ‘¤ "æ˜¯å® ç‰©å—ï¼Ÿ" â€” æ˜¯<br>
                ğŸ‘¤ "ä¼šæ±ªæ±ªå«å—ï¼Ÿ" â€” æ˜¯<br>
                ğŸ¯ "æ˜¯ç‹—ï¼"<br><br>

                è¿™ä¸ªæ¸¸æˆçš„ç²¾é«“å°±æ˜¯<span class="highlight-primary">å†³ç­–æ ‘çš„æ ¸å¿ƒæ€æƒ³</span>ï¼š<br>
                é€šè¿‡ä¸€ç³»åˆ—é—®é¢˜ï¼Œé€æ­¥ç¼©å°èŒƒå›´ï¼Œæœ€ç»ˆå¾—å‡ºç­”æ¡ˆã€‚<br><br>

                1963å¹´ï¼Œ<strong>Morganå’ŒSonquist</strong>é¦–æ¬¡æå‡ºäº†å†³ç­–æ ‘ç®—æ³•ï¼Œ<br>
                å°†è¿™ä¸ªç®€å•çš„æ¸¸æˆåŸç†ï¼Œå˜æˆäº†<span class="highlight-secondary">å¼ºå¤§çš„æœºå™¨å­¦ä¹ å·¥å…·</span>ï¼
            </p>
        </div>

        <div class="thinking-box content-box">
            <h3>ğŸ¯ å†³ç­–æ ‘çš„æ™ºæ…§ï¼šåˆ†è€Œæ²»ä¹‹</h3>
            <p style="margin-bottom: 20px;">å†³ç­–æ ‘é€šè¿‡é€’å½’åœ°é€‰æ‹©æœ€ä¼˜ç‰¹å¾ï¼Œå°†æ•°æ®ç©ºé—´åˆ’åˆ†æˆä¸åŒçš„åŒºåŸŸï¼š</p>

            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px;">
                <div style="background: rgba(79, 172, 254, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <h4 style="color: #4facfe;">1ï¸âƒ£ ç‰¹å¾é€‰æ‹©</h4>
                    <p style="font-size: 0.9rem;">é€‰æ‹©æœ€èƒ½åŒºåˆ†æ•°æ®çš„ç‰¹å¾</p>
                </div>
                <div style="background: rgba(167, 139, 250, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <h4 style="color: #a78bfa;">2ï¸âƒ£ å†³ç­–ç”Ÿæˆ</h4>
                    <p style="font-size: 0.9rem;">æ ¹æ®ç‰¹å¾å€¼åˆ’åˆ†æ•°æ®</p>
                </div>
                <div style="background: rgba(244, 114, 182, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <h4 style="color: #f472b6;">3ï¸âƒ£ å‰ªæä¼˜åŒ–</h4>
                    <p style="font-size: 0.9rem;">é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œæé«˜æ³›åŒ–</p>
                </div>
            </div>
        </div>

        <!-- å†³ç­–æ ‘äº¤äº’å¼æ¼”ç¤º -->
        <div class="demo-container">
            <h3 style="color: #4facfe; text-align: center; margin-bottom: 20px;">ğŸŒ³ å†³ç­–æ ‘ç”Ÿé•¿è¿‡ç¨‹å¯è§†åŒ–</h3>
            <div style="position: relative; height: 500px; background: #0a0e27; border-radius: 10px; margin: 20px auto;">
                <canvas id="treeCanvas" class="demo-canvas" width="800" height="500"></canvas>
            </div>

            <div class="param-panel">
                <div class="param-group">
                    <label class="param-label">æœ€å¤§æ·±åº¦:</label>
                    <input type="range" class="param-slider" id="maxDepth" min="1" max="5" value="3" onchange="updateTreeDepth()">
                    <span class="param-value" id="maxDepthValue">3</span>
                </div>
                <div class="param-group">
                    <label class="param-label">åˆ†è£‚å‡†åˆ™:</label>
                    <select id="criterion" onchange="updateCriterion()" style="padding: 5px 10px; border-radius: 5px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-primary);">
                        <option value="gini">åŸºå°¼æŒ‡æ•°</option>
                        <option value="entropy">ä¿¡æ¯å¢ç›Š</option>
                        <option value="gain_ratio">ä¿¡æ¯å¢ç›Šç‡</option>
                    </select>
                </div>
            </div>

            <div class="demo-controls">
                <button class="demo-btn" onclick="generateTreeData()">ğŸ² ç”Ÿæˆæ•°æ®</button>
                <button class="demo-btn" onclick="growTree()">ğŸŒ± ç”Ÿé•¿å†³ç­–æ ‘</button>
                <button class="demo-btn secondary" onclick="pruneTree()">âœ‚ï¸ å‰ªæä¼˜åŒ–</button>
                <button class="demo-btn secondary" onclick="animateDecision()">ğŸ¬ å†³ç­–è¿‡ç¨‹</button>
            </div>
        </div>

        <!-- ä¿¡æ¯å¢ç›Šå…¬å¼ -->
        <div class="formula-box content-box">
            <h3 style="color: #f472b6; margin-bottom: 20px;">ğŸ“ ç‰¹å¾é€‰æ‹©çš„æ•°å­¦åŸºç¡€</h3>

            <div style="text-align: left; margin: 20px auto; max-width: 700px;">
                <h4 style="color: #4facfe; margin-bottom: 15px;">1. ä¿¡æ¯ç†µï¼ˆä¸ç¡®å®šæ€§çš„åº¦é‡ï¼‰</h4>
                <p style="text-align: center; margin: 15px 0;">H(D) = -Î£ p_i Ã— logâ‚‚(p_i)</p>

                <h4 style="color: #a78bfa; margin: 15px 0;">2. ä¿¡æ¯å¢ç›Šï¼ˆä¸ç¡®å®šæ€§çš„å‡å°‘ï¼‰</h4>
                <p style="text-align: center; margin: 15px 0;">Gain(D, A) = H(D) - Î£ |D_v|/|D| Ã— H(D_v)</p>

                <h4 style="color: #f472b6; margin: 15px 0;">3. åŸºå°¼æŒ‡æ•°ï¼ˆä¸çº¯åº¦çš„åº¦é‡ï¼‰</h4>
                <p style="text-align: center; margin: 15px 0;">Gini(D) = 1 - Î£ p_iÂ²</p>
            </div>
        </div>

        <!-- å†³ç­–æ ‘ç®—æ³•å¯¹æ¯” -->
        <div style="margin: 30px 0;">
            <h3 style="color: #a78bfa; margin-bottom: 20px;">ğŸŒ² å†³ç­–æ ‘ç®—æ³•å®¶æ—</h3>
            <table class="data-table">
                <thead>
                <tr>
                    <th>ç®—æ³•</th>
                    <th>åˆ†è£‚å‡†åˆ™</th>
                    <th>ç‰¹ç‚¹</th>
                    <th>ä¼˜åŠ¿</th>
                    <th>å±€é™</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><strong>ID3</strong></td>
                    <td>ä¿¡æ¯å¢ç›Š</td>
                    <td>æœ€æ—©çš„å†³ç­–æ ‘ç®—æ³•</td>
                    <td>ç®€å•ç›´è§‚</td>
                    <td>åå‘å¤šå€¼ç‰¹å¾</td>
                </tr>
                <tr>
                    <td><strong>C4.5</strong></td>
                    <td>ä¿¡æ¯å¢ç›Šç‡</td>
                    <td>ID3çš„æ”¹è¿›ç‰ˆ</td>
                    <td>å¤„ç†è¿ç»­ç‰¹å¾</td>
                    <td>è®¡ç®—å¤æ‚</td>
                </tr>
                <tr>
                    <td><strong>CART</strong></td>
                    <td>åŸºå°¼æŒ‡æ•°</td>
                    <td>äºŒå‰æ ‘ç»“æ„</td>
                    <td>å¯åšå›å½’ï¼Œç¨³å®š</td>
                    <td>å®¹æ˜“è¿‡æ‹Ÿåˆ</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- å†³ç­–æ ‘ä»£ç ç¤ºä¾‹ -->
        <div class="code-block">
            <pre><code><span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">from</span> collections <span class="keyword">import</span> Counter
<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt

<span class="keyword">class</span> <span class="function">DecisionTreeClassifier</span>:
    <span class="string">"""å†³ç­–æ ‘åˆ†ç±»å™¨ - å¯è§£é‡Šçš„è§„åˆ™å­¦ä¹ """</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, max_depth=<span class="number">5</span>, min_samples_split=<span class="number">2</span>,
                 criterion=<span class="string">'gini'</span>):
        self.max_depth = max_depth
        self.min_samples_split = min_samples_split
        self.criterion = criterion
        self.tree = <span class="keyword">None</span>

    <span class="keyword">def</span> <span class="function">_entropy</span>(self, y):
        <span class="string">"""è®¡ç®—ä¿¡æ¯ç†µ"""</span>
        hist = np.bincount(y)
        ps = hist / len(y)
        <span class="keyword">return</span> -np.sum([p * np.log2(p) <span class="keyword">for</span> p <span class="keyword">in</span> ps <span class="keyword">if</span> p > <span class="number">0</span>])

    <span class="keyword">def</span> <span class="function">_gini</span>(self, y):
        <span class="string">"""è®¡ç®—åŸºå°¼æŒ‡æ•°"""</span>
        hist = np.bincount(y)
        ps = hist / len(y)
        <span class="keyword">return</span> <span class="number">1</span> - np.sum([p**<span class="number">2</span> <span class="keyword">for</span> p <span class="keyword">in</span> ps])

    <span class="keyword">def</span> <span class="function">_information_gain</span>(self, y, X_column, threshold):
        <span class="string">"""è®¡ç®—ä¿¡æ¯å¢ç›Š"""</span>
        <span class="comment"># çˆ¶èŠ‚ç‚¹çš„ä¸çº¯åº¦</span>
        parent_loss = self._entropy(y) <span class="keyword">if</span> self.criterion == <span class="string">'entropy'</span> \
                      <span class="keyword">else</span> self._gini(y)

        <span class="comment"># ç”Ÿæˆåˆ†å‰²</span>
        left_idxs = np.argwhere(X_column <= threshold).flatten()
        right_idxs = np.argwhere(X_column > threshold).flatten()

        <span class="keyword">if</span> len(left_idxs) == <span class="number">0</span> <span class="keyword">or</span> len(right_idxs) == <span class="number">0</span>:
            <span class="keyword">return</span> <span class="number">0</span>

        <span class="comment"># è®¡ç®—å­èŠ‚ç‚¹çš„åŠ æƒä¸çº¯åº¦</span>
        n = len(y)
        n_l, n_r = len(left_idxs), len(right_idxs)

        <span class="keyword">if</span> self.criterion == <span class="string">'entropy'</span>:
            e_l = self._entropy(y[left_idxs])
            e_r = self._entropy(y[right_idxs])
            child_loss = (n_l / n) * e_l + (n_r / n) * e_r
        <span class="keyword">else</span>:
            g_l = self._gini(y[left_idxs])
            g_r = self._gini(y[right_idxs])
            child_loss = (n_l / n) * g_l + (n_r / n) * g_r

        <span class="comment"># ä¿¡æ¯å¢ç›Š</span>
        <span class="keyword">return</span> parent_loss - child_loss

    <span class="keyword">def</span> <span class="function">_best_split</span>(self, X, y):
        <span class="string">"""å¯»æ‰¾æœ€ä½³åˆ†å‰²ç‚¹"""</span>
        m, n = X.shape
        <span class="keyword">if</span> m <= self.min_samples_split:
            <span class="keyword">return</span> <span class="keyword">None</span>, <span class="keyword">None</span>

        <span class="comment"># è®°å½•æœ€ä½³åˆ†å‰²</span>
        best_gain = -<span class="number">1</span>
        split_idx, split_threshold = <span class="keyword">None</span>, <span class="keyword">None</span>

        <span class="keyword">for</span> feature_idx <span class="keyword">in</span> range(n):
            X_column = X[:, feature_idx]
            thresholds = np.unique(X_column)

            <span class="keyword">for</span> threshold <span class="keyword">in</span> thresholds:
                gain = self._information_gain(y, X_column, threshold)

                <span class="keyword">if</span> gain > best_gain:
                    best_gain = gain
                    split_idx = feature_idx
                    split_threshold = threshold

        <span class="keyword">return</span> split_idx, split_threshold

    <span class="keyword">def</span> <span class="function">_grow_tree</span>(self, X, y, depth=<span class="number">0</span>):
        <span class="string">"""é€’å½’æ„å»ºå†³ç­–æ ‘"""</span>
        <span class="comment"># è®¡ç®—èŠ‚ç‚¹çš„é¢„æµ‹å€¼</span>
        n_samples_per_class = Counter(y)
        predicted_class = max(n_samples_per_class,
                            key=n_samples_per_class.get)

        node = {
            <span class="string">'predicted_class'</span>: predicted_class,
            <span class="string">'n_samples'</span>: len(y),
            <span class="string">'impurity'</span>: self._gini(y) <span class="keyword">if</span> self.criterion == <span class="string">'gini'</span>
                        <span class="keyword">else</span> self._entropy(y)
        }

        <span class="comment"># é€’å½’ç»ˆæ­¢æ¡ä»¶</span>
        <span class="keyword">if</span> (depth < self.max_depth <span class="keyword">and</span>
            len(set(y)) > <span class="number">1</span> <span class="keyword">and</span>
            len(y) >= self.min_samples_split):

            feature_idx, threshold = self._best_split(X, y)

            <span class="keyword">if</span> feature_idx <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:
                left_idxs = X[:, feature_idx] <= threshold
                right_idxs = X[:, feature_idx] > threshold

                node[<span class="string">'feature_idx'</span>] = feature_idx
                node[<span class="string">'threshold'</span>] = threshold
                node[<span class="string">'left'</span>] = self._grow_tree(X[left_idxs], y[left_idxs],
                                               depth + <span class="number">1</span>)
                node[<span class="string">'right'</span>] = self._grow_tree(X[right_idxs], y[right_idxs],
                                                depth + <span class="number">1</span>)

        <span class="keyword">return</span> node

    <span class="keyword">def</span> <span class="function">fit</span>(self, X, y):
        <span class="string">"""è®­ç»ƒå†³ç­–æ ‘"""</span>
        self.tree = self._grow_tree(X, y)

    <span class="keyword">def</span> <span class="function">_predict_sample</span>(self, x, node):
        <span class="string">"""é¢„æµ‹å•ä¸ªæ ·æœ¬"""</span>
        <span class="keyword">if</span> <span class="string">'threshold'</span> <span class="keyword">in</span> node:
            <span class="keyword">if</span> x[node[<span class="string">'feature_idx'</span>]] <= node[<span class="string">'threshold'</span>]:
                <span class="keyword">return</span> self._predict_sample(x, node[<span class="string">'left'</span>])
            <span class="keyword">else</span>:
                <span class="keyword">return</span> self._predict_sample(x, node[<span class="string">'right'</span>])
        <span class="keyword">else</span>:
            <span class="keyword">return</span> node[<span class="string">'predicted_class'</span>]

    <span class="keyword">def</span> <span class="function">predict</span>(self, X):
        <span class="string">"""é¢„æµ‹å¤šä¸ªæ ·æœ¬"""</span>
        <span class="keyword">return</span> np.array([self._predict_sample(x, self.tree) <span class="keyword">for</span> x <span class="keyword">in</span> X])

    <span class="keyword">def</span> <span class="function">print_tree</span>(self, node=<span class="keyword">None</span>, depth=<span class="number">0</span>):
        <span class="string">"""æ‰“å°å†³ç­–æ ‘ç»“æ„"""</span>
        <span class="keyword">if</span> node <span class="keyword">is</span> <span class="keyword">None</span>:
            node = self.tree

        <span class="keyword">if</span> <span class="string">'threshold'</span> <span class="keyword">in</span> node:
            print(<span class="string">'  '</span> * depth +
                  <span class="string">f"ç‰¹å¾{node['feature_idx']} <= {node['threshold']:.2f}"</span> +
                  <span class="string">f" (æ ·æœ¬æ•°: {node['n_samples']}, ä¸çº¯åº¦: {node['impurity']:.3f})"</span>)
            self.print_tree(node[<span class="string">'left'</span>], depth + <span class="number">1</span>)
            self.print_tree(node[<span class="string">'right'</span>], depth + <span class="number">1</span>)
        <span class="keyword">else</span>:
            print(<span class="string">'  '</span> * depth +
                  <span class="string">f"é¢„æµ‹ç±»åˆ«: {node['predicted_class']}"</span> +
                  <span class="string">f" (æ ·æœ¬æ•°: {node['n_samples']})"</span>)

<span class="comment"># ğŸš€ ä½¿ç”¨ç¤ºä¾‹ï¼šé¸¢å°¾èŠ±åˆ†ç±»</span>
<span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_iris
<span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split

<span class="comment"># åŠ è½½æ•°æ®</span>
iris = load_iris()
X, y = iris.data, iris.target

<span class="comment"># åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span>
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>
)

<span class="comment"># è®­ç»ƒå†³ç­–æ ‘</span>
tree = DecisionTreeClassifier(max_depth=<span class="number">3</span>, criterion=<span class="string">'gini'</span>)
tree.fit(X_train, y_train)

<span class="comment"># é¢„æµ‹</span>
predictions = tree.predict(X_test)
accuracy = np.mean(predictions == y_test)

print(<span class="string">f"ğŸŒ³ å†³ç­–æ ‘ç»“æ„ï¼š"</span>)
tree.print_tree()
print(<span class="string">f"\nğŸ¯ æµ‹è¯•é›†å‡†ç¡®ç‡: {accuracy:.2%}"</span>)</code></pre>
        </div>
    </div>

    <!-- 9.3 æ”¯æŒå‘é‡æœº -->
    <div id="svm" class="section-card fade-in section-anchor">
        <h2 class="section-title">âš¡ 9.3 æ”¯æŒå‘é‡æœº</h2>

        <div class="story-box content-box">
            <h3 style="color: #4facfe;">ğŸŒ‰ æœ€å®½çš„æ²³æµï¼Œæœ€å®‰å…¨çš„è¾¹ç•Œ</h3>
            <p style="margin-bottom: 20px;">
                1963å¹´ï¼Œè‹è”æ•°å­¦å®¶<strong>å¼—æ‹‰åŸºç±³å°”Â·ç“¦æ™®å°¼å…‹</strong>åœ¨æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š<br>
                "å¦‚ä½•åœ¨ä¸¤ä¸ªé˜µè¥ä¹‹é—´åˆ’å®šæœ€å®‰å…¨çš„è¾¹ç•Œï¼Ÿ"<br><br>

                æƒ³è±¡ä¸¤ä¸ªæ•Œå¯¹çš„éƒ¨è½åˆ†åˆ«ä½åœ¨æ²³çš„ä¸¤å²¸...<br>
                ğŸ˜ï¸ å¦‚æœæ²³å¾ˆçª„ï¼Œç¨æœ‰é£å¹è‰åŠ¨å°±å¯èƒ½å¼•å‘å†²çª<br>
                ğŸŒŠ å¦‚æœæ²³å¾ˆå®½ï¼ŒåŒæ–¹éƒ½æœ‰è¶³å¤Ÿçš„ç¼“å†²ç©ºé—´<br><br>

                è¿™ä¸ªç›´è§‰å¯å‘äº†ä»–ï¼š<br>
                <span class="highlight-primary">æœ€å¥½çš„åˆ†ç±»è¾¹ç•Œï¼Œåº”è¯¥ç¦»ä¸¤ç±»æ ·æœ¬éƒ½å°½å¯èƒ½è¿œï¼</span><br><br>

                30å¹´åçš„1995å¹´ï¼ŒVapnikå’ŒCortesæ­£å¼æå‡ºäº†<br>
                <span class="highlight-secondary">æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰</span>â€”â€”ä¸€ä¸ªç†è®ºä¼˜é›…ã€æ€§èƒ½å“è¶Šçš„ç®—æ³•ï¼
            </p>
        </div>

        <div class="thinking-box content-box">
            <h3>âš¡ SVMçš„æ ¸å¿ƒç†å¿µï¼šæœ€å¤§é—´éš”</h3>
            <p style="margin-bottom: 20px;">SVMå¯»æ‰¾ä¸€ä¸ªè¶…å¹³é¢ï¼Œä½¿å¾—ï¼š</p>

            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                <div style="background: rgba(79, 172, 254, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <h4 style="color: #4facfe;">ğŸ“ é—´éš”æœ€å¤§</h4>
                    <p style="font-size: 0.9rem;">ç¦»æœ€è¿‘ç‚¹çš„è·ç¦»æœ€è¿œ</p>
                </div>
                <div style="background: rgba(167, 139, 250, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <h4 style="color: #a78bfa;">ğŸ¯ æ”¯æŒå‘é‡</h4>
                    <p style="font-size: 0.9rem;">åªæœ‰è¾¹ç•Œä¸Šçš„ç‚¹é‡è¦</p>
                </div>
                <div style="background: rgba(244, 114, 182, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <h4 style="color: #f472b6;">ğŸŒ€ æ ¸æŠ€å·§</h4>
                    <p style="font-size: 0.9rem;">å°†æ•°æ®æ˜ å°„åˆ°é«˜ç»´</p>
                </div>
            </div>
        </div>

        <!-- SVMäº¤äº’å¼æ¼”ç¤º -->
        <div class="demo-container">
            <h3 style="color: #4facfe; text-align: center; margin-bottom: 20px;">âš¡ æ”¯æŒå‘é‡æœºå¯è§†åŒ–æ¼”ç¤º</h3>
            <canvas id="svmCanvas" class="demo-canvas" width="800" height="500"></canvas>

            <div class="param-panel">
                <div class="param-group">
                    <label class="param-label">æ ¸å‡½æ•°:</label>
                    <select id="kernelType" onchange="updateSVM()" style="padding: 5px 10px; border-radius: 5px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-primary);">
                        <option value="linear">çº¿æ€§æ ¸</option>
                        <option value="rbf">RBFæ ¸</option>
                        <option value="poly">å¤šé¡¹å¼æ ¸</option>
                    </select>
                </div>
                <div class="param-group">
                    <label class="param-label">
                        æƒ©ç½šå‚æ•° C:
                        <span class="param-value" id="svmCValue">1.0</span>
                    </label>
                    <input type="range" class="param-slider" id="svmC" min="0.1" max="10" step="0.1" value="1.0" onchange="updateSVMC()">
                </div>
            </div>

            <div class="demo-controls">
                <button class="demo-btn" onclick="generateSVMData()">ğŸ² ç”Ÿæˆæ•°æ®</button>
                <button class="demo-btn" onclick="trainSVM()">âš¡ è®­ç»ƒSVM</button>
                <button class="demo-btn secondary" onclick="showSupportVectors()">ğŸ¯ æ˜¾ç¤ºæ”¯æŒå‘é‡</button>
                <button class="demo-btn secondary" onclick="animateMargin()">ğŸ“ æ¼”ç¤ºé—´éš”</button>
            </div>
        </div>

        <!-- SVMæ•°å­¦åŸç† -->
        <div class="formula-box content-box">
            <h3 style="color: #f472b6; margin-bottom: 20px;">ğŸ“ SVMçš„æ•°å­¦ä¹‹ç¾</h3>

            <div style="text-align: left; margin: 20px auto; max-width: 700px;">
                <h4 style="color: #4facfe; margin-bottom: 15px;">1. çº¿æ€§å¯åˆ†SVM</h4>
                <p style="text-align: center;">æœ€å¤§åŒ–é—´éš”: max 2/||w||</p>
                <p style="text-align: center;">çº¦æŸæ¡ä»¶: y_i(wÂ·x_i + b) â‰¥ 1</p>

                <h4 style="color: #a78bfa; margin: 15px 0;">2. è½¯é—´éš”SVM</h4>
                <p style="text-align: center;">min (1/2)||w||Â² + Câˆ‘Î¾_i</p>
                <p style="text-align: center;">å…è®¸éƒ¨åˆ†æ ·æœ¬åˆ†ç±»é”™è¯¯</p>

                <h4 style="color: #f472b6; margin: 15px 0;">3. æ ¸æŠ€å·§</h4>
                <p style="text-align: center;">K(x_i, x_j) = Ï†(x_i)Â·Ï†(x_j)</p>
                <p style="text-align: center;">éšå¼æ˜ å°„åˆ°é«˜ç»´ç©ºé—´</p>
            </div>
        </div>

        <!-- å¸¸ç”¨æ ¸å‡½æ•° -->
        <div style="margin: 30px 0;">
            <h3 style="color: #a78bfa; margin-bottom: 20px;">ğŸŒ€ æ ¸å‡½æ•°çš„é­”æ³•</h3>
            <div class="metric-cards">
                <div class="metric-card">
                    <div class="metric-icon">ğŸ“</div>
                    <div class="metric-name">çº¿æ€§æ ¸</div>
                    <div class="metric-value">K(x,y) = xÂ·y</div>
                    <div class="metric-description">é€‚åˆçº¿æ€§å¯åˆ†æ•°æ®</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">ğŸŒŠ</div>
                    <div class="metric-name">RBFæ ¸</div>
                    <div class="metric-value">K(x,y) = e^(-Î³||x-y||Â²)</div>
                    <div class="metric-description">æœ€å¸¸ç”¨ï¼Œé€‚åº”æ€§å¼º</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">ğŸ“</div>
                    <div class="metric-name">å¤šé¡¹å¼æ ¸</div>
                    <div class="metric-value">K(x,y) = (xÂ·y+c)^d</div>
                    <div class="metric-description">é€‚åˆå¤šé¡¹å¼ç‰¹å¾</div>
                </div>
            </div>
        </div>

        <!-- SVMä¼˜ç¼ºç‚¹ -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
            <div style="background: rgba(52, 211, 153, 0.1); padding: 25px; border-radius: 15px; border: 2px solid rgba(52, 211, 153, 0.3);">
                <h4 style="color: #34d399; margin-bottom: 15px;">âœ… SVMçš„ç‹¬ç‰¹ä¼˜åŠ¿</h4>
                <ul style="list-style: none; padding: 0;">
                    <li>ğŸ¯ æ³›åŒ–èƒ½åŠ›å¼º</li>
                    <li>ğŸ“ ç†è®ºåŸºç¡€åšå®</li>
                    <li>ğŸŒ€ æ ¸æŠ€å·§å¤„ç†éçº¿æ€§</li>
                    <li>ğŸ’ åªä¾èµ–æ”¯æŒå‘é‡</li>
                    <li>ğŸ”¢ é«˜ç»´ç©ºé—´è¡¨ç°å¥½</li>
                </ul>
            </div>
            <div style="background: rgba(244, 114, 182, 0.1); padding: 25px; border-radius: 15px; border: 2px solid rgba(244, 114, 182, 0.3);">
                <h4 style="color: #f472b6; margin-bottom: 15px;">âš ï¸ SVMçš„å±€é™æ€§</h4>
                <ul style="list-style: none; padding: 0;">
                    <li>ğŸŒ å¤§è§„æ¨¡æ•°æ®è®­ç»ƒæ…¢</li>
                    <li>ğŸ›ï¸ å‚æ•°é€‰æ‹©å›°éš¾</li>
                    <li>ğŸ’¾ å†…å­˜éœ€æ±‚å¤§</li>
                    <li>ğŸ“Š ä¸ç›´æ¥æä¾›æ¦‚ç‡</li>
                    <li>ğŸ·ï¸ å¤šåˆ†ç±»éœ€è¦æ‰©å±•</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 9.4 é›†æˆå­¦ä¹  -->
    <div id="ensemble" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸŒ² 9.4 é›†æˆå­¦ä¹ </h2>

        <div class="story-box content-box">
            <h3 style="color: #4facfe;">ğŸ‘¥ ç¾¤ä½“çš„æ™ºæ…§</h3>
            <p style="margin-bottom: 20px;">
                1906å¹´ï¼Œè‹±å›½ç§‘å­¦å®¶<strong>å¼—æœ—è¥¿æ–¯Â·é«˜å°”é¡¿</strong>åœ¨é›†å¸‚ä¸Šå‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼š<br><br>

                ğŸ„ æœ‰äººä¸¾åŠäº†ä¸€ä¸ª"çŒœç‰›é‡"çš„æ¯”èµ›<br>
                ğŸ‘¥ 800å¤šäººå‚ä¸ï¼Œæ¯äººéƒ½å†™ä¸‹è‡ªå·±çš„çŒœæµ‹<br>
                ğŸ“Š å•ä¸ªäººçš„çŒœæµ‹å·®å¼‚å¾ˆå¤§ï¼Œæœ‰çš„å·®äº†å‡ ç™¾ç£…<br><br>

                ä½†ç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†ï¼š<br>
                <span class="highlight-primary">æ‰€æœ‰äººçŒœæµ‹çš„å¹³å‡å€¼æ˜¯1197ç£…</span><br>
                <span class="highlight-secondary">è€Œç‰›çš„å®é™…é‡é‡æ˜¯1198ç£…ï¼</span><br><br>

                è¿™å°±æ˜¯"ç¾¤ä½“æ™ºæ…§"çš„åŠ›é‡â€”â€”<br>
                å¤šä¸ª"å¼±"çš„ä¸ªä½“ç»„åˆèµ·æ¥ï¼Œå¯èƒ½æ¯”ä»»ä½•"å¼º"çš„ä¸ªä½“éƒ½è¦å‡†ç¡®ï¼<br><br>

                90å¹´åï¼Œæœºå™¨å­¦ä¹ å€Ÿé‰´äº†è¿™ä¸ªæ€æƒ³ï¼Œåˆ›é€ äº†<span class="highlight-warning">é›†æˆå­¦ä¹ </span>ï¼
            </p>
        </div>

        <div class="thinking-box content-box">
            <h3>ğŸ­ é›†æˆå­¦ä¹ çš„ä¸‰å¤§æµæ´¾</h3>

            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px;">
                <div style="background: rgba(79, 172, 254, 0.1); padding: 20px; border-radius: 10px;">
                    <h4 style="color: #4facfe;">ğŸ“š Bagging</h4>
                    <p style="font-size: 0.9rem;"><strong>å¹¶è¡Œè®­ç»ƒ</strong></p>
                    <p style="font-size: 0.85rem;">ç‹¬ç«‹è®­ç»ƒå¤šä¸ªæ¨¡å‹<br>æŠ•ç¥¨æˆ–å¹³å‡å¾—ç»“æœ<br>é™ä½æ–¹å·®ï¼Œé˜²è¿‡æ‹Ÿåˆ</p>
                    <p style="margin-top: 10px; font-style: italic;">ä»£è¡¨ï¼šéšæœºæ£®æ—</p>
                </div>
                <div style="background: rgba(167, 139, 250, 0.1); padding: 20px; border-radius: 10px;">
                    <h4 style="color: #a78bfa;">ğŸ”„ Boosting</h4>
                    <p style="font-size: 0.9rem;"><strong>ä¸²è¡Œè®­ç»ƒ</strong></p>
                    <p style="font-size: 0.85rem;">åç»­æ¨¡å‹å­¦ä¹ å‰è€…é”™è¯¯<br>åŠ æƒç»„åˆæ‰€æœ‰æ¨¡å‹<br>é™ä½åå·®ï¼Œæå‡ç²¾åº¦</p>
                    <p style="margin-top: 10px; font-style: italic;">ä»£è¡¨ï¼šAdaBoostã€XGBoost</p>
                </div>
                <div style="background: rgba(244, 114, 182, 0.1); padding: 20px; border-radius: 10px;">
                    <h4 style="color: #f472b6;">ğŸ—ï¸ Stacking</h4>
                    <p style="font-size: 0.9rem;"><strong>åˆ†å±‚ç»„åˆ</strong></p>
                    <p style="font-size: 0.85rem;">ç”¨å…ƒæ¨¡å‹ç»„åˆåŸºæ¨¡å‹<br>å……åˆ†åˆ©ç”¨ä¸åŒä¼˜åŠ¿<br>æ€§èƒ½ä¸Šé™é«˜</p>
                    <p style="margin-top: 10px; font-style: italic;">å¸¸ç”¨äºç«èµ›</p>
                </div>
            </div>
        </div>

        <!-- é›†æˆå­¦ä¹ äº¤äº’å¼æ¼”ç¤º -->
        <div class="demo-container">
            <h3 style="color: #4facfe; text-align: center; margin-bottom: 20px;">ğŸŒ² éšæœºæ£®æ— vs å•æ£µæ ‘</h3>
            <canvas id="ensembleCanvas" class="demo-canvas" width="800" height="500"></canvas>

            <div class="param-panel">
                <div class="param-group">
                    <label class="param-label">
                        æ ‘çš„æ•°é‡:
                        <span class="param-value" id="nTreesValue">10</span>
                    </label>
                    <input type="range" class="param-slider" id="nTrees" min="1" max="100" value="10" onchange="updateEnsemble()">
                </div>
                <div class="param-group">
                    <label class="param-label">
                        é‡‡æ ·æ¯”ä¾‹:
                        <span class="param-value" id="sampleRateValue">0.8</span>
                    </label>
                    <input type="range" class="param-slider" id="sampleRate" min="0.1" max="1.0" step="0.1" value="0.8" onchange="updateSampleRate()">
                </div>
            </div>

            <div class="demo-controls">
                <button class="demo-btn" onclick="generateEnsembleData()">ğŸ² ç”Ÿæˆæ•°æ®</button>
                <button class="demo-btn" onclick="trainSingleTree()">ğŸŒ³ è®­ç»ƒå•æ ‘</button>
                <button class="demo-btn secondary" onclick="trainRandomForest()">ğŸŒ² è®­ç»ƒæ£®æ—</button>
                <button class="demo-btn secondary" onclick="compareResults()">ğŸ“Š å¯¹æ¯”ç»“æœ</button>
            </div>

            <div class="metric-cards" style="margin-top: 20px;">
                <div class="metric-card">
                    <div class="metric-icon">ğŸŒ³</div>
                    <div class="metric-name">å•æ ‘å‡†ç¡®ç‡</div>
                    <div class="metric-value" id="singleAccuracy">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">ğŸŒ²</div>
                    <div class="metric-name">æ£®æ—å‡†ç¡®ç‡</div>
                    <div class="metric-value" id="forestAccuracy">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">ğŸ“ˆ</div>
                    <div class="metric-name">æ€§èƒ½æå‡</div>
                    <div class="metric-value" id="improvement">-</div>
                </div>
            </div>
        </div>

        <!-- é›†æˆå­¦ä¹ ä»£ç ç¤ºä¾‹ -->
        <div class="code-block">
            <pre><code><span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier
<span class="keyword">from</span> sklearn.base <span class="keyword">import</span> clone
<span class="keyword">from</span> collections <span class="keyword">import</span> Counter

<span class="keyword">class</span> <span class="function">RandomForestClassifier</span>:
    <span class="string">"""éšæœºæ£®æ—åˆ†ç±»å™¨ - é›†æˆå­¦ä¹ çš„ç»å…¸ä»£è¡¨"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, n_estimators=<span class="number">100</span>, max_depth=<span class="keyword">None</span>,
                 max_features=<span class="string">'sqrt'</span>, bootstrap=<span class="keyword">True</span>,
                 random_state=<span class="keyword">None</span>):
        self.n_estimators = n_estimators
        self.max_depth = max_depth
        self.max_features = max_features
        self.bootstrap = bootstrap
        self.random_state = random_state
        self.trees = []
        self.feature_indices = []

    <span class="keyword">def</span> <span class="function">_bootstrap_sample</span>(self, X, y):
        <span class="string">"""è‡ªåŠ©é‡‡æ ·ï¼ˆBootstrapï¼‰"""</span>
        n_samples = X.shape[<span class="number">0</span>]
        indices = np.random.choice(n_samples, n_samples, replace=<span class="keyword">True</span>)
        <span class="keyword">return</span> X[indices], y[indices]

    <span class="keyword">def</span> <span class="function">_get_feature_subset</span>(self, n_features):
        <span class="string">"""éšæœºé€‰æ‹©ç‰¹å¾å­é›†"""</span>
        <span class="keyword">if</span> self.max_features == <span class="string">'sqrt'</span>:
            max_features = int(np.sqrt(n_features))
        <span class="keyword">elif</span> self.max_features == <span class="string">'log2'</span>:
            max_features = int(np.log2(n_features))
        <span class="keyword">elif</span> isinstance(self.max_features, int):
            max_features = self.max_features
        <span class="keyword">else</span>:
            max_features = n_features

        feature_indices = np.random.choice(
            n_features, max_features, replace=<span class="keyword">False</span>
        )
        <span class="keyword">return</span> sorted(feature_indices)

    <span class="keyword">def</span> <span class="function">fit</span>(self, X, y):
        <span class="string">"""è®­ç»ƒéšæœºæ£®æ—"""</span>
        <span class="keyword">if</span> self.random_state:
            np.random.seed(self.random_state)

        n_samples, n_features = X.shape

        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.n_estimators):
            <span class="comment"># åˆ›å»ºå†³ç­–æ ‘</span>
            tree = DecisionTreeClassifier(
                max_depth=self.max_depth,
                random_state=np.random.randint(<span class="number">0</span>, <span class="number">1000</span>)
            )

            <span class="comment"># Bootstrapé‡‡æ ·</span>
            <span class="keyword">if</span> self.bootstrap:
                X_sample, y_sample = self._bootstrap_sample(X, y)
            <span class="keyword">else</span>:
                X_sample, y_sample = X, y

            <span class="comment"># éšæœºé€‰æ‹©ç‰¹å¾</span>
            feature_indices = self._get_feature_subset(n_features)

            <span class="comment"># è®­ç»ƒæ ‘</span>
            tree.fit(X_sample[:, feature_indices], y_sample)

            <span class="comment"># ä¿å­˜æ ‘å’Œç‰¹å¾ç´¢å¼•</span>
            self.trees.append(tree)
            self.feature_indices.append(feature_indices)

            <span class="keyword">if</span> (i + <span class="number">1</span>) % <span class="number">10</span> == <span class="number">0</span>:
                print(<span class="string">f"âœ… å·²è®­ç»ƒ {i+1}/{self.n_estimators} æ£µæ ‘"</span>)

    <span class="keyword">def</span> <span class="function">predict</span>(self, X):
        <span class="string">"""é¢„æµ‹ - å¤šæ•°æŠ•ç¥¨"""</span>
        predictions = []

        <span class="keyword">for</span> tree, features <span class="keyword">in</span> zip(self.trees, self.feature_indices):
            pred = tree.predict(X[:, features])
            predictions.append(pred)

        <span class="comment"># è½¬ç½®ï¼Œä½¿æ¯è¡Œæ˜¯ä¸€ä¸ªæ ·æœ¬çš„æ‰€æœ‰é¢„æµ‹</span>
        predictions = np.array(predictions).T

        <span class="comment"># å¤šæ•°æŠ•ç¥¨</span>
        final_predictions = []
        <span class="keyword">for</span> sample_preds <span class="keyword">in</span> predictions:
            vote = Counter(sample_preds).most_common(<span class="number">1</span>)[<span class="number">0</span>][<span class="number">0</span>]
            final_predictions.append(vote)

        <span class="keyword">return</span> np.array(final_predictions)

    <span class="keyword">def</span> <span class="function">feature_importances_</span>(self):
        <span class="string">"""è®¡ç®—ç‰¹å¾é‡è¦æ€§"""</span>
        n_features = len(self.feature_indices[<span class="number">0</span>])
        importances = np.zeros(n_features)

        <span class="keyword">for</span> tree, features <span class="keyword">in</span> zip(self.trees, self.feature_indices):
            tree_importances = tree.feature_importances_
            <span class="keyword">for</span> i, feat_idx <span class="keyword">in</span> enumerate(features):
                importances[feat_idx] += tree_importances[i]

        <span class="keyword">return</span> importances / self.n_estimators


<span class="keyword">class</span> <span class="function">AdaBoostClassifier</span>:
    <span class="string">"""AdaBooståˆ†ç±»å™¨ - Boostingçš„ç»å…¸å®ç°"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self, n_estimators=<span class="number">50</span>, learning_rate=<span class="number">1.0</span>):
        self.n_estimators = n_estimators
        self.learning_rate = learning_rate
        self.estimators = []
        self.estimator_weights = []
        self.estimator_errors = []

    <span class="keyword">def</span> <span class="function">fit</span>(self, X, y):
        <span class="string">"""è®­ç»ƒAdaBoost"""</span>
        n_samples = X.shape[<span class="number">0</span>]

        <span class="comment"># åˆå§‹åŒ–æ ·æœ¬æƒé‡</span>
        sample_weight = np.ones(n_samples) / n_samples

        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.n_estimators):
            <span class="comment"># è®­ç»ƒå¼±åˆ†ç±»å™¨</span>
            estimator = DecisionTreeClassifier(max_depth=<span class="number">1</span>)
            estimator.fit(X, y, sample_weight=sample_weight)

            <span class="comment"># é¢„æµ‹</span>
            predictions = estimator.predict(X)

            <span class="comment"># è®¡ç®—åŠ æƒé”™è¯¯ç‡</span>
            incorrect = predictions != y
            estimator_error = np.sum(sample_weight[incorrect]) / np.sum(sample_weight)

            <span class="comment"># é¿å…é™¤é›¶</span>
            <span class="keyword">if</span> estimator_error >= <span class="number">0.5</span>:
                <span class="keyword">break</span>

            <span class="comment"># è®¡ç®—åˆ†ç±»å™¨æƒé‡</span>
            estimator_weight = self.learning_rate * <span class="number">0.5</span> * np.log(
                (<span class="number">1</span> - estimator_error) / estimator_error
            )

            <span class="comment"># æ›´æ–°æ ·æœ¬æƒé‡</span>
            sample_weight *= np.exp(-estimator_weight * y * predictions)
            sample_weight /= np.sum(sample_weight)

            <span class="comment"># ä¿å­˜</span>
            self.estimators.append(estimator)
            self.estimator_weights.append(estimator_weight)
            self.estimator_errors.append(estimator_error)

            <span class="keyword">if</span> (i + <span class="number">1</span>) % <span class="number">10</span> == <span class="number">0</span>:
                print(<span class="string">f"ğŸ”„ Boostingè½®æ¬¡ {i+1}/{self.n_estimators}, é”™è¯¯ç‡: {estimator_error:.4f}"</span>)

    <span class="keyword">def</span> <span class="function">predict</span>(self, X):
        <span class="string">"""é¢„æµ‹ - åŠ æƒæŠ•ç¥¨"""</span>
        predictions = np.zeros(X.shape[<span class="number">0</span>])

        <span class="keyword">for</span> estimator, weight <span class="keyword">in</span> zip(self.estimators, self.estimator_weights):
            predictions += weight * estimator.predict(X)

        <span class="keyword">return</span> np.sign(predictions)

<span class="comment"># ğŸš€ ä½¿ç”¨ç¤ºä¾‹ï¼šæ¯”è¾ƒå•æ¨¡å‹ä¸é›†æˆæ¨¡å‹</span>
<span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_classification
<span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split

<span class="comment"># ç”Ÿæˆæ•°æ®</span>
X, y = make_classification(
    n_samples=<span class="number">1000</span>, n_features=<span class="number">20</span>, n_informative=<span class="number">15</span>,
    n_redundant=<span class="number">5</span>, random_state=<span class="number">42</span>
)

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>
)

<span class="comment"># å•æ£µå†³ç­–æ ‘</span>
single_tree = DecisionTreeClassifier(random_state=<span class="number">42</span>)
single_tree.fit(X_train, y_train)
single_acc = single_tree.score(X_test, y_test)

<span class="comment"># éšæœºæ£®æ—</span>
rf = RandomForestClassifier(n_estimators=<span class="number">50</span>, random_state=<span class="number">42</span>)
rf.fit(X_train, y_train)
rf_acc = np.mean(rf.predict(X_test) == y_test)

<span class="comment"># AdaBoost</span>
ada = AdaBoostClassifier(n_estimators=<span class="number">50</span>)
ada.fit(X_train, y_train)
ada_acc = np.mean(ada.predict(X_test) == y_test)

print(<span class="string">f"\nğŸ“Š æ¨¡å‹æ€§èƒ½å¯¹æ¯”ï¼š"</span>)
print(<span class="string">f"ğŸŒ³ å•æ£µå†³ç­–æ ‘: {single_acc:.2%}"</span>)
print(<span class="string">f"ğŸŒ² éšæœºæ£®æ—: {rf_acc:.2%}"</span>)
print(<span class="string">f"ğŸ”„ AdaBoost: {ada_acc:.2%}"</span>)
print(<span class="string">f"\nğŸ¯ é›†æˆå­¦ä¹ çš„å¨åŠ›: å‡†ç¡®ç‡æå‡ {(max(rf_acc, ada_acc) - single_acc):.2%}!"</span>)</code></pre>
        </div>
    </div>

    <!-- 9.5 ç®—æ³•å¯¹æ¯”ä¸é€‰æ‹© -->
    <div id="comparison" class="section-card fade-in section-anchor">
        <h2 class="section-title">âš”ï¸ 9.5 ç®—æ³•å¯¹æ¯”ä¸é€‰æ‹©</h2>

        <div class="story-box content-box">
            <h3 style="color: #4facfe;">ğŸ† æ²¡æœ‰æœ€å¥½ï¼Œåªæœ‰æœ€åˆé€‚</h3>
            <p style="margin-bottom: 20px;">
                åœ¨Netflixç™¾ä¸‡ç¾å…ƒå¤§å¥–èµ›ä¸­ï¼Œæœ‰ä¸€ä¸ªæœ‰è¶£çš„å‘ç°ï¼š<br><br>

                ğŸ¥‡ è·èƒœå›¢é˜Ÿä½¿ç”¨äº†<strong>è¶…è¿‡100ä¸ªæ¨¡å‹çš„é›†æˆ</strong><br>
                ğŸ¥ˆ ç¬¬äºŒåä¹Ÿç”¨äº†å‡ åä¸ªæ¨¡å‹çš„ç»„åˆ<br>
                ğŸ¥‰ æ²¡æœ‰ä»»ä½•å•ä¸€ç®—æ³•èƒ½ç‹¬å é³Œå¤´<br><br>

                è¿™å‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªé‡è¦çš„é“ç†ï¼š<br>
                <span class="highlight-primary">ç®—æ³•é€‰æ‹©å°±åƒæŒ‘é€‰å·¥å…·</span>â€”â€”<br>
                é”¤å­é€‚åˆé’‰é’‰å­ï¼Œèºä¸åˆ€é€‚åˆæ‹§èºä¸ï¼Œ<br>
                <span class="highlight-secondary">å…³é”®æ˜¯äº†è§£æ¯ä¸ªå·¥å…·çš„ç‰¹ç‚¹ï¼Œé€‰æ‹©åˆé€‚çš„</span>ï¼
            </p>
        </div>

        <!-- ç®—æ³•å¯¹æ¯”è¡¨ -->
        <div style="margin: 30px 0;">
            <h3 style="color: #a78bfa; margin-bottom: 20px;">ğŸ¯ ç®—æ³•ç‰¹æ€§å¯¹æ¯”è¡¨</h3>
            <table class="data-table">
                <thead>
                <tr>
                    <th>ç®—æ³•</th>
                    <th>è®­ç»ƒé€Ÿåº¦</th>
                    <th>é¢„æµ‹é€Ÿåº¦</th>
                    <th>å‡†ç¡®æ€§</th>
                    <th>å¯è§£é‡Šæ€§</th>
                    <th>é€‚ç”¨åœºæ™¯</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><strong>æœ´ç´ è´å¶æ–¯</strong></td>
                    <td>âš¡âš¡âš¡âš¡âš¡</td>
                    <td>âš¡âš¡âš¡âš¡âš¡</td>
                    <td>â­â­â­</td>
                    <td>â­â­â­â­</td>
                    <td>æ–‡æœ¬åˆ†ç±»ã€åƒåœ¾é‚®ä»¶</td>
                </tr>
                <tr>
                    <td><strong>å†³ç­–æ ‘</strong></td>
                    <td>âš¡âš¡âš¡âš¡</td>
                    <td>âš¡âš¡âš¡âš¡âš¡</td>
                    <td>â­â­â­</td>
                    <td>â­â­â­â­â­</td>
                    <td>è§„åˆ™æ˜ç¡®çš„åˆ†ç±»</td>
                </tr>
                <tr>
                    <td><strong>SVM</strong></td>
                    <td>âš¡âš¡</td>
                    <td>âš¡âš¡âš¡</td>
                    <td>â­â­â­â­</td>
                    <td>â­â­</td>
                    <td>ä¸­ç­‰è§„æ¨¡ã€é«˜ç»´æ•°æ®</td>
                </tr>
                <tr>
                    <td><strong>éšæœºæ£®æ—</strong></td>
                    <td>âš¡âš¡âš¡</td>
                    <td>âš¡âš¡âš¡</td>
                    <td>â­â­â­â­â­</td>
                    <td>â­â­â­</td>
                    <td>é€šç”¨ã€é˜²è¿‡æ‹Ÿåˆ</td>
                </tr>
                <tr>
                    <td><strong>XGBoost</strong></td>
                    <td>âš¡âš¡</td>
                    <td>âš¡âš¡âš¡</td>
                    <td>â­â­â­â­â­</td>
                    <td>â­â­</td>
                    <td>ç«èµ›ã€é«˜ç²¾åº¦éœ€æ±‚</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="thinking-box content-box">
            <h3>ğŸ¤” ç®—æ³•é€‰æ‹©å†³ç­–æ ‘</h3>
            <div style="margin-top: 20px; padding: 20px; background: rgba(79, 172, 254, 0.1); border-radius: 10px;">
                <p style="font-size: 1.1rem; text-align: center; margin-bottom: 20px;">
                    <strong>ä»é—®é¢˜ç‰¹å¾å‡ºå‘ï¼Œé€‰æ‹©åˆé€‚çš„ç®—æ³•</strong>
                </p>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4 style="color: #4facfe;">ğŸ“Š æ•°æ®ç‰¹å¾</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li>â€¢ <strong>å°æ•°æ®é›†</strong> â†’ æœ´ç´ è´å¶æ–¯ã€SVM</li>
                            <li>â€¢ <strong>å¤§æ•°æ®é›†</strong> â†’ éšæœºæ£®æ—ã€XGBoost</li>
                            <li>â€¢ <strong>é«˜ç»´ç¨€ç–</strong> â†’ æœ´ç´ è´å¶æ–¯ã€çº¿æ€§SVM</li>
                            <li>â€¢ <strong>éçº¿æ€§å¤æ‚</strong> â†’ æ ¸SVMã€é›†æˆæ–¹æ³•</li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="color: #a78bfa;">ğŸ¯ éœ€æ±‚ç‰¹å¾</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li>â€¢ <strong>è¦é€Ÿåº¦</strong> â†’ æœ´ç´ è´å¶æ–¯ã€å†³ç­–æ ‘</li>
                            <li>â€¢ <strong>è¦ç²¾åº¦</strong> â†’ é›†æˆå­¦ä¹ ã€æ·±åº¦å­¦ä¹ </li>
                            <li>â€¢ <strong>è¦è§£é‡Š</strong> â†’ å†³ç­–æ ‘ã€çº¿æ€§æ¨¡å‹</li>
                            <li>â€¢ <strong>è¦ç¨³å®š</strong> â†’ éšæœºæ£®æ—ã€Bagging</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç®—æ³•é€‰æ‹©æµç¨‹å›¾ -->
        <div style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.05)); padding: 25px; border-radius: 15px; margin: 20px 0; border: 2px solid rgba(251, 191, 36, 0.3);">
            <h4 style="color: #fbbf24; margin-bottom: 20px;">ğŸ—ºï¸ ç®—æ³•é€‰æ‹©è·¯çº¿å›¾</h4>

            <div style="text-align: center; font-size: 1.1rem; line-height: 2;">
                <p>å¼€å§‹ â†’ æ•°æ®é‡å¤§å—ï¼Ÿ</p>
                <p>â†™ï¸ æ˜¯ï¼šæ ·æœ¬ > 10ä¸‡ &nbsp;&nbsp;&nbsp;&nbsp; â†˜ï¸ å¦ï¼šæ ·æœ¬ < 10ä¸‡</p>
                <p>â†“ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; â†“</p>
                <p>éœ€è¦è§£é‡Šæ€§å—ï¼Ÿ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; æ–‡æœ¬æ•°æ®å—ï¼Ÿ</p>
                <p>â†™ï¸ æ˜¯ &nbsp;&nbsp; â†˜ï¸ å¦ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; â†™ï¸ æ˜¯ &nbsp;&nbsp; â†˜ï¸ å¦</p>
                <p>å†³ç­–æ ‘ &nbsp; XGBoost &nbsp;&nbsp; æœ´ç´ è´å¶æ–¯ &nbsp; SVM</p>
            </div>
        </div>
    </div>

    <!-- 9.6 å®æˆ˜ï¼šåƒåœ¾é‚®ä»¶è¿‡æ»¤ -->
    <div id="practice" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ¯ 9.6 å®æˆ˜ï¼šåƒåœ¾é‚®ä»¶è¿‡æ»¤ç³»ç»Ÿ</h2>

        <div class="story-box content-box">
            <h3 style="color: #4facfe;">ğŸ“§ å¯¹æŠ—åƒåœ¾é‚®ä»¶çš„"å†›å¤‡ç«èµ›"</h3>
            <p style="margin-bottom: 20px;">
                2004å¹´ï¼Œæ¯”å°”Â·ç›–èŒ¨æ›¾é¢„è¨€ï¼š<br>
                "ä¸¤å¹´å†…ï¼Œåƒåœ¾é‚®ä»¶é—®é¢˜å°†å¾—åˆ°è§£å†³ã€‚"<br><br>

                ç„¶è€Œ20å¹´è¿‡å»äº†ï¼Œåƒåœ¾é‚®ä»¶ä¾ç„¶å­˜åœ¨...<br>
                ä½†æˆ‘ä»¬çš„æ­¦å™¨å·²ç»è¿›åŒ–äº†å¾ˆå¤šï¼š<br><br>

                ğŸ“Š ä»ç®€å•çš„å…³é”®è¯è¿‡æ»¤<br>
                ğŸ§  åˆ°è´å¶æ–¯æ¦‚ç‡æ¨¡å‹<br>
                ğŸ¤– å†åˆ°æ·±åº¦å­¦ä¹ ...<br><br>

                ä»Šå¤©ï¼Œè®©æˆ‘ä»¬ç”¨<span class="highlight-primary">å¤šç§ç®—æ³•</span>æ„å»ºä¸€ä¸ª<br>
                <span class="highlight-secondary">æ™ºèƒ½åƒåœ¾é‚®ä»¶è¿‡æ»¤ç³»ç»Ÿ</span>ï¼Œ<br>
                ä½“éªŒä¸åŒç®—æ³•çš„å¨åŠ›ï¼
            </p>
        </div>

        <!-- é¡¹ç›®æµç¨‹ -->
        <div style="margin: 30px 0;">
            <h3 style="color: #a78bfa; margin-bottom: 20px;">ğŸ”„ åƒåœ¾é‚®ä»¶è¿‡æ»¤ç³»ç»Ÿæ„å»ºæµç¨‹</h3>
            <div style="background: linear-gradient(135deg, rgba(79, 172, 254, 0.05), rgba(167, 139, 250, 0.05)); padding: 30px; border-radius: 15px; border: 1px solid rgba(79, 172, 254, 0.3);">
                <ol style="line-height: 2.5; padding-left: 20px;">
                    <li><strong>ğŸ“Š æ•°æ®å‡†å¤‡</strong>ï¼šæ”¶é›†åƒåœ¾é‚®ä»¶å’Œæ­£å¸¸é‚®ä»¶æ ·æœ¬</li>
                    <li><strong>ğŸ”¤ æ–‡æœ¬é¢„å¤„ç†</strong>ï¼šåˆ†è¯ã€å»åœç”¨è¯ã€æå–ç‰¹å¾</li>
                    <li><strong>ğŸ¯ ç‰¹å¾å·¥ç¨‹</strong>ï¼šTF-IDFã€è¯è¢‹æ¨¡å‹ã€n-gram</li>
                    <li><strong>ğŸ¤– æ¨¡å‹è®­ç»ƒ</strong>ï¼šå°è¯•å¤šç§ç®—æ³•</li>
                    <li><strong>ğŸ“ˆ æ€§èƒ½è¯„ä¼°</strong>ï¼šå‡†ç¡®ç‡ã€å¬å›ç‡ã€F1åˆ†æ•°</li>
                    <li><strong>ğŸ”§ æ¨¡å‹ä¼˜åŒ–</strong>ï¼šå‚æ•°è°ƒä¼˜ã€ç‰¹å¾é€‰æ‹©</li>
                    <li><strong>ğŸš€ ç³»ç»Ÿéƒ¨ç½²</strong>ï¼šå®æ—¶è¿‡æ»¤ã€ç”¨æˆ·åé¦ˆ</li>
                </ol>
            </div>
        </div>

        <!-- å®æˆ˜ä»£ç  -->
        <div class="code-block">
            <pre><code><span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">import</span> pandas <span class="keyword">as</span> pd
<span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer
<span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split, cross_val_score
<span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> MultinomialNB
<span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier
<span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC
<span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier, VotingClassifier
<span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report, confusion_matrix
<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt
<span class="keyword">import</span> seaborn <span class="keyword">as</span> sns

<span class="keyword">class</span> <span class="function">SpamFilterSystem</span>:
    <span class="string">"""åƒåœ¾é‚®ä»¶è¿‡æ»¤ç³»ç»Ÿ - å¤šç®—æ³•é›†æˆ"""</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self):
        self.vectorizer = TfidfVectorizer(
            max_features=<span class="number">5000</span>,
            stop_words=<span class="string">'english'</span>,
            ngram_range=(<span class="number">1</span>, <span class="number">2</span>)  <span class="comment"># ä½¿ç”¨1-gramå’Œ2-gram</span>
        )
        self.models = {}
        self.best_model = <span class="keyword">None</span>
        self.ensemble_model = <span class="keyword">None</span>

    <span class="keyword">def</span> <span class="function">preprocess_text</span>(self, text):
        <span class="string">"""æ–‡æœ¬é¢„å¤„ç†"""</span>
        <span class="comment"># è½¬å°å†™</span>
        text = text.lower()

        <span class="comment"># ç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼ˆä¿ç•™å­—æ¯æ•°å­—å’Œç©ºæ ¼ï¼‰</span>
        text = re.sub(r'[^a-zA-Z0-9\s]', '', text)

        <span class="comment"># ç§»é™¤å¤šä½™ç©ºæ ¼</span>
        text = ' '.join(text.split())

        <span class="keyword">return</span> text

    <span class="keyword">def</span> <span class="function">extract_features</span>(self, emails):
        <span class="string">"""ç‰¹å¾æå– - æ·»åŠ è‡ªå®šä¹‰ç‰¹å¾"""</span>
        features = []

        <span class="keyword">for</span> email <span class="keyword">in</span> emails:
            <span class="comment"># åŸºç¡€ç‰¹å¾</span>
            feature_dict = {
                <span class="string">'length'</span>: len(email),
                <span class="string">'num_capitals'</span>: sum(<span class="number">1</span> <span class="keyword">for</span> c <span class="keyword">in</span> email <span class="keyword">if</span> c.isupper()),
                <span class="string">'num_exclamation'</span>: email.count(<span class="string">'!'</span>),
                <span class="string">'num_question'</span>: email.count(<span class="string">'?'</span>),
                <span class="string">'num_dollar'</span>: email.count(<span class="string">'</span>),
                <span class="string">'has_link'</span>: <span class="number">1</span> <span class="keyword">if</span> <span class="string">'http'</span> <span class="keyword">in</span> email.lower() <span class="keyword">else</span> <span class="number">0</span>
            }

            <span class="comment"># åƒåœ¾é‚®ä»¶å…³é”®è¯</span>
            spam_keywords = [<span class="string">'free'</span>, <span class="string">'win'</span>, <span class="string">'prize'</span>, <span class="string">'click'</span>,
                           <span class="string">'buy'</span>, <span class="string">'offer'</span>, <span class="string">'limited'</span>]
            feature_dict[<span class="string">'spam_word_count'</span>] = sum(
                <span class="number">1</span> <span class="keyword">for</span> word <span class="keyword">in</span> spam_keywords
                <span class="keyword">if</span> word <span class="keyword">in</span> email.lower()
            )

            features.append(list(feature_dict.values()))

        <span class="keyword">return</span> np.array(features)

    <span class="keyword">def</span> <span class="function">train_models</span>(self, X_train, y_train):
        <span class="string">"""è®­ç»ƒå¤šä¸ªæ¨¡å‹"""</span>
        print(<span class="string">"ğŸš€ å¼€å§‹è®­ç»ƒå¤šä¸ªæ¨¡å‹...\n"</span>)

        <span class="comment"># 1. æœ´ç´ è´å¶æ–¯</span>
        print(<span class="string">"ğŸ“§ è®­ç»ƒæœ´ç´ è´å¶æ–¯..."</span>)
        nb_model = MultinomialNB(alpha=<span class="number">0.1</span>)
        nb_scores = cross_val_score(nb_model, X_train, y_train, cv=<span class="number">5</span>)
        nb_model.fit(X_train, y_train)
        self.models[<span class="string">'Naive Bayes'</span>] = {
            <span class="string">'model'</span>: nb_model,
            <span class="string">'score'</span>: nb_scores.mean()
        }
        print(<span class="string">f"   å‡†ç¡®ç‡: {nb_scores.mean():.2%} (Â±{nb_scores.std():.2%})"</span>)

        <span class="comment"># 2. å†³ç­–æ ‘</span>
        print(<span class="string">"\nğŸŒ³ è®­ç»ƒå†³ç­–æ ‘..."</span>)
        dt_model = DecisionTreeClassifier(max_depth=<span class="number">20</span>, random_state=<span class="number">42</span>)
        dt_scores = cross_val_score(dt_model, X_train, y_train, cv=<span class="number">5</span>)
        dt_model.fit(X_train, y_train)
        self.models[<span class="string">'Decision Tree'</span>] = {
            <span class="string">'model'</span>: dt_model,
            <span class="string">'score'</span>: dt_scores.mean()
        }
        print(<span class="string">f"   å‡†ç¡®ç‡: {dt_scores.mean():.2%} (Â±{dt_scores.std():.2%})"</span>)

        <span class="comment"># 3. SVM</span>
        print(<span class="string">"\nâš¡ è®­ç»ƒSVM..."</span>)
        svm_model = SVC(kernel=<span class="string">'linear'</span>, probability=<span class="keyword">True</span>, random_state=<span class="number">42</span>)
        svm_scores = cross_val_score(svm_model, X_train, y_train, cv=<span class="number">5</span>)
        svm_model.fit(X_train, y_train)
        self.models[<span class="string">'SVM'</span>] = {
            <span class="string">'model'</span>: svm_model,
            <span class="string">'score'</span>: svm_scores.mean()
        }
        print(<span class="string">f"   å‡†ç¡®ç‡: {svm_scores.mean():.2%} (Â±{svm_scores.std():.2%})"</span>)

        <span class="comment"># 4. éšæœºæ£®æ—</span>
        print(<span class="string">"\nğŸŒ² è®­ç»ƒéšæœºæ£®æ—..."</span>)
        rf_model = RandomForestClassifier(
            n_estimators=<span class="number">100</span>, max_depth=<span class="number">20</span>, random_state=<span class="number">42</span>
        )
        rf_scores = cross_val_score(rf_model, X_train, y_train, cv=<span class="number">5</span>)
        rf_model.fit(X_train, y_train)
        self.models[<span class="string">'Random Forest'</span>] = {
            <span class="string">'model'</span>: rf_model,
            <span class="string">'score'</span>: rf_scores.mean()
        }
        print(<span class="string">f"   å‡†ç¡®ç‡: {rf_scores.mean():.2%} (Â±{rf_scores.std():.2%})"</span>)

        <span class="comment"># 5. é›†æˆæ¨¡å‹ï¼ˆæŠ•ç¥¨ï¼‰</span>
        print(<span class="string">"\nğŸ­ æ„å»ºé›†æˆæ¨¡å‹..."</span>)
        self.ensemble_model = VotingClassifier(
            estimators=[
                (<span class="string">'nb'</span>, nb_model),
                (<span class="string">'rf'</span>, rf_model),
                (<span class="string">'svm'</span>, svm_model)
            ],
            voting=<span class="string">'soft'</span>
        )
        ensemble_scores = cross_val_score(
            self.ensemble_model, X_train, y_train, cv=<span class="number">5</span>
        )
        self.ensemble_model.fit(X_train, y_train)
        print(<span class="string">f"   å‡†ç¡®ç‡: {ensemble_scores.mean():.2%} (Â±{ensemble_scores.std():.2%})"</span>)

        <span class="comment"># é€‰æ‹©æœ€ä½³æ¨¡å‹</span>
        best_name = max(self.models, key=<span class="keyword">lambda</span> x: self.models[x][<span class="string">'score'</span>])
        self.best_model = self.models[best_name][<span class="string">'model'</span>]

        print(<span class="string">f"\nğŸ† æœ€ä½³å•ä¸€æ¨¡å‹: {best_name} ({self.models[best_name]['score']:.2%})"</span>)
        <span class="keyword">if</span> ensemble_scores.mean() > self.models[best_name][<span class="string">'score'</span>]:
            print(<span class="string">f"ğŸ¯ ä½†é›†æˆæ¨¡å‹è¡¨ç°æ›´å¥½: {ensemble_scores.mean():.2%}"</span>)

    <span class="keyword">def</span> <span class="function">evaluate_models</span>(self, X_test, y_test):
        <span class="string">"""è¯„ä¼°æ‰€æœ‰æ¨¡å‹"""</span>
        print(<span class="string">"\nğŸ“Š æ¨¡å‹è¯„ä¼°ç»“æœï¼š\n"</span>)

        results = {}

        <span class="keyword">for</span> name, model_info <span class="keyword">in</span> self.models.items():
            model = model_info[<span class="string">'model'</span>]
            y_pred = model.predict(X_test)

            print(<span class="string">f"{'='*50}"</span>)
            print(<span class="string">f"{name} æ€§èƒ½æŠ¥å‘Šï¼š"</span>)
            print(classification_report(
                y_test, y_pred,
                target_names=[<span class="string">'æ­£å¸¸é‚®ä»¶'</span>, <span class="string">'åƒåœ¾é‚®ä»¶'</span>]
            ))

            results[name] = {
                <span class="string">'predictions'</span>: y_pred,
                <span class="string">'accuracy'</span>: np.mean(y_pred == y_test)
            }

        <span class="comment"># é›†æˆæ¨¡å‹è¯„ä¼°</span>
        y_pred_ensemble = self.ensemble_model.predict(X_test)
        print(<span class="string">f"{'='*50}"</span>)
        print(<span class="string">"é›†æˆæ¨¡å‹ æ€§èƒ½æŠ¥å‘Šï¼š"</span>)
        print(classification_report(
            y_test, y_pred_ensemble,
            target_names=[<span class="string">'æ­£å¸¸é‚®ä»¶'</span>, <span class="string">'åƒåœ¾é‚®ä»¶'</span>]
        ))

        <span class="keyword">return</span> results

    <span class="keyword">def</span> <span class="function">visualize_results</span>(self, results, y_test):
        <span class="string">"""å¯è§†åŒ–ç»“æœå¯¹æ¯”"""</span>
        fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">2</span>, figsize=(<span class="number">15</span>, <span class="number">12</span>))
        axes = axes.ravel()

        <span class="keyword">for</span> idx, (name, result) <span class="keyword">in</span> enumerate(results.items()):
            <span class="keyword">if</span> idx >= <span class="number">4</span>:
                <span class="keyword">break</span>

            <span class="comment"># æ··æ·†çŸ©é˜µ</span>
            cm = confusion_matrix(y_test, result[<span class="string">'predictions'</span>])
            sns.heatmap(cm, annot=<span class="keyword">True</span>, fmt=<span class="string">'d'</span>, cmap=<span class="string">'Blues'</span>,
                       xticklabels=[<span class="string">'æ­£å¸¸'</span>, <span class="string">'åƒåœ¾'</span>],
                       yticklabels=[<span class="string">'æ­£å¸¸'</span>, <span class="string">'åƒåœ¾'</span>],
                       ax=axes[idx])
            axes[idx].set_title(<span class="string">f'{name}\nå‡†ç¡®ç‡: {result["accuracy"]:.2%}'</span>)
            axes[idx].set_xlabel(<span class="string">'é¢„æµ‹æ ‡ç­¾'</span>)
            axes[idx].set_ylabel(<span class="string">'çœŸå®æ ‡ç­¾'</span>)

        plt.tight_layout()
        plt.show()

    <span class="keyword">def</span> <span class="function">predict_email</span>(self, email_text):
        <span class="string">"""é¢„æµ‹å•å°é‚®ä»¶"""</span>
        <span class="comment"># é¢„å¤„ç†</span>
        processed = self.preprocess_text(email_text)

        <span class="comment"># å‘é‡åŒ–</span>
        text_features = self.vectorizer.transform([processed])
        custom_features = self.extract_features([email_text])
        features = np.hstack([text_features.toarray(), custom_features])

        <span class="comment"># ä½¿ç”¨é›†æˆæ¨¡å‹é¢„æµ‹</span>
        prediction = self.ensemble_model.predict(features)[<span class="number">0</span>]
        probabilities = self.ensemble_model.predict_proba(features)[<span class="number">0</span>]

        <span class="keyword">return</span> {
            <span class="string">'is_spam'</span>: bool(prediction),
            <span class="string">'spam_probability'</span>: probabilities[<span class="number">1</span>],
            <span class="string">'confidence'</span>: max(probabilities)
        }

<span class="comment"># ğŸš€ ä½¿ç”¨ç¤ºä¾‹</span>
<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:
    <span class="comment"># ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®</span>
    np.random.seed(<span class="number">42</span>)

    <span class="comment"># æ­£å¸¸é‚®ä»¶ç¤ºä¾‹</span>
    normal_emails = [
        <span class="string">"ä¼šè®®å®‰æ’åœ¨æ˜å¤©ä¸‹åˆä¸‰ç‚¹ï¼Œè¯·å‡†æ—¶å‚åŠ "</span>,
        <span class="string">"é¡¹ç›®è¿›å±•æŠ¥å‘Šå·²ç»å‘é€åˆ°æ‚¨çš„é‚®ç®±"</span>,
        <span class="string">"è¯·æŸ¥æ”¶æœ¬æœˆçš„å·¥ä½œæ€»ç»“"</span>,
        <span class="string">"æ˜å¤©çš„å®¢æˆ·ä¼šè®®éœ€è¦å‡†å¤‡PPT"</span>,
        <span class="string">"å›¢é˜Ÿèšé¤å®šåœ¨å‘¨äº”æ™šä¸Š"</span>
    ] * <span class="number">100</span>

    <span class="comment"># åƒåœ¾é‚®ä»¶ç¤ºä¾‹</span>
    spam_emails = [
        <span class="string">"æ­å–œæ‚¨ä¸­å¥–äº†ï¼ç‚¹å‡»è¿™é‡Œé¢†å–å…è´¹å¤§å¥–"</span>,
        <span class="string">"é™æ—¶ä¼˜æƒ ï¼ç«‹å³è´­ä¹°äº«å—æŠ˜æ‰£"</span>,
        <span class="string">"å…è´¹è¯•ç”¨æˆ‘ä»¬çš„äº§å“ï¼Œæœºä¼šéš¾å¾—"</span>,
        <span class="string">"ç‚¹å‡»é“¾æ¥è·å¾—$$å¥–é‡‘"</span>,
        <span class="string">"ç‰¹ä»·ä¿ƒé”€ï¼ï¼ï¼ä¹°ä¸€é€ä¸€ï¼ï¼ï¼"</span>
    ] * <span class="number">100</span>

    <span class="comment"># åˆå¹¶æ•°æ®</span>
    all_emails = normal_emails + spam_emails
    labels = [<span class="number">0</span>] * len(normal_emails) + [<span class="number">1</span>] * len(spam_emails)

    <span class="comment"># åˆå§‹åŒ–ç³»ç»Ÿ</span>
    spam_filter = SpamFilterSystem()

    <span class="comment"># é¢„å¤„ç†æ–‡æœ¬</span>
    processed_emails = [spam_filter.preprocess_text(email)
                       <span class="keyword">for</span> email <span class="keyword">in</span> all_emails]

    <span class="comment"># ç‰¹å¾æå–</span>
    text_features = spam_filter.vectorizer.fit_transform(processed_emails)
    custom_features = spam_filter.extract_features(all_emails)
    X = np.hstack([text_features.toarray(), custom_features])
    y = np.array(labels)

    <span class="comment"># åˆ’åˆ†æ•°æ®é›†</span>
    X_train, X_test, y_train, y_test = train_test_split(
        X, y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>, stratify=y
    )

    <span class="comment"># è®­ç»ƒæ¨¡å‹</span>
    spam_filter.train_models(X_train, y_train)

    <span class="comment"># è¯„ä¼°æ¨¡å‹</span>
    results = spam_filter.evaluate_models(X_test, y_test)

    <span class="comment"># å¯è§†åŒ–ç»“æœ</span>
    spam_filter.visualize_results(results, y_test)

    <span class="comment"># æµ‹è¯•æ–°é‚®ä»¶</span>
    print(<span class="string">"\nğŸ“§ æµ‹è¯•æ–°é‚®ä»¶ï¼š"</span>)
    test_emails = [
        <span class="string">"æ­å–œæ‚¨è·å¾—å…è´¹iPhoneï¼Œç‚¹å‡»é¢†å–"</span>,
        <span class="string">"æ˜å¤©çš„ä¼šè®®æ”¹åˆ°ä¸‹åˆå››ç‚¹"</span>,
        <span class="string">"é™æ—¶ç‰¹ä»·ï¼ï¼ï¼ç«‹å³è´­ä¹°ï¼ï¼ï¼"</span>
    ]

    <span class="keyword">for</span> email <span class="keyword">in</span> test_emails:
        result = spam_filter.predict_email(email)
        print(<span class="string">f"\né‚®ä»¶: {email}"</span>)
        print(<span class="string">f"åˆ†ç±»: {'åƒåœ¾é‚®ä»¶' if result['is_spam'] else 'æ­£å¸¸é‚®ä»¶'}"</span>)
        print(<span class="string">f"åƒåœ¾é‚®ä»¶æ¦‚ç‡: {result['spam_probability']:.2%}"</span>)
        print(<span class="string">f"ç½®ä¿¡åº¦: {result['confidence']:.2%}"</span>)</code></pre>
        </div>

        <!-- å®æˆ˜æ€»ç»“ -->
        <div style="background: linear-gradient(135deg, rgba(52, 211, 153, 0.1), rgba(34, 197, 94, 0.05)); padding: 25px; border-radius: 15px; margin-top: 30px; border: 2px solid rgba(52, 211, 153, 0.3);">
            <h4 style="color: #34d399; margin-bottom: 20px;">ğŸ¯ åƒåœ¾é‚®ä»¶è¿‡æ»¤ç³»ç»Ÿçš„å®æˆ˜ç»éªŒ</h4>

            <div class="metric-cards">
                <div class="metric-card">
                    <div class="metric-icon">ğŸ“Š</div>
                    <div class="metric-name">ç‰¹å¾å·¥ç¨‹å¾ˆé‡è¦</div>
                    <div class="metric-description">
                        TF-IDF + è‡ªå®šä¹‰ç‰¹å¾<br>
                        æ˜¾è‘—æå‡æ€§èƒ½
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">ğŸ²</div>
                    <div class="metric-name">æœ´ç´ è´å¶æ–¯è¡¨ç°ä¼˜å¼‚</div>
                    <div class="metric-description">
                        æ–‡æœ¬åˆ†ç±»çš„å¤©ç„¶é€‰æ‹©<br>
                        é€Ÿåº¦å¿«ã€æ•ˆæœå¥½
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">ğŸ­</div>
                    <div class="metric-name">é›†æˆæ–¹æ³•æ›´ç¨³å®š</div>
                    <div class="metric-description">
                        ç»„åˆå¤šä¸ªæ¨¡å‹<br>
                        é™ä½è¯¯åˆ¤ç‡
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 9.7 æ€»ç»“ä¸å±•æœ› -->
    <div id="summary" class="section-card fade-in section-anchor">
        <h2 class="section-title">ğŸ“ 9.7 æ€»ç»“ä¸å±•æœ›</h2>

        <div class="story-box content-box">
            <h3 style="color: #4facfe;">ğŸŒŸ å›é¡¾æˆ‘ä»¬çš„ç®—æ³•ä¹‹æ—…</h3>
            <p style="margin-bottom: 20px;">
                å°±åƒç‘å£«å†›åˆ€ä¸Šçš„æ¯ä¸ªå·¥å…·éƒ½æœ‰å…¶ç‹¬ç‰¹ä»·å€¼ï¼Œ<br>
                æ¯ä¸ªç›‘ç£å­¦ä¹ ç®—æ³•éƒ½æ˜¯<span class="highlight-primary">è§£å†³ç‰¹å®šé—®é¢˜çš„åˆ©å™¨</span>ã€‚<br><br>

                åœ¨è¿™ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ä¸€èµ·æ¢ç´¢äº†ï¼š<br>
                ğŸ² <strong>æœ´ç´ è´å¶æ–¯</strong>ï¼šæ¦‚ç‡æ¨ç†çš„æ™ºæ…§<br>
                ğŸŒ³ <strong>å†³ç­–æ ‘</strong>ï¼šè§„åˆ™å­¦ä¹ çš„è‰ºæœ¯<br>
                âš¡ <strong>æ”¯æŒå‘é‡æœº</strong>ï¼šé—´éš”æœ€å¤§åŒ–çš„ä¼˜é›…<br>
                ğŸŒ² <strong>é›†æˆå­¦ä¹ </strong>ï¼šç¾¤ä½“æ™ºæ…§çš„åŠ›é‡<br><br>

                æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å­¦ä¼šäº†<span class="highlight-secondary">å¦‚ä½•é€‰æ‹©åˆé€‚çš„ç®—æ³•</span>ï¼Œ<br>
                ä»¥åŠ<span class="highlight-warning">å¦‚ä½•å°†å®ƒä»¬ç»„åˆèµ·æ¥è§£å†³å®é™…é—®é¢˜</span>ã€‚
            </p>
        </div>

        <!-- æ ¸å¿ƒçŸ¥è¯†æ€»ç»“ -->
        <div style="margin: 30px 0;">
            <h3 style="color: #a78bfa; margin-bottom: 20px;">ğŸ“š æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“</h3>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div style="background: rgba(79, 172, 254, 0.1); padding: 20px; border-radius: 15px; border: 2px solid rgba(79, 172, 254, 0.3);">
                    <h4 style="color: #4facfe; margin-bottom: 15px;">ğŸ² æœ´ç´ è´å¶æ–¯</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li>âœ“ åŸºäºè´å¶æ–¯å®šç†</li>
                        <li>âœ“ å‡è®¾ç‰¹å¾ç‹¬ç«‹</li>
                        <li>âœ“ é€‚åˆæ–‡æœ¬åˆ†ç±»</li>
                        <li>âœ“ å°æ•°æ®é›†è¡¨ç°å¥½</li>
                    </ul>
                </div>

                <div style="background: rgba(167, 139, 250, 0.1); padding: 20px; border-radius: 15px; border: 2px solid rgba(167, 139, 250, 0.3);">
                    <h4 style="color: #a78bfa; margin-bottom: 15px;">ğŸŒ³ å†³ç­–æ ‘</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li>âœ“ æ ‘å½¢ç»“æ„å†³ç­–</li>
                        <li>âœ“ å¯è§£é‡Šæ€§å¼º</li>
                        <li>âœ“ å¤„ç†éçº¿æ€§å…³ç³»</li>
                        <li>âœ“ å®¹æ˜“è¿‡æ‹Ÿåˆ</li>
                    </ul>
                </div>

                <div style="background: rgba(244, 114, 182, 0.1); padding: 20px; border-radius: 15px; border: 2px solid rgba(244, 114, 182, 0.3);">
                    <h4 style="color: #f472b6; margin-bottom: 15px;">âš¡ SVM</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li>âœ“ æœ€å¤§åŒ–é—´éš”</li>
                        <li>âœ“ æ ¸æŠ€å·§å¤„ç†éçº¿æ€§</li>
                        <li>âœ“ æ³›åŒ–èƒ½åŠ›å¼º</li>
                        <li>âœ“ å¤§æ•°æ®é›†è®­ç»ƒæ…¢</li>
                    </ul>
                </div>

                <div style="background: rgba(251, 191, 36, 0.1); padding: 20px; border-radius: 15px; border: 2px solid rgba(251, 191, 36, 0.3);">
                    <h4 style="color: #fbbf24; margin-bottom: 15px;">ğŸŒ² é›†æˆå­¦ä¹ </h4>
                    <ul style="list-style: none; padding: 0;">
                        <li>âœ“ ç»„åˆå¤šä¸ªæ¨¡å‹</li>
                        <li>âœ“ Baggingé™ä½æ–¹å·®</li>
                        <li>âœ“ Boostingé™ä½åå·®</li>
                        <li>âœ“ æ€§èƒ½é€šå¸¸æœ€ä¼˜</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ç®—æ³•é€‰æ‹©å†³ç­–æ ‘ -->
        <div class="thinking-box content-box">
            <h3>ğŸ’¡ ç®—æ³•é€‰æ‹©çš„é»„é‡‘æ³•åˆ™</h3>

            <div style="margin-top: 20px;">
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(79, 172, 254, 0.1); border-radius: 10px;">
                    <p><strong>1. ğŸ¯ æ²¡æœ‰å…è´¹çš„åˆé¤</strong></p>
                    <p style="margin-left: 20px; color: var(--text-muted);">æ²¡æœ‰ç®—æ³•åœ¨æ‰€æœ‰é—®é¢˜ä¸Šéƒ½æ˜¯æœ€å¥½çš„</p>
                </div>

                <div style="margin-bottom: 15px; padding: 15px; background: rgba(167, 139, 250, 0.1); border-radius: 10px;">
                    <p><strong>2. ğŸ” äº†è§£ä½ çš„æ•°æ®</strong></p>
                    <p style="margin-left: 20px; color: var(--text-muted);">æ•°æ®ç‰¹å¾å†³å®šç®—æ³•é€‰æ‹©</p>
                </div>

                <div style="margin-bottom: 15px; padding: 15px; background: rgba(244, 114, 182, 0.1); border-radius: 10px;">
                    <p><strong>3. ğŸ§ª å¤šå°è¯•ã€å¤šæ¯”è¾ƒ</strong></p>
                    <p style="margin-left: 20px; color: var(--text-muted);">å®è·µæ˜¯æ£€éªŒç®—æ³•çš„å”¯ä¸€æ ‡å‡†</p>
                </div>

                <div style="margin-bottom: 15px; padding: 15px; background: rgba(52, 211, 153, 0.1); border-radius: 10px;">
                    <p><strong>4. ğŸ­ è€ƒè™‘é›†æˆ</strong></p>
                    <p style="margin-left: 20px; color: var(--text-muted);">ç»„åˆå¾€å¾€ä¼˜äºå•ä¸€æ¨¡å‹</p>
                </div>

                <div style="padding: 15px; background: rgba(251, 191, 36, 0.1); border-radius: 10px;">
                    <p><strong>5. âš–ï¸ å¹³è¡¡å¤æ‚åº¦</strong></p>
                    <p style="margin-left: 20px; color: var(--text-muted);">æ€§èƒ½æå‡è¦å€¼å¾—é¢å¤–çš„å¤æ‚åº¦</p>
                </div>
            </div>
        </div>

        <!-- æœªæ¥å±•æœ› -->
        <div style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.05)); padding: 25px; border-radius: 15px; margin-top: 30px; border: 2px solid rgba(251, 191, 36, 0.3);">
            <h4 style="color: #fbbf24; margin-bottom: 20px;">ğŸš€ ç®—æ³•çš„æœªæ¥ï¼šæ–°çš„å¯èƒ½æ€§</h4>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ§ </div>
                    <h5>æ·±åº¦å­¦ä¹ é›†æˆ</h5>
                    <p style="font-size: 0.9rem; color: var(--text-muted);">
                        ä¼ ç»Ÿç®—æ³•+æ·±åº¦å­¦ä¹ <br>
                        å–é•¿è¡¥çŸ­ï¼Œæ€§èƒ½æ›´ä¼˜
                    </p>
                </div>
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ¤–</div>
                    <h5>è‡ªåŠ¨æœºå™¨å­¦ä¹ </h5>
                    <p style="font-size: 0.9rem; color: var(--text-muted);">
                        AutoMLè‡ªåŠ¨é€‰æ‹©ç®—æ³•<br>
                        é™ä½ä½¿ç”¨é—¨æ§›
                    </p>
                </div>
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ’¡</div>
                    <h5>å¯è§£é‡ŠAI</h5>
                    <p style="font-size: 0.9rem; color: var(--text-muted);">
                        è®©å¤æ‚ç®—æ³•å¯è§£é‡Š<br>
                        å¢å¼ºä¿¡ä»»å’Œåº”ç”¨
                    </p>
                </div>
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">âš¡</div>
                    <h5>é‡å­æœºå™¨å­¦ä¹ </h5>
                    <p style="font-size: 0.9rem; color: var(--text-muted);">
                        é‡å­è®¡ç®—åŠ é€Ÿ<br>
                        çªç ´è®¡ç®—ç“¶é¢ˆ
                    </p>
                </div>
            </div>
        </div>

        <!-- ç»“è¯­ -->
        <div style="margin-top: 40px; text-align: center; padding: 30px; background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(167, 139, 250, 0.1)); border-radius: 20px;">
            <h3 style="font-size: 2rem; margin-bottom: 20px; background: linear-gradient(135deg, var(--algo-blue), var(--algo-purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                ğŸ› ï¸ æŒæ¡ç®—æ³•ï¼Œé©¾é©­æ•°æ®
            </h3>
            <p style="font-size: 1.2rem; color: var(--text-secondary); line-height: 1.8;">
                ç›‘ç£å­¦ä¹ ç®—æ³•å°±åƒä¸€å¥—ç²¾å¯†çš„å·¥å…·ï¼Œ<br>
                æ¯ä¸€ä¸ªéƒ½æœ‰å…¶ç‹¬ç‰¹çš„<strong>æ™ºæ…§å’Œä»·å€¼</strong>ã€‚<br><br>

                æŒæ¡å®ƒä»¬ï¼Œä¸ä»…æ˜¯æŒæ¡æŠ€æœ¯ï¼Œ<br>
                æ›´æ˜¯æŒæ¡<strong>è§£å†³é—®é¢˜çš„æ€ç»´æ–¹å¼</strong>ã€‚<br><br>

                æ„¿ä½ åœ¨æœºå™¨å­¦ä¹ çš„é“è·¯ä¸Šï¼Œ<br>
                <strong>é€‰å¯¹å·¥å…·ï¼Œè§£å†³éš¾é¢˜ï¼Œåˆ›é€ ä»·å€¼</strong>ï¼
            </p>

            <div style="margin-top: 30px;">
                <button class="demo-btn" style="font-size: 1.1rem; padding: 15px 40px;">
                    ğŸš€ å¼€å¯ä¸‹ä¸€æ®µå­¦ä¹ ä¹‹æ—…
                </button>
            </div>
        </div>
    </div>
</div>

<!-- æµ®åŠ¨å·¥å…·æ  -->
<div class="floating-toolbar">
    <button class="toolbar-btn" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">
        ğŸŒ“
    </button>
    <button class="toolbar-btn" onclick="scrollToTop()" title="å›åˆ°é¡¶éƒ¨">
        â¬†ï¸
    </button>
</div>

<!-- JavaScriptä»£ç  -->
<script>
    // å¯¼èˆªç³»ç»Ÿ
    function toggleNav() {
        document.body.classList.toggle('nav-open');
    }

    // å¯¼èˆªé¡¹æ¿€æ´»çŠ¶æ€
    document.querySelectorAll('.nav-item a').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);

            // æ›´æ–°æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            this.parentElement.classList.add('active');

            // å¹³æ»‘æ»šåŠ¨
            targetElement.scrollIntoView({ behavior: 'smooth' });

            // ç§»åŠ¨ç«¯è‡ªåŠ¨å…³é—­å¯¼èˆª
            if (window.innerWidth <= 768) {
                document.body.classList.remove('nav-open');
            }
        });
    });

    // è¿›åº¦è¿½è¸ª
    function updateProgress() {
        const sections = document.querySelectorAll('.section-anchor');
        const scrollPosition = window.scrollY + 200;
        let currentSection = 0;

        sections.forEach((section, index) => {
            if (scrollPosition >= section.offsetTop) {
                currentSection = index;

                // æ›´æ–°å¯¼èˆªæ¿€æ´»çŠ¶æ€
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                const navItem = document.querySelector(`[data-section="${section.id}"]`);
                if (navItem) {
                    navItem.classList.add('active');
                }
            }
        });

        // æ›´æ–°è¿›åº¦æ¡
        const progress = ((currentSection + 1) / sections.length) * 100;
        document.getElementById('progressFill').style.width = progress + '%';
        document.getElementById('progressText').textContent = Math.round(progress) + '%';

        // æ›´æ–°å·²å®Œæˆçš„ç« èŠ‚
        document.querySelectorAll('.nav-item').forEach((item, index) => {
            if (index < currentSection) {
                item.classList.add('completed');
            }
        });
    }

    window.addEventListener('scroll', updateProgress);

    // ä¸»é¢˜åˆ‡æ¢
    function toggleTheme() {
        document.body.classList.toggle('light-theme');
        localStorage.setItem('theme', document.body.classList.contains('light-theme') ? 'light' : 'dark');
    }

    // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
    if (localStorage.getItem('theme') === 'light') {
        document.body.classList.add('light-theme');
    }

    // å›åˆ°é¡¶éƒ¨
    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ç²’å­èƒŒæ™¯ç³»ç»Ÿ
    class ParticleSystem {
        constructor(canvasId) {
            this.canvas = document.getElementById(canvasId);
            this.ctx = this.canvas.getContext('2d');
            this.particles = [];
            this.connections = [];
            this.mouse = { x: 0, y: 0 };

            this.init();
            this.animate();

            window.addEventListener('resize', () => this.init());
            window.addEventListener('mousemove', (e) => {
                this.mouse.x = e.clientX;
                this.mouse.y = e.clientY;
            });
        }

        init() {
            this.canvas.width = window.innerWidth;
            this.canvas.height = window.innerHeight;

            // åˆ›å»ºç²’å­
            this.particles = [];
            const particleCount = Math.floor((this.canvas.width * this.canvas.height) / 15000);

            for (let i = 0; i < particleCount; i++) {
                this.particles.push({
                    x: Math.random() * this.canvas.width,
                    y: Math.random() * this.canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    radius: Math.random() * 2 + 1,
                    color: `hsla(${200 + Math.random() * 60}, 70%, 60%, 0.3)`
                });
            }
        }

        animate() {
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

            // æ›´æ–°å’Œç»˜åˆ¶ç²’å­
            this.particles.forEach((particle, i) => {
                particle.x += particle.vx;
                particle.y += particle.vy;

                // è¾¹ç•Œåå¼¹
                if (particle.x < 0 || particle.x > this.canvas.width) particle.vx *= -1;
                if (particle.y < 0 || particle.y > this.canvas.height) particle.vy *= -1;

                // ç»˜åˆ¶ç²’å­
                this.ctx.beginPath();
                this.ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                this.ctx.fillStyle = particle.color;
                this.ctx.fill();

                // è¿æ¥ä¸´è¿‘ç²’å­
                for (let j = i + 1; j < this.particles.length; j++) {
                    const dx = this.particles[j].x - particle.x;
                    const dy = this.particles[j].y - particle.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < 150) {
                        this.ctx.beginPath();
                        this.ctx.moveTo(particle.x, particle.y);
                        this.ctx.lineTo(this.particles[j].x, this.particles[j].y);
                        this.ctx.strokeStyle = `rgba(79, 172, 254, ${0.2 * (1 - distance / 150)})`;
                        this.ctx.stroke();
                    }
                }

                // é¼ æ ‡äº¤äº’
                const mouseDistance = Math.sqrt(
                    Math.pow(this.mouse.x - particle.x, 2) +
                    Math.pow(this.mouse.y - particle.y, 2)
                );

                if (mouseDistance < 100) {
                    const force = (100 - mouseDistance) / 100;
                    particle.vx += (this.mouse.x - particle.x) * force * 0.01;
                    particle.vy += (this.mouse.y - particle.y) * force * 0.01;
                }
            });

            requestAnimationFrame(() => this.animate());
        }
    }

    // æœ´ç´ è´å¶æ–¯æ¼”ç¤º
    let bayesData = {
        spam: [],
        ham: [],
        wordFreq: {},
        animationRunning: false
    };

    function updateBayesDemo() {
        const samples = document.getElementById('bayesSamples').value;
        document.getElementById('bayesSamplesValue').textContent = samples;
    }

    function trainBayes() {
        // æ¨¡æ‹Ÿè®­ç»ƒæ•°æ®
        const spamWords = ['free', 'win', 'click', 'buy', 'offer', 'prize', 'congratulations', 'limited'];
        const hamWords = ['meeting', 'project', 'report', 'work', 'team', 'schedule', 'deadline', 'update'];

        bayesData.wordFreq = {
            spam: {},
            ham: {}
        };

        // ç»Ÿè®¡è¯é¢‘ï¼ˆæ›´çœŸå®çš„æ¦‚ç‡åˆ†å¸ƒï¼‰
        spamWords.forEach(word => {
            bayesData.wordFreq.spam[word] = 0.6 + Math.random() * 0.3; // 0.6-0.9
        });

        hamWords.forEach(word => {
            bayesData.wordFreq.ham[word] = 0.7 + Math.random() * 0.25; // 0.7-0.95
        });

        // æ·»åŠ ä¸€äº›äº¤å‰è¯æ±‡
        ['click', 'update'].forEach(word => {
            bayesData.wordFreq.ham[word] = 0.3 + Math.random() * 0.2; // 0.3-0.5
        });

        drawBayesVisualization();

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯è€Œä¸æ˜¯å¼¹çª—
        document.getElementById('spamProb').textContent = 'å·²è®­ç»ƒ';
        document.getElementById('hamProb').textContent = 'å·²è®­ç»ƒ';
        document.getElementById('classResult').textContent = 'å°±ç»ª';
    }

    function testBayes() {
        const testEmail = document.getElementById('testEmail').value || 'å…è´¹èµ¢å–å¤§å¥–';

        // è´å¶æ–¯æ¦‚ç‡è®¡ç®—
        let spamScore = 0.5; // å…ˆéªŒæ¦‚ç‡
        let hamScore = 0.5;

        const words = testEmail.toLowerCase().split(/\s+/);

        // è®¡ç®—ä¼¼ç„¶æ¦‚ç‡
        words.forEach(word => {
            if (bayesData.wordFreq.spam[word]) {
                spamScore *= bayesData.wordFreq.spam[word];
            } else {
                spamScore *= 0.1; // å¹³æ»‘å¤„ç†
            }

            if (bayesData.wordFreq.ham[word]) {
                hamScore *= bayesData.wordFreq.ham[word];
            } else {
                hamScore *= 0.1;
            }
        });

        // å½’ä¸€åŒ–
        const totalScore = spamScore + hamScore;
        const spamProb = spamScore / totalScore;
        const hamProb = hamScore / totalScore;

        document.getElementById('spamProb').textContent = (spamProb * 100).toFixed(1) + '%';
        document.getElementById('hamProb').textContent = (hamProb * 100).toFixed(1) + '%';
        document.getElementById('classResult').textContent = spamProb > 0.5 ? 'åƒåœ¾é‚®ä»¶' : 'æ­£å¸¸é‚®ä»¶';

        // é«˜äº®æ˜¾ç¤ºæ£€æµ‹åˆ°çš„è¯
        highlightDetectedWords(words);
    }

    function showWordProbs() {
        // æ˜¾ç¤ºè¯é¢‘ç»Ÿè®¡è¯¦æƒ…
        const canvas = document.getElementById('bayesCanvas');
        const ctx = canvas.getContext('2d');

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ç»˜åˆ¶æ ‡é¢˜
        ctx.fillStyle = '#e8eaed';
        ctx.font = 'bold 18px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('è¯æ±‡æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ', canvas.width / 2, 30);

        // ç»˜åˆ¶å›¾ä¾‹
        ctx.font = '14px Arial';
        ctx.fillStyle = '#f472b6';
        ctx.fillRect(canvas.width - 150, 10, 15, 15);
        ctx.fillText('åƒåœ¾é‚®ä»¶', canvas.width - 130, 23);

        ctx.fillStyle = '#4facfe';
        ctx.fillRect(canvas.width - 150, 30, 15, 15);
        ctx.fillText('æ­£å¸¸é‚®ä»¶', canvas.width - 130, 43);

        // åˆå¹¶æ‰€æœ‰è¯æ±‡
        const allWords = new Set([
            ...Object.keys(bayesData.wordFreq.spam),
            ...Object.keys(bayesData.wordFreq.ham)
        ]);

        const words = Array.from(allWords);
        const barWidth = (canvas.width - 100) / (words.length * 2.5);
        const maxHeight = 250;

        // ç»˜åˆ¶è¯é¢‘æ¡å½¢å›¾
        words.forEach((word, i) => {
            const x = 50 + i * barWidth * 2.5;
            const spamProb = bayesData.wordFreq.spam[word] || 0.1;
            const hamProb = bayesData.wordFreq.ham[word] || 0.1;

            // åƒåœ¾é‚®ä»¶æ¦‚ç‡
            const spamHeight = spamProb * maxHeight;
            ctx.fillStyle = '#f472b6';
            ctx.fillRect(x, canvas.height - spamHeight - 60, barWidth, spamHeight);

            // æ­£å¸¸é‚®ä»¶æ¦‚ç‡
            const hamHeight = hamProb * maxHeight;
            ctx.fillStyle = '#4facfe';
            ctx.fillRect(x + barWidth + 3, canvas.height - hamHeight - 60, barWidth, hamHeight);

            // è¯æ±‡æ ‡ç­¾
            ctx.save();
            ctx.translate(x + barWidth, canvas.height - 50);
            ctx.rotate(-Math.PI / 4);
            ctx.fillStyle = '#e8eaed';
            ctx.font = '12px Arial';
            ctx.textAlign = 'right';
            ctx.fillText(word, 0, 0);
            ctx.restore();

            // æ¦‚ç‡å€¼
            ctx.fillStyle = '#8b98a8';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(spamProb.toFixed(2), x + barWidth/2, canvas.height - spamHeight - 65);
            ctx.fillText(hamProb.toFixed(2), x + barWidth * 1.5 + 3, canvas.height - hamHeight - 65);
        });
    }

    function animateBayes() {
        if (bayesData.animationRunning) return;
        bayesData.animationRunning = true;

        const testEmail = document.getElementById('testEmail').value || 'å…è´¹èµ¢å–å¤§å¥–';
        const words = testEmail.toLowerCase().split(/\s+/);
        const canvas = document.getElementById('bayesCanvas');
        const ctx = canvas.getContext('2d');

        let currentWordIndex = 0;
        let spamScore = 0.5;
        let hamScore = 0.5;

        function animateStep() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // æ ‡é¢˜
            ctx.fillStyle = '#e8eaed';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('è´å¶æ–¯æ¨ç†è¿‡ç¨‹åŠ¨ç”»', canvas.width / 2, 30);

            // å½“å‰å¤„ç†çš„è¯
            if (currentWordIndex < words.length) {
                const word = words[currentWordIndex];
                ctx.font = 'bold 24px Arial';
                ctx.fillStyle = '#fbbf24';
                ctx.fillText(`å½“å‰è¯: "${word}"`, canvas.width / 2, 80);

                // æ›´æ–°æ¦‚ç‡
                const spamWordProb = bayesData.wordFreq.spam[word] || 0.1;
                const hamWordProb = bayesData.wordFreq.ham[word] || 0.1;

                spamScore *= spamWordProb;
                hamScore *= hamWordProb;

                // å½’ä¸€åŒ–
                const total = spamScore + hamScore;
                const spamProb = spamScore / total;
                const hamProb = hamScore / total;

                // ç»˜åˆ¶æ¦‚ç‡æ¡
                const barY = 150;
                const barHeight = 40;
                const barWidth = 300;

                // èƒŒæ™¯
                ctx.fillStyle = '#2a2a2a';
                ctx.fillRect((canvas.width - barWidth) / 2, barY, barWidth, barHeight);

                // åƒåœ¾é‚®ä»¶æ¦‚ç‡
                ctx.fillStyle = '#f472b6';
                ctx.fillRect((canvas.width - barWidth) / 2, barY, barWidth * spamProb, barHeight);

                // æ¦‚ç‡æ–‡å­—
                ctx.fillStyle = '#ffffff';
                ctx.font = '16px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(`åƒåœ¾é‚®ä»¶: ${(spamProb * 100).toFixed(1)}%`,
                    (canvas.width - barWidth) / 2 + 10, barY + 25);
                ctx.textAlign = 'right';
                ctx.fillText(`æ­£å¸¸é‚®ä»¶: ${(hamProb * 100).toFixed(1)}%`,
                    (canvas.width + barWidth) / 2 - 10, barY + 25);

                // æ˜¾ç¤ºå·²å¤„ç†çš„è¯
                ctx.fillStyle = '#8b98a8';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                const processedWords = words.slice(0, currentWordIndex + 1).join(' â†’ ');
                ctx.fillText('å·²å¤„ç†: ' + processedWords, canvas.width / 2, 250);

                currentWordIndex++;

                if (currentWordIndex < words.length) {
                    setTimeout(animateStep, 1000);
                } else {
                    // åŠ¨ç”»ç»“æŸ
                    ctx.fillStyle = '#34d399';
                    ctx.font = 'bold 20px Arial';
                    ctx.fillText(`æœ€ç»ˆç»“æœ: ${spamProb > 0.5 ? 'åƒåœ¾é‚®ä»¶' : 'æ­£å¸¸é‚®ä»¶'}`,
                        canvas.width / 2, 300);
                    bayesData.animationRunning = false;

                    // æ›´æ–°ç•Œé¢ç»“æœ
                    document.getElementById('spamProb').textContent = (spamProb * 100).toFixed(1) + '%';
                    document.getElementById('hamProb').textContent = (hamProb * 100).toFixed(1) + '%';
                    document.getElementById('classResult').textContent = spamProb > 0.5 ? 'åƒåœ¾é‚®ä»¶' : 'æ­£å¸¸é‚®ä»¶';
                }
            }
        }

        animateStep();
    }

    function highlightDetectedWords(words) {
        const canvas = document.getElementById('bayesCanvas');
        const ctx = canvas.getContext('2d');

        // åœ¨ç°æœ‰å›¾è¡¨ä¸Šæ·»åŠ é«˜äº®
        ctx.fillStyle = 'rgba(251, 191, 36, 0.3)';
        ctx.strokeStyle = '#fbbf24';
        ctx.lineWidth = 2;

        const allWords = Array.from(new Set([
            ...Object.keys(bayesData.wordFreq.spam),
            ...Object.keys(bayesData.wordFreq.ham)
        ]));

        const barWidth = (canvas.width - 100) / (allWords.length * 2.5);

        words.forEach(word => {
            const index = allWords.indexOf(word);
            if (index !== -1) {
                const x = 50 + index * barWidth * 2.5;
                ctx.fillRect(x - 5, 50, barWidth * 2 + 10, canvas.height - 110);
                ctx.strokeRect(x - 5, 50, barWidth * 2 + 10, canvas.height - 110);
            }
        });
    }

    function drawBayesVisualization() {
        const canvas = document.getElementById('bayesCanvas');
        const ctx = canvas.getContext('2d');

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ç»˜åˆ¶æ ‡é¢˜
        ctx.fillStyle = '#e8eaed';
        ctx.font = 'bold 16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('è¯æ±‡æ¦‚ç‡åˆ†å¸ƒ', canvas.width / 2, 30);

        // åˆå¹¶æ‰€æœ‰è¯æ±‡
        const allWords = new Set([
            ...Object.keys(bayesData.wordFreq.spam),
            ...Object.keys(bayesData.wordFreq.ham)
        ]);

        const words = Array.from(allWords);
        const barWidth = (canvas.width - 100) / (words.length * 2.5);
        const maxHeight = 200;

        // ç»˜åˆ¶è¯é¢‘æ¡å½¢å›¾
        words.forEach((word, i) => {
            const x = 50 + i * barWidth * 2.5;
            const spamProb = bayesData.wordFreq.spam[word] || 0.1;
            const hamProb = bayesData.wordFreq.ham[word] || 0.1;

            // åƒåœ¾é‚®ä»¶è¯é¢‘ï¼ˆçº¢è‰²ï¼‰
            const spamHeight = spamProb * maxHeight;
            ctx.fillStyle = '#f472b6';
            ctx.fillRect(x, canvas.height - spamHeight - 60, barWidth, spamHeight);

            // æ­£å¸¸é‚®ä»¶è¯é¢‘ï¼ˆè“è‰²ï¼‰
            const hamHeight = hamProb * maxHeight;
            ctx.fillStyle = '#4facfe';
            ctx.fillRect(x + barWidth + 3, canvas.height - hamHeight - 60, barWidth, hamHeight);

            // è¯æ±‡æ ‡ç­¾
            ctx.save();
            ctx.translate(x + barWidth, canvas.height - 45);
            ctx.rotate(-Math.PI / 6);
            ctx.fillStyle = '#e8eaed';
            ctx.font = '11px Arial';
            ctx.textAlign = 'right';
            ctx.fillText(word, 0, 0);
            ctx.restore();
        });

        // ç»˜åˆ¶å›¾ä¾‹
        ctx.font = '12px Arial';
        ctx.fillStyle = '#f472b6';
        ctx.fillRect(canvas.width - 120, 10, 12, 12);
        ctx.fillText('åƒåœ¾é‚®ä»¶', canvas.width - 100, 21);

        ctx.fillStyle = '#4facfe';
        ctx.fillRect(canvas.width - 120, 28, 12, 12);
        ctx.fillText('æ­£å¸¸é‚®ä»¶', canvas.width - 100, 39);
    }

    // å†³ç­–æ ‘æ¼”ç¤º
    let treeData = {
        nodes: [],
        edges: []
    };

    function updateTreeDepth() {
        const depth = document.getElementById('maxDepth').value;
        document.getElementById('maxDepthValue').textContent = depth;
    }

    function updateCriterion() {
        // æ›´æ–°åˆ†è£‚å‡†åˆ™
    }

    function generateTreeData() {
        // ç”Ÿæˆå†³ç­–æ ‘æ•°æ®
        alert('ç”Ÿæˆå†³ç­–æ ‘æ•°æ® - å¾…å®ç°');
    }

    function growTree() {
        // ç”Ÿé•¿å†³ç­–æ ‘
        const canvas = document.getElementById('treeCanvas');
        const ctx = canvas.getContext('2d');

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ç®€å•çš„æ ‘å½¢ç»“æ„ç»˜åˆ¶
        drawTreeNode(ctx, canvas.width / 2, 50, 'æ ¹èŠ‚ç‚¹', true);
        drawTreeNode(ctx, canvas.width / 3, 150, 'å·¦å­èŠ‚ç‚¹', false);
        drawTreeNode(ctx, 2 * canvas.width / 3, 150, 'å³å­èŠ‚ç‚¹', false);

        // è¿çº¿
        ctx.strokeStyle = '#4facfe';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(canvas.width / 2, 80);
        ctx.lineTo(canvas.width / 3, 120);
        ctx.moveTo(canvas.width / 2, 80);
        ctx.lineTo(2 * canvas.width / 3, 120);
        ctx.stroke();

        alert('å†³ç­–æ ‘å·²ç”Ÿæˆï¼');
    }

    function drawTreeNode(ctx, x, y, node) {
        // å¦‚æœnodeæ˜¯å­—ç¬¦ä¸²ï¼ˆæ—§çš„è°ƒç”¨æ–¹å¼ï¼‰ï¼Œè½¬æ¢ä¸ºå¯¹è±¡
        if (typeof node === 'string') {
            node = {
                type: 'internal',
                samples: 100,
                label: node
            };
        }

        const width = 120;
        const height = 40;

        // èŠ‚ç‚¹èƒŒæ™¯
        if (node.type === 'leaf') {
            ctx.fillStyle = node.label === 1 ? '#4facfe' : '#f472b6';
        } else {
            ctx.fillStyle = '#a78bfa';
        }

        ctx.fillRect(x - width/2, y - height/2, width, height);

        // èŠ‚ç‚¹è¾¹æ¡†
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 2;
        ctx.strokeRect(x - width/2, y - height/2, width, height);

        // èŠ‚ç‚¹æ–‡å­—
        ctx.fillStyle = '#ffffff';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';

        if (node.type === 'leaf') {
            ctx.fillText(`ç±»åˆ«: ${node.label}`, x, y - 5);
            ctx.fillText(`æ ·æœ¬: ${node.samples}`, x, y + 10);
        } else if (node.feature) {
            const featureName = node.feature === 'x' ? 'Xè½´' : 'Yè½´';
            ctx.fillText(`${featureName} <= ${node.threshold.toFixed(0)}`, x, y - 5);
            ctx.fillText(`æ ·æœ¬: ${node.samples}`, x, y + 10);
        } else {
            // å…¼å®¹æ—§çš„è°ƒç”¨æ–¹å¼
            ctx.fillText(node.label || 'èŠ‚ç‚¹', x, y);
        }
    }

    function pruneTree() {
        // å†³ç­–æ ‘å‰ªæ - å¾…å®ç°
        console.log('å†³ç­–æ ‘å‰ªæåŠŸèƒ½å¾…å®ç°');
    }

    function animateDecision() {
        // å†³ç­–è¿‡ç¨‹åŠ¨ç”» - å¾…å®ç°
        console.log('å†³ç­–è¿‡ç¨‹åŠ¨ç”»å¾…å®ç°');
    }

    // SVMæ¼”ç¤º
    let svmData = {
        points: [],
        supportVectors: [],
        hyperplane: { a: 0, b: 0, c: 0 },
        animationRunning: false
    };

    function updateSVM() {
        // æ›´æ–°SVMå‚æ•°æ—¶é‡æ–°è®­ç»ƒ
        if (svmData.points.length > 0) {
            trainSVM();
        }
    }

    function updateSVMC() {
        const c = document.getElementById('svmC').value;
        document.getElementById('svmCValue').textContent = c;

        if (svmData.points.length > 0) {
            trainSVM();
        }
    }

    function generateSVMData() {
        const canvas = document.getElementById('svmCanvas');
        svmData.points = [];

        // ç”Ÿæˆçº¿æ€§å¯åˆ†çš„ä¸¤ç±»æ•°æ®
        const margin = 50;
        const noise = 30;

        // ç¬¬ä¸€ç±»ï¼ˆå·¦ä¸Šï¼‰
        for (let i = 0; i < 20; i++) {
            svmData.points.push({
                x: margin + Math.random() * (canvas.width/2 - margin - noise),
                y: margin + Math.random() * (canvas.height/2 - margin - noise),
                class: 1
            });
        }

        // ç¬¬äºŒç±»ï¼ˆå³ä¸‹ï¼‰
        for (let i = 0; i < 20; i++) {
            svmData.points.push({
                x: canvas.width/2 + noise + Math.random() * (canvas.width/2 - margin - noise),
                y: canvas.height/2 + noise + Math.random() * (canvas.height/2 - margin - noise),
                class: -1
            });
        }

        // æ·»åŠ ä¸€äº›æ¥è¿‘è¾¹ç•Œçš„ç‚¹
        for (let i = 0; i < 5; i++) {
            const t = Math.random();
            svmData.points.push({
                x: canvas.width * t,
                y: canvas.height * (1 - t) + (Math.random() - 0.5) * 50,
                class: Math.random() > 0.5 ? 1 : -1
            });
        }

        drawSVM();
    }

    function trainSVM() {
        if (svmData.points.length === 0) return;

        // ç®€åŒ–çš„SVMè®­ç»ƒï¼ˆæ‰¾åˆ°æœ€ä½³åˆ†å‰²çº¿ï¼‰
        const canvas = document.getElementById('svmCanvas');

        // åˆ†ç¦»ä¸¤ç±»æ•°æ®
        const class1 = svmData.points.filter(p => p.class === 1);
        const class2 = svmData.points.filter(p => p.class === -1);

        // è®¡ç®—ä¸¤ç±»çš„ä¸­å¿ƒ
        const center1 = {
            x: class1.reduce((sum, p) => sum + p.x, 0) / class1.length,
            y: class1.reduce((sum, p) => sum + p.y, 0) / class1.length
        };

        const center2 = {
            x: class2.reduce((sum, p) => sum + p.x, 0) / class2.length,
            y: class2.reduce((sum, p) => sum + p.y, 0) / class2.length
        };

        // è®¡ç®—åˆ†å‰²çº¿çš„æ³•å‘é‡ï¼ˆè¿æ¥ä¸¤ä¸ªä¸­å¿ƒçš„å‘é‡ï¼‰
        const dx = center2.x - center1.x;
        const dy = center2.y - center1.y;
        const norm = Math.sqrt(dx * dx + dy * dy);

        // å½’ä¸€åŒ–æ³•å‘é‡
        const nx = dx / norm;
        const ny = dy / norm;

        // åˆ†å‰²çº¿é€šè¿‡ä¸¤ä¸ªä¸­å¿ƒçš„ä¸­ç‚¹
        const midX = (center1.x + center2.x) / 2;
        const midY = (center1.y + center2.y) / 2;

        // è¶…å¹³é¢æ–¹ç¨‹: ax + by + c = 0
        svmData.hyperplane = {
            a: nx,
            b: ny,
            c: -(nx * midX + ny * midY)
        };

        // æ‰¾åˆ°æ”¯æŒå‘é‡ï¼ˆè·ç¦»è¶…å¹³é¢æœ€è¿‘çš„ç‚¹ï¼‰
        svmData.supportVectors = [];

        const distances = svmData.points.map((point, idx) => {
            const dist = Math.abs(point.x * nx + point.y * ny + svmData.hyperplane.c);
            return { idx, dist, class: point.class };
        });

        // æ¯ç±»é€‰æ‹©æœ€è¿‘çš„å‡ ä¸ªç‚¹ä½œä¸ºæ”¯æŒå‘é‡
        const class1Distances = distances.filter(d => svmData.points[d.idx].class === 1)
            .sort((a, b) => a.dist - b.dist);
        const class2Distances = distances.filter(d => svmData.points[d.idx].class === -1)
            .sort((a, b) => a.dist - b.dist);

        // é€‰æ‹©æœ€è¿‘çš„3ä¸ªç‚¹ä½œä¸ºæ”¯æŒå‘é‡
        class1Distances.slice(0, 3).forEach(d => svmData.supportVectors.push(d.idx));
        class2Distances.slice(0, 3).forEach(d => svmData.supportVectors.push(d.idx));

        drawSVM();

        // åœ¨ç”»å¸ƒä¸Šæ˜¾ç¤ºå®Œæˆä¿¡æ¯
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#34d399';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('SVMè®­ç»ƒå®Œæˆï¼', canvas.width / 2, 30);
    }

    function showSupportVectors() {
        drawSVM(true);
    }

    function animateMargin() {
        if (svmData.animationRunning || svmData.points.length === 0) return;

        svmData.animationRunning = true;
        const canvas = document.getElementById('svmCanvas');
        const ctx = canvas.getContext('2d');

        let marginWidth = 0;
        const maxMargin = 100;
        const animationSpeed = 2;

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶æ•°æ®ç‚¹
            svmData.points.forEach((point, idx) => {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 8, 0, Math.PI * 2);

                if (svmData.supportVectors.includes(idx)) {
                    ctx.strokeStyle = '#fbbf24';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                }

                ctx.fillStyle = point.class === 1 ? '#4facfe' : '#f472b6';
                ctx.fill();
            });

            // ç»˜åˆ¶è¶…å¹³é¢å’Œé—´éš”
            const { a, b, c } = svmData.hyperplane;

            // ä¸»åˆ†å‰²çº¿
            ctx.strokeStyle = '#00f2fe';
            ctx.lineWidth = 3;
            ctx.beginPath();

            if (Math.abs(b) > 0.01) {
                const x1 = 0;
                const y1 = -(a * x1 + c) / b;
                const x2 = canvas.width;
                const y2 = -(a * x2 + c) / b;
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
            } else {
                const x = -c / a;
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
            }
            ctx.stroke();

            // åŠ¨ç”»é—´éš”çº¿
            ctx.strokeStyle = `rgba(251, 191, 36, ${1 - marginWidth / maxMargin})`;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);

            // ä¸Šé—´éš”çº¿
            ctx.beginPath();
            if (Math.abs(b) > 0.01) {
                const x1 = 0;
                const y1 = -(a * x1 + c - marginWidth) / b;
                const x2 = canvas.width;
                const y2 = -(a * x2 + c - marginWidth) / b;
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
            }
            ctx.stroke();

            // ä¸‹é—´éš”çº¿
            ctx.beginPath();
            if (Math.abs(b) > 0.01) {
                const x1 = 0;
                const y1 = -(a * x1 + c + marginWidth) / b;
                const x2 = canvas.width;
                const y2 = -(a * x2 + c + marginWidth) / b;
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
            }
            ctx.stroke();

            ctx.setLineDash([]);

            // æ˜¾ç¤ºé—´éš”å®½åº¦
            ctx.fillStyle = '#fbbf24';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`é—´éš”å®½åº¦: ${(marginWidth * 2).toFixed(0)}`, canvas.width / 2, canvas.height - 20);

            marginWidth += animationSpeed;

            if (marginWidth < maxMargin) {
                requestAnimationFrame(animate);
            } else {
                // åŠ¨ç”»ç»“æŸï¼Œæ¢å¤æ­£å¸¸æ˜¾ç¤º
                setTimeout(() => {
                    drawSVM(true);
                    svmData.animationRunning = false;
                }, 500);
            }
        }

        animate();
    }

    function drawSVM(showSupport = false) {
        const canvas = document.getElementById('svmCanvas');
        const ctx = canvas.getContext('2d');

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (svmData.hyperplane.a !== 0 || svmData.hyperplane.b !== 0) {
            const { a, b, c } = svmData.hyperplane;

            // ç»˜åˆ¶åˆ†å‰²çº¿
            ctx.strokeStyle = '#00f2fe';
            ctx.lineWidth = 3;
            ctx.beginPath();

            if (Math.abs(b) > 0.01) {
                // è®¡ç®—ä¸ç”»å¸ƒè¾¹ç•Œçš„äº¤ç‚¹
                const x1 = 0;
                const y1 = -(a * x1 + c) / b;
                const x2 = canvas.width;
                const y2 = -(a * x2 + c) / b;
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
            } else {
                // å‚ç›´çº¿
                const x = -c / a;
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
            }
            ctx.stroke();

            // ç»˜åˆ¶é—´éš”çº¿
            if (showSupport && svmData.supportVectors.length > 0) {
                // è®¡ç®—é—´éš”å®½åº¦
                let minDist = Infinity;
                svmData.supportVectors.forEach(idx => {
                    const point = svmData.points[idx];
                    const dist = Math.abs(a * point.x + b * point.y + c) / Math.sqrt(a * a + b * b);
                    minDist = Math.min(minDist, dist);
                });

                ctx.strokeStyle = '#fbbf24';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);

                // ä¸Šé—´éš”
                ctx.beginPath();
                if (Math.abs(b) > 0.01) {
                    const margin = minDist * Math.sqrt(a * a + b * b);
                    const x1 = 0;
                    const y1 = -(a * x1 + c - margin) / b;
                    const x2 = canvas.width;
                    const y2 = -(a * x2 + c - margin) / b;
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                }
                ctx.stroke();

                // ä¸‹é—´éš”
                ctx.beginPath();
                if (Math.abs(b) > 0.01) {
                    const margin = minDist * Math.sqrt(a * a + b * b);
                    const x1 = 0;
                    const y1 = -(a * x1 + c + margin) / b;
                    const x2 = canvas.width;
                    const y2 = -(a * x2 + c + margin) / b;
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                }
                ctx.stroke();

                ctx.setLineDash([]);
            }
        }

        // ç»˜åˆ¶æ•°æ®ç‚¹
        svmData.points.forEach((point, idx) => {
            ctx.beginPath();
            ctx.arc(point.x, point.y, 8, 0, Math.PI * 2);

            if (showSupport && svmData.supportVectors.includes(idx)) {
                ctx.strokeStyle = '#fbbf24';
                ctx.lineWidth = 3;
                ctx.stroke();
            }

            ctx.fillStyle = point.class === 1 ? '#4facfe' : '#f472b6';
            ctx.fill();
        });
    }

    // é›†æˆå­¦ä¹ æ¼”ç¤º
    let ensembleData = {
        data: [],
        trees: [],
        predictions: [],
        singleTreePred: [],
        forestPred: []
    };

    function updateEnsemble() {
        const nTrees = document.getElementById('nTrees').value;
        document.getElementById('nTreesValue').textContent = nTrees;

        if (ensembleData.data.length > 0) {
            trainRandomForest();
        }
    }

    function updateSampleRate() {
        const rate = document.getElementById('sampleRate').value;
        document.getElementById('sampleRateValue').textContent = rate;
    }

    function generateEnsembleData() {
        const canvas = document.getElementById('ensembleCanvas');
        const ctx = canvas.getContext('2d');

        ensembleData.data = [];

        // ç”Ÿæˆéçº¿æ€§å¯åˆ†çš„æ•°æ®ï¼ˆæœˆç‰™å½¢ï¼‰
        const numSamples = 200;

        // ç¬¬ä¸€ä¸ªæœˆç‰™
        for (let i = 0; i < numSamples / 2; i++) {
            const angle = Math.random() * Math.PI;
            const r = 150 + (Math.random() - 0.5) * 50;
            ensembleData.data.push({
                x: 200 + r * Math.cos(angle),
                y: 250 + r * Math.sin(angle),
                label: 0
            });
        }

        // ç¬¬äºŒä¸ªæœˆç‰™
        for (let i = 0; i < numSamples / 2; i++) {
            const angle = Math.random() * Math.PI + Math.PI;
            const r = 150 + (Math.random() - 0.5) * 50;
            ensembleData.data.push({
                x: 400 + r * Math.cos(angle),
                y: 150 + r * Math.sin(angle),
                label: 1
            });
        }

        // æ·»åŠ ä¸€äº›å™ªå£°ç‚¹
        for (let i = 0; i < 20; i++) {
            ensembleData.data.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                label: Math.random() > 0.5 ? 1 : 0
            });
        }

        // ç»˜åˆ¶æ•°æ®
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ensembleData.data.forEach(point => {
            ctx.beginPath();
            ctx.arc(point.x, point.y, 4, 0, Math.PI * 2);
            ctx.fillStyle = point.label === 0 ? '#4facfe' : '#f472b6';
            ctx.fill();
        });

        ctx.fillStyle = '#34d399';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('æ•°æ®ç”Ÿæˆå®Œæˆï¼è¿™æ˜¯ä¸€ä¸ªéçº¿æ€§å¯åˆ†çš„æ•°æ®é›†', canvas.width / 2, 30);
    }

    function trainSingleTree() {
        if (ensembleData.data.length === 0) {
            generateEnsembleData();
            return;
        }

        const canvas = document.getElementById('ensembleCanvas');
        const ctx = canvas.getContext('2d');

        // æ¨¡æ‹Ÿå•æ£µå†³ç­–æ ‘çš„é¢„æµ‹ï¼ˆç®€å•çš„çº¿æ€§åˆ†å‰²ï¼‰
        ensembleData.singleTreePred = [];

        // ç®€å•çš„å†³ç­–è¾¹ç•Œï¼šæ–œçº¿
        const slope = -0.8;
        const intercept = 350;

        ensembleData.data.forEach(point => {
            const prediction = point.y < slope * point.x + intercept ? 0 : 1;
            ensembleData.singleTreePred.push(prediction);
        });

        // è®¡ç®—å‡†ç¡®ç‡
        let correct = 0;
        ensembleData.data.forEach((point, idx) => {
            if (point.label === ensembleData.singleTreePred[idx]) correct++;
        });
        const accuracy = (correct / ensembleData.data.length * 100).toFixed(1);

        document.getElementById('singleAccuracy').textContent = accuracy + '%';

        // ç»˜åˆ¶å†³ç­–è¾¹ç•Œ
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ç»˜åˆ¶å†³ç­–åŒºåŸŸ
        for (let x = 0; x < canvas.width; x += 10) {
            for (let y = 0; y < canvas.height; y += 10) {
                const pred = y < slope * x + intercept ? 0 : 1;
                ctx.fillStyle = pred === 0 ? 'rgba(79, 172, 254, 0.1)' : 'rgba(244, 114, 182, 0.1)';
                ctx.fillRect(x, y, 10, 10);
            }
        }

        // é‡æ–°ç»˜åˆ¶æ•°æ®ç‚¹
        ensembleData.data.forEach(point => {
            ctx.beginPath();
            ctx.arc(point.x, point.y, 4, 0, Math.PI * 2);
            ctx.fillStyle = point.label === 0 ? '#4facfe' : '#f472b6';
            ctx.fill();
        });

        // ç»˜åˆ¶å†³ç­–è¾¹ç•Œçº¿
        ctx.strokeStyle = '#fbbf24';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(0, intercept);
        ctx.lineTo(canvas.width, slope * canvas.width + intercept);
        ctx.stroke();

        ctx.fillStyle = '#34d399';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('å•æ£µå†³ç­–æ ‘è®­ç»ƒå®Œæˆï¼æ³¨æ„çº¿æ€§è¾¹ç•Œçš„å±€é™æ€§', canvas.width / 2, canvas.height - 20);
    }

    function trainRandomForest() {
        if (ensembleData.data.length === 0) {
            generateEnsembleData();
            return;
        }

        const canvas = document.getElementById('ensembleCanvas');
        const ctx = canvas.getContext('2d');
        const nTrees = parseInt(document.getElementById('nTrees').value);
        const sampleRate = parseFloat(document.getElementById('sampleRate').value);

        // è®­ç»ƒå¤šæ£µæ ‘
        ensembleData.trees = [];

        for (let t = 0; t < nTrees; t++) {
            // Bootstrapé‡‡æ ·
            const sampledData = [];
            const sampleSize = Math.floor(ensembleData.data.length * sampleRate);

            for (let i = 0; i < sampleSize; i++) {
                const idx = Math.floor(Math.random() * ensembleData.data.length);
                sampledData.push(ensembleData.data[idx]);
            }

            // æ¯æ£µæ ‘ä½¿ç”¨ä¸åŒçš„éšæœºå†³ç­–è¾¹ç•Œ
            const tree = {
                type: Math.random() > 0.5 ? 'linear' : 'circular',
                params: {}
            };

            if (tree.type === 'linear') {
                // éšæœºçº¿æ€§è¾¹ç•Œ
                tree.params.slope = (Math.random() - 0.5) * 2;
                tree.params.intercept = Math.random() * canvas.height;
            } else {
                // éšæœºåœ†å½¢è¾¹ç•Œ
                tree.params.centerX = Math.random() * canvas.width;
                tree.params.centerY = Math.random() * canvas.height;
                tree.params.radius = 50 + Math.random() * 150;
            }

            ensembleData.trees.push(tree);
        }

        // é›†æˆé¢„æµ‹ï¼ˆæŠ•ç¥¨ï¼‰
        ensembleData.forestPred = [];

        ensembleData.data.forEach((point, idx) => {
            const votes = { 0: 0, 1: 0 };

            ensembleData.trees.forEach(tree => {
                let prediction;
                if (tree.type === 'linear') {
                    prediction = point.y < tree.params.slope * point.x + tree.params.intercept ? 0 : 1;
                } else {
                    const dist = Math.sqrt(
                        Math.pow(point.x - tree.params.centerX, 2) +
                        Math.pow(point.y - tree.params.centerY, 2)
                    );
                    prediction = dist < tree.params.radius ? 0 : 1;
                }
                votes[prediction]++;
            });

            ensembleData.forestPred.push(votes[0] > votes[1] ? 0 : 1);
        });

        // è®¡ç®—å‡†ç¡®ç‡
        let correct = 0;
        ensembleData.data.forEach((point, idx) => {
            if (point.label === ensembleData.forestPred[idx]) correct++;
        });
        const accuracy = (correct / ensembleData.data.length * 100).toFixed(1);

        document.getElementById('forestAccuracy').textContent = accuracy + '%';

        // è®¡ç®—æå‡
        const singleAcc = parseFloat(document.getElementById('singleAccuracy').textContent) || 0;
        const improvement = accuracy - singleAcc;
        document.getElementById('improvement').textContent = improvement > 0 ? `+${improvement.toFixed(1)}%` : `${improvement.toFixed(1)}%`;

        // ç»˜åˆ¶é›†æˆå†³ç­–è¾¹ç•Œ
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ç»˜åˆ¶å†³ç­–åŒºåŸŸï¼ˆä½¿ç”¨é›†æˆæŠ•ç¥¨ï¼‰
        for (let x = 0; x < canvas.width; x += 5) {
            for (let y = 0; y < canvas.height; y += 5) {
                const votes = { 0: 0, 1: 0 };

                ensembleData.trees.forEach(tree => {
                    let prediction;
                    if (tree.type === 'linear') {
                        prediction = y < tree.params.slope * x + tree.params.intercept ? 0 : 1;
                    } else {
                        const dist = Math.sqrt(
                            Math.pow(x - tree.params.centerX, 2) +
                            Math.pow(y - tree.params.centerY, 2)
                        );
                        prediction = dist < tree.params.radius ? 0 : 1;
                    }
                    votes[prediction]++;
                });

                const finalPred = votes[0] > votes[1] ? 0 : 1;
                const confidence = Math.max(votes[0], votes[1]) / nTrees;
                const alpha = 0.1 + 0.2 * confidence;

                ctx.fillStyle = finalPred === 0 ?
                    `rgba(79, 172, 254, ${alpha})` :
                    `rgba(244, 114, 182, ${alpha})`;
                ctx.fillRect(x, y, 5, 5);
            }
        }

        // é‡æ–°ç»˜åˆ¶æ•°æ®ç‚¹
        ensembleData.data.forEach(point => {
            ctx.beginPath();
            ctx.arc(point.x, point.y, 4, 0, Math.PI * 2);
            ctx.fillStyle = point.label === 0 ? '#4facfe' : '#f472b6';
            ctx.fill();

            // æ ‡è®°é”™è¯¯åˆ†ç±»çš„ç‚¹
            const idx = ensembleData.data.indexOf(point);
            if (point.label !== ensembleData.forestPred[idx]) {
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        });

        ctx.fillStyle = '#34d399';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(`éšæœºæ£®æ—è®­ç»ƒå®Œæˆï¼${nTrees}æ£µæ ‘çš„é›†æˆæ•ˆæœ`, canvas.width / 2, canvas.height - 20);
    }

    function compareResults() {
        if (ensembleData.singleTreePred.length === 0 || ensembleData.forestPred.length === 0) {
            console.log('è¯·å…ˆè®­ç»ƒå•æ ‘å’Œéšæœºæ£®æ—');
            return;
        }

        const canvas = document.getElementById('ensembleCanvas');
        const ctx = canvas.getContext('2d');

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // å·¦åŠéƒ¨åˆ†æ˜¾ç¤ºå•æ ‘ç»“æœ
        ctx.save();
        ctx.beginPath();
        ctx.rect(0, 0, canvas.width / 2, canvas.height);
        ctx.clip();

        // ç»˜åˆ¶å•æ ‘å†³ç­–è¾¹ç•Œ
        const slope = -0.8;
        const intercept = 350;

        for (let x = 0; x < canvas.width / 2; x += 10) {
            for (let y = 0; y < canvas.height; y += 10) {
                const pred = y < slope * x + intercept ? 0 : 1;
                ctx.fillStyle = pred === 0 ? 'rgba(79, 172, 254, 0.2)' : 'rgba(244, 114, 182, 0.2)';
                ctx.fillRect(x, y, 10, 10);
            }
        }

        // ç»˜åˆ¶æ•°æ®ç‚¹ï¼ˆå·¦åŠéƒ¨åˆ†ï¼‰
        ensembleData.data.forEach((point, idx) => {
            if (point.x < canvas.width / 2) {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 4, 0, Math.PI * 2);
                ctx.fillStyle = point.label === 0 ? '#4facfe' : '#f472b6';
                ctx.fill();

                if (point.label !== ensembleData.singleTreePred[idx]) {
                    ctx.strokeStyle = '#ef4444';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
        });

        ctx.restore();

        // å³åŠéƒ¨åˆ†æ˜¾ç¤ºéšæœºæ£®æ—ç»“æœ
        ctx.save();
        ctx.beginPath();
        ctx.rect(canvas.width / 2, 0, canvas.width / 2, canvas.height);
        ctx.clip();

        // ç»˜åˆ¶é›†æˆå†³ç­–è¾¹ç•Œ
        const nTrees = ensembleData.trees.length;
        for (let x = canvas.width / 2; x < canvas.width; x += 5) {
            for (let y = 0; y < canvas.height; y += 5) {
                const votes = { 0: 0, 1: 0 };

                ensembleData.trees.forEach(tree => {
                    let prediction;
                    if (tree.type === 'linear') {
                        prediction = y < tree.params.slope * x + tree.params.intercept ? 0 : 1;
                    } else {
                        const dist = Math.sqrt(
                            Math.pow(x - tree.params.centerX, 2) +
                            Math.pow(y - tree.params.centerY, 2)
                        );
                        prediction = dist < tree.params.radius ? 0 : 1;
                    }
                    votes[prediction]++;
                });

                const finalPred = votes[0] > votes[1] ? 0 : 1;
                ctx.fillStyle = finalPred === 0 ? 'rgba(79, 172, 254, 0.3)' : 'rgba(244, 114, 182, 0.3)';
                ctx.fillRect(x, y, 5, 5);
            }
        }

        // ç»˜åˆ¶æ•°æ®ç‚¹ï¼ˆå³åŠéƒ¨åˆ†ï¼‰
        ensembleData.data.forEach((point, idx) => {
            if (point.x >= canvas.width / 2) {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 4, 0, Math.PI * 2);
                ctx.fillStyle = point.label === 0 ? '#4facfe' : '#f472b6';
                ctx.fill();

                if (point.label !== ensembleData.forestPred[idx]) {
                    ctx.strokeStyle = '#ef4444';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
        });

        ctx.restore();

        // ç»˜åˆ¶åˆ†å‰²çº¿
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(canvas.width / 2, 0);
        ctx.lineTo(canvas.width / 2, canvas.height);
        ctx.stroke();

        // æ·»åŠ æ ‡ç­¾
        ctx.fillStyle = '#e8eaed';
        ctx.font = 'bold 18px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('å•æ£µå†³ç­–æ ‘', canvas.width / 4, 30);
        ctx.fillText('éšæœºæ£®æ—', 3 * canvas.width / 4, 30);

        // æ˜¾ç¤ºå‡†ç¡®ç‡
        ctx.font = '16px Arial';
        ctx.fillStyle = '#fbbf24';
        ctx.fillText(`å‡†ç¡®ç‡: ${document.getElementById('singleAccuracy').textContent}`, canvas.width / 4, canvas.height - 20);
        ctx.fillText(`å‡†ç¡®ç‡: ${document.getElementById('forestAccuracy').textContent}`, 3 * canvas.width / 4, canvas.height - 20);
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        // åˆ›å»ºç²’å­èƒŒæ™¯
        new ParticleSystem('particleSystem');

        // åˆå§‹åŒ–è¿›åº¦
        updateProgress();

        // åˆå§‹åŒ–è´å¶æ–¯æ•°æ®
        const spamWords = ['free', 'win', 'click', 'buy', 'offer', 'prize', 'congratulations', 'limited'];
        const hamWords = ['meeting', 'project', 'report', 'work', 'team', 'schedule', 'deadline', 'update'];

        bayesData.wordFreq = {
            spam: {},
            ham: {}
        };

        spamWords.forEach(word => {
            bayesData.wordFreq.spam[word] = 0.6 + Math.random() * 0.3;
        });

        hamWords.forEach(word => {
            bayesData.wordFreq.ham[word] = 0.7 + Math.random() * 0.25;
        });

        // æ·»åŠ ä¸€äº›äº¤å‰è¯æ±‡
        ['click', 'update'].forEach(word => {
            bayesData.wordFreq.ham[word] = 0.3 + Math.random() * 0.2;
        });

        drawBayesVisualization();

        // åˆå§‹åŒ–SVMæ•°æ®
        generateSVMData();

        // åˆå§‹åŒ–å„ä¸ªæ¼”ç¤ºçš„ç”»å¸ƒ
        ['treeCanvas', 'ensembleCanvas'].forEach(canvasId => {
            const canvas = document.getElementById(canvasId);
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#8b98a8';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ¼”ç¤º', canvas.width / 2, canvas.height / 2);
            }
        });
    });
</script>

</body>
</html>