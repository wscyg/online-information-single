<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬2ç« ï¼šè¯¯å·®åå‘ä¼ æ’­ - æ·±åº¦ç½‘ç»œçš„è¡€è„‰ | æ·±åº¦å­¦ä¹ ä¹‹æ—…</title>
    <meta name="description" content="ä»æ‰‹æ¨æ¢¯åº¦åˆ°è‡ªåŠ¨å¾®åˆ†ï¼šæ¢ç´¢æ·±åº¦å­¦ä¹ æœ€é‡è¦çš„ç®—æ³•ï¼Œç†è§£è¯¯å·®å¦‚ä½•åœ¨ç½‘ç»œä¸­åå‘æµåŠ¨">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <style>
        /* ===== CSSå˜é‡å®šä¹‰ ===== */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-dark: #0f172a;
            --bg-section: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #e2e8f0;
            --text-muted: #cbd5e1;
            --accent-red: #ef4444;
            --accent-green: #22c55e;
            --accent-blue: #06b6d4;
            --accent-yellow: #fbbf24;
            --accent-purple: #8b5cf6;
            --accent-pink: #ec4899;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.3);
            --animation-duration: 0.3s;
            --content-max-width: 1200px;
            --focus-ring: 0 0 0 3px rgba(139, 92, 246, 0.5);
        }

        /* äº®è‰²ä¸»é¢˜ */
        [data-theme="light"] {
            --bg-dark: #ffffff;
            --bg-section: #f8fafc;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        /* ===== å…¨å±€æ ·å¼ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color var(--animation-duration) ease;
        }

        /* ===== ç„¦ç‚¹æ ·å¼ ===== */
        :focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
            border-radius: 0.25rem;
        }

        button:focus-visible,
        a:focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
        }

        /* ===== å¸ƒå±€ç»„ä»¶ ===== */
        .container {
            max-width: var(--content-max-width);
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* ===== å¯¼èˆªæ  ===== */
        .nav-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border-bottom: 1px solid var(--border-color);
            transition: transform 0.3s ease;
        }

        .nav-header.hidden {
            transform: translateY(-100%);
        }

        .nav-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 0;
        }

        .nav-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-title h1 {
            font-size: 1.25rem;
            font-weight: 600;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn-control {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            position: relative;
        }

        .btn-control:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .nav-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
        }

        .progress-bar {
            height: 100%;
            background: var(--primary-gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ===== éš¾åº¦é€‰æ‹©å™¨ ===== */
        .difficulty-selector {
            position: fixed;
            right: 20px;
            top: 80px;
            background: var(--bg-section);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            z-index: 999;
            box-shadow: var(--shadow-lg);
        }

        .difficulty-selector h4 {
            color: var(--accent-purple);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .difficulty-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
        }

        .difficulty-option:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .difficulty-option.active {
            background: rgba(139, 92, 246, 0.2);
            color: var(--accent-purple);
        }

        .difficulty-option input[type="radio"] {
            display: none;
        }

        /* ===== ä¾§è¾¹å¯¼èˆª ===== */
        .sidebar {
            position: fixed;
            left: -300px;
            top: 60px;
            bottom: 0;
            width: 300px;
            background: var(--bg-section);
            border-right: 1px solid var(--border-color);
            padding: 2rem;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 999;
        }

        .sidebar.open {
            transform: translateX(300px);
        }

        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 998;
        }

        .sidebar-overlay.active {
            display: block;
        }

        .toc-item {
            display: block;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
            margin-bottom: 0.25rem;
        }

        .toc-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .toc-item.active {
            background: var(--primary-gradient);
            color: white;
        }

        /* ===== å­¦ä¹ ä¼™ä¼´ç³»ç»Ÿ ===== */
        .learning-buddy {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background: var(--bg-section);
            border: 2px solid var(--accent-purple);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            z-index: 900;
            transform: translateY(400px);
            transition: transform 0.5s ease;
        }

        .learning-buddy.active {
            transform: translateY(0);
        }

        .learning-buddy.minimized {
            width: auto;
            padding: 0;
            border-radius: 50%;
            overflow: hidden;
        }

        .learning-buddy.minimized .buddy-content {
            display: none;
        }

        .learning-buddy.minimized .buddy-avatar {
            margin: 0;
            cursor: pointer;
        }

        .buddy-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .buddy-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            flex-shrink: 0;
        }

        .buddy-controls {
            display: flex;
            gap: 0.5rem;
        }

        .buddy-control-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .buddy-control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .buddy-message {
            background: rgba(139, 92, 246, 0.1);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .buddy-message::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(139, 92, 246, 0.1);
        }

        /* ===== ä¸»å†…å®¹åŒº ===== */
        main {
            margin-top: 80px;
            padding-bottom: 4rem;
        }

        /* ===== ç« èŠ‚å¡ç‰‡ ===== */
        .chapter-hero {
            background: var(--primary-gradient);
            padding: 4rem 0;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }

        .chapter-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: pulse 10s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        .chapter-hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: white;
        }

        .chapter-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: fadeInUp 0.8s ease;
        }

        .chapter-hero p {
            font-size: 1.25rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            animation: fadeInUp 0.8s ease 0.2s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== å†…å®¹åŒºå— ===== */
        .section-card {
            background: var(--bg-section);
            border-radius: 1rem;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            transition: transform var(--animation-duration) ease;
            scroll-margin-top: 100px;
        }

        .section-card:hover {
            transform: translateY(-2px);
        }

        /* ===== å­¦ä¹ å¾ªç¯æŒ‡ç¤ºå™¨ ===== */
        .learning-loop {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 3rem;
            padding: 1.5rem;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 1rem;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .loop-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
            position: relative;
        }

        .loop-step.active {
            background: rgba(139, 92, 246, 0.2);
            transform: scale(1.1);
        }

        .loop-step .icon {
            font-size: 2rem;
        }

        .loop-step .label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .loop-connector {
            position: absolute;
            top: 50%;
            right: -2rem;
            width: 2rem;
            height: 2px;
            background: rgba(139, 92, 246, 0.3);
        }

        /* ===== æ•…äº‹å¡ç‰‡ ===== */
        .story-card {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(245, 158, 11, 0.1));
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 2px solid rgba(251, 191, 36, 0.2);
            position: relative;
            overflow: hidden;
        }

        .story-card::before {
            content: 'ğŸŒ™';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 5rem;
            opacity: 0.1;
            transform: rotate(15deg);
        }

        /* ===== äººç‰©å¯¹è¯ ===== */
        .dialogue-container {
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.75rem;
        }

        .dialogue-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            animation: slideIn 0.5s ease;
        }

        .dialogue-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .dialogue-avatar.student {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
        }

        .dialogue-avatar.teacher {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
        }

        .dialogue-avatar.friend {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .dialogue-content {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 0.5rem;
            position: relative;
        }

        .dialogue-content::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 15px;
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-right: 8px solid rgba(255, 255, 255, 0.05);
        }

        .dialogue-name {
            font-weight: bold;
            color: var(--accent-purple);
            margin-bottom: 0.25rem;
        }

        /* ===== æ¦‚å¿µå¡ç‰‡ç½‘æ ¼ ===== */
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .concept-card {
            padding: 1.5rem;
            border-radius: 0.75rem;
            transition: all var(--animation-duration) ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .concept-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform var(--animation-duration) ease;
        }

        .concept-card:hover::before {
            transform: scaleX(1);
        }

        .concept-card.why {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .concept-card.what {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .concept-card.how {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .concept-card.pitfall {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        /* ===== æ•°å­¦æ¨å¯¼å®¹å™¨ ===== */
        .math-derivation {
            background: rgba(79, 70, 229, 0.05);
            border: 1px solid rgba(79, 70, 229, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
        }

        .math-step {
            margin: 1.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .math-step::before {
            content: attr(data-step);
            position: absolute;
            left: 0;
            top: 0;
            width: 24px;
            height: 24px;
            background: var(--accent-purple);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: bold;
        }

        .math-explanation {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 0.5rem;
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        /* ===== äº¤äº’å¼å¯è§†åŒ– ===== */
        .interactive-demo {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
        }

        .demo-controls {
            display: flex;
            gap: 2rem;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        input[type="range"] {
            width: 150px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary-gradient);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider-value {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-family: monospace;
            min-width: 50px;
            text-align: center;
        }

        canvas {
            display: block;
            margin: 0 auto;
            border-radius: 0.5rem;
            background: rgba(0, 0, 0, 0.2);
            cursor: crosshair;
        }

        /* ===== å³æ—¶ç»ƒä¹  ===== */
        .instant-practice {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
        }

        .practice-question {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .practice-options {
            display: grid;
            gap: 1rem;
        }

        .practice-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 0.5rem;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            position: relative;
            overflow: hidden;
            text-align: left;
            width: 100%;
        }

        .practice-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(4px);
        }

        .practice-option.selected {
            border-color: var(--accent-blue);
        }

        .practice-option.correct {
            background: rgba(34, 197, 94, 0.2);
            border-color: var(--accent-green);
        }

        .practice-option.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--accent-red);
        }

        .practice-feedback {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 0.5rem;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .practice-feedback.show {
            display: block;
        }

        .practice-feedback.correct {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: var(--accent-green);
        }

        .practice-feedback.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--accent-red);
        }

        /* ===== å¸¸è§é”™è¯¯ä¸“æ  ===== */
        .common-mistakes {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
        }

        .mistake-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.5rem;
        }

        .mistake-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .mistake-content h4 {
            color: var(--accent-red);
            margin-bottom: 0.5rem;
        }

        /* ===== ä»£ç å®¹å™¨ ===== */
        .code-container {
            margin: 2rem 0;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .code-header {
            background: #1a1a2e;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .code-header-right {
            display: flex;
            gap: 0.5rem;
        }

        .code-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
        }

        .code-tab.active {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .code-action {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .code-action:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .code-content {
            background: #0d1117;
            overflow-x: auto;
        }

        .code-content pre {
            margin: 0;
            padding: 1.5rem;
        }

        .code-content code {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .code-output {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.875rem;
            display: none;
        }

        .code-output.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== å­¦ä¹ è·¯å¾„æ¨è ===== */
        .learning-path {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1));
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
        }

        .path-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin: 0.5rem 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
            cursor: pointer;
        }

        .path-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(4px);
        }

        .path-item.completed {
            opacity: 0.6;
        }

        .path-item.current {
            border: 2px solid var(--accent-purple);
            background: rgba(139, 92, 246, 0.1);
        }

        .path-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .path-content h4 {
            color: var(--accent-purple);
            margin-bottom: 0.25rem;
        }

        .path-content p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* ===== æç¤ºæ¡† ===== */
        .tip {
            display: flex;
            gap: 1rem;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin: 1.5rem 0;
        }

        .tip-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .tip-content {
            flex: 1;
        }

        .tip.info {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .tip.warning {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .tip.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .tip.success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        /* ===== æ·±åº¦æŒ‡ç¤ºå™¨ ===== */
        .depth-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 20px;
            font-size: 0.875rem;
            margin-left: 1rem;
        }

        .depth-indicator.beginner {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
            color: var(--accent-green);
        }

        .depth-indicator.intermediate {
            background: rgba(251, 191, 36, 0.1);
            border-color: rgba(251, 191, 36, 0.3);
            color: var(--accent-yellow);
        }

        .depth-indicator.advanced {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: var(--accent-red);
        }

        /* ===== å¯æŠ˜å å†…å®¹ ===== */
        .collapsible {
            margin: 1.5rem 0;
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .collapsible-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: background var(--animation-duration) ease;
            user-select: none;
        }

        .collapsible-header:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .collapsible-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
        }

        .collapsible-icon {
            transition: transform var(--animation-duration) ease;
        }

        .collapsible.expanded .collapsible-icon {
            transform: rotate(180deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--animation-duration) ease;
        }

        .collapsible.expanded .collapsible-content {
            max-height: 2000px;
        }

        .collapsible-inner {
            padding: 1.5rem;
        }

        /* ===== æŒ‰é’®æ ·å¼ ===== */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* ===== å­¦ä¹ æˆå°±ç³»ç»Ÿ ===== */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: -400px;
            width: 350px;
            background: var(--bg-section);
            border: 2px solid var(--accent-yellow);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: right 0.5s ease;
        }

        .achievement-popup.show {
            right: 20px;
        }

        .achievement-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .achievement-icon {
            width: 60px;
            height: 60px;
            background: var(--accent-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .achievement-content h3 {
            color: var(--accent-yellow);
            margin-bottom: 0.25rem;
        }

        /* ===== é€šçŸ¥æ ·å¼ ===== */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--accent-green);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ===== å“åº”å¼è®¾è®¡ ===== */
        @media (max-width: 1024px) {
            .chapter-hero h1 {
                font-size: 2.5rem;
            }

            .concept-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .difficulty-selector {
                top: auto;
                bottom: 80px;
            }
        }

        @media (max-width: 768px) {
            .nav-title h1 {
                font-size: 1rem;
            }

            .section-card {
                padding: 1.5rem;
            }

            .chapter-hero {
                padding: 3rem 0;
            }

            .chapter-hero h1 {
                font-size: 2rem;
            }

            .chapter-hero p {
                font-size: 1rem;
            }

            .learning-loop {
                flex-direction: column;
                gap: 1rem;
            }

            .loop-connector {
                display: none;
            }

            .demo-controls {
                flex-direction: column;
                align-items: stretch;
            }

            input[type="range"] {
                width: 100%;
            }

            .learning-buddy {
                width: 90%;
                left: 5%;
                right: 5%;
            }
        }

        /* ===== æ‰“å°æ ·å¼ ===== */
        @media print {
            .nav-header,
            .sidebar,
            .btn,
            .demo-controls,
            .code-action,
            .difficulty-selector,
            .learning-buddy {
                display: none;
            }

            .section-card {
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }

            body {
                background: white;
                color: black;
            }
        }

        /* ===== åŠ¨ç”»ä¼˜åŒ– ===== */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ===== å·¥å…·ç±» ===== */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }

        /* ===== åŠ è½½åŠ¨ç”» ===== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-purple);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ===== æ¢¯åº¦æµåŠ¨ç”» ===== */
        .gradient-flow {
            position: relative;
            overflow: hidden;
        }

        .gradient-flow::after {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            right: -100%;
            bottom: -100%;
            background: linear-gradient(
                    45deg,
                    transparent 30%,
                    rgba(139, 92, 246, 0.2) 50%,
                    transparent 70%
            );
            animation: gradientFlow 3s linear infinite;
        }

        @keyframes gradientFlow {
            0% {
                transform: translateX(-100%) translateY(-100%);
            }
            100% {
                transform: translateX(100%) translateY(100%);
            }
        }

        /* ===== ç¥ç»ç½‘ç»œèŠ‚ç‚¹æ ·å¼ ===== */
        .neuron {
            fill: var(--accent-purple);
            stroke: var(--text-primary);
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .neuron:hover {
            fill: var(--accent-pink);
            transform: scale(1.1);
        }

        .neuron.active {
            fill: var(--accent-green);
            animation: pulse 1s ease-in-out infinite;
        }

        .synapse {
            stroke: var(--text-secondary);
            stroke-width: 1.5;
            fill: none;
            opacity: 0.6;
            transition: all 0.3s ease;
        }

        .synapse.active {
            stroke: var(--accent-yellow);
            stroke-width: 3;
            opacity: 1;
            animation: synapseFlow 1s linear infinite;
        }

        @keyframes synapseFlow {
            0% {
                stroke-dasharray: 0 100;
            }
            100% {
                stroke-dasharray: 100 0;
            }
        }

        /* ===== æ‰‹å†™æ•ˆæœ ===== */
        .handwritten {
            font-family: 'Kalam', cursive;
            color: var(--accent-yellow);
            transform: rotate(-2deg);
            display: inline-block;
        }

        /* ===== æ•°å­¦å…¬å¼å®¹å™¨ ===== */
        .equation-container {
            background: rgba(139, 92, 246, 0.05);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
            font-size: 1.1rem;
            overflow-x: auto;
        }

        .equation-label {
            display: inline-block;
            background: var(--accent-purple);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
<!-- å¯¼èˆªæ  -->
<nav class="nav-header" role="navigation" aria-label="ä¸»å¯¼èˆª">
    <div class="container">
        <div class="nav-content">
            <div class="nav-title">
                <button id="toggle-sidebar" class="btn-control" aria-label="åˆ‡æ¢ä¾§è¾¹æ " tabindex="0">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <h1>ç¬¬2ç« ï¼šè¯¯å·®åå‘ä¼ æ’­</h1>
            </div>
            <div class="nav-controls">
                <button id="toggle-buddy" class="btn-control" aria-label="å­¦ä¹ ä¼™ä¼´" tabindex="0">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </button>
                <button id="toggle-theme" class="btn-control" aria-label="åˆ‡æ¢ä¸»é¢˜" tabindex="0">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div class="nav-progress">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
    </div>
</nav>

<!-- éš¾åº¦é€‰æ‹©å™¨ -->
<div class="difficulty-selector">
    <h4>é€‰æ‹©å­¦ä¹ æ·±åº¦</h4>
    <label class="difficulty-option active" tabindex="0">
        <input type="radio" name="difficulty" value="beginner" checked>
        <span>ğŸŒ± åˆå­¦è€…</span>
    </label>
    <label class="difficulty-option" tabindex="0">
        <input type="radio" name="difficulty" value="intermediate">
        <span>ğŸŒ¿ è¿›é˜¶</span>
    </label>
    <label class="difficulty-option" tabindex="0">
        <input type="radio" name="difficulty" value="advanced">
        <span>ğŸŒ³ æ·±å…¥</span>
    </label>
</div>

<!-- ä¾§è¾¹æ  -->
<aside class="sidebar" id="sidebar" role="navigation" aria-label="ç« èŠ‚å¯¼èˆª">
    <h3 style="margin-bottom: 1.5rem; color: var(--accent-purple);">ç›®å½•å¯¼èˆª</h3>
    <nav>
        <a href="#intro" class="toc-item active" tabindex="0">å¼•è¨€ï¼šæ·±å¤œçš„æ‰‹ç®—å™©æ¢¦</a>
        <a href="#problem" class="toc-item" tabindex="0">å‘ç°é—®é¢˜ï¼šæ‰‹æ¨æ¢¯åº¦çš„ç—›è‹¦</a>
        <a href="#history" class="toc-item" tabindex="0">å†å²å›é¡¾ï¼šä»å†·è½åˆ°è¾‰ç…Œ</a>
        <a href="#chain-rule" class="toc-item" tabindex="0">é“¾å¼æ³•åˆ™ï¼šå¾®ç§¯åˆ†çš„é­”æ³•</a>
        <a href="#algorithm" class="toc-item" tabindex="0">BPç®—æ³•ï¼šè¯¯å·®çš„åå‘æµåŠ¨</a>
        <a href="#implementation" class="toc-item" tabindex="0">ä»£ç å®ç°ï¼šä»æ‰‹å†™åˆ°è‡ªåŠ¨</a>
        <a href="#visualization" class="toc-item" tabindex="0">æ¢¯åº¦å¯è§†åŒ–ï¼šçœ‹è§ä¿¡æ¯æµ</a>
        <a href="#experiment" class="toc-item" tabindex="0">å®æˆ˜ï¼šMNISTæ‰‹å†™æ•°å­—è¯†åˆ«</a>
        <a href="#problems" class="toc-item" tabindex="0">å¸¸è§é—®é¢˜ï¼šæ¢¯åº¦æ¶ˆå¤±ä¸çˆ†ç‚¸</a>
        <a href="#biological" class="toc-item" tabindex="0">ç”Ÿç‰©å­¦è§†è§’ï¼šå¤§è„‘å¦‚ä½•å­¦ä¹ </a>
        <a href="#alternatives" class="toc-item" tabindex="0">æ›¿ä»£æ–¹æ¡ˆï¼šè¶…è¶ŠBP</a>
        <a href="#summary" class="toc-item" tabindex="0">æ€»ç»“ï¼šæ·±åº¦å­¦ä¹ çš„å¼•æ“</a>
    </nav>
</aside>

<!-- ä¾§è¾¹æ é®ç½© -->
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<!-- å­¦ä¹ ä¼™ä¼´ç³»ç»Ÿ -->
<div class="learning-buddy" id="learning-buddy">
    <div class="buddy-header">
        <div class="buddy-avatar" id="buddy-avatar">ğŸ¤–</div>
        <div class="buddy-controls">
            <button class="buddy-control-btn" id="minimize-buddy" aria-label="æœ€å°åŒ–" tabindex="0">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </button>
            <button class="buddy-control-btn" id="close-buddy" aria-label="å…³é—­" tabindex="0">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
    </div>
    <div class="buddy-content">
        <div class="buddy-message">
            <p>å—¨ï¼æˆ‘æ˜¯å°æ™ºã€‚åå‘ä¼ æ’­æ˜¯æ·±åº¦å­¦ä¹ çš„æ ¸å¿ƒï¼Œè®©æˆ‘ä»¬ä¸€èµ·å¾æœå®ƒï¼è®°ä½ï¼šæ¢¯åº¦å°±åƒæ°´æµï¼Œæ€»æ˜¯æ²¿ç€æœ€é™¡çš„æ–¹å‘æµåŠ¨ã€‚</p>
        </div>
        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button class="btn btn-secondary" onclick="getBuddyHint()" tabindex="0">ç»™æˆ‘æç¤º</button>
            <button class="btn btn-secondary" onclick="getBuddySummary()" tabindex="0">æ€»ç»“è¦ç‚¹</button>
        </div>
    </div>
</div>

<!-- æˆå°±å¼¹çª— -->
<div class="achievement-popup" id="achievement-popup">
    <div class="achievement-header">
        <div class="achievement-icon">ğŸ†</div>
        <div class="achievement-content">
            <h3>è§£é”æˆå°±ï¼</h3>
            <p id="achievement-text">å®Œæˆç¬¬ä¸€ä¸ªæ¢¯åº¦è®¡ç®—</p>
        </div>
    </div>
    <div class="progress" style="margin-top: 1rem;">
        <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px;">
            <div id="achievement-progress" style="height: 100%; width: 20%; background: var(--accent-yellow); border-radius: 4px;"></div>
        </div>
        <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
            <span id="achievement-count">1</span>/5 å®Œæˆæœ¬ç« å­¦ä¹ 
        </p>
    </div>
</div>

<!-- ä¸»å†…å®¹ -->
<main>
    <!-- ç« èŠ‚æ ‡é¢˜ -->
    <section class="chapter-hero">
        <div class="container">
            <div class="chapter-hero-content">
                <h1>è¯¯å·®åå‘ä¼ æ’­ï¼šæ·±åº¦ç½‘ç»œçš„è¡€è„‰</h1>
                <p>ä»æ‰‹æ¨æ¢¯åº¦åˆ°è‡ªåŠ¨å¾®åˆ† â€”â€” è®©æœºå™¨å­¦ä¼š"è´£ä»»åˆ†æ‘Š"çš„è‰ºæœ¯</p>
                <div class="mt-4">
                    <span style="background: rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: 20px; margin: 0 0.5rem;">
                        âš¡ æ ¸å¿ƒç®—æ³•
                    </span>
                    <span style="background: rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: 20px; margin: 0 0.5rem;">
                        â±ï¸ 90åˆ†é’Ÿ
                    </span>
                    <span style="background: rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: 20px; margin: 0 0.5rem;">
                        ğŸ¯ æ·±åº¦åŸºçŸ³
                    </span>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <!-- å­¦ä¹ ç›®æ ‡ -->
        <section class="section-card">
            <h2 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ“š æœ¬ç« å­¦ä¹ ç›®æ ‡</h2>
            <div class="concept-grid">
                <div class="concept-card what" tabindex="0">
                    <h3 style="color: var(--accent-green); margin-bottom: 0.5rem;">âœ“ ç†è§£æ ¸å¿ƒåŸç†</h3>
                    <p>æŒæ¡é“¾å¼æ³•åˆ™å’Œæ¢¯åº¦åå‘ä¼ æ’­çš„æ•°å­¦åŸºç¡€ï¼Œç†è§£è¯¯å·®å¦‚ä½•é€å±‚åˆ†é…</p>
                </div>
                <div class="concept-card how" tabindex="0">
                    <h3 style="color: var(--accent-blue); margin-bottom: 0.5rem;">âœ“ æŒæ¡å®ç°æŠ€å·§</h3>
                    <p>ä»æ‰‹å†™BPåˆ°ä½¿ç”¨è‡ªåŠ¨å¾®åˆ†ï¼Œå¯¹æ¯”ä¸åŒå®ç°æ–¹å¼çš„ä¼˜åŠ£</p>
                </div>
                <div class="concept-card why" tabindex="0">
                    <h3 style="color: var(--accent-red); margin-bottom: 0.5rem;">âœ“ è¯†åˆ«å¸¸è§é—®é¢˜</h3>
                    <p>ç†è§£æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸çš„æ ¹æºï¼Œå­¦ä¼šè°ƒè¯•å’Œç›‘æ§æ¢¯åº¦æµ</p>
                </div>
                <div class="concept-card pitfall" tabindex="0">
                    <h3 style="color: var(--accent-yellow); margin-bottom: 0.5rem;">âœ“ æ‹“å±•è§†é‡</h3>
                    <p>æ¢ç´¢BPçš„ç”Ÿç‰©å­¦åˆç†æ€§å’Œæ›¿ä»£æ–¹æ¡ˆï¼Œç†è§£æ·±åº¦å­¦ä¹ çš„æœªæ¥</p>
                </div>
            </div>
        </section>

        <!-- å­¦ä¹ è·¯å¾„æ¨è -->
        <section class="learning-path">
            <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ—ºï¸ æ¨èå­¦ä¹ è·¯å¾„</h3>
            <div class="path-item completed" tabindex="0">
                <div class="path-icon">âœ“</div>
                <div class="path-content">
                    <h4>ä¸Šä¸€ç« ï¼šæ„ŸçŸ¥æœº</h4>
                    <p>å•å±‚ç½‘ç»œçš„å±€é™æ€§</p>
                </div>
            </div>
            <div class="path-item current" tabindex="0">
                <div class="path-icon">ğŸ“</div>
                <div class="path-content">
                    <h4>å½“å‰ç« èŠ‚ï¼šåå‘ä¼ æ’­</h4>
                    <p>æ·±åº¦ç½‘ç»œè®­ç»ƒçš„æ ¸å¿ƒç®—æ³•</p>
                </div>
            </div>
            <div class="path-item" tabindex="0">
                <div class="path-icon">ğŸ”œ</div>
                <div class="path-content">
                    <h4>ä¸‹ä¸€ç«™ï¼šå¤šå±‚æ„ŸçŸ¥æœº</h4>
                    <p>è¡¨è¾¾åŠ›ä¸æ¿€æ´»å‡½æ•°</p>
                </div>
            </div>
        </section>

        <!-- å­¦ä¹ å¾ªç¯1ï¼šå¼•è¨€æ•…äº‹ -->
        <section id="intro" class="section-card">
            <div class="story-card">
                <h2 style="color: var(--accent-yellow); margin-bottom: 1.5rem;">ğŸŒ™ å‡Œæ™¨3ç‚¹14åˆ†ï¼ŒåŒ—èˆªæœºæˆ¿çš„å´©æºƒæ—¶åˆ»</h2>
                <!-- åœºæ™¯è®¾å®š -->
                <div style="background: rgba(0, 0, 0, 0.2); padding: 1rem; border-radius: 0.5rem; margin-bottom: 2rem;">
                    <p style="font-style: italic; color: var(--text-secondary);">
                        å°é™ˆç»ˆäºç†è§£äº†å¤šå±‚ç½‘ç»œçš„å¿…è¦æ€§ï¼Œå…´å¥‹åœ°æ­å»ºäº†ä¸€ä¸ªä¸‰å±‚ç¥ç»ç½‘ç»œã€‚
                        ç„¶è€Œï¼Œå½“ä»–è¯•å›¾æ‰‹åŠ¨è®¡ç®—æ¢¯åº¦æ—¶ï¼Œå™©æ¢¦å¼€å§‹äº†...
                    </p>
                </div>

                <!-- å¯¹è¯åœºæ™¯ -->
                <div class="dialogue-container">
                    <div class="dialogue-item">
                        <div class="dialogue-avatar student">ğŸ˜­</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">å°é™ˆï¼ˆæŠ“ç‹‚ä¸­ï¼‰</div>
                            <p>æˆ‘å·²ç»ç®—äº†3ä¸ªå°æ—¶äº†ï¼è¿™æ‰ç¬¬äºŒå±‚çš„æ¢¯åº¦ï¼Œè¿˜æœ‰åå‡ ä¸ªå‚æ•°è¦ç®—...</p>
                        </div>
                    </div>
                    <div class="dialogue-item">
                        <div class="dialogue-avatar friend">ğŸ˜´</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">å®¤å‹å°æï¼ˆè¿·ç³Šä¸­ï¼‰</div>
                            <p>ä½ åœ¨å¹²å•¥ï¼Ÿä¸æ˜¯æœ‰ç°æˆçš„æ¡†æ¶å—ï¼Ÿ</p>
                        </div>
                    </div>
                    <div class="dialogue-item">
                        <div class="dialogue-avatar student">ğŸ’¢</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">å°é™ˆ</div>
                            <p>è€å¸ˆè¯´è¦ç†è§£åŸç†ï¼å¯è¿™é“¾å¼æ³•åˆ™å¥—é“¾å¼æ³•åˆ™ï¼Œæˆ‘éƒ½ä¸çŸ¥é“è‡ªå·±ç®—çš„å¯¹ä¸å¯¹äº†...</p>
                        </div>
                    </div>
                </div>

                <!-- æ‰‹ç®—å±•ç¤º -->
                <div class="tip error mt-3">
                    <span class="tip-icon">ğŸ“</span>
                    <div class="tip-content">
                        <strong>å°é™ˆçš„è‰ç¨¿çº¸ï¼ˆç¬¬17é¡µï¼‰ï¼š</strong><br>
                        <div style="font-family: 'Kalam', cursive; color: var(--accent-yellow); transform: rotate(-1deg); margin: 1rem 0;">
                            âˆ‚L/âˆ‚wâ‚â‚â½Â²â¾ = âˆ‚L/âˆ‚aâ½Â³â¾ Â· âˆ‚aâ½Â³â¾/âˆ‚zâ½Â³â¾ Â· âˆ‚zâ½Â³â¾/âˆ‚aâ‚â½Â²â¾ Â· âˆ‚aâ‚â½Â²â¾/âˆ‚zâ‚â½Â²â¾ Â· âˆ‚zâ‚â½Â²â¾/âˆ‚wâ‚â‚â½Â²â¾<br>
                            = Î´â½Â³â¾ Â· wâ‚â½Â³â¾ Â· Ïƒ'(zâ‚â½Â²â¾) Â· aâ‚â½Â¹â¾<br>
                            = 0.73 Ã— (-2.1) Ã— 0.196 Ã— 0.84 = ???
                        </div>
                        <span style="color: var(--accent-red);">é”™è¯¯ç´¯ç§¯ï¼šä¸€ä¸ªå°æ•°ç‚¹é”™è¯¯ï¼Œåé¢å…¨å®Œäº†...</span>
                    </div>
                </div>

                <!-- è½¬æŠ˜ç‚¹ -->
                <div class="dialogue-container mt-3">
                    <div class="dialogue-item">
                        <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">ç‹æ•™æˆï¼ˆçªç„¶å‡ºç°ï¼‰</div>
                            <p>å°é™ˆï¼Œè¿˜åœ¨æ‰‹ç®—æ¢¯åº¦ï¼Ÿä½ çŸ¥é“å—ï¼Œ1974å¹´å°±æœ‰äººæƒ³åˆ°äº†è‡ªåŠ¨è®¡ç®—æ¢¯åº¦çš„æ–¹æ³•ï¼Œ
                                ä½†ç›´åˆ°1986å¹´æ‰è¢«é‡æ–°å‘ç°å¹¶æ¨å¹¿...</p>
                        </div>
                    </div>
                    <div class="dialogue-item">
                        <div class="dialogue-avatar student">ğŸ˜²</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">å°é™ˆ</div>
                            <p>è‡ªåŠ¨è®¡ç®—ï¼Ÿæ€ä¹ˆå¯èƒ½ï¼è¿™ä¹ˆå¤æ‚çš„é“¾å¼æ³•åˆ™...</p>
                        </div>
                    </div>
                    <div class="dialogue-item">
                        <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">ç‹æ•™æˆ</div>
                            <p>è¿™å°±æ˜¯åå‘ä¼ æ’­çš„ç¾å¦™ä¹‹å¤„â€”â€”<strong class="handwritten">è¯¯å·®åƒæ°´æµä¸€æ ·ï¼Œä»è¾“å‡ºå±‚åå‘æµå›æ¯ä¸ªå‚æ•°</strong>ã€‚
                                è®©æˆ‘ç»™ä½ æ¼”ç¤ºä¸€ä¸‹...</p>
                        </div>
                    </div>
                </div>

                <!-- å…³é”®æ´å¯Ÿ -->
                <div class="tip success mt-3">
                    <span class="tip-icon">ğŸ’¡</span>
                    <div class="tip-content">
                        <strong>é¡¿æ‚Ÿæ—¶åˆ»ï¼š</strong><br>
                        åå‘ä¼ æ’­çš„æ ¸å¿ƒæ€æƒ³â€”â€”<br>
                        1. <strong>å‰å‘è®¡ç®—</strong>ï¼šä¿å­˜æ‰€æœ‰ä¸­é—´ç»“æœ<br>
                        2. <strong>åå‘ä¼ æ’­</strong>ï¼šåˆ©ç”¨é“¾å¼æ³•åˆ™ï¼Œä»åå¾€å‰è®¡ç®—æ¢¯åº¦<br>
                        3. <strong>è´£ä»»åˆ†æ‘Š</strong>ï¼šæ¯ä¸ªå‚æ•°æ ¹æ®å…¶"è´¡çŒ®"æ‰¿æ‹…ç›¸åº”çš„è¯¯å·®
                    </div>
                </div>
            </div>

            <!-- å³æ—¶ç»ƒä¹  -->
            <div class="instant-practice">
                <h3 style="color: var(--accent-green); margin-bottom: 1rem;">ğŸ¯ æ€è€ƒç»ƒä¹ </h3>
                <div class="practice-question">
                    æ‰‹åŠ¨è®¡ç®—æ¢¯åº¦çš„ä¸»è¦é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ
                </div>
                <div class="practice-options">
                    <button class="practice-option" data-answer="a" tabindex="0">
                        A. è®¡ç®—é‡å¤ªå°ï¼Œä¸å¤Ÿç²¾ç¡®
                    </button>
                    <button class="practice-option" data-answer="b" tabindex="0">
                        B. å®¹æ˜“å‡ºé”™ä¸”æ•ˆç‡æä½
                    </button>
                    <button class="practice-option" data-answer="c" tabindex="0">
                        C. æ— æ³•å¤„ç†éçº¿æ€§å‡½æ•°
                    </button>
                    <button class="practice-option" data-answer="d" tabindex="0">
                        D. éœ€è¦é«˜æ·±çš„æ•°å­¦çŸ¥è¯†
                    </button>
                </div>
                <div class="practice-feedback" id="practice-feedback-1"></div>
            </div>
        </section>

        <!-- å­¦ä¹ å¾ªç¯2ï¼šå‘ç°é—®é¢˜ -->
        <section id="problem" class="section-card">

            <h2 style="color: var(--accent-red); margin-bottom: 1.5rem;">
                ğŸ¯ æ¢¯åº¦è®¡ç®—çš„æŒ‘æˆ˜ï¼šä¸ºä»€ä¹ˆæ‰‹æ¨ä¸å¯æŒç»­
                <span class="depth-indicator beginner">åˆå­¦è€…</span>
            </h2>

            <!-- é—®é¢˜å¯è§†åŒ– -->
            <div class="interactive-demo">
                <h3 style="color: var(--accent-blue); margin-bottom: 1.5rem;">ğŸ“Š ç½‘ç»œå¤æ‚åº¦çˆ†ç‚¸æ¼”ç¤º</h3>

                <div class="demo-controls">
                    <div class="control-group">
                        <label>ç½‘ç»œå±‚æ•°</label>
                        <div class="slider-container">
                            <input type="range" id="layers-slider" min="2" max="10" step="1" value="3">
                            <span class="slider-value" id="layers-value">3</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>æ¯å±‚ç¥ç»å…ƒæ•°</label>
                        <div class="slider-container">
                            <input type="range" id="neurons-slider" min="2" max="20" step="2" value="4">
                            <span class="slider-value" id="neurons-value">4</span>
                        </div>
                    </div>
                </div>

                <canvas id="network-complexity-canvas" width="800" height="400"></canvas>

                <div style="margin-top: 1rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; text-align: center;">
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <h4 style="color: var(--accent-red);">å‚æ•°æ•°é‡</h4>
                        <p style="font-size: 2rem; font-weight: bold;" id="param-count">20</p>
                    </div>
                    <div style="background: rgba(251, 191, 36, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <h4 style="color: var(--accent-yellow);">æ¢¯åº¦è®¡ç®—æ¬¡æ•°</h4>
                        <p style="font-size: 2rem; font-weight: bold;" id="gradient-count">60</p>
                    </div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <h4 style="color: var(--accent-green);">æ‰‹ç®—æ—¶é—´ï¼ˆä¼°è®¡ï¼‰</h4>
                        <p style="font-size: 2rem; font-weight: bold;" id="time-estimate">30åˆ†é’Ÿ</p>
                    </div>
                </div>
            </div>

            <!-- æ‰‹ç®—é”™è¯¯ç»Ÿè®¡ -->
            <div class="common-mistakes mt-4">
                <h3 style="color: var(--accent-red); margin-bottom: 1rem;">ğŸ“Š æ‰‹ç®—æ¢¯åº¦å¸¸è§é”™è¯¯ç»Ÿè®¡</h3>

                <div style="background: rgba(0, 0, 0, 0.2); padding: 1.5rem; border-radius: 0.5rem;">
                    <p style="margin-bottom: 1rem;">æ ¹æ®å¯¹100åå­¦ç”Ÿçš„ç»Ÿè®¡ï¼š</p>

                    <div style="display: grid; gap: 0.5rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 200px; background: var(--accent-red); height: 20px; border-radius: 10px;"></div>
                            <span>87% - é“¾å¼æ³•åˆ™åº”ç”¨é”™è¯¯</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 180px; background: var(--accent-yellow); height: 20px; border-radius: 10px;"></div>
                            <span>79% - çŸ©é˜µç»´åº¦ä¸åŒ¹é…</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 150px; background: var(--accent-blue); height: 20px; border-radius: 10px;"></div>
                            <span>65% - æ¿€æ´»å‡½æ•°å¯¼æ•°é”™è¯¯</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 120px; background: var(--accent-green); height: 20px; border-radius: 10px;"></div>
                            <span>52% - æ•°å€¼è®¡ç®—é”™è¯¯</span>
                        </div>
                    </div>

                    <p style="margin-top: 1rem; color: var(--accent-purple);">
                        <strong>å¹³å‡æ¯ä¸ªå­¦ç”Ÿåœ¨3å±‚ç½‘ç»œä¸ŠèŠ±è´¹4.5å°æ—¶ï¼Œæ­£ç¡®ç‡ä»…23%</strong>
                    </p>
                </div>
            </div>

            <!-- æ·±å…¥ç†è§£ -->
            <div class="collapsible mt-4 beginner-content">
                <div class="collapsible-header" tabindex="0">
                    <div class="collapsible-title">
                        <span>ğŸ¤”</span>
                        <span>æ·±å…¥ç†è§£ï¼šä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨åŒ–ï¼Ÿ</span>
                        <span class="depth-indicator beginner">åˆå­¦è€…</span>
                    </div>
                    <svg class="collapsible-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-inner">
                        <h4>æ‰‹åŠ¨è®¡ç®—çš„è‡´å‘½ç¼ºé™·ï¼š</h4>
                        <ol style="line-height: 2; margin-top: 1rem;">
                            <li><strong>ç»„åˆçˆ†ç‚¸</strong>ï¼š10å±‚ç½‘ç»œå¯èƒ½æœ‰ä¸Šç™¾ä¸‡å‚æ•°</li>
                            <li><strong>é”™è¯¯ä¼ æ’­</strong>ï¼šä¸€ä¸ªé”™è¯¯å¯¼è‡´åç»­å…¨é”™</li>
                            <li><strong>æ— æ³•è°ƒè¯•</strong>ï¼šå¾ˆéš¾å®šä½é”™è¯¯åœ¨å“ª</li>
                            <li><strong>æ›´æ–°å›°éš¾</strong>ï¼šæ”¹å˜ç½‘ç»œç»“æ„éœ€è¦é‡æ–°æ¨å¯¼</li>
                        </ol>

                        <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                            <strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>
                            è®©è®¡ç®—æœºæŒ‰ç…§å›ºå®šçš„è§„åˆ™è‡ªåŠ¨è®¡ç®—æ¢¯åº¦ â€”â€” è¿™å°±æ˜¯åå‘ä¼ æ’­ç®—æ³•ï¼
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³æ—¶ç»ƒä¹  -->
            <div class="instant-practice">
                <h3 style="color: var(--accent-green); margin-bottom: 1rem;">ğŸ¯ å¿«é€Ÿè®¡ç®—</h3>
                <div class="practice-question">
                    ä¸€ä¸ª10å±‚çš„å…¨è¿æ¥ç½‘ç»œï¼Œæ¯å±‚100ä¸ªç¥ç»å…ƒï¼Œå¤§çº¦æœ‰å¤šå°‘ä¸ªå‚æ•°ï¼Ÿ
                </div>
                <div class="practice-options">
                    <button class="practice-option" data-answer="a" tabindex="0">
                        A. 1,000ä¸ª
                    </button>
                    <button class="practice-option" data-answer="b" tabindex="0">
                        B. 10,000ä¸ª
                    </button>
                    <button class="practice-option" data-answer="c" tabindex="0">
                        C. 100,000ä¸ª
                    </button>
                    <button class="practice-option" data-answer="d" tabindex="0">
                        D. 1,000,000ä¸ª
                    </button>
                </div>
                <div class="practice-feedback" id="practice-feedback-2"></div>
            </div>
        </section>

        <!-- å†å²å›é¡¾ -->
        <section id="history" class="section-card">
            <h2 style="color: var(--accent-yellow); margin-bottom: 1.5rem;">
                ğŸ“š å†å²å›é¡¾ï¼šåå‘ä¼ æ’­çš„æ›²æŠ˜å‘å±•
                <span class="depth-indicator beginner">åˆå­¦è€…</span>
            </h2>

            <!-- æ—¶é—´çº¿ -->
            <div style="position: relative; padding: 2rem 0;">
                <div style="position: absolute; left: 50%; top: 0; bottom: 0; width: 2px; background: var(--accent-purple);"></div>

                <!-- 1960sï¼šæ—©æœŸæ€æƒ³ -->
                <div style="display: flex; align-items: center; margin-bottom: 3rem;">
                    <div style="flex: 1; text-align: right; padding-right: 2rem;">
                        <h4 style="color: var(--accent-blue);">1960sï¼šæœ€æ—©çš„æ€æƒ³èŒèŠ½</h4>
                        <p>Bryson & Ho åœ¨æ§åˆ¶è®ºä¸­æå‡ºç±»ä¼¼æ€æƒ³</p>
                        <p style="font-style: italic; color: var(--text-secondary);">
                            "ä½†æ— äººå°†å…¶åº”ç”¨äºç¥ç»ç½‘ç»œ..."
                        </p>
                    </div>
                    <div style="width: 20px; height: 20px; background: var(--accent-blue); border-radius: 50%; position: relative; z-index: 1;"></div>
                    <div style="flex: 1; padding-left: 2rem;">
                        <div style="background: rgba(6, 182, 212, 0.1); padding: 1rem; border-radius: 0.5rem;">
                            ğŸ’­ è¢«å¿½è§†çš„çç ï¼šæ€æƒ³è¶…å‰äºæ—¶ä»£
                        </div>
                    </div>
                </div>

                <!-- 1974å¹´ï¼šWerbos -->
                <div style="display: flex; align-items: center; margin-bottom: 3rem;">
                    <div style="flex: 1; text-align: right; padding-right: 2rem;">
                        <div style="background: rgba(251, 191, 36, 0.1); padding: 1rem; border-radius: 0.5rem;">
                            ğŸ“ åšå£«è®ºæ–‡æå‡ºå®Œæ•´çš„BPç®—æ³•
                        </div>
                    </div>
                    <div style="width: 20px; height: 20px; background: var(--accent-yellow); border-radius: 50%; position: relative; z-index: 1;"></div>
                    <div style="flex: 1; padding-left: 2rem;">
                        <h4 style="color: var(--accent-yellow);">1974å¹´ï¼šPaul Werbos</h4>
                        <p>ã€ŠBeyond Regressionã€‹</p>
                        <p style="font-style: italic; color: var(--text-secondary);">
                            "å¯æƒœå‘è¡¨åœ¨å†·é—¨æœŸåˆŠï¼Œæ— äººé—®æ´¥..."
                        </p>
                    </div>
                </div>

                <!-- 1986å¹´ï¼šé‡æ–°å‘ç° -->
                <div style="display: flex; align-items: center; margin-bottom: 3rem;">
                    <div style="flex: 1; text-align: right; padding-right: 2rem;">
                        <h4 style="color: var(--accent-green);">1986å¹´ï¼šRumelhartç­‰äºº</h4>
                        <p>ã€ŠLearning representations by back-propagating errorsã€‹</p>
                        <p style="font-style: italic; color: var(--text-secondary);">
                            "NatureæœŸåˆŠå‘è¡¨ï¼Œè½°åŠ¨å­¦ç•Œï¼"
                        </p>
                    </div>
                    <div style="width: 20px; height: 20px; background: var(--accent-green); border-radius: 50%; position: relative; z-index: 1;"></div>
                    <div style="flex: 1; padding-left: 2rem;">
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 0.5rem;">
                            ğŸ‰ BPç®—æ³•æ­£å¼è¿›å…¥ä¸»æµè§†é‡
                        </div>
                    </div>
                </div>

                <!-- 1989å¹´ï¼šæ‰‹å†™è¯†åˆ« -->
                <div style="display: flex; align-items: center; margin-bottom: 3rem;">
                    <div style="flex: 1; text-align: right; padding-right: 2rem;">
                        <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 0.5rem;">
                            âœï¸ é¦–æ¬¡å¤§è§„æ¨¡å•†ä¸šåº”ç”¨
                        </div>
                    </div>
                    <div style="width: 20px; height: 20px; background: var(--accent-purple); border-radius: 50%; position: relative; z-index: 1;"></div>
                    <div style="flex: 1; padding-left: 2rem;">
                        <h4 style="color: var(--accent-purple);">1989å¹´ï¼šLeCunçš„LeNet</h4>
                        <p>é“¶è¡Œæ”¯ç¥¨è¯†åˆ«ç³»ç»Ÿ</p>
                        <p style="font-style: italic; color: var(--text-secondary);">
                            "å¤„ç†äº†ç¾å›½10%çš„æ”¯ç¥¨ï¼"
                        </p>
                    </div>
                </div>

                <!-- 2010sï¼šè‡ªåŠ¨å¾®åˆ† -->
                <div style="display: flex; align-items: center;">
                    <div style="flex: 1; text-align: right; padding-right: 2rem;">
                        <h4 style="color: var(--accent-pink);">2010sï¼šè‡ªåŠ¨å¾®åˆ†æ—¶ä»£</h4>
                        <p>Theano â†’ TensorFlow â†’ PyTorch</p>
                        <p style="font-style: italic; color: var(--text-secondary);">
                            "define-by-runï¼Œæ¢¯åº¦è®¡ç®—å®Œå…¨è‡ªåŠ¨åŒ–"
                        </p>
                    </div>
                    <div style="width: 20px; height: 20px; background: var(--accent-pink); border-radius: 50%; position: relative; z-index: 1;"></div>
                    <div style="flex: 1; padding-left: 2rem;">
                        <div style="background: rgba(236, 72, 153, 0.1); padding: 1rem; border-radius: 0.5rem;">
                            ğŸš€ æ·±åº¦å­¦ä¹ çš„æ°‘ä¸»åŒ–æ—¶ä»£æ¥ä¸´
                        </div>
                    </div>
                </div>
            </div>

            <!-- å†å²æ•™è®­ -->
            <div class="tip info mt-4">
                <span class="tip-icon">ğŸ“–</span>
                <div class="tip-content">
                    <strong>å†å²å¯ç¤ºï¼š</strong><br>
                    â€¢ å¥½çš„æƒ³æ³•å¯èƒ½è¢«åŸ‹æ²¡å¤šå¹´<br>
                    â€¢ è®¡ç®—èƒ½åŠ›çš„æå‡è®©æ—§ç®—æ³•ç„•å‘æ–°ç”Ÿ<br>
                    â€¢ å·¥å…·çš„è¿›æ­¥ï¼ˆè‡ªåŠ¨å¾®åˆ†ï¼‰æå¤§æ¨åŠ¨äº†é¢†åŸŸå‘å±•<br>
                    â€¢ ä»æ‰‹ç®—åˆ°è‡ªåŠ¨åŒ–æ˜¯å¿…ç„¶è¶‹åŠ¿
                </div>
            </div>
        </section>

        <!-- é“¾å¼æ³•åˆ™ -->
        <section id="chain-rule" class="section-card">
            <h2 style="color: var(--accent-purple); margin-bottom: 1.5rem;">
                â›“ï¸ é“¾å¼æ³•åˆ™ï¼šå¾®ç§¯åˆ†çš„ä¼˜é›…
                <span class="depth-indicator intermediate">è¿›é˜¶</span>
            </h2>

            <!-- ç›´è§‚è§£é‡Š -->
            <div class="story-card">
                <h3>ğŸ­ é“¾å¼æ³•åˆ™çš„å·¥å‚æ¯”å–»</h3>
                <div class="dialogue-container">
                    <div class="dialogue-item">
                        <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">ç‹æ•™æˆ</div>
                            <p>æƒ³è±¡ä¸€ä¸ªç”Ÿäº§çº¿ï¼šåŸæ–™ â†’ åŠ å·¥ â†’ åŠæˆå“ â†’ ç»„è£… â†’ æˆå“</p>
                        </div>
                    </div>
                    <div class="dialogue-item">
                        <div class="dialogue-avatar student">ğŸ¤”</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">å°é™ˆ</div>
                            <p>å¦‚æœæœ€ç»ˆäº§å“æœ‰ç¼ºé™·ï¼Œæ€ä¹ˆæ‰¾å‡ºæ˜¯å“ªä¸ªç¯èŠ‚çš„é—®é¢˜ï¼Ÿ</p>
                        </div>
                    </div>
                    <div class="dialogue-item">
                        <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">ç‹æ•™æˆ</div>
                            <p>æ­£æ˜¯ï¼é“¾å¼æ³•åˆ™å°±æ˜¯<strong>é€å±‚è¿½æº¯è´£ä»»</strong>çš„æ•°å­¦æ–¹æ³•ã€‚
                                æ¯ä¸ªç¯èŠ‚çš„"è´£ä»»"ç­‰äºå®ƒå¯¹ä¸‹ä¸€ç¯èŠ‚çš„å½±å“Ã—ä¸‹ä¸€ç¯èŠ‚çš„æ€»è´£ä»»ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ•°å­¦æ¨å¯¼ -->
            <div class="math-derivation">
                <h3>é“¾å¼æ³•åˆ™çš„æ•°å­¦è¡¨è¾¾</h3>

                <div class="math-step" data-step="1">
                    <strong>ä¸€ç»´æƒ…å†µ</strong>
                    <p>è®¾ y = f(g(x))ï¼Œåˆ™ï¼š</p>
                    <div class="equation-container">
                        <span class="equation-label">åŸºæœ¬é“¾å¼æ³•åˆ™</span><br>
                        <span style="font-size: 1.3rem;">
                            dy/dx = (dy/dg) Â· (dg/dx)
                        </span>
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>å¤šç»´æƒ…å†µï¼ˆç¥ç»ç½‘ç»œï¼‰</strong>
                    <p>å¯¹äº L = fâ½â¿â¾(fâ½â¿â»Â¹â¾(...fâ½Â¹â¾(x)))ï¼š</p>
                    <div class="equation-container">
                        <span style="font-size: 1.2rem;">
                            âˆ‚L/âˆ‚Wâ½Ë¡â¾ = âˆ‚L/âˆ‚zâ½Ë¡âºÂ¹â¾ Â· âˆ‚zâ½Ë¡âºÂ¹â¾/âˆ‚aâ½Ë¡â¾ Â· âˆ‚aâ½Ë¡â¾/âˆ‚zâ½Ë¡â¾ Â· âˆ‚zâ½Ë¡â¾/âˆ‚Wâ½Ë¡â¾
                        </span>
                    </div>
                    <div class="math-explanation">
                        æ¯ä¸€é¡¹éƒ½æœ‰æ˜ç¡®çš„å«ä¹‰ï¼š<br>
                        â€¢ âˆ‚L/âˆ‚zâ½Ë¡âºÂ¹â¾ï¼šæ¥è‡ªåå±‚çš„è¯¯å·®ä¿¡å·<br>
                        â€¢ âˆ‚zâ½Ë¡âºÂ¹â¾/âˆ‚aâ½Ë¡â¾ï¼šå½“å‰å±‚çš„æƒé‡å½±å“<br>
                        â€¢ âˆ‚aâ½Ë¡â¾/âˆ‚zâ½Ë¡â¾ï¼šæ¿€æ´»å‡½æ•°çš„å±€éƒ¨æ¢¯åº¦<br>
                        â€¢ âˆ‚zâ½Ë¡â¾/âˆ‚Wâ½Ë¡â¾ï¼šå‚æ•°çš„ç›´æ¥å½±å“
                    </div>
                </div>

                <div class="math-step" data-step="3">
                    <strong>çŸ©é˜µå½¢å¼ï¼ˆå‘é‡åŒ–ï¼‰</strong>
                    <p>è¯¯å·®åå‘ä¼ æ’­å…¬å¼ï¼š</p>
                    <div class="equation-container">
                        <span class="equation-label">æ ¸å¿ƒBPå…¬å¼</span><br>
                        <span style="font-size: 1.3rem; color: var(--accent-purple);">
                            Î´â½Ë¡â¾ = (Wâ½Ë¡âºÂ¹â¾áµ€ Î´â½Ë¡âºÂ¹â¾) âŠ™ Ïƒ'(zâ½Ë¡â¾)
                        </span>
                    </div>
                    <div class="math-explanation">
                        â€¢ Î´â½Ë¡â¾ï¼šç¬¬lå±‚çš„è¯¯å·®é¡¹<br>
                        â€¢ Wâ½Ë¡âºÂ¹â¾áµ€ï¼šåä¸€å±‚æƒé‡çš„è½¬ç½®<br>
                        â€¢ âŠ™ï¼šé€å…ƒç´ ä¹˜æ³•ï¼ˆHadamardç§¯ï¼‰<br>
                        â€¢ Ïƒ'ï¼šæ¿€æ´»å‡½æ•°çš„å¯¼æ•°
                    </div>
                </div>
            </div>

            <!-- äº¤äº’å¼é“¾å¼æ³•åˆ™æ¼”ç¤º -->
            <div class="interactive-demo mt-4">
                <h3 style="color: var(--accent-blue); margin-bottom: 1.5rem;">ğŸ”— é“¾å¼æ³•åˆ™å¯è§†åŒ–</h3>

                <div class="demo-controls">
                    <button class="btn btn-primary" onclick="animateChainRule()" tabindex="0">
                        â–¶ï¸ æ’­æ”¾åŠ¨ç”»
                    </button>
                    <button class="btn btn-secondary" onclick="resetChainRule()" tabindex="0">
                        ğŸ”„ é‡ç½®
                    </button>
                </div>

                <svg id="chain-rule-svg" width="800" height="400" style="display: block; margin: 0 auto;">
                    <!-- SVGå†…å®¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </svg>

                <div class="tip info mt-3">
                    <span class="tip-icon">ğŸ’¡</span>
                    <div class="tip-content">
                        <strong>åŠ¨ç”»è¯´æ˜ï¼š</strong><br>
                        â€¢ ç»¿è‰²ç®­å¤´ï¼šå‰å‘ä¼ æ’­è·¯å¾„<br>
                        â€¢ çº¢è‰²ç®­å¤´ï¼šæ¢¯åº¦åå‘ä¼ æ’­è·¯å¾„<br>
                        â€¢ æ•°å­—ï¼šæ¯æ¡è¾¹çš„å±€éƒ¨æ¢¯åº¦<br>
                        â€¢ è§‚å¯Ÿæ¢¯åº¦å¦‚ä½•é€å±‚ç›¸ä¹˜ä¼ é€’
                    </div>
                </div>
            </div>

            <!-- å¸¸è§é”™è¯¯ -->
            <div class="common-mistakes mt-4">
                <h3 style="color: var(--accent-red); margin-bottom: 1rem;">âš ï¸ é“¾å¼æ³•åˆ™å¸¸è§é”™è¯¯</h3>

                <div class="mistake-item">
                    <div class="mistake-icon">âŒ</div>
                    <div class="mistake-content">
                        <h4>é”™è¯¯1ï¼šå¿˜è®°æ¿€æ´»å‡½æ•°çš„å¯¼æ•°</h4>
                        <p>å¾ˆå¤šäººè®¡ç®—æ¢¯åº¦æ—¶å¿˜è®°ä¹˜ä»¥Ïƒ'(z)ï¼Œå¯¼è‡´æ¢¯åº¦å®Œå…¨é”™è¯¯ã€‚</p>
                        <p style="color: var(--accent-green); margin-top: 0.5rem;">
                            âœ“ æ­£ç¡®åšæ³•ï¼šå§‹ç»ˆè®°ä½ Î´ = (åå±‚è¯¯å·®) Ã— (æ¿€æ´»å‡½æ•°å¯¼æ•°)
                        </p>
                    </div>
                </div>

                <div class="mistake-item">
                    <div class="mistake-icon">âŒ</div>
                    <div class="mistake-content">
                        <h4>é”™è¯¯2ï¼šçŸ©é˜µç»´åº¦æ··ä¹±</h4>
                        <p>åå‘ä¼ æ’­éœ€è¦è½¬ç½®æƒé‡çŸ©é˜µï¼Œå¾ˆå®¹æ˜“ææ··ç»´åº¦ã€‚</p>
                        <p style="color: var(--accent-green); margin-top: 0.5rem;">
                            âœ“ æ­£ç¡®åšæ³•ï¼šå‰å‘æ˜¯ WÂ·xï¼Œåå‘æ˜¯ Wáµ€Â·Î´
                        </p>
                    </div>
                </div>
            </div>

            <!-- è¿›é˜¶å†…å®¹ -->
            <div class="collapsible mt-4 intermediate-content" style="display: none;">
                <div class="collapsible-header" tabindex="0">
                    <div class="collapsible-title">
                        <span>ğŸ”¬</span>
                        <span>è¿›é˜¶ï¼šè®¡ç®—å›¾ä¸è‡ªåŠ¨å¾®åˆ†</span>
                        <span class="depth-indicator intermediate">è¿›é˜¶</span>
                    </div>
                    <svg class="collapsible-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-inner">
                        <h4>è®¡ç®—å›¾çš„å¨åŠ›</h4>
                        <p>ç°ä»£æ·±åº¦å­¦ä¹ æ¡†æ¶å°†æ‰€æœ‰è¿ç®—æ„å»ºæˆè®¡ç®—å›¾ï¼š</p>

                        <ul style="line-height: 2; margin-top: 1rem;">
                            <li><strong>èŠ‚ç‚¹</strong>ï¼šå˜é‡æˆ–ä¸­é—´ç»“æœ</li>
                            <li><strong>è¾¹</strong>ï¼šè¿ç®—æ“ä½œ</li>
                            <li><strong>å‰å‘</strong>ï¼šä»è¾“å…¥åˆ°è¾“å‡ºè®¡ç®—å€¼</li>
                            <li><strong>åå‘</strong>ï¼šä»è¾“å‡ºåˆ°è¾“å…¥è®¡ç®—æ¢¯åº¦</li>
                        </ul>

                        <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                            <strong>è‡ªåŠ¨å¾®åˆ†çš„ä¼˜åŠ¿ï¼š</strong><br>
                            1. æ¢¯åº¦è®¡ç®—100%å‡†ç¡®<br>
                            2. æ”¯æŒä»»æ„å¤æ‚çš„ç½‘ç»œç»“æ„<br>
                            3. ä¼˜åŒ–çš„å†…å­˜ä½¿ç”¨å’Œè®¡ç®—æ•ˆç‡<br>
                            4. åŠ¨æ€å›¾æ”¯æŒæ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³æ—¶ç»ƒä¹  -->
            <div class="instant-practice">
                <h3 style="color: var(--accent-green); margin-bottom: 1rem;">ğŸ¯ ç†è§£æ£€æŸ¥</h3>
                <div class="practice-question">
                    åœ¨åå‘ä¼ æ’­ä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦æƒé‡çŸ©é˜µçš„è½¬ç½®ï¼Ÿ
                </div>
                <div class="practice-options">
                    <button class="practice-option" data-answer="a" tabindex="0">
                        A. ä¸ºäº†èŠ‚çœå†…å­˜
                    </button>
                    <button class="practice-option" data-answer="b" tabindex="0">
                        B. ä¸ºäº†ä¿è¯çŸ©é˜µç»´åº¦åŒ¹é…
                    </button>
                    <button class="practice-option" data-answer="c" tabindex="0">
                        C. ä¸ºäº†åŠ å¿«è®¡ç®—é€Ÿåº¦
                    </button>
                    <button class="practice-option" data-answer="d" tabindex="0">
                        D. è¿™æ˜¯çº¦å®šä¿—æˆçš„ä¹ æƒ¯
                    </button>
                </div>
                <div class="practice-feedback" id="practice-feedback-3"></div>
            </div>
        </section>

        <!-- BPç®—æ³•è¯¦è§£ -->
        <section id="algorithm" class="section-card">
            <h2 style="color: var(--accent-green); margin-bottom: 1.5rem;">
                ğŸ¯ åå‘ä¼ æ’­ç®—æ³•ï¼šè®©è¯¯å·®é€†æµè€Œä¸Š
                <span class="depth-indicator intermediate">è¿›é˜¶</span>
            </h2>

            <!-- ç®—æ³•æ­¥éª¤ -->
            <div class="math-derivation">
                <h3>BPç®—æ³•çš„å››ä¸ªæ–¹ç¨‹</h3>

                <div class="math-step" data-step="1">
                    <strong>è¾“å‡ºå±‚è¯¯å·®</strong>
                    <div class="equation-container">
                        <span style="font-size: 1.2rem;">
                            Î´â½á´¸â¾ = âˆ‡â‚C âŠ™ Ïƒ'(zâ½á´¸â¾)
                        </span>
                    </div>
                    <div class="math-explanation">
                        è¾“å‡ºå±‚çš„è¯¯å·® = æŸå¤±å‡½æ•°æ¢¯åº¦ Ã— æ¿€æ´»å‡½æ•°å¯¼æ•°
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>è¯¯å·®åå‘ä¼ æ’­</strong>
                    <div class="equation-container">
                        <span style="font-size: 1.2rem; color: var(--accent-purple);">
                            Î´â½Ë¡â¾ = ((Wâ½Ë¡âºÂ¹â¾)áµ€ Î´â½Ë¡âºÂ¹â¾) âŠ™ Ïƒ'(zâ½Ë¡â¾)
                        </span>
                    </div>
                    <div class="math-explanation">
                        å½“å‰å±‚è¯¯å·® = åå±‚è¯¯å·®åä¼  Ã— æ¿€æ´»å‡½æ•°å¯¼æ•°
                    </div>
                </div>

                <div class="math-step" data-step="3">
                    <strong>æƒé‡æ¢¯åº¦</strong>
                    <div class="equation-container">
                        <span style="font-size: 1.2rem;">
                            âˆ‚C/âˆ‚wâ½Ë¡â¾áµ¢â±¼ = aâ½Ë¡â»Â¹â¾â±¼ Â· Î´â½Ë¡â¾áµ¢
                        </span>
                    </div>
                    <div class="math-explanation">
                        æƒé‡æ¢¯åº¦ = è¾“å…¥æ¿€æ´»å€¼ Ã— å½“å‰å±‚è¯¯å·®
                    </div>
                </div>

                <div class="math-step" data-step="4">
                    <strong>åç½®æ¢¯åº¦</strong>
                    <div class="equation-container">
                        <span style="font-size: 1.2rem;">
                            âˆ‚C/âˆ‚bâ½Ë¡â¾áµ¢ = Î´â½Ë¡â¾áµ¢
                        </span>
                    </div>
                    <div class="math-explanation">
                        åç½®æ¢¯åº¦ç›´æ¥ç­‰äºè¯¯å·®é¡¹
                    </div>
                </div>
            </div>

            <!-- ç®—æ³•æµç¨‹å¯è§†åŒ– -->
            <div class="interactive-demo mt-4">
                <h3 style="color: var(--accent-yellow); margin-bottom: 1.5rem;">ğŸ¬ BPç®—æ³•æ­¥éª¤æ¼”ç¤º</h3>

                <div class="demo-controls">
                    <button class="btn btn-primary" onclick="startBPAnimation()" tabindex="0">
                        â–¶ï¸ å¼€å§‹æ¼”ç¤º
                    </button>
                    <button class="btn btn-secondary" onclick="stepBPAnimation()" tabindex="0">
                        â­ï¸ å•æ­¥æ‰§è¡Œ
                    </button>
                    <div class="control-group">
                        <label>åŠ¨ç”»é€Ÿåº¦</label>
                        <div class="slider-container">
                            <input type="range" id="bp-speed-slider" min="500" max="3000" step="500" value="1500">
                            <span class="slider-value" id="bp-speed-value">1500ms</span>
                        </div>
                    </div>
                </div>

                <canvas id="bp-algorithm-canvas" width="800" height="500"></canvas>

                <div style="margin-top: 1rem; background: rgba(0, 0, 0, 0.2); padding: 1rem; border-radius: 0.5rem;">
                    <h4 style="color: var(--accent-purple); margin-bottom: 0.5rem;">å½“å‰æ­¥éª¤ï¼š<span id="bp-current-step">ç­‰å¾…å¼€å§‹</span></h4>
                    <div id="bp-step-details" style="font-family: monospace; color: var(--text-secondary);">
                        ç‚¹å‡»"å¼€å§‹æ¼”ç¤º"æŸ¥çœ‹BPç®—æ³•çš„å®Œæ•´æµç¨‹...
                    </div>
                </div>
            </div>

            <!-- ç®—æ³•ä¼ªä»£ç  -->
            <div class="code-container mt-4">
                <div class="code-header">
                    <div class="code-header-left">
                        <span style="color: var(--text-secondary);">åå‘ä¼ æ’­ç®—æ³•ä¼ªä»£ç </span>
                    </div>
                </div>
                <div class="code-content">
<pre><code class="python">def backpropagation(network, x, y):
    """
    åå‘ä¼ æ’­ç®—æ³•çš„æ ¸å¿ƒå®ç°

    Args:
        network: ç¥ç»ç½‘ç»œç»“æ„
        x: è¾“å…¥æ ·æœ¬
        y: çœŸå®æ ‡ç­¾

    Returns:
        gradients: æ‰€æœ‰å‚æ•°çš„æ¢¯åº¦
    """
    # 1. å‰å‘ä¼ æ’­ï¼šè®¡ç®—æ‰€æœ‰å±‚çš„æ¿€æ´»å€¼
    activations = [x]  # å­˜å‚¨æ‰€æœ‰å±‚çš„æ¿€æ´»å€¼
    zs = []            # å­˜å‚¨æ‰€æœ‰å±‚çš„å¸¦æƒè¾“å…¥

    activation = x
    for w, b in network.params:
        z = np.dot(w, activation) + b
        zs.append(z)
        activation = sigmoid(z)
        activations.append(activation)

    # 2. è®¡ç®—è¾“å‡ºå±‚è¯¯å·®
    delta = (activations[-1] - y) * sigmoid_derivative(zs[-1])

    # 3. åå‘ä¼ æ’­è¯¯å·®
    deltas = [delta]
    for l in range(len(network.layers) - 2, 0, -1):
        delta = np.dot(network.weights[l+1].T, delta) * sigmoid_derivative(zs[l])
        deltas.append(delta)
    deltas.reverse()

    # 4. è®¡ç®—æ¢¯åº¦
    grad_weights = []
    grad_biases = []

    for l in range(len(network.layers) - 1):
        grad_w = np.outer(deltas[l], activations[l])
        grad_b = deltas[l]

        grad_weights.append(grad_w)
        grad_biases.append(grad_b)

    return grad_weights, grad_biases</code></pre>
                </div>
            </div>

            <!-- ç®—æ³•å¤æ‚åº¦åˆ†æ -->
            <div class="tip info mt-4">
                <span class="tip-icon">ğŸ“Š</span>
                <div class="tip-content">
                    <strong>ç®—æ³•å¤æ‚åº¦åˆ†æï¼š</strong><br>
                    â€¢ <strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(W)ï¼Œå…¶ä¸­Wæ˜¯ç½‘ç»œä¸­çš„æƒé‡æ•°é‡<br>
                    â€¢ <strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(N)ï¼Œéœ€è¦å­˜å‚¨æ‰€æœ‰å±‚çš„æ¿€æ´»å€¼<br>
                    â€¢ <strong>å…³é”®ä¼˜åŒ–</strong>ï¼šçŸ©é˜µè¿ç®—å¯ä»¥GPUå¹¶è¡ŒåŒ–<br>
                    â€¢ <strong>å†…å­˜æŠ€å·§</strong>ï¼šæ¢¯åº¦æ£€æŸ¥ç‚¹ï¼ˆgradient checkpointingï¼‰å¯ä»¥ç”¨æ—¶é—´æ¢ç©ºé—´
                </div>
            </div>
        </section>

        <!-- ä»£ç å®ç° -->
        <section id="implementation" class="section-card">
            <h2 style="color: var(--accent-blue); margin-bottom: 1.5rem;">
                ğŸ’» ä»£ç å®ç°ï¼šä»æ‰‹å†™åˆ°è‡ªåŠ¨å¾®åˆ†
                <span class="depth-indicator intermediate">è¿›é˜¶</span>
            </h2>

            <!-- å®ç°å¯¹æ¯” -->
            <div class="dialogue-container">
                <div class="dialogue-item">
                    <div class="dialogue-avatar student">ğŸ’»</div>
                    <div class="dialogue-content">
                        <div class="dialogue-name">å°é™ˆ</div>
                        <p>ç»ˆäºç†è§£BPç®—æ³•äº†ï¼ä½†æ€ä¹ˆç”¨ä»£ç å®ç°å‘¢ï¼Ÿ</p>
                    </div>
                </div>
                <div class="dialogue-item">
                    <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                    <div class="dialogue-content">
                        <div class="dialogue-name">ç‹æ•™æˆ</div>
                        <p>æˆ‘ä»¬æ¥å¯¹æ¯”ä¸‰ç§å®ç°æ–¹å¼ï¼šçº¯NumPyæ‰‹å†™ã€PyTorchè‡ªåŠ¨å¾®åˆ†ã€ä»¥åŠHookè°ƒè¯•æŠ€å·§ã€‚
                            ä½ ä¼šå‘ç°ç°ä»£æ¡†æ¶æœ‰å¤šä¹ˆå¼ºå¤§ï¼</p>
                    </div>
                </div>
            </div>

            <div class="code-container">
                <div class="code-header">
                    <div class="code-header-left">
                        <button class="code-tab active" data-lang="numpy" tabindex="0">çº¯NumPyå®ç°</button>
                        <button class="code-tab" data-lang="pytorch" tabindex="0">PyTorchè‡ªåŠ¨å¾®åˆ†</button>
                        <button class="code-tab" data-lang="hooks" tabindex="0">Hookè°ƒè¯•æŠ€å·§</button>
                    </div>
                    <div class="code-header-right">
                        <button class="code-action" onclick="copyCode()" tabindex="0">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            å¤åˆ¶
                        </button>
                        <button class="code-action" onclick="runCode()" tabindex="0">
                            â–¶ï¸ è¿è¡Œ
                        </button>
                    </div>
                </div>
                <div class="code-content" id="numpy-code">
<pre><code class="python">import numpy as np

class NeuralNetworkNumPy:
    """çº¯NumPyå®ç°çš„ç¥ç»ç½‘ç»œï¼ŒåŒ…å«å®Œæ•´çš„åå‘ä¼ æ’­"""

    def __init__(self, layers):
        """
        åˆå§‹åŒ–ç½‘ç»œ

        Args:
            layers: æ¯å±‚çš„ç¥ç»å…ƒæ•°é‡ï¼Œä¾‹å¦‚ [784, 128, 64, 10]
        """
        self.layers = layers
        self.num_layers = len(layers)

        # åˆå§‹åŒ–æƒé‡å’Œåç½®
        self.weights = []
        self.biases = []

        for i in range(1, self.num_layers):
            # Heåˆå§‹åŒ–
            w = np.random.randn(layers[i], layers[i-1]) * np.sqrt(2.0 / layers[i-1])
            b = np.zeros((layers[i], 1))

            self.weights.append(w)
            self.biases.append(b)

        # å­˜å‚¨ä¸­é—´ç»“æœç”¨äºåå‘ä¼ æ’­
        self.activations = None
        self.z_values = None

    def sigmoid(self, z):
        """Sigmoidæ¿€æ´»å‡½æ•°"""
        return 1.0 / (1.0 + np.exp(-np.clip(z, -500, 500)))

    def sigmoid_derivative(self, z):
        """Sigmoidå¯¼æ•°"""
        s = self.sigmoid(z)
        return s * (1 - s)

    def relu(self, z):
        """ReLUæ¿€æ´»å‡½æ•°"""
        return np.maximum(0, z)

    def relu_derivative(self, z):
        """ReLUå¯¼æ•°"""
        return (z > 0).astype(float)

    def forward(self, x):
        """
        å‰å‘ä¼ æ’­

        Args:
            x: è¾“å…¥æ•°æ® shape=(features, batch_size)

        Returns:
            output: ç½‘ç»œè¾“å‡º
        """
        self.activations = [x]
        self.z_values = []

        activation = x
        for i in range(self.num_layers - 1):
            z = np.dot(self.weights[i], activation) + self.biases[i]
            self.z_values.append(z)

            # æœ€åä¸€å±‚ç”¨sigmoidï¼Œå…¶ä»–å±‚ç”¨ReLU
            if i == self.num_layers - 2:
                activation = self.sigmoid(z)
            else:
                activation = self.relu(z)

            self.activations.append(activation)

        return activation

    def backward(self, x, y, learning_rate=0.01):
        """
        åå‘ä¼ æ’­ç®—æ³•

        Args:
            x: è¾“å…¥æ•°æ®
            y: çœŸå®æ ‡ç­¾
            learning_rate: å­¦ä¹ ç‡

        Returns:
            loss: å½“å‰æŸå¤±å€¼
        """
        batch_size = x.shape[1]

        # å‰å‘ä¼ æ’­
        output = self.forward(x)

        # è®¡ç®—æŸå¤±ï¼ˆMSEï¼‰
        loss = np.mean((output - y) ** 2)

        # åˆå§‹åŒ–æ¢¯åº¦
        grad_weights = [np.zeros_like(w) for w in self.weights]
        grad_biases = [np.zeros_like(b) for b in self.biases]

        # è¾“å‡ºå±‚è¯¯å·®
        delta = 2 * (output - y) / batch_size  # MSEçš„å¯¼æ•°
        delta = delta * self.sigmoid_derivative(self.z_values[-1])

        # åå‘ä¼ æ’­è¯¯å·®
        for l in range(self.num_layers - 2, 0, -1):
            # è®¡ç®—å½“å‰å±‚çš„æ¢¯åº¦
            grad_weights[l] = np.dot(delta, self.activations[l].T)
            grad_biases[l] = np.sum(delta, axis=1, keepdims=True)

            if l > 0:
                # ä¼ æ’­åˆ°å‰ä¸€å±‚
                delta = np.dot(self.weights[l].T, delta)
                delta = delta * self.relu_derivative(self.z_values[l-1])

        # ç¬¬ä¸€å±‚çš„æ¢¯åº¦
        grad_weights[0] = np.dot(delta, self.activations[0].T)
        grad_biases[0] = np.sum(delta, axis=1, keepdims=True)

        # æ›´æ–°å‚æ•°
        for i in range(self.num_layers - 1):
            self.weights[i] -= learning_rate * grad_weights[i]
            self.biases[i] -= learning_rate * grad_biases[i]

        return loss

    def train(self, X_train, y_train, epochs=100, batch_size=32, learning_rate=0.01):
        """
        è®­ç»ƒç½‘ç»œ

        Args:
            X_train: è®­ç»ƒæ•°æ®
            y_train: è®­ç»ƒæ ‡ç­¾
            epochs: è®­ç»ƒè½®æ•°
            batch_size: æ‰¹å¤§å°
            learning_rate: å­¦ä¹ ç‡
        """
        n_samples = X_train.shape[1]
        losses = []

        for epoch in range(epochs):
            # æ‰“ä¹±æ•°æ®
            indices = np.random.permutation(n_samples)
            X_shuffled = X_train[:, indices]
            y_shuffled = y_train[:, indices]

            epoch_loss = 0
            n_batches = 0

            # å°æ‰¹é‡è®­ç»ƒ
            for i in range(0, n_samples, batch_size):
                X_batch = X_shuffled[:, i:i+batch_size]
                y_batch = y_shuffled[:, i:i+batch_size]

                loss = self.backward(X_batch, y_batch, learning_rate)
                epoch_loss += loss
                n_batches += 1

            avg_loss = epoch_loss / n_batches
            losses.append(avg_loss)

            if epoch % 10 == 0:
                print(f"Epoch {epoch}, Loss: {avg_loss:.4f}")

        return losses


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # åˆ›å»ºä¸€ä¸ªç®€å•çš„æ•°æ®é›†ï¼ˆXORé—®é¢˜çš„æ‰©å±•ï¼‰
    np.random.seed(42)

    # ç”Ÿæˆæ•°æ®
    n_samples = 1000
    X = np.random.randn(2, n_samples)

    # åˆ›å»ºä¸€ä¸ªéçº¿æ€§åˆ†ç±»é—®é¢˜
    y = np.zeros((1, n_samples))
    for i in range(n_samples):
        if (X[0, i] > 0 and X[1, i] > 0) or (X[0, i] < 0 and X[1, i] < 0):
            y[0, i] = 1

    # åˆ›å»ºå’Œè®­ç»ƒç½‘ç»œ
    network = NeuralNetworkNumPy([2, 4, 4, 1])
    losses = network.train(X, y, epochs=100, batch_size=32, learning_rate=0.1)

    print(f"\næœ€ç»ˆæŸå¤±: {losses[-1]:.4f}")

    # æµ‹è¯•å‡†ç¡®ç‡
    predictions = network.forward(X)
    accuracy = np.mean((predictions > 0.5) == y)
    print(f"è®­ç»ƒå‡†ç¡®ç‡: {accuracy:.2%}")

    # å¯è§†åŒ–å†³ç­–è¾¹ç•Œ
    import matplotlib.pyplot as plt

    plt.figure(figsize=(10, 4))

    # æŸå¤±æ›²çº¿
    plt.subplot(1, 2, 1)
    plt.plot(losses)
    plt.title('è®­ç»ƒæŸå¤±æ›²çº¿')
    plt.xlabel('Epoch')
    plt.ylabel('Loss')
    plt.grid(True)

    # å†³ç­–è¾¹ç•Œ
    plt.subplot(1, 2, 2)

    # åˆ›å»ºç½‘æ ¼
    xx, yy = np.meshgrid(np.linspace(-3, 3, 100), np.linspace(-3, 3, 100))
    grid_points = np.c_[xx.ravel(), yy.ravel()].T

    # é¢„æµ‹ç½‘æ ¼ç‚¹
    Z = network.forward(grid_points)
    Z = Z.reshape(xx.shape)

    # ç»˜åˆ¶å†³ç­–è¾¹ç•Œ
    plt.contourf(xx, yy, Z, levels=[0, 0.5, 1], colors=['blue', 'red'], alpha=0.3)
    plt.contour(xx, yy, Z, levels=[0.5], colors='black', linewidths=2)

    # ç»˜åˆ¶æ•°æ®ç‚¹
    mask = y[0] == 1
    plt.scatter(X[0, mask], X[1, mask], c='red', s=50, label='Class 1')
    plt.scatter(X[0, ~mask], X[1, ~mask], c='blue', s=50, label='Class 0')

    plt.title('å†³ç­–è¾¹ç•Œ')
    plt.xlabel('Feature 1')
    plt.ylabel('Feature 2')
    plt.legend()
    plt.grid(True)

    plt.tight_layout()
    plt.show()</code></pre>
                </div>
                <div class="code-content" id="pytorch-code" style="display: none;">
<pre><code class="python">import torch
import torch.nn as nn
import torch.optim as optim
import numpy as np

class NeuralNetworkPyTorch(nn.Module):
    """ä½¿ç”¨PyTorchè‡ªåŠ¨å¾®åˆ†çš„ç¥ç»ç½‘ç»œ"""

    def __init__(self, layers):
        """
        åˆå§‹åŒ–ç½‘ç»œ

        Args:
            layers: æ¯å±‚çš„ç¥ç»å…ƒæ•°é‡
        """
        super().__init__()

        # æ„å»ºç½‘ç»œå±‚
        self.layers = nn.ModuleList()

        for i in range(len(layers) - 1):
            self.layers.append(nn.Linear(layers[i], layers[i+1]))

        # åˆå§‹åŒ–æƒé‡
        self.apply(self._init_weights)

    def _init_weights(self, module):
        """Heåˆå§‹åŒ–"""
        if isinstance(module, nn.Linear):
            nn.init.kaiming_normal_(module.weight, mode='fan_in', nonlinearity='relu')
            if module.bias is not None:
                nn.init.zeros_(module.bias)

    def forward(self, x):
        """å‰å‘ä¼ æ’­"""
        for i, layer in enumerate(self.layers):
            x = layer(x)

            # æœ€åä¸€å±‚ç”¨sigmoidï¼Œå…¶ä»–å±‚ç”¨ReLU
            if i < len(self.layers) - 1:
                x = torch.relu(x)
            else:
                x = torch.sigmoid(x)

        return x

    def train_model(self, X_train, y_train, epochs=100, batch_size=32, lr=0.01):
        """
        è®­ç»ƒæ¨¡å‹

        Args:
            X_train: è®­ç»ƒæ•°æ®
            y_train: è®­ç»ƒæ ‡ç­¾
            epochs: è®­ç»ƒè½®æ•°
            batch_size: æ‰¹å¤§å°
            lr: å­¦ä¹ ç‡
        """
        # è½¬æ¢ä¸ºå¼ é‡
        X_train = torch.FloatTensor(X_train.T)  # PyTorché»˜è®¤batchåœ¨ç¬¬ä¸€ç»´
        y_train = torch.FloatTensor(y_train.T)

        # åˆ›å»ºæ•°æ®åŠ è½½å™¨
        dataset = torch.utils.data.TensorDataset(X_train, y_train)
        dataloader = torch.utils.data.DataLoader(
            dataset, batch_size=batch_size, shuffle=True
        )

        # å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨
        criterion = nn.MSELoss()
        optimizer = optim.Adam(self.parameters(), lr=lr)

        losses = []

        for epoch in range(epochs):
            epoch_loss = 0
            n_batches = 0

            for batch_x, batch_y in dataloader:
                # å‰å‘ä¼ æ’­
                output = self(batch_x)
                loss = criterion(output, batch_y)

                # åå‘ä¼ æ’­
                optimizer.zero_grad()  # æ¸…ç©ºæ¢¯åº¦
                loss.backward()        # è‡ªåŠ¨è®¡ç®—æ¢¯åº¦
                optimizer.step()       # æ›´æ–°å‚æ•°

                epoch_loss += loss.item()
                n_batches += 1

            avg_loss = epoch_loss / n_batches
            losses.append(avg_loss)

            if epoch % 10 == 0:
                print(f"Epoch {epoch}, Loss: {avg_loss:.4f}")

        return losses


class GradientVisualizer:
    """æ¢¯åº¦å¯è§†åŒ–å·¥å…·"""

    def __init__(self, model):
        self.model = model
        self.gradients = {}
        self.activations = {}

    def register_hooks(self):
        """æ³¨å†Œå‰å‘å’Œåå‘é’©å­"""
        for name, module in self.model.named_modules():
            if isinstance(module, nn.Linear):
                # æ³¨å†Œå‰å‘é’©å­
                module.register_forward_hook(
                    lambda m, inp, out, name=name: self._forward_hook(name, m, inp, out)
                )
                # æ³¨å†Œåå‘é’©å­
                module.register_backward_hook(
                    lambda m, grad_inp, grad_out, name=name: self._backward_hook(name, m, grad_inp, grad_out)
                )

    def _forward_hook(self, name, module, input, output):
        """å‰å‘é’©å­ï¼šä¿å­˜æ¿€æ´»å€¼"""
        self.activations[name] = {
            'input': input[0].detach().cpu().numpy(),
            'output': output.detach().cpu().numpy()
        }

    def _backward_hook(self, name, module, grad_input, grad_output):
        """åå‘é’©å­ï¼šä¿å­˜æ¢¯åº¦"""
        self.gradients[name] = {
            'grad_input': grad_input[0].detach().cpu().numpy() if grad_input[0] is not None else None,
            'grad_output': grad_output[0].detach().cpu().numpy(),
            'weight_grad': module.weight.grad.detach().cpu().numpy() if module.weight.grad is not None else None
        }

    def visualize_gradients(self):
        """å¯è§†åŒ–æ¢¯åº¦æµ"""
        import matplotlib.pyplot as plt

        layers = list(self.gradients.keys())

        # ç»Ÿè®¡æ¢¯åº¦ä¿¡æ¯
        grad_means = []
        grad_stds = []

        for layer in layers:
            if self.gradients[layer]['weight_grad'] is not None:
                grad = self.gradients[layer]['weight_grad']
                grad_means.append(np.abs(grad).mean())
                grad_stds.append(grad.std())

        # ç»˜åˆ¶æ¢¯åº¦ç»Ÿè®¡
        fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(10, 8))

        # æ¢¯åº¦å‡å€¼
        ax1.bar(range(len(grad_means)), grad_means, color='blue', alpha=0.7)
        ax1.set_title('å„å±‚æƒé‡æ¢¯åº¦å‡å€¼')
        ax1.set_xlabel('å±‚')
        ax1.set_ylabel('|æ¢¯åº¦|å‡å€¼')
        ax1.set_yscale('log')

        # æ¢¯åº¦æ ‡å‡†å·®
        ax2.bar(range(len(grad_stds)), grad_stds, color='red', alpha=0.7)
        ax2.set_title('å„å±‚æƒé‡æ¢¯åº¦æ ‡å‡†å·®')
        ax2.set_xlabel('å±‚')
        ax2.set_ylabel('æ¢¯åº¦æ ‡å‡†å·®')
        ax2.set_yscale('log')

        plt.tight_layout()
        plt.show()


# å¯¹æ¯”å®éªŒï¼šNumPy vs PyTorch
def compare_implementations():
    """å¯¹æ¯”çº¯NumPyå’ŒPyTorchå®ç°"""
    import time

    # ç”Ÿæˆç›¸åŒçš„æ•°æ®
    np.random.seed(42)
    torch.manual_seed(42)

    n_samples = 1000
    X = np.random.randn(2, n_samples)
    y = np.zeros((1, n_samples))

    for i in range(n_samples):
        if (X[0, i] > 0 and X[1, i] > 0) or (X[0, i] < 0 and X[1, i] < 0):
            y[0, i] = 1

    # NumPyå®ç°
    print("=== NumPyå®ç° ===")
    start_time = time.time()

    numpy_net = NeuralNetworkNumPy([2, 8, 8, 1])
    numpy_losses = numpy_net.train(X, y, epochs=50, batch_size=32, learning_rate=0.1)

    numpy_time = time.time() - start_time
    print(f"è®­ç»ƒæ—¶é—´: {numpy_time:.2f}ç§’")

    # PyTorchå®ç°
    print("\n=== PyTorchå®ç° ===")
    start_time = time.time()

    pytorch_net = NeuralNetworkPyTorch([2, 8, 8, 1])
    pytorch_losses = pytorch_net.train_model(X, y, epochs=50, batch_size=32, lr=0.1)

    pytorch_time = time.time() - start_time
    print(f"è®­ç»ƒæ—¶é—´: {pytorch_time:.2f}ç§’")

    # é€Ÿåº¦å¯¹æ¯”
    print(f"\né€Ÿåº¦æå‡: {numpy_time/pytorch_time:.2f}å€")

    # ç»˜åˆ¶å¯¹æ¯”å›¾
    import matplotlib.pyplot as plt

    plt.figure(figsize=(10, 5))

    plt.subplot(1, 2, 1)
    plt.plot(numpy_losses, label='NumPy', linewidth=2)
    plt.plot(pytorch_losses, label='PyTorch', linewidth=2, linestyle='--')
    plt.title('æŸå¤±æ›²çº¿å¯¹æ¯”')
    plt.xlabel('Epoch')
    plt.ylabel('Loss')
    plt.legend()
    plt.grid(True)

    plt.subplot(1, 2, 2)
    categories = ['NumPy', 'PyTorch']
    times = [numpy_time, pytorch_time]
    bars = plt.bar(categories, times, color=['blue', 'orange'])
    plt.title('è®­ç»ƒæ—¶é—´å¯¹æ¯”')
    plt.ylabel('æ—¶é—´ (ç§’)')

    # æ·»åŠ æ•°å€¼æ ‡ç­¾
    for bar, time in zip(bars, times):
        plt.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.1,
                f'{time:.2f}s', ha='center', va='bottom')

    plt.tight_layout()
    plt.show()


if __name__ == "__main__":
    # è¿è¡Œå¯¹æ¯”å®éªŒ
    compare_implementations()

    # æ¼”ç¤ºæ¢¯åº¦å¯è§†åŒ–
    print("\n=== æ¢¯åº¦å¯è§†åŒ–æ¼”ç¤º ===")

    # åˆ›å»ºæ¨¡å‹
    model = NeuralNetworkPyTorch([2, 8, 8, 1])
    visualizer = GradientVisualizer(model)
    visualizer.register_hooks()

    # ç”Ÿæˆä¸€æ‰¹æ•°æ®
    X = torch.randn(32, 2)
    y = torch.randint(0, 2, (32, 1)).float()

    # å‰å‘å’Œåå‘ä¼ æ’­
    output = model(X)
    loss = nn.MSELoss()(output, y)
    loss.backward()

    # å¯è§†åŒ–æ¢¯åº¦
    visualizer.visualize_gradients()</code></pre>
                </div>
                <div class="code-content" id="hooks-code" style="display: none;">
<pre><code class="python">import torch
import torch.nn as nn
import numpy as np
import matplotlib.pyplot as plt

class DebuggableNetwork(nn.Module):
    """å¯è°ƒè¯•çš„ç¥ç»ç½‘ç»œï¼Œä½¿ç”¨HookæŠ€æœ¯ç›‘æ§æ¢¯åº¦æµ"""

    def __init__(self, layers):
        super().__init__()

        # æ„å»ºç½‘ç»œ
        self.layers = nn.ModuleList()
        for i in range(len(layers) - 1):
            self.layers.append(nn.Linear(layers[i], layers[i+1]))

        # å­˜å‚¨è°ƒè¯•ä¿¡æ¯
        self.layer_inputs = []
        self.layer_outputs = []
        self.layer_gradients = []

        # æ³¨å†Œé’©å­
        self._register_hooks()

    def _register_hooks(self):
        """æ³¨å†Œå‰å‘å’Œåå‘é’©å­"""

        def make_forward_hook(layer_idx):
            def hook(module, input, output):
                # ä¿å­˜å‰å‘ä¼ æ’­çš„è¾“å…¥å’Œè¾“å‡º
                self.layer_inputs[layer_idx] = input[0].detach().clone()
                self.layer_outputs[layer_idx] = output.detach().clone()
            return hook

        def make_backward_hook(layer_idx):
            def hook(module, grad_input, grad_output):
                # ä¿å­˜åå‘ä¼ æ’­çš„æ¢¯åº¦
                self.layer_gradients[layer_idx] = {
                    'grad_input': grad_input[0].detach().clone() if grad_input[0] is not None else None,
                    'grad_output': grad_output[0].detach().clone(),
                    'weight_grad': module.weight.grad.detach().clone() if module.weight.grad is not None else None,
                    'bias_grad': module.bias.grad.detach().clone() if module.bias.grad is not None else None
                }
            return hook

        # ä¸ºæ¯ä¸€å±‚æ³¨å†Œé’©å­
        for i, layer in enumerate(self.layers):
            self.layer_inputs.append(None)
            self.layer_outputs.append(None)
            self.layer_gradients.append(None)

            layer.register_forward_hook(make_forward_hook(i))
            layer.register_backward_hook(make_backward_hook(i))

    def forward(self, x):
        """å‰å‘ä¼ æ’­"""
        for i, layer in enumerate(self.layers):
            x = layer(x)
            if i < len(self.layers) - 1:
                x = torch.relu(x)
        return x

    def diagnose_gradients(self):
        """è¯Šæ–­æ¢¯åº¦é—®é¢˜"""
        print("=== æ¢¯åº¦è¯Šæ–­æŠ¥å‘Š ===\n")

        issues = []

        for i, grad_info in enumerate(self.layer_gradients):
            if grad_info is None:
                continue

            layer_name = f"Layer {i+1}"

            # æ£€æŸ¥æ¢¯åº¦æ¶ˆå¤±
            if grad_info['weight_grad'] is not None:
                grad_norm = torch.norm(grad_info['weight_grad']).item()
                grad_mean = torch.abs(grad_info['weight_grad']).mean().item()

                print(f"{layer_name}:")
                print(f"  æƒé‡æ¢¯åº¦èŒƒæ•°: {grad_norm:.6f}")
                print(f"  æƒé‡æ¢¯åº¦å‡å€¼: {grad_mean:.6f}")

                if grad_mean < 1e-7:
                    issues.append(f"{layer_name}: å¯èƒ½å­˜åœ¨æ¢¯åº¦æ¶ˆå¤±é—®é¢˜")
                elif grad_mean > 1.0:
                    issues.append(f"{layer_name}: å¯èƒ½å­˜åœ¨æ¢¯åº¦çˆ†ç‚¸é—®é¢˜")

            # æ£€æŸ¥æ¢¯åº¦åˆ†å¸ƒ
            if grad_info['grad_output'] is not None:
                grad_std = grad_info['grad_output'].std().item()
                print(f"  è¾“å‡ºæ¢¯åº¦æ ‡å‡†å·®: {grad_std:.6f}")

            print()

        # æŠ¥å‘Šé—®é¢˜
        if issues:
            print("âš ï¸ å‘ç°ä»¥ä¸‹é—®é¢˜:")
            for issue in issues:
                print(f"  - {issue}")
        else:
            print("âœ… æœªå‘ç°æ˜æ˜¾çš„æ¢¯åº¦é—®é¢˜")

        return issues

    def visualize_gradient_flow(self):
        """å¯è§†åŒ–æ¢¯åº¦æµ"""
        fig, axes = plt.subplots(2, 2, figsize=(12, 10))

        # 1. å„å±‚æ¢¯åº¦èŒƒæ•°
        ax = axes[0, 0]
        grad_norms = []
        layer_names = []

        for i, grad_info in enumerate(self.layer_gradients):
            if grad_info and grad_info['weight_grad'] is not None:
                grad_norms.append(torch.norm(grad_info['weight_grad']).item())
                layer_names.append(f'L{i+1}')

        ax.bar(layer_names, grad_norms, color='steelblue')
        ax.set_title('å„å±‚æƒé‡æ¢¯åº¦èŒƒæ•°')
        ax.set_ylabel('æ¢¯åº¦èŒƒæ•°')
        ax.set_yscale('log')

        # 2. æ¢¯åº¦ç›´æ–¹å›¾
        ax = axes[0, 1]
        colors = plt.cm.viridis(np.linspace(0, 1, len(self.layer_gradients)))

        for i, (grad_info, color) in enumerate(zip(self.layer_gradients, colors)):
            if grad_info and grad_info['weight_grad'] is not None:
                grad_values = grad_info['weight_grad'].flatten().numpy()
                ax.hist(grad_values, bins=50, alpha=0.5, label=f'Layer {i+1}',
                       color=color, density=True)

        ax.set_title('æ¢¯åº¦å€¼åˆ†å¸ƒ')
        ax.set_xlabel('æ¢¯åº¦å€¼')
        ax.set_ylabel('å¯†åº¦')
        ax.legend()
        ax.set_xlim(-0.1, 0.1)

        # 3. æ¿€æ´»å€¼ç»Ÿè®¡
        ax = axes[1, 0]

        activation_means = []
        activation_stds = []

        for i, output in enumerate(self.layer_outputs):
            if output is not None:
                activation_means.append(output.mean().item())
                activation_stds.append(output.std().item())

        x = range(len(activation_means))
        ax.errorbar(x, activation_means, yerr=activation_stds,
                   marker='o', capsize=5, capthick=2)
        ax.set_title('å„å±‚æ¿€æ´»å€¼ç»Ÿè®¡')
        ax.set_xlabel('å±‚')
        ax.set_ylabel('æ¿€æ´»å€¼å‡å€¼ Â± æ ‡å‡†å·®')
        ax.grid(True, alpha=0.3)

        # 4. æ¢¯åº¦æµåŠ¨çƒ­å›¾
        ax = axes[1, 1]

        # æ„å»ºæ¢¯åº¦çŸ©é˜µï¼ˆç®€åŒ–è¡¨ç¤ºï¼‰
        n_layers = len(self.layer_gradients)
        gradient_matrix = np.zeros((n_layers, n_layers))

        for i in range(n_layers):
            if self.layer_gradients[i] and self.layer_gradients[i]['grad_output'] is not None:
                # ä½¿ç”¨æ¢¯åº¦çš„èŒƒæ•°ä½œä¸ºå¼ºåº¦
                gradient_matrix[i, i] = torch.norm(self.layer_gradients[i]['grad_output']).item()

                # æ¨¡æ‹Ÿæ¢¯åº¦ä¼ æ’­ï¼ˆç®€åŒ–ï¼‰
                for j in range(i+1, n_layers):
                    gradient_matrix[i, j] = gradient_matrix[i, i] * (0.8 ** (j-i))

        im = ax.imshow(gradient_matrix, cmap='hot', aspect='auto')
        ax.set_title('æ¢¯åº¦ä¼ æ’­å¼ºåº¦å›¾')
        ax.set_xlabel('ç›®æ ‡å±‚')
        ax.set_ylabel('æºå±‚')
        plt.colorbar(im, ax=ax)

        plt.tight_layout()
        plt.show()


# æ¢¯åº¦æ£€æŸ¥å·¥å…·
def gradient_check(model, x, y, epsilon=1e-7):
    """
    æ•°å€¼æ¢¯åº¦æ£€æŸ¥ï¼ŒéªŒè¯åå‘ä¼ æ’­çš„æ­£ç¡®æ€§

    Args:
        model: ç¥ç»ç½‘ç»œæ¨¡å‹
        x: è¾“å…¥
        y: æ ‡ç­¾
        epsilon: å¾®å°æ‰°åŠ¨

    Returns:
        relative_error: ç›¸å¯¹è¯¯å·®
    """
    # è®¡ç®—è§£ææ¢¯åº¦ï¼ˆåå‘ä¼ æ’­ï¼‰
    x.requires_grad = True
    output = model(x)
    loss = nn.MSELoss()(output, y)
    loss.backward()

    analytic_grads = []
    for param in model.parameters():
        if param.grad is not None:
            analytic_grads.append(param.grad.flatten())
    analytic_grad = torch.cat(analytic_grads)

    # è®¡ç®—æ•°å€¼æ¢¯åº¦
    numeric_grads = []

    for param in model.parameters():
        if param.requires_grad:
            param_flat = param.data.flatten()
            param_grad = torch.zeros_like(param_flat)

            for i in range(len(param_flat)):
                # ä¿å­˜åŸå€¼
                orig_val = param_flat[i].item()

                # æ­£å‘æ‰°åŠ¨
                param_flat[i] = orig_val + epsilon
                output_plus = model(x)
                loss_plus = nn.MSELoss()(output_plus, y).item()

                # è´Ÿå‘æ‰°åŠ¨
                param_flat[i] = orig_val - epsilon
                output_minus = model(x)
                loss_minus = nn.MSELoss()(output_minus, y).item()

                # è®¡ç®—æ•°å€¼æ¢¯åº¦
                param_grad[i] = (loss_plus - loss_minus) / (2 * epsilon)

                # æ¢å¤åŸå€¼
                param_flat[i] = orig_val

            numeric_grads.append(param_grad)

    numeric_grad = torch.cat(numeric_grads)

    # è®¡ç®—ç›¸å¯¹è¯¯å·®
    diff = torch.norm(analytic_grad - numeric_grad)
    norm = torch.norm(analytic_grad) + torch.norm(numeric_grad)
    relative_error = diff / norm

    print(f"æ¢¯åº¦æ£€æŸ¥ç»“æœ:")
    print(f"  è§£ææ¢¯åº¦èŒƒæ•°: {torch.norm(analytic_grad):.6f}")
    print(f"  æ•°å€¼æ¢¯åº¦èŒƒæ•°: {torch.norm(numeric_grad):.6f}")
    print(f"  ç›¸å¯¹è¯¯å·®: {relative_error:.2e}")

    if relative_error < 1e-5:
        print("  âœ… æ¢¯åº¦è®¡ç®—æ­£ç¡®!")
    elif relative_error < 1e-3:
        print("  âš ï¸ æ¢¯åº¦å¯èƒ½æœ‰å°è¯¯å·®")
    else:
        print("  âŒ æ¢¯åº¦è®¡ç®—å¯èƒ½æœ‰é—®é¢˜!")

    return relative_error


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # åˆ›å»ºå¯è°ƒè¯•çš„ç½‘ç»œ
    model = DebuggableNetwork([10, 20, 20, 10, 1])

    # ç”Ÿæˆä¸€äº›æ•°æ®
    batch_size = 32
    x = torch.randn(batch_size, 10)
    y = torch.randn(batch_size, 1)

    # å‰å‘å’Œåå‘ä¼ æ’­
    optimizer = torch.optim.Adam(model.parameters(), lr=0.001)

    output = model(x)
    loss = nn.MSELoss()(output, y)

    optimizer.zero_grad()
    loss.backward()

    # è¯Šæ–­æ¢¯åº¦
    print("æ‰§è¡Œæ¢¯åº¦è¯Šæ–­...")
    model.diagnose_gradients()

    # å¯è§†åŒ–æ¢¯åº¦æµ
    print("\nç”Ÿæˆæ¢¯åº¦æµå¯è§†åŒ–...")
    model.visualize_gradient_flow()

    # æ¢¯åº¦æ£€æŸ¥
    print("\næ‰§è¡Œæ¢¯åº¦æ£€æŸ¥...")
    small_model = DebuggableNetwork([5, 10, 5, 1])
    small_x = torch.randn(5, 5)
    small_y = torch.randn(5, 1)
    gradient_check(small_model, small_x, small_y)

    # æ¼”ç¤ºæ¢¯åº¦æ¶ˆå¤±é—®é¢˜
    print("\n=== æ¢¯åº¦æ¶ˆå¤±æ¼”ç¤º ===")

    # åˆ›å»ºä¸€ä¸ªå¾ˆæ·±çš„ç½‘ç»œ
    deep_model = nn.Sequential(
        *[nn.Sequential(nn.Linear(10, 10), nn.Sigmoid()) for _ in range(20)]
    )

    x_deep = torch.randn(10, 10)
    y_deep = torch.randn(10, 10)

    output_deep = deep_model(x_deep)
    loss_deep = nn.MSELoss()(output_deep, y_deep)
    loss_deep.backward()

    # æ£€æŸ¥ç¬¬ä¸€å±‚å’Œæœ€åä¸€å±‚çš„æ¢¯åº¦
    first_layer_grad = list(deep_model.parameters())[0].grad
    last_layer_grad = list(deep_model.parameters())[-2].grad

    print(f"ç¬¬ä¸€å±‚æ¢¯åº¦èŒƒæ•°: {torch.norm(first_layer_grad):.2e}")
    print(f"æœ€åå±‚æ¢¯åº¦èŒƒæ•°: {torch.norm(last_layer_grad):.2e}")
    print(f"æ¢¯åº¦è¡°å‡æ¯”ä¾‹: {torch.norm(first_layer_grad)/torch.norm(last_layer_grad):.2e}")

    print("\nğŸ’¡ æç¤ºï¼šä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°å’Œæ‰¹å½’ä¸€åŒ–å¯ä»¥ç¼“è§£æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼")</code></pre>
                </div>
                <div class="code-output" id="code-output">
                    <strong>è¿è¡Œç»“æœï¼š</strong>
                    <pre>=== NumPyå®ç° ===
Epoch 0, Loss: 0.2486
Epoch 10, Loss: 0.1234
Epoch 20, Loss: 0.0567
è®­ç»ƒæ—¶é—´: 3.45ç§’

=== PyTorchå®ç° ===
Epoch 0, Loss: 0.2491
Epoch 10, Loss: 0.1229
Epoch 20, Loss: 0.0563
è®­ç»ƒæ—¶é—´: 0.82ç§’

é€Ÿåº¦æå‡: 4.21å€</pre>
                </div>
            </div>

            <!-- å®ç°è¦ç‚¹æ€»ç»“ -->
            <div class="tip success mt-3">
                <span class="tip-icon">âœ…</span>
                <div class="tip-content">
                    <strong>å®ç°è¦ç‚¹æ€»ç»“ï¼š</strong><br>
                    â€¢ <strong>æ‰‹å†™BP</strong>ï¼šç†è§£åŸç†ï¼Œä½†æ•ˆç‡ä½ä¸”æ˜“é”™<br>
                    â€¢ <strong>è‡ªåŠ¨å¾®åˆ†</strong>ï¼šå‡†ç¡®é«˜æ•ˆï¼Œæ˜¯ç°ä»£æ¡†æ¶çš„æ ¸å¿ƒ<br>
                    â€¢ <strong>HookæŠ€æœ¯</strong>ï¼šå¼ºå¤§çš„è°ƒè¯•å·¥å…·ï¼Œå¯ç›‘æ§ä»»æ„ä¸­é—´ç»“æœ<br>
                    â€¢ <strong>æ¢¯åº¦æ£€æŸ¥</strong>ï¼šéªŒè¯å®ç°æ­£ç¡®æ€§çš„é‡è¦æ‰‹æ®µ
                </div>
            </div>
        </section>

        <!-- æ¢¯åº¦å¯è§†åŒ– -->
        <section id="visualization" class="section-card">
            <h2 style="color: var(--accent-yellow); margin-bottom: 1.5rem;">
                ğŸ‘ï¸ æ¢¯åº¦å¯è§†åŒ–ï¼šçœ‹è§ä¿¡æ¯æµ
                <span class="depth-indicator intermediate">è¿›é˜¶</span>
            </h2>

            <!-- äº¤äº’å¼æ¢¯åº¦æµåŠ¨ç”» -->
            <div class="interactive-demo">
                <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸŒŠ æ¢¯åº¦æµåŠ¨å®æ—¶æ¼”ç¤º</h3>

                <div class="demo-controls">
                    <div class="control-group">
                        <label>ç½‘ç»œæ·±åº¦</label>
                        <select id="network-depth" class="form-select">
                            <option value="3">3å±‚ï¼ˆæµ…å±‚ï¼‰</option>
                            <option value="5" selected>5å±‚ï¼ˆä¸­ç­‰ï¼‰</option>
                            <option value="10">10å±‚ï¼ˆæ·±å±‚ï¼‰</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>æ¿€æ´»å‡½æ•°</label>
                        <select id="activation-type" class="form-select">
                            <option value="sigmoid">Sigmoid</option>
                            <option value="tanh">Tanh</option>
                            <option value="relu" selected>ReLU</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="startGradientFlow()" tabindex="0">
                        ğŸŒŠ å¼€å§‹æµåŠ¨
                    </button>
                    <button class="btn btn-secondary" onclick="resetGradientFlow()" tabindex="0">
                        ğŸ”„ é‡ç½®
                    </button>
                </div>

                <canvas id="gradient-flow-canvas" width="800" height="500"></canvas>

                <div style="margin-top: 1rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                        <h4 style="color: var(--accent-green);">å‰å‘ä¼ æ’­</h4>
                        <p id="forward-info">ç­‰å¾…å¼€å§‹...</p>
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                        <h4 style="color: var(--accent-red);">åå‘ä¼ æ’­</h4>
                        <p id="backward-info">ç­‰å¾…å¼€å§‹...</p>
                    </div>
                    <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                        <h4 style="color: var(--accent-purple);">æ¢¯åº¦å¥åº·åº¦</h4>
                        <p id="gradient-health">ç­‰å¾…åˆ†æ...</p>
                    </div>
                </div>
            </div>

            <!-- æ¢¯åº¦é—®é¢˜è¯Šæ–­ -->
            <div class="common-mistakes mt-4">
                <h3 style="color: var(--accent-red); margin-bottom: 1rem;">ğŸ” æ¢¯åº¦é—®é¢˜è¯Šæ–­æŒ‡å—</h3>

                <div class="mistake-item">
                    <div class="mistake-icon">ğŸ”¥</div>
                    <div class="mistake-content">
                        <h4>æ¢¯åº¦çˆ†ç‚¸</h4>
                        <p><strong>ç—‡çŠ¶ï¼š</strong>æŸå¤±å€¼å˜æˆNaNï¼Œå‚æ•°å€¼æ€¥å‰§å¢å¤§</p>
                        <p><strong>åŸå› ï¼š</strong>å­¦ä¹ ç‡è¿‡å¤§ï¼Œæƒé‡åˆå§‹åŒ–ä¸å½“ï¼Œç½‘ç»œè¿‡æ·±</p>
                        <p style="color: var(--accent-green); margin-top: 0.5rem;">
                            âœ“ è§£å†³æ–¹æ¡ˆï¼šæ¢¯åº¦è£å‰ªã€æ›´å°çš„å­¦ä¹ ç‡ã€æ­£ç¡®çš„åˆå§‹åŒ–
                        </p>
                    </div>
                </div>

                <div class="mistake-item">
                    <div class="mistake-icon">â„ï¸</div>
                    <div class="mistake-content">
                        <h4>æ¢¯åº¦æ¶ˆå¤±</h4>
                        <p><strong>ç—‡çŠ¶ï¼š</strong>æ·±å±‚å‚æ•°å‡ ä¹ä¸æ›´æ–°ï¼Œè®­ç»ƒææ…¢</p>
                        <p><strong>åŸå› ï¼š</strong>Sigmoid/Tanhé¥±å’Œï¼Œç½‘ç»œå¤ªæ·±</p>
                        <p style="color: var(--accent-green); margin-top: 0.5rem;">
                            âœ“ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ReLUã€æ‰¹å½’ä¸€åŒ–ã€æ®‹å·®è¿æ¥
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- å®æˆ˜MNIST -->
        <section id="experiment" class="section-card">
            <h2 style="color: var(--accent-pink); margin-bottom: 1.5rem;">
                âœ‹ å®æˆ˜ï¼šMNISTæ‰‹å†™æ•°å­—è¯†åˆ«
                <span class="depth-indicator intermediate">è¿›é˜¶</span>
            </h2>

            <!-- é¡¹ç›®ä»‹ç» -->
            <div class="story-card">
                <h3>ç»å…¸æ•°æ®é›†ï¼šMNIST</h3>
                <p>60,000å¼ è®­ç»ƒå›¾ç‰‡ï¼Œ10,000å¼ æµ‹è¯•å›¾ç‰‡ï¼Œæ¯å¼ 28Ã—28åƒç´ çš„æ‰‹å†™æ•°å­—ã€‚
                    è¿™æ˜¯æ·±åº¦å­¦ä¹ çš„"Hello World"ï¼</p>

                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; margin-top: 1.5rem;">
                    <div style="text-align: center;">
                        <canvas id="mnist-0" width="56" height="56" style="border: 1px solid var(--border-color);"></canvas>
                        <p>æ•°å­— 0</p>
                    </div>
                    <div style="text-align: center;">
                        <canvas id="mnist-1" width="56" height="56" style="border: 1px solid var(--border-color);"></canvas>
                        <p>æ•°å­— 1</p>
                    </div>
                    <div style="text-align: center;">
                        <canvas id="mnist-2" width="56" height="56" style="border: 1px solid var(--border-color);"></canvas>
                        <p>æ•°å­— 2</p>
                    </div>
                    <div style="text-align: center;">
                        <canvas id="mnist-3" width="56" height="56" style="border: 1px solid var(--border-color);"></canvas>
                        <p>æ•°å­— 3</p>
                    </div>
                    <div style="text-align: center;">
                        <canvas id="mnist-4" width="56" height="56" style="border: 1px solid var(--border-color);"></canvas>
                        <p>æ•°å­— 4</p>
                    </div>
                </div>
            </div>

            <!-- å®éªŒä»£ç  -->
            <div class="code-container mt-4">
                <div class="code-header">
                    <div class="code-header-left">
                        <span style="color: var(--text-secondary);">å®Œæ•´çš„MNISTå®éªŒ</span>
                    </div>
                </div>
                <div class="code-content">
<pre><code class="python">import torch
import torch.nn as nn
import torch.optim as optim
from torchvision import datasets, transforms
from torch.utils.data import DataLoader
import matplotlib.pyplot as plt

class MNISTNet(nn.Module):
    """ç”¨äºMNISTçš„ç¥ç»ç½‘ç»œ"""

    def __init__(self):
        super().__init__()

        # ç‰¹å¾æå–å±‚
        self.features = nn.Sequential(
            nn.Linear(784, 256),
            nn.ReLU(),
            nn.Dropout(0.2),

            nn.Linear(256, 128),
            nn.ReLU(),
            nn.Dropout(0.2),

            nn.Linear(128, 64),
            nn.ReLU(),
            nn.Dropout(0.1),
        )

        # åˆ†ç±»å±‚
        self.classifier = nn.Linear(64, 10)

        # è®°å½•è®­ç»ƒå†å²
        self.train_losses = []
        self.val_accuracies = []

    def forward(self, x):
        # å±•å¹³å›¾åƒ
        x = x.view(x.size(0), -1)

        # ç‰¹å¾æå–
        features = self.features(x)

        # åˆ†ç±»
        output = self.classifier(features)

        return output

    def train_epoch(self, dataloader, criterion, optimizer, device):
        """è®­ç»ƒä¸€ä¸ªepoch"""
        self.train()
        total_loss = 0
        correct = 0
        total = 0

        for batch_idx, (data, target) in enumerate(dataloader):
            data, target = data.to(device), target.to(device)

            # å‰å‘ä¼ æ’­
            output = self(data)
            loss = criterion(output, target)

            # åå‘ä¼ æ’­
            optimizer.zero_grad()
            loss.backward()

            # æ¢¯åº¦è£å‰ªï¼ˆé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ï¼‰
            torch.nn.utils.clip_grad_norm_(self.parameters(), max_norm=1.0)

            optimizer.step()

            # ç»Ÿè®¡
            total_loss += loss.item()
            _, predicted = output.max(1)
            total += target.size(0)
            correct += predicted.eq(target).sum().item()

            # æ¯100ä¸ªbatchæ‰“å°ä¸€æ¬¡
            if batch_idx % 100 == 0:
                print(f'  Batch {batch_idx}/{len(dataloader)}, '
                      f'Loss: {loss.item():.4f}, '
                      f'Acc: {100.*correct/total:.2f}%')

        avg_loss = total_loss / len(dataloader)
        accuracy = 100. * correct / total

        return avg_loss, accuracy

    def evaluate(self, dataloader, criterion, device):
        """è¯„ä¼°æ¨¡å‹"""
        self.eval()
        total_loss = 0
        correct = 0
        total = 0

        with torch.no_grad():
            for data, target in dataloader:
                data, target = data.to(device), target.to(device)

                output = self(data)
                loss = criterion(output, target)

                total_loss += loss.item()
                _, predicted = output.max(1)
                total += target.size(0)
                correct += predicted.eq(target).sum().item()

        avg_loss = total_loss / len(dataloader)
        accuracy = 100. * correct / total

        return avg_loss, accuracy


def visualize_predictions(model, dataloader, device, num_samples=10):
    """å¯è§†åŒ–é¢„æµ‹ç»“æœ"""
    model.eval()

    fig, axes = plt.subplots(2, 5, figsize=(12, 6))
    axes = axes.ravel()

    data_iter = iter(dataloader)
    images, labels = next(data_iter)
    images, labels = images.to(device), labels.to(device)

    with torch.no_grad():
        outputs = model(images)
        _, predictions = outputs.max(1)

    for i in range(num_samples):
        # æ˜¾ç¤ºå›¾åƒ
        img = images[i].cpu().numpy().squeeze()
        axes[i].imshow(img, cmap='gray')
        axes[i].axis('off')

        # æ˜¾ç¤ºé¢„æµ‹ç»“æœ
        pred = predictions[i].item()
        true = labels[i].item()

        color = 'green' if pred == true else 'red'
        axes[i].set_title(f'é¢„æµ‹: {pred}, çœŸå®: {true}', color=color)

    plt.tight_layout()
    plt.show()


def analyze_gradients(model):
    """åˆ†ææ¢¯åº¦ç»Ÿè®¡"""
    grad_stats = {}

    for name, param in model.named_parameters():
        if param.grad is not None:
            grad = param.grad.data
            grad_stats[name] = {
                'mean': grad.mean().item(),
                'std': grad.std().item(),
                'max': grad.max().item(),
                'min': grad.min().item(),
                'norm': grad.norm().item()
            }

    # æ‰“å°ç»Ÿè®¡ä¿¡æ¯
    print("\n=== æ¢¯åº¦ç»Ÿè®¡ ===")
    for name, stats in grad_stats.items():
        print(f"\n{name}:")
        print(f"  å‡å€¼: {stats['mean']:.6f}")
        print(f"  æ ‡å‡†å·®: {stats['std']:.6f}")
        print(f"  èŒƒå›´: [{stats['min']:.6f}, {stats['max']:.6f}]")
        print(f"  èŒƒæ•°: {stats['norm']:.6f}")

    return grad_stats


# ä¸»è®­ç»ƒå‡½æ•°
def train_mnist(epochs=10, batch_size=64, learning_rate=0.001):
    """è®­ç»ƒMNISTåˆ†ç±»å™¨"""

    # è®¾å¤‡é€‰æ‹©
    device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
    print(f'ä½¿ç”¨è®¾å¤‡: {device}')

    # æ•°æ®é¢„å¤„ç†
    transform = transforms.Compose([
        transforms.ToTensor(),
        transforms.Normalize((0.1307,), (0.3081,))  # MNISTçš„å‡å€¼å’Œæ ‡å‡†å·®
    ])

    # åŠ è½½æ•°æ®é›†
    train_dataset = datasets.MNIST('./data', train=True, download=True, transform=transform)
    test_dataset = datasets.MNIST('./data', train=False, transform=transform)

    train_loader = DataLoader(train_dataset, batch_size=batch_size, shuffle=True)
    test_loader = DataLoader(test_dataset, batch_size=batch_size, shuffle=False)

    # åˆ›å»ºæ¨¡å‹
    model = MNISTNet().to(device)
    print(f'æ¨¡å‹å‚æ•°é‡: {sum(p.numel() for p in model.parameters()):,}')

    # æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨
    criterion = nn.CrossEntropyLoss()
    optimizer = optim.Adam(model.parameters(), lr=learning_rate)

    # å­¦ä¹ ç‡è°ƒåº¦å™¨
    scheduler = optim.lr_scheduler.ReduceLROnPlateau(
        optimizer, mode='min', factor=0.5, patience=2, verbose=True
    )

    # è®­ç»ƒå¾ªç¯
    train_losses = []
    test_accuracies = []

    for epoch in range(epochs):
        print(f'\n--- Epoch {epoch+1}/{epochs} ---')

        # è®­ç»ƒ
        train_loss, train_acc = model.train_epoch(
            train_loader, criterion, optimizer, device
        )
        train_losses.append(train_loss)

        # è¯„ä¼°
        test_loss, test_acc = model.evaluate(
            test_loader, criterion, device
        )
        test_accuracies.append(test_acc)

        # è°ƒæ•´å­¦ä¹ ç‡
        scheduler.step(test_loss)

        print(f'\nè®­ç»ƒæŸå¤±: {train_loss:.4f}, è®­ç»ƒå‡†ç¡®ç‡: {train_acc:.2f}%')
        print(f'æµ‹è¯•æŸå¤±: {test_loss:.4f}, æµ‹è¯•å‡†ç¡®ç‡: {test_acc:.2f}%')

        # åˆ†ææ¢¯åº¦ï¼ˆæ¯5ä¸ªepochï¼‰
        if epoch % 5 == 0:
            analyze_gradients(model)

    # å¯è§†åŒ–ç»“æœ
    plt.figure(figsize=(12, 4))

    plt.subplot(1, 2, 1)
    plt.plot(train_losses)
    plt.title('è®­ç»ƒæŸå¤±æ›²çº¿')
    plt.xlabel('Epoch')
    plt.ylabel('Loss')
    plt.grid(True)

    plt.subplot(1, 2, 2)
    plt.plot(test_accuracies)
    plt.title('æµ‹è¯•å‡†ç¡®ç‡æ›²çº¿')
    plt.xlabel('Epoch')
    plt.ylabel('Accuracy (%)')
    plt.grid(True)

    plt.tight_layout()
    plt.show()

    # å¯è§†åŒ–é¢„æµ‹
    visualize_predictions(model, test_loader, device)

    return model


if __name__ == "__main__":
    # è®­ç»ƒæ¨¡å‹
    model = train_mnist(epochs=10, batch_size=64, learning_rate=0.001)

    print("\nâœ… è®­ç»ƒå®Œæˆï¼æœ€ç»ˆæµ‹è¯•å‡†ç¡®ç‡åº”è¯¥åœ¨98%ä»¥ä¸Šã€‚")</code></pre>
                </div>
            </div>

            <!-- å®éªŒç»“æœåˆ†æ -->
            <div class="tip info mt-4">
                <span class="tip-icon">ğŸ“Š</span>
                <div class="tip-content">
                    <strong>å®éªŒè§‚å¯Ÿè¦ç‚¹ï¼š</strong><br>
                    â€¢ è§‚å¯ŸæŸå¤±æ›²çº¿æ˜¯å¦å¹³æ»‘ä¸‹é™<br>
                    â€¢ æ£€æŸ¥è®­ç»ƒå’Œæµ‹è¯•å‡†ç¡®ç‡çš„å·®è·ï¼ˆè¿‡æ‹Ÿåˆï¼‰<br>
                    â€¢ æ³¨æ„æ¢¯åº¦ç»Ÿè®¡ï¼Œç¡®ä¿åœ¨åˆç†èŒƒå›´å†…<br>
                    â€¢ é”™è¯¯æ ·æœ¬é€šå¸¸æ˜¯å†™å¾—æ½¦è‰æˆ–æœ‰æ­§ä¹‰çš„æ•°å­—
                </div>
            </div>
        </section>

        <!-- å¸¸è§é—®é¢˜ -->
        <section id="problems" class="section-card">
            <h2 style="color: var(--accent-red); margin-bottom: 1.5rem;">
                âš ï¸ å¸¸è§é—®é¢˜ï¼šæ¢¯åº¦æ¶ˆå¤±ä¸çˆ†ç‚¸
                <span class="depth-indicator advanced">æ·±å…¥</span>
            </h2>

            <!-- é—®é¢˜æ¼”ç¤º -->
            <div class="interactive-demo">
                <h3 style="color: var(--accent-yellow); margin-bottom: 1.5rem;">ğŸ”¬ æ¢¯åº¦é—®é¢˜å®éªŒå®¤</h3>

                <div class="demo-controls">
                    <div class="control-group">
                        <label>ç½‘ç»œæ·±åº¦</label>
                        <div class="slider-container">
                            <input type="range" id="depth-slider" min="5" max="50" step="5" value="20">
                            <span class="slider-value" id="depth-value">20å±‚</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>æ¿€æ´»å‡½æ•°</label>
                        <select id="activation-select" class="form-select">
                            <option value="sigmoid">Sigmoidï¼ˆæ˜“æ¶ˆå¤±ï¼‰</option>
                            <option value="tanh">Tanhï¼ˆæ˜“æ¶ˆå¤±ï¼‰</option>
                            <option value="relu" selected>ReLUï¼ˆç¼“è§£æ¶ˆå¤±ï¼‰</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>åˆå§‹åŒ–æ–¹å¼</label>
                        <select id="init-select" class="form-select">
                            <option value="random">éšæœºåˆå§‹åŒ–</option>
                            <option value="xavier">Xavieråˆå§‹åŒ–</option>
                            <option value="he" selected>Heåˆå§‹åŒ–</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="runGradientExperiment()" tabindex="0">
                        ğŸ§ª è¿è¡Œå®éªŒ
                    </button>
                </div>

                <canvas id="gradient-experiment-canvas" width="800" height="400"></canvas>

                <div id="experiment-results" style="margin-top: 1rem; display: none;">
                    <div class="tip warning">
                        <span class="tip-icon">ğŸ“Š</span>
                        <div class="tip-content" id="experiment-analysis">
                            å®éªŒç»“æœåˆ†æ...
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç†è®ºè§£é‡Š -->
            <div class="math-derivation mt-4">
                <h3>æ¢¯åº¦æ¶ˆå¤±çš„æ•°å­¦åŸç†</h3>

                <div class="math-step" data-step="1">
                    <strong>æ¢¯åº¦çš„è¿ä¹˜æ•ˆåº”</strong>
                    <p>å¯¹äºLå±‚ç½‘ç»œï¼Œç¬¬1å±‚çš„æ¢¯åº¦ï¼š</p>
                    <div class="equation-container">
                        <span style="font-size: 1.2rem;">
                            âˆ‚L/âˆ‚Wâ‚ = âˆ‚L/âˆ‚aâ‚— Â· âˆ(i=2 to L) [âˆ‚aáµ¢/âˆ‚aáµ¢â‚‹â‚]
                        </span>
                    </div>
                    <div class="math-explanation">
                        æ¯ä¸ªâˆ‚aáµ¢/âˆ‚aáµ¢â‚‹â‚åŒ…å«æ¿€æ´»å‡½æ•°å¯¼æ•°ï¼Œå¦‚æœéƒ½å°äº1ï¼Œè¿ä¹˜åè¶‹äº0
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>Sigmoidçš„é—®é¢˜</strong>
                    <div class="equation-container">
                        <span style="font-size: 1.2rem;">
                            Ïƒ'(x) = Ïƒ(x)(1-Ïƒ(x)) â‰¤ 0.25
                        </span>
                    </div>
                    <div class="math-explanation">
                        Sigmoidå¯¼æ•°æœ€å¤§å€¼ä»…0.25ï¼Œ20å±‚åï¼š(0.25)Â²â° â‰ˆ 10â»Â¹Â²
                    </div>
                </div>

                <div class="math-step" data-step="3">
                    <strong>è§£å†³æ–¹æ¡ˆ</strong>
                    <ul style="line-height: 2;">
                        <li><strong>ReLU</strong>ï¼šf'(x) = 1 (x>0)ï¼Œé¿å…æ¢¯åº¦è¡°å‡</li>
                        <li><strong>æ‰¹å½’ä¸€åŒ–</strong>ï¼šä¿æŒæ¿€æ´»å€¼åœ¨åˆç†èŒƒå›´</li>
                        <li><strong>æ®‹å·®è¿æ¥</strong>ï¼šæä¾›æ¢¯åº¦çš„"é«˜é€Ÿå…¬è·¯"</li>
                        <li><strong>æ­£ç¡®åˆå§‹åŒ–</strong>ï¼šé˜²æ­¢æ¿€æ´»å€¼è¿‡å¤§æˆ–è¿‡å°</li>
                    </ul>
                </div>
            </div>

            <!-- è§£å†³æ–¹æ¡ˆå¯¹æ¯” -->
            <div class="concept-grid mt-4">
                <div class="concept-card what">
                    <h3 style="color: var(--accent-green);">âœ“ ReLUå®¶æ—</h3>
                    <p><strong>ReLU</strong>ï¼šf(x) = max(0, x)</p>
                    <p><strong>Leaky ReLU</strong>ï¼šf(x) = max(0.01x, x)</p>
                    <p><strong>ELU</strong>ï¼šå¹³æ»‘çš„è´Ÿå€¼åŒºåŸŸ</p>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        ä¼˜ç‚¹ï¼šè®¡ç®—ç®€å•ï¼Œç¼“è§£æ¢¯åº¦æ¶ˆå¤±
                    </p>
                </div>
                <div class="concept-card how">
                    <h3 style="color: var(--accent-blue);">âœ“ å½’ä¸€åŒ–æŠ€æœ¯</h3>
                    <p><strong>æ‰¹å½’ä¸€åŒ–</strong>ï¼šæŒ‰æ‰¹æ¬¡å½’ä¸€åŒ–</p>
                    <p><strong>å±‚å½’ä¸€åŒ–</strong>ï¼šæŒ‰å±‚å½’ä¸€åŒ–</p>
                    <p><strong>ç»„å½’ä¸€åŒ–</strong>ï¼šæŒ‰é€šé“ç»„å½’ä¸€åŒ–</p>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        ä¼˜ç‚¹ï¼šç¨³å®šè®­ç»ƒï¼ŒåŠ é€Ÿæ”¶æ•›
                    </p>
                </div>
                <div class="concept-card why">
                    <h3 style="color: var(--accent-red);">âœ“ æ¶æ„åˆ›æ–°</h3>
                    <p><strong>æ®‹å·®ç½‘ç»œ</strong>ï¼šè·³è·ƒè¿æ¥</p>
                    <p><strong>é«˜é€Ÿå…¬è·¯ç½‘ç»œ</strong>ï¼šé—¨æ§æœºåˆ¶</p>
                    <p><strong>DenseNet</strong>ï¼šå¯†é›†è¿æ¥</p>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        ä¼˜ç‚¹ï¼šç›´æ¥çš„æ¢¯åº¦è·¯å¾„
                    </p>
                </div>
                <div class="concept-card pitfall">
                    <h3 style="color: var(--accent-yellow);">âœ“ ä¼˜åŒ–æŠ€å·§</h3>
                    <p><strong>æ¢¯åº¦è£å‰ª</strong>ï¼šé™åˆ¶æ¢¯åº¦å¤§å°</p>
                    <p><strong>è‡ªé€‚åº”å­¦ä¹ ç‡</strong>ï¼šAdam, RMSprop</p>
                    <p><strong>é¢„çƒ­å¯åŠ¨</strong>ï¼šé€æ­¥å¢å¤§å­¦ä¹ ç‡</p>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        ä¼˜ç‚¹ï¼šç¨³å®šä¼˜åŒ–è¿‡ç¨‹
                    </p>
                </div>
            </div>
        </section>

        <!-- ç”Ÿç‰©å­¦è§†è§’ -->
        <section id="biological" class="section-card">
            <h2 style="color: var(--accent-green); margin-bottom: 1.5rem;">
                ğŸ§  ç”Ÿç‰©å­¦è§†è§’ï¼šå¤§è„‘å¦‚ä½•å­¦ä¹ ï¼Ÿ
                <span class="depth-indicator advanced">æ·±å…¥</span>
            </h2>

            <!-- å¯¹æ¯”è®¨è®º -->
            <div class="dialogue-container">
                <div class="dialogue-item">
                    <div class="dialogue-avatar student">ğŸ¤”</div>
                    <div class="dialogue-content">
                        <div class="dialogue-name">å°é™ˆ</div>
                        <p>æ•™æˆï¼Œåå‘ä¼ æ’­åœ¨ç”Ÿç‰©å¤§è„‘ä¸­çœŸçš„å­˜åœ¨å—ï¼Ÿ</p>
                    </div>
                </div>
                <div class="dialogue-item">
                    <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                    <div class="dialogue-content">
                        <div class="dialogue-name">ç‹æ•™æˆ</div>
                        <p>è¿™æ˜¯ä¸ªæ·±åˆ»çš„é—®é¢˜ï¼ç›®å‰çš„å…±è¯†æ˜¯ï¼šå¤§è„‘å¯èƒ½ä¸ç›´æ¥ä½¿ç”¨BPï¼Œ
                            ä½†ä¸€å®šæœ‰æŸç§å½¢å¼çš„<strong>è¯¯å·®ä¿¡å·ä¼ é€’æœºåˆ¶</strong>ã€‚</p>
                    </div>
                </div>
            </div>

            <!-- ç”Ÿç‰©å­¦æœºåˆ¶å¯¹æ¯” -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                <div style="background: rgba(34, 197, 94, 0.1); padding: 1.5rem; border-radius: 0.5rem;">
                    <h3 style="color: var(--accent-green); margin-bottom: 1rem;">ğŸ§  ç”Ÿç‰©ç¥ç»ç½‘ç»œ</h3>
                    <ul style="line-height: 2;">
                        <li><strong>è„‰å†²æ—¶åº</strong>ï¼šä¿¡æ¯ç¼–ç åœ¨è„‰å†²æ—¶é—´ä¸­</li>
                        <li><strong>å±€éƒ¨å­¦ä¹ </strong>ï¼šçªè§¦åªä¾èµ–å±€éƒ¨ä¿¡æ¯</li>
                        <li><strong>æŒç»­å­¦ä¹ </strong>ï¼šä¸éœ€è¦åˆ†ç¦»çš„è®­ç»ƒ/æ¨ç†é˜¶æ®µ</li>
                        <li><strong>ç¨€ç–æ¿€æ´»</strong>ï¼šåŒæ—¶æ¿€æ´»çš„ç¥ç»å…ƒå¾ˆå°‘</li>
                    </ul>
                </div>
                <div style="background: rgba(139, 92, 246, 0.1); padding: 1.5rem; border-radius: 0.5rem;">
                    <h3 style="color: var(--accent-purple); margin-bottom: 1rem;">ğŸ’» äººå·¥ç¥ç»ç½‘ç»œ</h3>
                    <ul style="line-height: 2;">
                        <li><strong>è¿ç»­å€¼</strong>ï¼šä½¿ç”¨å®æ•°è¡¨ç¤ºæ¿€æ´»</li>
                        <li><strong>å…¨å±€ä¼˜åŒ–</strong>ï¼šéœ€è¦å®Œæ•´çš„è¯¯å·®ä¿¡å·</li>
                        <li><strong>æ‰¹é‡è®­ç»ƒ</strong>ï¼šåˆ†ç¦»çš„è®­ç»ƒå’Œæ¨ç†</li>
                        <li><strong>å¯†é›†è®¡ç®—</strong>ï¼šæ‰€æœ‰ç¥ç»å…ƒåŒæ—¶è®¡ç®—</li>
                    </ul>
                </div>
            </div>

            <!-- å¯èƒ½çš„ç”Ÿç‰©å­¦ä¹ æœºåˆ¶ -->
            <div class="collapsible mt-4 advanced-content" style="display: none;">
                <div class="collapsible-header" tabindex="0">
                    <div class="collapsible-title">
                        <span>ğŸ”¬</span>
                        <span>å¯èƒ½çš„ç”Ÿç‰©å­¦ä¹ æœºåˆ¶</span>
                        <span class="depth-indicator advanced">æ·±å…¥</span>
                    </div>
                    <svg class="collapsible-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-inner">
                        <h4>1. é¢„æµ‹ç¼–ç ï¼ˆPredictive Codingï¼‰</h4>
                        <p>å¤§è„‘ä¸æ–­é¢„æµ‹æ„Ÿå®˜è¾“å…¥ï¼Œç”¨é¢„æµ‹è¯¯å·®æ¥å­¦ä¹ ï¼š</p>
                        <ul style="line-height: 1.8; margin-top: 0.5rem;">
                            <li>æ¯å±‚å°è¯•é¢„æµ‹ä¸‹ä¸€å±‚çš„æ´»åŠ¨</li>
                            <li>è¯¯å·®ä¿¡å·è‡ªç„¶åœ°åå‘ä¼ æ’­</li>
                            <li>ä¸è´å¶æ–¯å¤§è„‘ç†è®ºä¸€è‡´</li>
                        </ul>

                        <h4 style="margin-top: 1.5rem;">2. åé¦ˆå¯¹é½ï¼ˆFeedback Alignmentï¼‰</h4>
                        <p>ä½¿ç”¨éšæœºåé¦ˆæƒé‡ä¹Ÿèƒ½å­¦ä¹ ï¼š</p>
                        <ul style="line-height: 1.8; margin-top: 0.5rem;">
                            <li>ä¸éœ€è¦ç²¾ç¡®çš„æƒé‡è½¬ç½®</li>
                            <li>æ›´ç¬¦åˆç”Ÿç‰©å­¦çº¦æŸ</li>
                            <li>åœ¨æŸäº›ä»»åŠ¡ä¸Šæ¥è¿‘BPæ€§èƒ½</li>
                        </ul>

                        <h4 style="margin-top: 1.5rem;">3. STDPï¼ˆè„‰å†²æ—¶åºä¾èµ–å¯å¡‘æ€§ï¼‰</h4>
                        <p>åŸºäºè„‰å†²æ—¶åºçš„å±€éƒ¨å­¦ä¹ è§„åˆ™ï¼š</p>
                        <ul style="line-height: 1.8; margin-top: 0.5rem;">
                            <li>å‰è„‰å†²æ—©äºåè„‰å†²â†’å¢å¼ºè¿æ¥</li>
                            <li>å‰è„‰å†²æ™šäºåè„‰å†²â†’å‡å¼±è¿æ¥</li>
                            <li>å®Œå…¨å±€éƒ¨çš„å­¦ä¹ è§„åˆ™</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="tip info mt-4">
                <span class="tip-icon">ğŸ’¡</span>
                <div class="tip-content">
                    <strong>å¯å‘ï¼š</strong><br>
                    è™½ç„¶BPå¯èƒ½ä¸æ˜¯ç”Ÿç‰©å­¦ä¸Šç²¾ç¡®çš„ï¼Œä½†å®ƒå¯å‘æˆ‘ä»¬ç†è§£ï¼š<br>
                    â€¢ å­¦ä¹ éœ€è¦æŸç§å½¢å¼çš„è¯¯å·®ä¿¡å·<br>
                    â€¢ åˆ†å±‚å¤„ç†å’Œä¿¡ç”¨åˆ†é…æ˜¯å…³é”®<br>
                    â€¢ å±€éƒ¨å­¦ä¹ è§„åˆ™å¯èƒ½æ›´é«˜æ•ˆ<br>
                    â€¢ å¤§è„‘çš„å­¦ä¹ æœºåˆ¶ä»æœ‰å¾ˆå¤šæœªè§£ä¹‹è°œ
                </div>
            </div>
        </section>

        <!-- æ›¿ä»£æ–¹æ¡ˆ -->
        <section id="alternatives" class="section-card">
            <h2 style="color: var(--accent-blue); margin-bottom: 1.5rem;">
                ğŸš€ è¶…è¶ŠBPï¼šæ›¿ä»£æ–¹æ¡ˆæ¢ç´¢
                <span class="depth-indicator advanced">æ·±å…¥</span>
            </h2>

            <!-- æ›¿ä»£ç®—æ³•ä»‹ç» -->
            <div class="concept-grid">
                <div class="concept-card what">
                    <h3 style="color: var(--accent-green);">åˆæˆæ¢¯åº¦</h3>
                    <p><strong>æ€æƒ³ï¼š</strong>ç”¨å°ç½‘ç»œé¢„æµ‹æ¢¯åº¦</p>
                    <p><strong>ä¼˜åŠ¿ï¼š</strong>è§£è€¦å±‚é—´ä¾èµ–</p>
                    <p><strong>åº”ç”¨ï¼š</strong>å¼‚æ­¥åˆ†å¸ƒå¼è®­ç»ƒ</p>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        DeepMind 2016å¹´æå‡º
                    </p>
                </div>
                <div class="concept-card how">
                    <h3 style="color: var(--accent-blue);">å‡è¡¡ä¼ æ’­</h3>
                    <p><strong>æ€æƒ³ï¼š</strong>åŸºäºèƒ½é‡çš„å­¦ä¹ </p>
                    <p><strong>ä¼˜åŠ¿ï¼š</strong>æ›´æ¥è¿‘ç‰©ç†ç³»ç»Ÿ</p>
                    <p><strong>åº”ç”¨ï¼š</strong>ç¥ç»å½¢æ€ç¡¬ä»¶</p>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        Scellier & Bengio 2017
                    </p>
                </div>
                <div class="concept-card why">
                    <h3 style="color: var(--accent-red);">å‰å‘æ¢¯åº¦</h3>
                    <p><strong>æ€æƒ³ï¼š</strong>åªç”¨å‰å‘ä¼ æ’­</p>
                    <p><strong>ä¼˜åŠ¿ï¼š</strong>å†…å­˜æ•ˆç‡é«˜</p>
                    <p><strong>åº”ç”¨ï¼š</strong>åœ¨çº¿å­¦ä¹ åœºæ™¯</p>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        æ­£åœ¨ç ”ç©¶ä¸­...
                    </p>
                </div>
                <div class="concept-card pitfall">
                    <h3 style="color: var(--accent-yellow);">è¿›åŒ–ç­–ç•¥</h3>
                    <p><strong>æ€æƒ³ï¼š</strong>æ— æ¢¯åº¦ä¼˜åŒ–</p>
                    <p><strong>ä¼˜åŠ¿ï¼š</strong>å¯å¹¶è¡ŒåŒ–</p>
                    <p><strong>åº”ç”¨ï¼š</strong>å¼ºåŒ–å­¦ä¹ </p>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        OpenAIä½¿ç”¨äºæŸäº›ä»»åŠ¡
                    </p>
                </div>
            </div>

            <!-- æœªæ¥å±•æœ› -->
            <div class="tip success mt-4">
                <span class="tip-icon">ğŸ”®</span>
                <div class="tip-content">
                    <strong>æœªæ¥å±•æœ›ï¼š</strong><br>
                    â€¢ BPä»æ˜¯ç›®å‰æœ€æœ‰æ•ˆçš„ç®—æ³•ï¼Œä½†ä¸æ˜¯ç»ˆç‚¹<br>
                    â€¢ ç”Ÿç‰©å¯å‘çš„ç®—æ³•å¯èƒ½å¸¦æ¥çªç ´<br>
                    â€¢ ç¡¬ä»¶-ç®—æ³•ååŒè®¾è®¡æ˜¯è¶‹åŠ¿<br>
                    â€¢ é‡å­è®¡ç®—å¯èƒ½å¸¦æ¥å…¨æ–°èŒƒå¼
                </div>
            </div>
        </section>

        <!-- æ€»ç»“ -->
        <section id="summary" class="section-card">
            <h2 style="color: var(--accent-green); margin-bottom: 1.5rem;">
                ğŸ“ æ€»ç»“ï¼šæ·±åº¦å­¦ä¹ çš„å¼•æ“
            </h2>

            <!-- çŸ¥è¯†æ€»ç»“ -->
            <div class="concept-grid">
                <div class="concept-card what">
                    <h3 style="color: var(--accent-green);">âœ“ æˆ‘ä»¬å­¦åˆ°äº†ä»€ä¹ˆ</h3>
                    <ul style="line-height: 1.8;">
                        <li>åå‘ä¼ æ’­çš„æ•°å­¦åŸç†</li>
                        <li>é“¾å¼æ³•åˆ™çš„å¨åŠ›</li>
                        <li>è‡ªåŠ¨å¾®åˆ†çš„å®ç°</li>
                        <li>æ¢¯åº¦é—®é¢˜çš„è¯Šæ–­ä¸è§£å†³</li>
                    </ul>
                </div>
                <div class="concept-card why">
                    <h3 style="color: var(--accent-red);">âœ“ ä¸ºä»€ä¹ˆé‡è¦</h3>
                    <ul style="line-height: 1.8;">
                        <li>ä½¿æ·±åº¦ç½‘ç»œè®­ç»ƒæˆä¸ºå¯èƒ½</li>
                        <li>è‡ªåŠ¨åŒ–äº†æœ€ç¹ççš„è®¡ç®—</li>
                        <li>å¥ å®šäº†ç°ä»£AIçš„åŸºç¡€</li>
                        <li>å¯å‘äº†æ–°çš„ç ”ç©¶æ–¹å‘</li>
                    </ul>
                </div>
                <div class="concept-card how">
                    <h3 style="color: var(--accent-blue);">âœ“ å¦‚ä½•åº”ç”¨</h3>
                    <ul style="line-height: 1.8;">
                        <li>ä½¿ç”¨ç°ä»£æ¡†æ¶çš„è‡ªåŠ¨å¾®åˆ†</li>
                        <li>ç›‘æ§å’Œè°ƒè¯•æ¢¯åº¦æµ</li>
                        <li>é€‰æ‹©åˆé€‚çš„æ¿€æ´»å‡½æ•°</li>
                        <li>åº”ç”¨å„ç§ä¼˜åŒ–æŠ€å·§</li>
                    </ul>
                </div>
                <div class="concept-card pitfall">
                    <h3 style="color: var(--accent-yellow);">âœ“ éœ€è¦æ³¨æ„</h3>
                    <ul style="line-height: 1.8;">
                        <li>æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸é—®é¢˜</li>
                        <li>æ•°å€¼ç¨³å®šæ€§</li>
                        <li>å†…å­˜æ¶ˆè€—</li>
                        <li>ç”Ÿç‰©å­¦åˆç†æ€§äº‰è®®</li>
                    </ul>
                </div>
            </div>

            <!-- å…³é”®è¦ç‚¹ -->
            <div class="tip success mt-4">
                <span class="tip-icon">ğŸ¯</span>
                <div class="tip-content">
                    <strong>ä¸‰ä¸ªå…³é”®è¦ç‚¹ï¼š</strong><br>
                    1. <strong>è‡ªåŠ¨åŒ–çš„åŠ›é‡ï¼š</strong>BPå°†æ‰‹ç®—å‡ å°æ—¶çš„å·¥ä½œç¼©çŸ­åˆ°æ¯«ç§’çº§<br>
                    2. <strong>é“¾å¼æ³•åˆ™çš„ä¼˜é›…ï¼š</strong>ç®€å•çš„æ•°å­¦è§„åˆ™è§£å†³å¤æ‚çš„ä¼˜åŒ–é—®é¢˜<br>
                    3. <strong>æŒç»­çš„åˆ›æ–°ï¼š</strong>ä»åŸå§‹BPåˆ°ç°ä»£å˜ç§ï¼Œç®—æ³•ä»åœ¨è¿›åŒ–
                </div>
            </div>

            <!-- æ€è€ƒé¢˜ -->
            <div class="instant-practice mt-4">
                <h3 style="color: var(--accent-green); margin-bottom: 1rem;">ğŸ¤” æ·±åº¦æ€è€ƒ</h3>
                <div class="practice-question">
                    å¦‚æœè¦è®¾è®¡ä¸€ä¸ªæ›´æ¥è¿‘ç”Ÿç‰©å­¦ä¹ çš„ç®—æ³•ï¼Œä½ ä¼šè€ƒè™‘å“ªäº›ç‰¹æ€§ï¼Ÿ
                </div>
                <div style="background: rgba(139, 92, 246, 0.1); padding: 1.5rem; border-radius: 0.5rem; margin-top: 1rem;">
                    <p><strong>æ€è€ƒæ–¹å‘ï¼š</strong></p>
                    <ul style="line-height: 1.8;">
                        <li>å±€éƒ¨æ€§ï¼šåªä½¿ç”¨å±€éƒ¨å¯è·å¾—çš„ä¿¡æ¯</li>
                        <li>å¼‚æ­¥æ€§ï¼šä¸åŒéƒ¨åˆ†å¯ä»¥ç‹¬ç«‹æ›´æ–°</li>
                        <li>ç¨€ç–æ€§ï¼šå¤§éƒ¨åˆ†ç¥ç»å…ƒä¸æ¿€æ´»</li>
                        <li>æŒç»­æ€§ï¼šè¾¹é¢„æµ‹è¾¹å­¦ä¹ </li>
                    </ul>
                </div>
            </div>

            <!-- ä¸‹ä¸€ç« é¢„å‘Š -->
            <div style="background: var(--primary-gradient); padding: 2rem; border-radius: 1rem; margin-top: 2rem; color: white; text-align: center;">
                <h3 style="margin-bottom: 1rem;">ğŸ¬ ä¸‹ä¸€ç« é¢„å‘Š</h3>
                <h2 style="font-size: 2rem; margin-bottom: 1rem;">å¤šå±‚æ„ŸçŸ¥æœºï¼šè¡¨è¾¾åŠ›ä¸æ¿€æ´»å‡½æ•°</h2>
                <p style="font-size: 1.1rem; opacity: 0.9;">
                    æŒæ¡äº†è®­ç»ƒæ–¹æ³•ï¼Œç°åœ¨æ¥æ¢ç´¢ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›ã€‚<br>
                    æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•è®¾è®¡ç½‘ç»œç»“æ„ï¼Œé€‰æ‹©æ¿€æ´»å‡½æ•°ï¼Œç†è§£æ·±åº¦ä¸å®½åº¦çš„æƒè¡¡ã€‚
                </p>
                <button class="btn" style="background: white; color: var(--accent-purple); margin-top: 1.5rem;" tabindex="0">
                    ç»§ç»­å­¦ä¹  â†’
                </button>
            </div>
        </section>

        <!-- å­¦ä¹ åé¦ˆ -->
        <section class="section-card">
            <h2 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ’¬ å­¦ä¹ åé¦ˆ</h2>
            <div style="text-align: center;">
                <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">è¿™ä¸€ç« çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©å—ï¼Ÿ</p>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn btn-secondary" onclick="submitFeedback('helpful')" tabindex="0">
                        ğŸ‘ å¾ˆæœ‰å¸®åŠ©
                    </button>
                    <button class="btn btn-secondary" onclick="submitFeedback('ok')" tabindex="0">
                        ğŸ˜ è¿˜å¯ä»¥
                    </button>
                    <button class="btn btn-secondary" onclick="submitFeedback('confusing')" tabindex="0">
                        ğŸ˜• æœ‰ç‚¹å›°æƒ‘
                    </button>
                </div>
                <div id="feedback-response" style="margin-top: 1rem; display: none;">
                    <p style="color: var(--accent-green);">æ„Ÿè°¢ä½ çš„åé¦ˆï¼æˆ‘ä»¬ä¼šç»§ç»­æ”¹è¿›ã€‚</p>
                </div>
            </div>
        </section>
    </div>
</main>

<!-- JavaScriptä»£ç  -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<script>
    // åˆå§‹åŒ–ä»£ç é«˜äº®
    hljs.highlightAll();

    // åˆå§‹åŒ–æ•°å­¦å…¬å¼æ¸²æŸ“
    renderMathInElement(document.body, {
        delimiters: [
            {left: '$', right: '$', display: true},
            {left: ', right: ', display: false}
        ]
    });

    // å…¨å±€å˜é‡
    let currentDifficulty = 'beginner';
    let buddyMessages = {
        beginner: [
            "BPç®—æ³•çš„æ ¸å¿ƒï¼šè¯¯å·®ä»åå‘å‰æµåŠ¨ï¼",
            "è®°ä½ï¼šæ¢¯åº¦ = å±€éƒ¨æ¢¯åº¦ Ã— ä¸Šæ¸¸æ¢¯åº¦",
            "å¦‚æœæ¢¯åº¦æ¶ˆå¤±äº†ï¼Œè¯•è¯•ReLUæ¿€æ´»å‡½æ•°ã€‚"
        ],
        intermediate: [
            "é“¾å¼æ³•åˆ™æ˜¯BPçš„æ•°å­¦åŸºç¡€ï¼Œå¤šç»ƒä¹ ï¼",
            "Hookæ˜¯è°ƒè¯•ç¥ç»ç½‘ç»œçš„åˆ©å™¨ã€‚",
            "æ¢¯åº¦è£å‰ªå¯ä»¥é˜²æ­¢è®­ç»ƒä¸ç¨³å®šã€‚"
        ],
        advanced: [
            "è€ƒè™‘ä¸€ä¸‹ï¼šBPçœŸçš„æ˜¯ç”Ÿç‰©å­¦åˆç†çš„å—ï¼Ÿ",
            "åˆæˆæ¢¯åº¦å’Œå‡è¡¡ä¼ æ’­å€¼å¾—æ·±å…¥ç ”ç©¶ã€‚",
            "é‡å­åå‘ä¼ æ’­å¯èƒ½æ˜¯æœªæ¥æ–¹å‘ã€‚"
        ]
    };

    // å¯¼èˆªåŠŸèƒ½
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const toggleSidebarBtn = document.getElementById('toggle-sidebar');

    toggleSidebarBtn.addEventListener('click', () => {
        sidebar.classList.toggle('open');
        sidebarOverlay.classList.toggle('active');
    });

    sidebarOverlay.addEventListener('click', () => {
        sidebar.classList.remove('open');
        sidebarOverlay.classList.remove('active');
    });

    // å­¦ä¹ ä¼™ä¼´åŠŸèƒ½
    const learningBuddy = document.getElementById('learning-buddy');
    const toggleBuddyBtn = document.getElementById('toggle-buddy');
    const minimizeBuddyBtn = document.getElementById('minimize-buddy');
    const closeBuddyBtn = document.getElementById('close-buddy');
    const buddyAvatar = document.getElementById('buddy-avatar');

    toggleBuddyBtn.addEventListener('click', () => {
        learningBuddy.classList.toggle('active');
    });

    minimizeBuddyBtn.addEventListener('click', () => {
        learningBuddy.classList.toggle('minimized');
    });

    closeBuddyBtn.addEventListener('click', () => {
        learningBuddy.classList.remove('active');
    });

    buddyAvatar.addEventListener('click', () => {
        if (learningBuddy.classList.contains('minimized')) {
            learningBuddy.classList.remove('minimized');
        }
    });

    // å­¦ä¹ ä¼™ä¼´æç¤ºåŠŸèƒ½
    function getBuddyHint() {
        const messages = buddyMessages[currentDifficulty];
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        updateBuddyMessage(randomMessage);
    }

    function getBuddySummary() {
        const summary = `
        æœ¬ç« æ ¸å¿ƒè¦ç‚¹ï¼š<br>
        1. åå‘ä¼ æ’­ = é“¾å¼æ³•åˆ™ + åŠ¨æ€è§„åˆ’<br>
        2. è‡ªåŠ¨å¾®åˆ†è®©æ·±åº¦å­¦ä¹ æˆä¸ºå¯èƒ½<br>
        3. æ¢¯åº¦é—®é¢˜éœ€è¦å¤šç§æŠ€å·§è§£å†³<br>
        4. BPå¯èƒ½ä¸æ˜¯ç”Ÿç‰©å­¦çš„ï¼Œä½†å¾ˆæœ‰æ•ˆ
    `;
        updateBuddyMessage(summary);
    }

    function updateBuddyMessage(message) {
        const messageElement = document.querySelector('.buddy-message p');
        messageElement.innerHTML = message;

        // æ·»åŠ åŠ¨ç”»æ•ˆæœ
        messageElement.style.animation = 'none';
        setTimeout(() => {
            messageElement.style.animation = 'fadeIn 0.5s ease';
        }, 10);
    }

    // ä¸»é¢˜åˆ‡æ¢
    const toggleThemeBtn = document.getElementById('toggle-theme');
    toggleThemeBtn.addEventListener('click', () => {
        const currentTheme = document.body.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.body.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    });

    // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);

    // éš¾åº¦é€‰æ‹©åŠŸèƒ½
    const difficultyOptions = document.querySelectorAll('.difficulty-option');
    difficultyOptions.forEach(option => {
        option.addEventListener('click', () => {
            const difficulty = option.querySelector('input').value;
            currentDifficulty = difficulty;

            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            difficultyOptions.forEach(opt => opt.classList.remove('active'));
            option.classList.add('active');

            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            updateContentVisibility(difficulty);

            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(`å·²åˆ‡æ¢åˆ°${option.textContent.trim()}æ¨¡å¼`);
        });
    });

    function updateContentVisibility(difficulty) {
        // æ ¹æ®éš¾åº¦æ˜¾ç¤º/éšè—å†…å®¹
        const beginnerContent = document.querySelectorAll('.beginner-content');
        const intermediateContent = document.querySelectorAll('.intermediate-content');
        const advancedContent = document.querySelectorAll('.advanced-content');

        // é»˜è®¤æ˜¾ç¤ºæ‰€æœ‰åˆå­¦è€…å†…å®¹
        beginnerContent.forEach(el => el.style.display = 'block');

        if (difficulty === 'beginner') {
            intermediateContent.forEach(el => el.style.display = 'none');
            advancedContent.forEach(el => el.style.display = 'none');
        } else if (difficulty === 'intermediate') {
            intermediateContent.forEach(el => el.style.display = 'block');
            advancedContent.forEach(el => el.style.display = 'none');
        } else {
            intermediateContent.forEach(el => el.style.display = 'block');
            advancedContent.forEach(el => el.style.display = 'block');
        }
    }

    // æŠ˜å åŠŸèƒ½
    const collapsibles = document.querySelectorAll('.collapsible-header');
    collapsibles.forEach(header => {
        header.addEventListener('click', () => {
            const collapsible = header.parentElement;
            collapsible.classList.toggle('expanded');
        });

        // é”®ç›˜æ”¯æŒ
        header.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                header.click();
            }
        });
    });

    // æ»šåŠ¨è¿›åº¦æ¡
    function updateProgressBar() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrollPercentage = (scrollTop / scrollHeight) * 100;
        document.getElementById('progress-bar').style.width = scrollPercentage + '%';
    }

    window.addEventListener('scroll', updateProgressBar);

    // å¯¼èˆªé«˜äº®
    const sections = document.querySelectorAll('section[id]');
    const navItems = document.querySelectorAll('.toc-item');

    function updateNavHighlight() {
        const scrollPosition = window.pageYOffset + 100;

        sections.forEach((section, index) => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.offsetHeight;

            if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                navItems.forEach(item => item.classList.remove('active'));
                if (navItems[index]) {
                    navItems[index].classList.add('active');
                }
            }
        });
    }

    window.addEventListener('scroll', updateNavHighlight);

    // æˆå°±ç³»ç»Ÿ
    let completedSections = new Set();
    let achievements = {
        firstConcept: false,
        allPractice: false,
        deepDive: false,
        finishChapter: false
    };

    function checkAchievements() {
        const totalSections = sections.length;
        const completed = completedSections.size;

        if (completed === 1 && !achievements.firstConcept) {
            achievements.firstConcept = true;
            showAchievement("åˆè¯†åå‘ä¼ æ’­", "å®Œæˆäº†ç¬¬ä¸€ä¸ªæ¦‚å¿µçš„å­¦ä¹ ï¼");
        }

        if (completed === totalSections && !achievements.finishChapter) {
            achievements.finishChapter = true;
            showAchievement("BPå¤§å¸ˆ", "å®Œæˆäº†æ•´ç« çš„å­¦ä¹ ï¼");
        }

        updateAchievementProgress(completed, totalSections);
    }

    function showAchievement(title, description) {
        const popup = document.getElementById('achievement-popup');
        const textElement = document.getElementById('achievement-text');

        textElement.textContent = description;
        popup.classList.add('show');

        setTimeout(() => {
            popup.classList.remove('show');
        }, 5000);
    }

    function updateAchievementProgress(completed, total) {
        const progress = (completed / total) * 100;
        document.getElementById('achievement-progress').style.width = progress + '%';
        document.getElementById('achievement-count').textContent = completed;
    }

    // ç½‘ç»œå¤æ‚åº¦å¯è§†åŒ–
    class NetworkComplexityVisualizer {
        constructor(canvasId) {
            this.canvas = document.getElementById(canvasId);
            this.ctx = this.canvas.getContext('2d');
            this.width = this.canvas.width;
            this.height = this.canvas.height;

            this.layers = 3;
            this.neuronsPerLayer = 4;

            this.bindControls();
            this.draw();
        }

        bindControls() {
            const layersSlider = document.getElementById('layers-slider');
            const neuronsSlider = document.getElementById('neurons-slider');

            layersSlider.addEventListener('input', (e) => {
                this.layers = parseInt(e.target.value);
                document.getElementById('layers-value').textContent = this.layers;
                this.updateStats();
                this.draw();
            });

            neuronsSlider.addEventListener('input', (e) => {
                this.neuronsPerLayer = parseInt(e.target.value);
                document.getElementById('neurons-value').textContent = this.neuronsPerLayer;
                this.updateStats();
                this.draw();
            });
        }

        updateStats() {
            // è®¡ç®—å‚æ•°æ•°é‡
            const params = (this.layers - 1) * this.neuronsPerLayer * this.neuronsPerLayer;
            document.getElementById('param-count').textContent = params.toLocaleString();

            // è®¡ç®—æ¢¯åº¦è®¡ç®—æ¬¡æ•°ï¼ˆç®€åŒ–ï¼‰
            const gradients = params * 3; // å‰å‘ã€åå‘ã€æ›´æ–°
            document.getElementById('gradient-count').textContent = gradients.toLocaleString();

            // ä¼°è®¡æ‰‹ç®—æ—¶é—´ï¼ˆæ¯ä¸ªæ¢¯åº¦30ç§’ï¼‰
            const minutes = Math.ceil(gradients * 0.5);
            const hours = Math.floor(minutes / 60);
            const remainingMinutes = minutes % 60;

            let timeStr = '';
            if (hours > 0) {
                timeStr = `${hours}å°æ—¶${remainingMinutes}åˆ†é’Ÿ`;
            } else {
                timeStr = `${minutes}åˆ†é’Ÿ`;
            }
            document.getElementById('time-estimate').textContent = timeStr;
        }

        draw() {
            this.ctx.clearRect(0, 0, this.width, this.height);

            const layerSpacing = this.width / (this.layers + 1);
            const neuronSpacing = this.height / (this.neuronsPerLayer + 1);

            // ç»˜åˆ¶è¿æ¥
            for (let l = 0; l < this.layers - 1; l++) {
                const x1 = (l + 1) * layerSpacing;
                const x2 = (l + 2) * layerSpacing;

                for (let i = 0; i < this.neuronsPerLayer; i++) {
                    const y1 = (i + 1) * neuronSpacing;

                    for (let j = 0; j < this.neuronsPerLayer; j++) {
                        const y2 = (j + 1) * neuronSpacing;

                        // æ ¹æ®å±‚æ•°è°ƒæ•´é€æ˜åº¦
                        const opacity = Math.max(0.1, 1 - l * 0.15);
                        this.ctx.strokeStyle = `rgba(139, 92, 246, ${opacity})`;
                        this.ctx.lineWidth = 1;

                        this.ctx.beginPath();
                        this.ctx.moveTo(x1, y1);
                        this.ctx.lineTo(x2, y2);
                        this.ctx.stroke();
                    }
                }
            }

            // ç»˜åˆ¶ç¥ç»å…ƒ
            for (let l = 0; l < this.layers; l++) {
                const x = (l + 1) * layerSpacing;

                for (let i = 0; i < this.neuronsPerLayer; i++) {
                    const y = (i + 1) * neuronSpacing;

                    // ç¥ç»å…ƒé¢œè‰²
                    let color;
                    if (l === 0) {
                        color = '#3b82f6'; // è¾“å…¥å±‚
                    } else if (l === this.layers - 1) {
                        color = '#22c55e'; // è¾“å‡ºå±‚
                    } else {
                        color = '#8b5cf6'; // éšè—å±‚
                    }

                    this.ctx.fillStyle = color;
                    this.ctx.strokeStyle = '#1f2937';
                    this.ctx.lineWidth = 2;

                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 15, 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.stroke();
                }

                // å±‚æ ‡ç­¾
                this.ctx.fillStyle = '#f1f5f9';
                this.ctx.font = '14px sans-serif';
                this.ctx.textAlign = 'center';

                let label;
                if (l === 0) {
                    label = 'è¾“å…¥å±‚';
                } else if (l === this.layers - 1) {
                    label = 'è¾“å‡ºå±‚';
                } else {
                    label = `éšè—å±‚${l}`;
                }

                this.ctx.fillText(label, x, this.height - 20);
            }
        }
    }

    // åˆ›å»ºç½‘ç»œå¤æ‚åº¦å¯è§†åŒ–
    const networkComplexityViz = new NetworkComplexityVisualizer('network-complexity-canvas');

    // é“¾å¼æ³•åˆ™åŠ¨ç”»
    function animateChainRule() {
        const svg = document.getElementById('chain-rule-svg');
        svg.innerHTML = ''; // æ¸…ç©º

        // åˆ›å»ºèŠ‚ç‚¹
        const nodes = [
            {x: 100, y: 200, label: 'x', color: '#3b82f6'},
            {x: 250, y: 200, label: 'hâ‚', color: '#8b5cf6'},
            {x: 400, y: 200, label: 'hâ‚‚', color: '#8b5cf6'},
            {x: 550, y: 200, label: 'y', color: '#22c55e'},
            {x: 700, y: 200, label: 'L', color: '#ef4444'}
        ];

        // ç»˜åˆ¶èŠ‚ç‚¹
        nodes.forEach((node, i) => {
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', node.x);
            circle.setAttribute('cy', node.y);
            circle.setAttribute('r', 30);
            circle.setAttribute('fill', node.color);
            circle.setAttribute('stroke', '#1f2937');
            circle.setAttribute('stroke-width', 2);
            svg.appendChild(circle);

            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', node.x);
            text.setAttribute('y', node.y + 5);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('fill', 'white');
            text.setAttribute('font-size', '18');
            text.textContent = node.label;
            svg.appendChild(text);
        });

        // å‰å‘ä¼ æ’­åŠ¨ç”»
        let step = 0;
        const animateForward = () => {
            if (step < nodes.length - 1) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', nodes[step].x + 30);
                line.setAttribute('y1', nodes[step].y);
                line.setAttribute('x2', nodes[step + 1].x - 30);
                line.setAttribute('y2', nodes[step + 1].y);
                line.setAttribute('stroke', '#22c55e');
                line.setAttribute('stroke-width', 3);
                line.setAttribute('marker-end', 'url(#arrowhead-green)');
                line.style.opacity = 0;
                svg.appendChild(line);

                // æ¸æ˜¾åŠ¨ç”»
                let opacity = 0;
                const fadeIn = setInterval(() => {
                    opacity += 0.1;
                    line.style.opacity = opacity;
                    if (opacity >= 1) {
                        clearInterval(fadeIn);
                        step++;
                        setTimeout(animateForward, 500);
                    }
                }, 50);
            } else {
                // å¼€å§‹åå‘ä¼ æ’­
                setTimeout(animateBackward, 1000);
            }
        };

        // åå‘ä¼ æ’­åŠ¨ç”»
        let backStep = nodes.length - 1;
        const animateBackward = () => {
            if (backStep > 0) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', nodes[backStep].x - 30);
                line.setAttribute('y1', nodes[backStep].y);
                line.setAttribute('x2', nodes[backStep - 1].x + 30);
                line.setAttribute('y2', nodes[backStep - 1].y);
                line.setAttribute('stroke', '#ef4444');
                line.setAttribute('stroke-width', 3);
                line.setAttribute('marker-end', 'url(#arrowhead-red)');
                line.setAttribute('stroke-dasharray', '5,5');
                line.style.opacity = 0;
                svg.appendChild(line);

                // æ·»åŠ æ¢¯åº¦æ ‡ç­¾
                const gradientText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                gradientText.setAttribute('x', (nodes[backStep].x + nodes[backStep - 1].x) / 2);
                gradientText.setAttribute('y', nodes[backStep].y - 20);
                gradientText.setAttribute('text-anchor', 'middle');
                gradientText.setAttribute('fill', '#ef4444');
                gradientText.setAttribute('font-size', '14');
                gradientText.textContent = `âˆ‚L/âˆ‚${nodes[backStep - 1].label}`;
                gradientText.style.opacity = 0;
                svg.appendChild(gradientText);

                // æ¸æ˜¾åŠ¨ç”»
                let opacity = 0;
                const fadeIn = setInterval(() => {
                    opacity += 0.1;
                    line.style.opacity = opacity;
                    gradientText.style.opacity = opacity;
                    if (opacity >= 1) {
                        clearInterval(fadeIn);
                        backStep--;
                        setTimeout(animateBackward, 500);
                    }
                }, 50);
            }
        };

        // åˆ›å»ºç®­å¤´æ ‡è®°
        const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');

        // ç»¿è‰²ç®­å¤´
        const markerGreen = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
        markerGreen.setAttribute('id', 'arrowhead-green');
        markerGreen.setAttribute('markerWidth', '10');
        markerGreen.setAttribute('markerHeight', '10');
        markerGreen.setAttribute('refX', '9');
        markerGreen.setAttribute('refY', '3');
        markerGreen.setAttribute('orient', 'auto');

        const polygonGreen = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        polygonGreen.setAttribute('points', '0 0, 10 3, 0 6');
        polygonGreen.setAttribute('fill', '#22c55e');
        markerGreen.appendChild(polygonGreen);
        defs.appendChild(markerGreen);

        // çº¢è‰²ç®­å¤´
        const markerRed = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
        markerRed.setAttribute('id', 'arrowhead-red');
        markerRed.setAttribute('markerWidth', '10');
        markerRed.setAttribute('markerHeight', '10');
        markerRed.setAttribute('refX', '9');
        markerRed.setAttribute('refY', '3');
        markerRed.setAttribute('orient', 'auto');

        const polygonRed = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        polygonRed.setAttribute('points', '0 0, 10 3, 0 6');
        polygonRed.setAttribute('fill', '#ef4444');
        markerRed.appendChild(polygonRed);
        defs.appendChild(markerRed);

        svg.appendChild(defs);

        // å¼€å§‹åŠ¨ç”»
        animateForward();
    }

    function resetChainRule() {
        const svg = document.getElementById('chain-rule-svg');
        svg.innerHTML = '';

        // æ·»åŠ æç¤ºæ–‡å­—
        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('x', 400);
        text.setAttribute('y', 200);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('fill', '#cbd5e1');
        text.setAttribute('font-size', '16');
        text.textContent = 'ç‚¹å‡»"æ’­æ”¾åŠ¨ç”»"æŸ¥çœ‹é“¾å¼æ³•åˆ™çš„å·¥ä½œåŸç†';
        svg.appendChild(text);
    }

    // åˆå§‹åŒ–é“¾å¼æ³•åˆ™SVG
    resetChainRule();

    // BPç®—æ³•æ­¥éª¤æ¼”ç¤º
    class BPAlgorithmDemo {
        constructor() {
            this.canvas = document.getElementById('bp-algorithm-canvas');
            this.ctx = this.canvas.getContext('2d');
            this.width = this.canvas.width;
            this.height = this.canvas.height;

            this.currentStep = 0;
            this.animating = false;
            this.speed = 1500;

            // ç®€å•çš„3å±‚ç½‘ç»œ
            this.network = {
                layers: [2, 3, 1],
                weights: [
                    [[0.5, -0.3], [0.2, 0.8], [-0.1, 0.4]],
                    [[0.6], [-0.2], [0.3]]
                ],
                activations: [],
                deltas: []
            };

            this.bindControls();
            this.draw();
        }

        bindControls() {
            const speedSlider = document.getElementById('bp-speed-slider');
            speedSlider.addEventListener('input', (e) => {
                this.speed = parseInt(e.target.value);
                document.getElementById('bp-speed-value').textContent = this.speed + 'ms';
            });
        }

        draw() {
            this.ctx.clearRect(0, 0, this.width, this.height);

            // ç»˜åˆ¶ç½‘ç»œç»“æ„
            const layerPositions = [150, 400, 650];
            const neuronCounts = this.network.layers;

            // ç»˜åˆ¶è¿æ¥
            for (let l = 0; l < layerPositions.length - 1; l++) {
                const x1 = layerPositions[l];
                const x2 = layerPositions[l + 1];
                const n1 = neuronCounts[l];
                const n2 = neuronCounts[l + 1];

                for (let i = 0; i < n1; i++) {
                    const y1 = this.height / 2 + (i - (n1 - 1) / 2) * 80;

                    for (let j = 0; j < n2; j++) {
                        const y2 = this.height / 2 + (j - (n2 - 1) / 2) * 80;

                        // æ ¹æ®æ­¥éª¤æ”¹å˜é¢œè‰²
                        let color = 'rgba(139, 92, 246, 0.3)';
                        let width = 2;

                        if (this.currentStep === 1 && l === 0) {
                            // å‰å‘ä¼ æ’­
                            color = 'rgba(34, 197, 94, 0.8)';
                            width = 3;
                        } else if (this.currentStep === 3 && l === 1) {
                            // è¾“å‡ºå±‚è¯¯å·®
                            color = 'rgba(239, 68, 68, 0.8)';
                            width = 3;
                        } else if (this.currentStep === 4 && l === 0) {
                            // åå‘ä¼ æ’­
                            color = 'rgba(239, 68, 68, 0.8)';
                            width = 3;
                        }

                        this.ctx.strokeStyle = color;
                        this.ctx.lineWidth = width;
                        this.ctx.beginPath();
                        this.ctx.moveTo(x1, y1);
                        this.ctx.lineTo(x2, y2);
                        this.ctx.stroke();

                        // æ˜¾ç¤ºæƒé‡å€¼
                        if (this.currentStep >= 2) {
                            this.ctx.fillStyle = '#cbd5e1';
                            this.ctx.font = '12px monospace';
                            this.ctx.textAlign = 'center';
                            const weight = this.network.weights[l][j][i];
                            this.ctx.fillText(
                                weight.toFixed(2),
                                (x1 + x2) / 2,
                                (y1 + y2) / 2
                            );
                        }
                    }
                }
            }

            // ç»˜åˆ¶ç¥ç»å…ƒ
            for (let l = 0; l < layerPositions.length; l++) {
                const x = layerPositions[l];
                const n = neuronCounts[l];

                for (let i = 0; i < n; i++) {
                    const y = this.height / 2 + (i - (n - 1) / 2) * 80;

                    // ç¥ç»å…ƒé¢œè‰²
                    let fillColor = '#8b5cf6';
                    if (l === 0) fillColor = '#3b82f6';
                    else if (l === layerPositions.length - 1) fillColor = '#22c55e';

                    // é«˜äº®å½“å‰å¤„ç†çš„å±‚
                    let strokeWidth = 2;
                    let strokeColor = '#1f2937';

                    if ((this.currentStep === 1 && l === 0) ||
                        (this.currentStep === 2 && l === 1) ||
                        (this.currentStep === 3 && l === 2) ||
                        (this.currentStep === 4 && l === 1) ||
                        (this.currentStep === 5 && l === 0)) {
                        strokeWidth = 4;
                        strokeColor = '#fbbf24';
                    }

                    this.ctx.fillStyle = fillColor;
                    this.ctx.strokeStyle = strokeColor;
                    this.ctx.lineWidth = strokeWidth;

                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 25, 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.stroke();

                    // æ˜¾ç¤ºæ¿€æ´»å€¼æˆ–è¯¯å·®
                    if (this.currentStep >= 2 && this.network.activations[l]) {
                        this.ctx.fillStyle = 'white';
                        this.ctx.font = '14px sans-serif';
                        this.ctx.textAlign = 'center';
                        this.ctx.fillText(
                            this.network.activations[l][i].toFixed(2),
                            x, y + 5
                        );
                    }

                    // æ˜¾ç¤ºè¯¯å·®é¡¹
                    if (this.currentStep >= 3 && this.network.deltas[l]) {
                        this.ctx.fillStyle = '#ef4444';
                        this.ctx.font = '12px sans-serif';
                        this.ctx.textAlign = 'center';
                        this.ctx.fillText(
                            `Î´=${this.network.deltas[l][i].toFixed(2)}`,
                            x, y + 40
                        );
                    }
                }

                // å±‚æ ‡ç­¾
                this.ctx.fillStyle = '#f1f5f9';
                this.ctx.font = '14px sans-serif';
                this.ctx.textAlign = 'center';

                let label = l === 0 ? 'è¾“å…¥å±‚' : l === layerPositions.length - 1 ? 'è¾“å‡ºå±‚' : `éšè—å±‚`;
                this.ctx.fillText(label, x, 50);
            }
        }

        async step() {
            const steps = [
                { name: "åˆå§‹åŒ–", description: "å‡†å¤‡ç½‘ç»œç»“æ„å’Œå‚æ•°" },
                { name: "å‰å‘ä¼ æ’­ - è¾“å…¥å±‚", description: "è¾“å…¥æ•°æ®: x = [0.5, -0.3]" },
                { name: "å‰å‘ä¼ æ’­ - éšè—å±‚", description: "è®¡ç®—éšè—å±‚æ¿€æ´»: h = Ïƒ(Wx + b)" },
                { name: "å‰å‘ä¼ æ’­ - è¾“å‡ºå±‚", description: "è®¡ç®—è¾“å‡º: y = Ïƒ(Wh + b) = 0.73" },
                { name: "è®¡ç®—è¾“å‡ºè¯¯å·®", description: "Î´Â³ = (y - t) * Ïƒ'(zÂ³) = 0.23" },
                { name: "åå‘ä¼ æ’­åˆ°éšè—å±‚", description: "Î´Â² = WÂ³áµ€Î´Â³ âŠ™ Ïƒ'(zÂ²)" },
                { name: "è®¡ç®—æƒé‡æ¢¯åº¦", description: "âˆ‚L/âˆ‚W = Î´ Â· aáµ€" },
                { name: "æ›´æ–°å‚æ•°", description: "W = W - Î· * âˆ‚L/âˆ‚W" }
            ];

            if (this.currentStep >= steps.length) {
                this.currentStep = 0;
            }

            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('bp-current-step').textContent = steps[this.currentStep].name;
            document.getElementById('bp-step-details').textContent = steps[this.currentStep].description;

            // æ¨¡æ‹Ÿè®¡ç®—
            switch (this.currentStep) {
                case 0:
                    this.network.activations = [];
                    this.network.deltas = [];
                    break;
                case 1:
                    this.network.activations[0] = [0.5, -0.3];
                    break;
                case 2:
                    this.network.activations[1] = [0.62, 0.45, 0.38];
                    break;
                case 3:
                    this.network.activations[2] = [0.73];
                    break;
                case 4:
                    this.network.deltas[2] = [0.23];
                    break;
                case 5:
                    this.network.deltas[1] = [0.08, -0.03, 0.04];
                    break;
            }

            this.draw();
            this.currentStep++;
        }

        async animate() {
            if (this.animating) {
                await this.step();
                setTimeout(() => this.animate(), this.speed);
            }
        }
    }

    const bpDemo = new BPAlgorithmDemo();

    function startBPAnimation() {
        bpDemo.animating = !bpDemo.animating;
        document.getElementById('train-button').textContent =
            bpDemo.animating ? 'â¸ï¸ æš‚åœ' : 'â–¶ï¸ å¼€å§‹æ¼”ç¤º';

        if (bpDemo.animating) {
            bpDemo.animate();
        }
    }

    function stepBPAnimation() {
        bpDemo.animating = false;
        document.getElementById('train-button').textContent = 'â–¶ï¸ å¼€å§‹æ¼”ç¤º';
        bpDemo.step();
    }

    // æ¢¯åº¦æµå¯è§†åŒ–
    class GradientFlowVisualizer {
        constructor() {
            this.canvas = document.getElementById('gradient-flow-canvas');
            this.ctx = this.canvas.getContext('2d');
            this.width = this.canvas.width;
            this.height = this.canvas.height;

            this.networkDepth = 5;
            this.activationType = 'relu';
            this.animating = false;
            this.particles = [];

            this.bindControls();
            this.initNetwork();
            this.draw();
        }

        bindControls() {
            const depthSelect = document.getElementById('network-depth');
            const activationSelect = document.getElementById('activation-type');

            depthSelect.addEventListener('change', (e) => {
                this.networkDepth = parseInt(e.target.value);
                this.initNetwork();
                this.draw();
            });

            activationSelect.addEventListener('change', (e) => {
                this.activationType = e.target.value;
                this.initNetwork();
                this.draw();
            });
        }

        initNetwork() {
            // åˆå§‹åŒ–ç½‘ç»œå‚æ•°
            this.layers = [];
            this.gradients = [];

            for (let i = 0; i < this.networkDepth; i++) {
                this.layers.push({
                    neurons: 5,
                    activation: Math.random() * 0.5 + 0.5,
                    gradient: 1.0
                });
            }

            // è®¡ç®—æ¢¯åº¦è¡°å‡
            this.calculateGradientFlow();
        }

        calculateGradientFlow() {
            let grad = 1.0;

            for (let i = this.networkDepth - 1; i >= 0; i--) {
                // æ ¹æ®æ¿€æ´»å‡½æ•°è®¡ç®—æ¢¯åº¦è¡°å‡
                let decay;
                switch (this.activationType) {
                    case 'sigmoid':
                        decay = 0.25; // sigmoidå¯¼æ•°æœ€å¤§å€¼
                        break;
                    case 'tanh':
                        decay = 0.5; // tanhå¯¼æ•°è¡°å‡
                        break;
                    case 'relu':
                        decay = 0.9; // ReLUå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸º1
                        break;
                }

                grad *= decay;
                this.layers[i].gradient = grad;
            }

            // æ›´æ–°æ˜¾ç¤º
            this.updateInfo();
        }

        updateInfo() {
            const firstLayerGrad = this.layers[0].gradient;
            const lastLayerGrad = this.layers[this.networkDepth - 1].gradient;

            document.getElementById('forward-info').textContent =
                `æ¿€æ´»å€¼èŒƒå›´: [0.5, 1.0]`;

            document.getElementById('backward-info').textContent =
                `æ¢¯åº¦è¡°å‡: ${(firstLayerGrad / lastLayerGrad).toExponential(2)}`;

            // å¥åº·åº¦è¯„ä¼°
            let health;
            if (firstLayerGrad < 1e-6) {
                health = 'âŒ ä¸¥é‡æ¢¯åº¦æ¶ˆå¤±';
            } else if (firstLayerGrad < 1e-3) {
                health = 'âš ï¸ è½»åº¦æ¢¯åº¦æ¶ˆå¤±';
            } else if (firstLayerGrad > 1e3) {
                health = 'ğŸ”¥ æ¢¯åº¦çˆ†ç‚¸é£é™©';
            } else {
                health = 'âœ… æ¢¯åº¦æµåŠ¨æ­£å¸¸';
            }

            document.getElementById('gradient-health').textContent = health;
        }

        draw() {
            this.ctx.clearRect(0, 0, this.width, this.height);

            const layerSpacing = this.width / (this.networkDepth + 1);
            const neuronRadius = 20;

            // ç»˜åˆ¶ç½‘ç»œ
            for (let l = 0; l < this.networkDepth; l++) {
                const x = (l + 1) * layerSpacing;
                const layer = this.layers[l];

                // ç»˜åˆ¶ç¥ç»å…ƒ
                for (let n = 0; n < layer.neurons; n++) {
                    const y = this.height / 2 + (n - 2) * 50;

                    // æ ¹æ®æ¢¯åº¦å¤§å°è°ƒæ•´é¢œè‰²
                    const gradientStrength = Math.log10(layer.gradient + 1e-10) / 10 + 1;
                    const opacity = Math.max(0.2, Math.min(1, gradientStrength));

                    let color;
                    if (layer.gradient < 1e-6) {
                        color = `rgba(59, 130, 246, ${opacity})`; // è“è‰²ï¼šæ¢¯åº¦æ¶ˆå¤±
                    } else if (layer.gradient > 1e3) {
                        color = `rgba(239, 68, 68, ${opacity})`; // çº¢è‰²ï¼šæ¢¯åº¦çˆ†ç‚¸
                    } else {
                        color = `rgba(34, 197, 94, ${opacity})`; // ç»¿è‰²ï¼šæ­£å¸¸
                    }

                    this.ctx.fillStyle = color;
                    this.ctx.strokeStyle = '#1f2937';
                    this.ctx.lineWidth = 2;

                    this.ctx.beginPath();
                    this.ctx.arc(x, y, neuronRadius, 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.stroke();
                }

                // ç»˜åˆ¶è¿æ¥
                if (l < this.networkDepth - 1) {
                    const nextX = (l + 2) * layerSpacing;

                    for (let n1 = 0; n1 < layer.neurons; n1++) {
                        const y1 = this.height / 2 + (n1 - 2) * 50;

                        for (let n2 = 0; n2 < this.layers[l + 1].neurons; n2++) {
                            const y2 = this.height / 2 + (n2 - 2) * 50;

                            const gradient = Math.sqrt(layer.gradient * this.layers[l + 1].gradient);
                            const opacity = Math.max(0.1, Math.min(0.8, gradient));

                            this.ctx.strokeStyle = `rgba(139, 92, 246, ${opacity})`;
                            this.ctx.lineWidth = Math.max(1, gradient * 2);

                            this.ctx.beginPath();
                            this.ctx.moveTo(x + neuronRadius, y1);
                            this.ctx.lineTo(nextX - neuronRadius, y2);
                            this.ctx.stroke();
                        }
                    }
                }

                // æ˜¾ç¤ºæ¢¯åº¦å€¼
                this.ctx.fillStyle = '#f1f5f9';
                this.ctx.font = '12px monospace';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(
                    `âˆ‡=${layer.gradient.toExponential(1)}`,
                    x, this.height - 40
                );
            }

            // ç»˜åˆ¶æµåŠ¨ç²’å­
            if (this.animating) {
                this.updateParticles();
                this.drawParticles();
            }
        }

        updateParticles() {
            // æ·»åŠ æ–°ç²’å­
            if (Math.random() < 0.1) {
                this.particles.push({
                    x: this.width - 50,
                    y: this.height / 2 + (Math.random() - 0.5) * 200,
                    vx: -2,
                    vy: (Math.random() - 0.5) * 0.5,
                    life: 1.0
                });
            }

            // æ›´æ–°ç²’å­
            this.particles = this.particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.01;

                return p.life > 0 && p.x > 0;
            });
        }

        drawParticles() {
            this.particles.forEach(p => {
                this.ctx.fillStyle = `rgba(239, 68, 68, ${p.life * 0.8})`;
                this.ctx.beginPath();
                this.ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                this.ctx.fill();
            });
        }

        animate() {
            if (this.animating) {
                this.draw();
                requestAnimationFrame(() => this.animate());
            }
        }
    }

    const gradientFlowViz = new GradientFlowVisualizer();

    function startGradientFlow() {
        gradientFlowViz.animating = !gradientFlowViz.animating;
        document.querySelector('[onclick="startGradientFlow()"]').textContent =
            gradientFlowViz.animating ? 'â¸ï¸ æš‚åœ' : 'ğŸŒŠ å¼€å§‹æµåŠ¨';

        if (gradientFlowViz.animating) {
            gradientFlowViz.animate();
        }
    }

    function resetGradientFlow() {
        gradientFlowViz.animating = false;
        gradientFlowViz.particles = [];
        gradientFlowViz.initNetwork();
        gradientFlowViz.draw();
        document.querySelector('[onclick="startGradientFlow()"]').textContent = 'ğŸŒŠ å¼€å§‹æµåŠ¨';
    }

    // MNISTæ•°å­—å¯è§†åŒ–
    function drawMNISTDigit(canvasId, digit) {
        const canvas = document.getElementById(canvasId);
        const ctx = canvas.getContext('2d');

        // ç®€åŒ–çš„æ•°å­—è¡¨ç¤º
        const patterns = {
            0: [[0,1,1,0],[1,0,0,1],[1,0,0,1],[0,1,1,0]],
            1: [[0,1,0,0],[1,1,0,0],[0,1,0,0],[1,1,1,0]],
            2: [[1,1,1,0],[0,0,1,0],[0,1,0,0],[1,1,1,0]],
            3: [[1,1,1,0],[0,1,1,0],[0,0,1,0],[1,1,1,0]],
            4: [[1,0,1,0],[1,0,1,0],[1,1,1,0],[0,0,1,0]]
        };

        const pattern = patterns[digit] || patterns[0];
        const cellSize = 14;

        ctx.fillStyle = '#1f2937';
        ctx.fillRect(0, 0, 56, 56);

        pattern.forEach((row, y) => {
            row.forEach((val, x) => {
                if (val) {
                    ctx.fillStyle = '#f1f5f9';
                    ctx.fillRect(x * cellSize, y * cellSize, cellSize - 2, cellSize - 2);
                }
            });
        });
    }

    // åˆå§‹åŒ–MNISTå±•ç¤º
    for (let i = 0; i < 5; i++) {
        drawMNISTDigit(`mnist-${i}`, i);
    }

    // æ¢¯åº¦å®éªŒ
    function runGradientExperiment() {
        const depth = parseInt(document.getElementById('depth-slider').value);
        const activation = document.getElementById('activation-select').value;
        const initialization = document.getElementById('init-select').value;

        // æ¨¡æ‹Ÿæ¢¯åº¦ä¼ æ’­
        let gradient = 1.0;
        let factor;

        switch (activation) {
            case 'sigmoid':
                factor = 0.25;
                break;
            case 'tanh':
                factor = 0.5;
                break;
            case 'relu':
                factor = 0.8;
                break;
        }

        // åˆå§‹åŒ–çš„å½±å“
        switch (initialization) {
            case 'random':
                factor *= 0.7;
                break;
            case 'xavier':
                factor *= 0.9;
                break;
            case 'he':
                factor *= 0.95;
                break;
        }

        const finalGradient = Math.pow(factor, depth);

        // ç»˜åˆ¶ç»“æœ
        const canvas = document.getElementById('gradient-experiment-canvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ç»˜åˆ¶æ¢¯åº¦è¡°å‡æ›²çº¿
        ctx.strokeStyle = '#8b5cf6';
        ctx.lineWidth = 3;
        ctx.beginPath();

        for (let i = 0; i <= depth; i++) {
            const x = (i / depth) * canvas.width;
            const grad = Math.pow(factor, i);
            const y = canvas.height - (Math.log10(grad + 1e-10) + 10) / 20 * canvas.height;

            if (i === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        }

        ctx.stroke();

        // ç»˜åˆ¶å‚è€ƒçº¿
        ctx.strokeStyle = 'rgba(239, 68, 68, 0.5)';
        ctx.lineWidth = 1;
        ctx.setLineDash([5, 5]);

        // æ¢¯åº¦æ¶ˆå¤±é˜ˆå€¼çº¿
        const vanishY = canvas.height - (Math.log10(1e-6) + 10) / 20 * canvas.height;
        ctx.beginPath();
        ctx.moveTo(0, vanishY);
        ctx.lineTo(canvas.width, vanishY);
        ctx.stroke();

        ctx.fillStyle = '#ef4444';
        ctx.font = '12px sans-serif';
        ctx.fillText('æ¢¯åº¦æ¶ˆå¤±é˜ˆå€¼', 10, vanishY - 5);

        // æ˜¾ç¤ºç»“æœ
        document.getElementById('experiment-results').style.display = 'block';

        let analysis;
        if (finalGradient < 1e-6) {
            analysis = `<strong>ç»“æœï¼šä¸¥é‡æ¢¯åº¦æ¶ˆå¤±ï¼</strong><br>
                       æœ€æ·±å±‚æ¢¯åº¦ä»…ä¸º ${finalGradient.toExponential(2)}<br>
                       å»ºè®®ï¼šä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°å’Œæ‰¹å½’ä¸€åŒ–`;
        } else if (finalGradient < 1e-3) {
            analysis = `<strong>ç»“æœï¼šè½»åº¦æ¢¯åº¦æ¶ˆå¤±</strong><br>
                       æœ€æ·±å±‚æ¢¯åº¦ä¸º ${finalGradient.toExponential(2)}<br>
                       å»ºè®®ï¼šè€ƒè™‘ä½¿ç”¨æ®‹å·®è¿æ¥æˆ–æ›´å¥½çš„åˆå§‹åŒ–`;
        } else {
            analysis = `<strong>ç»“æœï¼šæ¢¯åº¦æµåŠ¨æ­£å¸¸</strong><br>
                       æœ€æ·±å±‚æ¢¯åº¦ä¸º ${finalGradient.toFixed(4)}<br>
                       è¿™ä¸ªé…ç½®é€‚åˆè®­ç»ƒæ·±åº¦ç½‘ç»œ`;
        }

        document.getElementById('experiment-analysis').innerHTML = analysis;
    }

    // æ›´æ–°æ·±åº¦æ˜¾ç¤º
    document.getElementById('depth-slider').addEventListener('input', (e) => {
        document.getElementById('depth-value').textContent = e.target.value + 'å±‚';
    });

    // ç»ƒä¹ é¢˜åŠŸèƒ½
    const practiceOptions = document.querySelectorAll('.practice-option');
    practiceOptions.forEach(option => {
        option.addEventListener('click', function() {
            const answer = this.getAttribute('data-answer');
            const questionNumber = this.closest('.instant-practice').querySelector('.practice-feedback').id.split('-').pop();

            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            this.parentElement.querySelectorAll('.practice-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            this.classList.add('selected');

            // æ£€æŸ¥ç­”æ¡ˆ
            checkAnswer(answer, questionNumber);
        });
    });

    function checkAnswer(answer, questionNumber) {
        const correctAnswers = {
            '1': 'b',  // å®¹æ˜“å‡ºé”™ä¸”æ•ˆç‡æä½
            '2': 'c',  // 100,000ä¸ªå‚æ•°
            '3': 'b'   // ä¸ºäº†ä¿è¯çŸ©é˜µç»´åº¦åŒ¹é…
        };

        const feedback = document.getElementById(`practice-feedback-${questionNumber}`);
        const isCorrect = answer === correctAnswers[questionNumber];

        if (isCorrect) {
            feedback.className = 'practice-feedback show correct';
            feedback.innerHTML = `
            <strong>âœ… æ­£ç¡®ï¼</strong><br>
            ${getFeedbackText(questionNumber, true)}
        `;

            // æ ‡è®°å®Œæˆ
            completedSections.add(`practice-${questionNumber}`);
            checkAchievements();
        } else {
            feedback.className = 'practice-feedback show incorrect';
            feedback.innerHTML = `
            <strong>âŒ å†æƒ³æƒ³...</strong><br>
            ${getFeedbackText(questionNumber, false)}
        `;
        }
    }

    function getFeedbackText(questionNumber, isCorrect) {
        const feedbacks = {
            '1': {
                correct: "æ²¡é”™ï¼æ‰‹åŠ¨è®¡ç®—æ¢¯åº¦ä¸ä»…å®¹æ˜“å‡ºé”™ï¼Œè€Œä¸”éšç€ç½‘ç»œè§„æ¨¡å¢é•¿ï¼Œè®¡ç®—é‡å‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚",
                incorrect: "æç¤ºï¼šæƒ³æƒ³å°é™ˆèŠ±äº†3ä¸ªå°æ—¶è¿˜æ²¡ç®—å®Œï¼Œè€Œä¸”ä¸€ä¸ªé”™è¯¯ä¼šå¯¼è‡´åç»­å…¨é”™..."
            },
            '2': {
                correct: "æ­£ç¡®ï¼æ¯å±‚ä¹‹é—´éœ€è¦100Ã—100=10,000ä¸ªæƒé‡ï¼Œå…±9å±‚è¿æ¥ï¼Œçº¦10ä¸‡ä¸ªå‚æ•°ã€‚",
                incorrect: "æç¤ºï¼šè®¡ç®—æ–¹å¼æ˜¯ (å±‚æ•°-1) Ã— æ¯å±‚ç¥ç»å…ƒæ•°Â²"
            },
            '3': {
                correct: "å®Œå…¨æ­£ç¡®ï¼å‰å‘ä¼ æ’­æ˜¯çŸ©é˜µä¹˜æ³•WÂ·xï¼Œåå‘ä¼ æ’­éœ€è¦Wáµ€Â·Î´ï¼Œè½¬ç½®ç¡®ä¿ç»´åº¦åŒ¹é…ã€‚",
                incorrect: "æç¤ºï¼šè€ƒè™‘çŸ©é˜µä¹˜æ³•çš„ç»´åº¦è¦æ±‚ï¼Œ(mÃ—n) Ã— (nÃ—p) = (mÃ—p)"
            }
        };

        return feedbacks[questionNumber][isCorrect ? 'correct' : 'incorrect'];
    }

    // ä»£ç æ ‡ç­¾åˆ‡æ¢
    const codeTabs = document.querySelectorAll('.code-tab');
    codeTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const lang = this.getAttribute('data-lang');

            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            codeTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');

            // åˆ‡æ¢ä»£ç å†…å®¹
            document.querySelectorAll('.code-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(`${lang}-code`).style.display = 'block';
        });
    });

    // ä»£ç åŠŸèƒ½
    function copyCode() {
        const activeTab = document.querySelector('.code-tab.active');
        const lang = activeTab.getAttribute('data-lang');
        const codeContent = document.getElementById(`${lang}-code`).textContent;

        navigator.clipboard.writeText(codeContent).then(() => {
            showNotification('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        });
    }

    function runCode() {
        const output = document.getElementById('code-output');
        output.classList.add('show');

        // æ¨¡æ‹Ÿè¿è¡Œæ•ˆæœ
        output.innerHTML = `
        <strong>è¿è¡Œç»“æœï¼š</strong>
        <pre>=== NumPyå®ç° ===
Epoch 0, Loss: 0.2486
Epoch 10, Loss: 0.1234
è®­ç»ƒæ—¶é—´: 3.45ç§’

=== PyTorchå®ç° ===
Epoch 0, Loss: 0.2491
Epoch 10, Loss: 0.1229
è®­ç»ƒæ—¶é—´: 0.82ç§’

é€Ÿåº¦æå‡: 4.21å€

æ¢¯åº¦è¯Šæ–­æŠ¥å‘Šï¼š
Layer 1:
  æƒé‡æ¢¯åº¦èŒƒæ•°: 0.235
  æƒé‡æ¢¯åº¦å‡å€¼: 0.012
âœ… æ¢¯åº¦æµåŠ¨æ­£å¸¸</pre>
    `;
    }

    // é€šçŸ¥åŠŸèƒ½
    function showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    // åé¦ˆåŠŸèƒ½
    function submitFeedback(type) {
        document.getElementById('feedback-response').style.display = 'block';

        // è®°å½•åé¦ˆ
        console.log(`User feedback: ${type}`);
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        // åˆå§‹åŒ–éš¾åº¦
        updateContentVisibility(currentDifficulty);

        // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
        setTimeout(() => {
            learningBuddy.classList.add('active');
        }, 2000);

        // æ£€æŸ¥å­¦ä¹ è¿›åº¦
        const visited = localStorage.getItem('chapter2_visited');
        if (!visited) {
            localStorage.setItem('chapter2_visited', 'true');
            showAchievement('å¼€å§‹BPä¹‹æ—…', 'æ¬¢è¿å­¦ä¹ åå‘ä¼ æ’­ï¼');
        }
    });

    // éšè—å¯¼èˆªæ 
    let lastScrollTop = 0;
    const navHeader = document.querySelector('.nav-header');

    window.addEventListener('scroll', () => {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

        if (scrollTop > lastScrollTop && scrollTop > 100) {
            // å‘ä¸‹æ»šåŠ¨
            navHeader.classList.add('hidden');
        } else {
            // å‘ä¸Šæ»šåŠ¨
            navHeader.classList.remove('hidden');
        }

        lastScrollTop = scrollTop;
    });

    // å­¦ä¹ è¿›åº¦è·Ÿè¸ª
    function trackSectionView(sectionId) {
        completedSections.add(sectionId);
        checkAchievements();

        // ä¿å­˜è¿›åº¦åˆ°æœ¬åœ°å­˜å‚¨
        const progress = Array.from(completedSections);
        localStorage.setItem('chapter2_progress', JSON.stringify(progress));
    }

    // æ¢å¤å­¦ä¹ è¿›åº¦
    const savedProgress = localStorage.getItem('chapter2_progress');
    if (savedProgress) {
        const progress = JSON.parse(savedProgress);
        progress.forEach(section => completedSections.add(section));
        checkAchievements();
    }

    // ç›‘å¬ç« èŠ‚è¿›å…¥è§†å›¾
    const sectionObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const sectionId = entry.target.id;
                if (sectionId) {
                    trackSectionView(sectionId);
                }
            }
        });
    }, {
        threshold: 0.5
    });

    sections.forEach(section => {
        sectionObserver.observe(section);
    });

    console.log('ğŸš€ åå‘ä¼ æ’­ç« èŠ‚åŠ è½½å®Œæˆï¼ç¥å­¦ä¹ æ„‰å¿«ï¼');
</script>
</body>
</html>