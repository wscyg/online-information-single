<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬3ç« ï¼šå¤šå±‚æ„ŸçŸ¥æœº - è¡¨è¾¾åŠ›ä¸æ¿€æ´»å‡½æ•° | æ·±åº¦å­¦ä¹ ä¹‹æ—…</title>
    <meta name="description" content="æ¢ç´¢ç¥ç»ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›ï¼šä»é€šç”¨é€¼è¿‘å®šç†åˆ°æ¿€æ´»å‡½æ•°çš„é€‰æ‹©ï¼Œç†è§£æ·±åº¦ä¸å®½åº¦çš„æƒè¡¡">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <style>
        /* ===== CSSå˜é‡å®šä¹‰ ===== */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-dark: #0f172a;
            --bg-section: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #e2e8f0;
            --text-muted: #cbd5e1;
            --accent-red: #ef4444;
            --accent-green: #22c55e;
            --accent-blue: #06b6d4;
            --accent-yellow: #fbbf24;
            --accent-purple: #8b5cf6;
            --accent-pink: #ec4899;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.3);
            --animation-duration: 0.3s;
            --content-max-width: 1200px;
            --focus-ring: 0 0 0 3px rgba(139, 92, 246, 0.5);
        }

        /* äº®è‰²ä¸»é¢˜ */
        [data-theme="light"] {
            --bg-dark: #ffffff;
            --bg-section: #f8fafc;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        /* ===== å…¨å±€æ ·å¼ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color var(--animation-duration) ease;
        }

        /* ===== ç„¦ç‚¹æ ·å¼ ===== */
        :focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
            border-radius: 0.25rem;
        }

        button:focus-visible,
        a:focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
        }

        /* ===== å¸ƒå±€ç»„ä»¶ ===== */
        .container {
            max-width: var(--content-max-width);
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* ===== å¯¼èˆªæ  ===== */
        .nav-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border-bottom: 1px solid var(--border-color);
            transition: transform 0.3s ease;
        }

        .nav-header.hidden {
            transform: translateY(-100%);
        }

        .nav-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 0;
        }

        .nav-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-title h1 {
            font-size: 1.25rem;
            font-weight: 600;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn-control {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            position: relative;
        }

        .btn-control:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .nav-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
        }

        .progress-bar {
            height: 100%;
            background: var(--primary-gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ===== éš¾åº¦é€‰æ‹©å™¨ ===== */
        .difficulty-selector {
            position: fixed;
            right: 20px;
            top: 80px;
            background: var(--bg-section);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            z-index: 999;
            box-shadow: var(--shadow-lg);
        }

        .difficulty-selector h4 {
            color: var(--accent-purple);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .difficulty-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
        }

        .difficulty-option:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .difficulty-option.active {
            background: rgba(139, 92, 246, 0.2);
            color: var(--accent-purple);
        }

        .difficulty-option input[type="radio"] {
            display: none;
        }

        /* ===== ä¾§è¾¹å¯¼èˆª ===== */
        .sidebar {
            position: fixed;
            left: -300px;
            top: 60px;
            bottom: 0;
            width: 300px;
            background: var(--bg-section);
            border-right: 1px solid var(--border-color);
            padding: 2rem;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 999;
        }

        .sidebar.open {
            transform: translateX(300px);
        }

        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 998;
        }

        .sidebar-overlay.active {
            display: block;
        }

        .toc-item {
            display: block;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
            margin-bottom: 0.25rem;
        }

        .toc-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .toc-item.active {
            background: var(--primary-gradient);
            color: white;
        }

        /* ===== å­¦ä¹ ä¼™ä¼´ç³»ç»Ÿ ===== */
        .learning-buddy {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background: var(--bg-section);
            border: 2px solid var(--accent-purple);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            z-index: 900;
            transform: translateY(400px);
            transition: transform 0.5s ease;
        }

        .learning-buddy.active {
            transform: translateY(0);
        }

        .learning-buddy.minimized {
            width: auto;
            padding: 0;
            border-radius: 50%;
            overflow: hidden;
        }

        .learning-buddy.minimized .buddy-content {
            display: none;
        }

        .learning-buddy.minimized .buddy-avatar {
            margin: 0;
            cursor: pointer;
        }

        .buddy-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .buddy-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            flex-shrink: 0;
        }

        .buddy-controls {
            display: flex;
            gap: 0.5rem;
        }

        .buddy-control-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .buddy-control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .buddy-message {
            background: rgba(139, 92, 246, 0.1);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .buddy-message::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(139, 92, 246, 0.1);
        }

        /* ===== ä¸»å†…å®¹åŒº ===== */
        main {
            margin-top: 80px;
            padding-bottom: 4rem;
        }

        /* ===== ç« èŠ‚å¡ç‰‡ ===== */
        .chapter-hero {
            background: var(--primary-gradient);
            padding: 4rem 0;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }

        .chapter-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: pulse 10s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        .chapter-hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: white;
        }

        .chapter-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: fadeInUp 0.8s ease;
        }

        .chapter-hero p {
            font-size: 1.25rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            animation: fadeInUp 0.8s ease 0.2s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== å†…å®¹åŒºå— ===== */
        .section-card {
            background: var(--bg-section);
            border-radius: 1rem;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            transition: transform var(--animation-duration) ease;
            scroll-margin-top: 100px;
        }

        .section-card:hover {
            transform: translateY(-2px);
        }

        /* ===== å­¦ä¹ å¾ªç¯æŒ‡ç¤ºå™¨ ===== */
        .learning-loop {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 3rem;
            padding: 1.5rem;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 1rem;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .loop-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
            position: relative;
        }

        .loop-step.active {
            background: rgba(139, 92, 246, 0.2);
            transform: scale(1.1);
        }

        .loop-step .icon {
            font-size: 2rem;
        }

        .loop-step .label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .loop-connector {
            position: absolute;
            top: 50%;
            right: -2rem;
            width: 2rem;
            height: 2px;
            background: rgba(139, 92, 246, 0.3);
        }

        /* ===== æ•…äº‹å¡ç‰‡ ===== */
        .story-card {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(245, 158, 11, 0.1));
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 2px solid rgba(251, 191, 36, 0.2);
            position: relative;
            overflow: hidden;
        }

        .story-card::before {
            content: 'ğŸ§ ';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 5rem;
            opacity: 0.1;
            transform: rotate(15deg);
        }

        /* ===== äººç‰©å¯¹è¯ ===== */
        .dialogue-container {
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.75rem;
        }

        .dialogue-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            animation: slideIn 0.5s ease;
        }

        .dialogue-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .dialogue-avatar.student {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
        }

        .dialogue-avatar.teacher {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
        }

        .dialogue-avatar.friend {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .dialogue-content {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 0.5rem;
            position: relative;
        }

        .dialogue-content::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 15px;
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-right: 8px solid rgba(255, 255, 255, 0.05);
        }

        .dialogue-name {
            font-weight: bold;
            color: var(--accent-purple);
            margin-bottom: 0.25rem;
        }

        /* ===== æ¦‚å¿µå¡ç‰‡ç½‘æ ¼ ===== */
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .concept-card {
            padding: 1.5rem;
            border-radius: 0.75rem;
            transition: all var(--animation-duration) ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .concept-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform var(--animation-duration) ease;
        }

        .concept-card:hover::before {
            transform: scaleX(1);
        }

        .concept-card.why {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .concept-card.what {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .concept-card.how {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .concept-card.pitfall {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        /* ===== æ•°å­¦æ¨å¯¼å®¹å™¨ ===== */
        .math-derivation {
            background: rgba(79, 70, 229, 0.05);
            border: 1px solid rgba(79, 70, 229, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
        }

        .math-step {
            margin: 1.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .math-step::before {
            content: attr(data-step);
            position: absolute;
            left: 0;
            top: 0;
            width: 24px;
            height: 24px;
            background: var(--accent-purple);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: bold;
        }

        .math-explanation {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 0.5rem;
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        /* ===== äº¤äº’å¼å¯è§†åŒ– ===== */
        .interactive-demo {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
        }

        .demo-controls {
            display: flex;
            gap: 2rem;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        input[type="range"] {
            width: 150px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary-gradient);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider-value {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-family: monospace;
            min-width: 50px;
            text-align: center;
        }

        canvas {
            display: block;
            margin: 0 auto;
            border-radius: 0.5rem;
            background: rgba(0, 0, 0, 0.2);
            cursor: crosshair;
        }

        /* ===== å³æ—¶ç»ƒä¹  ===== */
        .instant-practice {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
        }

        .practice-question {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .practice-options {
            display: grid;
            gap: 1rem;
        }

        .practice-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 0.5rem;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            position: relative;
            overflow: hidden;
            text-align: left;
            width: 100%;
        }

        .practice-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(4px);
        }

        .practice-option.selected {
            border-color: var(--accent-blue);
        }

        .practice-option.correct {
            background: rgba(34, 197, 94, 0.2);
            border-color: var(--accent-green);
        }

        .practice-option.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--accent-red);
        }

        .practice-feedback {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 0.5rem;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .practice-feedback.show {
            display: block;
        }

        .practice-feedback.correct {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: var(--accent-green);
        }

        .practice-feedback.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--accent-red);
        }

        /* ===== å¸¸è§é”™è¯¯ä¸“æ  ===== */
        .common-mistakes {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
        }

        .mistake-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.5rem;
        }

        .mistake-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .mistake-content h4 {
            color: var(--accent-red);
            margin-bottom: 0.5rem;
        }

        /* ===== ä»£ç å®¹å™¨ ===== */
        .code-container {
            margin: 2rem 0;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .code-header {
            background: #1a1a2e;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .code-header-right {
            display: flex;
            gap: 0.5rem;
        }

        .code-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
        }

        .code-tab.active {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .code-action {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .code-action:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .code-content {
            background: #0d1117;
            overflow-x: auto;
        }

        .code-content pre {
            margin: 0;
            padding: 1.5rem;
        }

        .code-content code {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .code-output {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.875rem;
            display: none;
        }

        .code-output.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== å­¦ä¹ è·¯å¾„æ¨è ===== */
        .learning-path {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1));
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
        }

        .path-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin: 0.5rem 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
            cursor: pointer;
        }

        .path-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(4px);
        }

        .path-item.completed {
            opacity: 0.6;
        }

        .path-item.current {
            border: 2px solid var(--accent-purple);
            background: rgba(139, 92, 246, 0.1);
        }

        .path-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .path-content h4 {
            color: var(--accent-purple);
            margin-bottom: 0.25rem;
        }

        .path-content p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* ===== æç¤ºæ¡† ===== */
        .tip {
            display: flex;
            gap: 1rem;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin: 1.5rem 0;
        }

        .tip-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .tip-content {
            flex: 1;
        }

        .tip.info {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .tip.warning {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .tip.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .tip.success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        /* ===== æ·±åº¦æŒ‡ç¤ºå™¨ ===== */
        .depth-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 20px;
            font-size: 0.875rem;
            margin-left: 1rem;
        }

        .depth-indicator.beginner {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
            color: var(--accent-green);
        }

        .depth-indicator.intermediate {
            background: rgba(251, 191, 36, 0.1);
            border-color: rgba(251, 191, 36, 0.3);
            color: var(--accent-yellow);
        }

        .depth-indicator.advanced {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: var(--accent-red);
        }

        /* ===== å¯æŠ˜å å†…å®¹ ===== */
        .collapsible {
            margin: 1.5rem 0;
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .collapsible-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: background var(--animation-duration) ease;
            user-select: none;
        }

        .collapsible-header:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .collapsible-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
        }

        .collapsible-icon {
            transition: transform var(--animation-duration) ease;
        }

        .collapsible.expanded .collapsible-icon {
            transform: rotate(180deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--animation-duration) ease;
        }

        .collapsible.expanded .collapsible-content {
            max-height: 2000px;
        }

        .collapsible-inner {
            padding: 1.5rem;
        }

        /* ===== æŒ‰é’®æ ·å¼ ===== */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* ===== å­¦ä¹ æˆå°±ç³»ç»Ÿ ===== */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: -400px;
            width: 350px;
            background: var(--bg-section);
            border: 2px solid var(--accent-yellow);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: right 0.5s ease;
        }

        .achievement-popup.show {
            right: 20px;
        }

        .achievement-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .achievement-icon {
            width: 60px;
            height: 60px;
            background: var(--accent-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .achievement-content h3 {
            color: var(--accent-yellow);
            margin-bottom: 0.25rem;
        }

        /* ===== é€šçŸ¥æ ·å¼ ===== */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--accent-green);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ===== å“åº”å¼è®¾è®¡ ===== */
        @media (max-width: 1024px) {
            .chapter-hero h1 {
                font-size: 2.5rem;
            }

            .concept-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .difficulty-selector {
                top: auto;
                bottom: 80px;
            }
        }

        @media (max-width: 768px) {
            .nav-title h1 {
                font-size: 1rem;
            }

            .section-card {
                padding: 1.5rem;
            }

            .chapter-hero {
                padding: 3rem 0;
            }

            .chapter-hero h1 {
                font-size: 2rem;
            }

            .chapter-hero p {
                font-size: 1rem;
            }

            .learning-loop {
                flex-direction: column;
                gap: 1rem;
            }

            .loop-connector {
                display: none;
            }

            .demo-controls {
                flex-direction: column;
                align-items: stretch;
            }

            input[type="range"] {
                width: 100%;
            }

            .learning-buddy {
                width: 90%;
                left: 5%;
                right: 5%;
            }
        }

        /* ===== æ‰“å°æ ·å¼ ===== */
        @media print {
            .nav-header,
            .sidebar,
            .btn,
            .demo-controls,
            .code-action,
            .difficulty-selector,
            .learning-buddy {
                display: none;
            }

            .section-card {
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }

            body {
                background: white;
                color: black;
            }
        }

        /* ===== åŠ¨ç”»ä¼˜åŒ– ===== */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ===== å·¥å…·ç±» ===== */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }

        /* ===== åŠ è½½åŠ¨ç”» ===== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-purple);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ===== æ¢¯åº¦æµåŠ¨ç”» ===== */
        .gradient-flow {
            position: relative;
            overflow: hidden;
        }

        .gradient-flow::after {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            right: -100%;
            bottom: -100%;
            background: linear-gradient(
                    45deg,
                    transparent 30%,
                    rgba(139, 92, 246, 0.2) 50%,
                    transparent 70%
            );
            animation: gradientFlow 3s linear infinite;
        }

        @keyframes gradientFlow {
            0% {
                transform: translateX(-100%) translateY(-100%);
            }
            100% {
                transform: translateX(100%) translateY(100%);
            }
        }

        /* ===== ç¥ç»å…ƒæ ·å¼ ===== */
        .neuron {
            fill: var(--accent-purple);
            stroke: var(--text-primary);
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .neuron:hover {
            fill: var(--accent-pink);
            transform: scale(1.1);
        }

        .neuron.active {
            fill: var(--accent-green);
            animation: pulse 1s ease-in-out infinite;
        }

        .synapse {
            stroke: var(--text-secondary);
            stroke-width: 1.5;
            fill: none;
            opacity: 0.6;
            transition: all 0.3s ease;
        }

        .synapse.active {
            stroke: var(--accent-yellow);
            stroke-width: 3;
            opacity: 1;
            animation: synapseFlow 1s linear infinite;
        }

        @keyframes synapseFlow {
            0% {
                stroke-dasharray: 0 100;
            }
            100% {
                stroke-dasharray: 100 0;
            }
        }

        /* ===== æ‰‹å†™æ•ˆæœ ===== */
        .handwritten {
            font-family: 'Kalam', cursive;
            color: var(--accent-yellow);
            transform: rotate(-2deg);
            display: inline-block;
        }

        /* ===== æ•°å­¦å…¬å¼å®¹å™¨ ===== */
        .equation-container {
            background: rgba(139, 92, 246, 0.05);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
            font-size: 1.1rem;
            overflow-x: auto;
        }

        .equation-label {
            display: inline-block;
            background: var(--accent-purple);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        /* ===== é€‰æ‹©å™¨æ ·å¼ ===== */
        .form-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
        }

        .form-select:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .form-select:focus {
            outline: none;
            box-shadow: var(--focus-ring);
        }

        /* ===== æ¿€æ´»å‡½æ•°å›¾è¡¨æ ·å¼ ===== */
        .activation-chart {
            position: relative;
            margin: 2rem 0;
        }

        .chart-legend {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-color {
            width: 20px;
            height: 4px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
<!-- å¯¼èˆªæ  -->
<nav class="nav-header" role="navigation" aria-label="ä¸»å¯¼èˆª">
    <div class="container">
        <div class="nav-content">
            <div class="nav-title">
                <button id="toggle-sidebar" class="btn-control" aria-label="åˆ‡æ¢ä¾§è¾¹æ " tabindex="0">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <h1>ç¬¬3ç« ï¼šå¤šå±‚æ„ŸçŸ¥æœº</h1>
            </div>
            <div class="nav-controls">
                <button id="toggle-buddy" class="btn-control" aria-label="å­¦ä¹ ä¼™ä¼´" tabindex="0">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </button>
                <button id="toggle-theme" class="btn-control" aria-label="åˆ‡æ¢ä¸»é¢˜" tabindex="0">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div class="nav-progress">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
    </div>
</nav>

<!-- éš¾åº¦é€‰æ‹©å™¨ -->
<div class="difficulty-selector">
    <h4>é€‰æ‹©å­¦ä¹ æ·±åº¦</h4>
    <label class="difficulty-option active" tabindex="0">
        <input type="radio" name="difficulty" value="beginner" checked>
        <span>ğŸŒ± åˆå­¦è€…</span>
    </label>
    <label class="difficulty-option" tabindex="0">
        <input type="radio" name="difficulty" value="intermediate">
        <span>ğŸŒ¿ è¿›é˜¶</span>
    </label>
    <label class="difficulty-option" tabindex="0">
        <input type="radio" name="difficulty" value="advanced">
        <span>ğŸŒ³ æ·±å…¥</span>
    </label>
</div>

<!-- ä¾§è¾¹æ  -->
<aside class="sidebar" id="sidebar" role="navigation" aria-label="ç« èŠ‚å¯¼èˆª">
    <h3 style="margin-bottom: 1.5rem; color: var(--accent-purple);">ç›®å½•å¯¼èˆª</h3>
    <nav>
        <a href="#intro" class="toc-item active" tabindex="0">å¼•è¨€ï¼šäºŒç»´ä¸–ç•Œçš„å±€é™</a>
        <a href="#limitation" class="toc-item" tabindex="0">çº¿æ€§è¾¹ç•Œçš„å›°å¢ƒ</a>
        <a href="#universal" class="toc-item" tabindex="0">é€šç”¨é€¼è¿‘å®šç†</a>
        <a href="#activation" class="toc-item" tabindex="0">æ¿€æ´»å‡½æ•°å¤§è§‚å›­</a>
        <a href="#comparison" class="toc-item" tabindex="0">æ¿€æ´»å‡½æ•°å¯¹æ¯”å®éªŒ</a>
        <a href="#depth-width" class="toc-item" tabindex="0">æ·±åº¦vså®½åº¦çš„æƒè¡¡</a>
        <a href="#implementation" class="toc-item" tabindex="0">ä»£ç å®ç°ï¼šæ„å»ºMLP</a>
        <a href="#visualization" class="toc-item" tabindex="0">å†³ç­–è¾¹ç•Œå¯è§†åŒ–</a>
        <a href="#practice" class="toc-item" tabindex="0">å®æˆ˜ï¼šè¡¨æ ¼vsè§†è§‰ä»»åŠ¡</a>
        <a href="#saturation" class="toc-item" tabindex="0">æ¿€æ´»é¥±å’Œé—®é¢˜</a>
        <a href="#tricks" class="toc-item" tabindex="0">å®ç”¨æŠ€å·§ä¸ç»éªŒ</a>
        <a href="#summary" class="toc-item" tabindex="0">æ€»ç»“ï¼šè¡¨è¾¾åŠ›çš„è‰ºæœ¯</a>
    </nav>
</aside>

<!-- ä¾§è¾¹æ é®ç½© -->
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<!-- å­¦ä¹ ä¼™ä¼´ç³»ç»Ÿ -->
<div class="learning-buddy" id="learning-buddy">
    <div class="buddy-header">
        <div class="buddy-avatar" id="buddy-avatar">ğŸ§ </div>
        <div class="buddy-controls">
            <button class="buddy-control-btn" id="minimize-buddy" aria-label="æœ€å°åŒ–" tabindex="0">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </button>
            <button class="buddy-control-btn" id="close-buddy" aria-label="å…³é—­" tabindex="0">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
    </div>
    <div class="buddy-content">
        <div class="buddy-message">
            <p>ä½ å¥½ï¼æˆ‘æ˜¯å°æ™ºã€‚å¤šå±‚æ„ŸçŸ¥æœºæ˜¯æ·±åº¦å­¦ä¹ çš„åŸºçŸ³ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢å¦‚ä½•è®¾è®¡å¼ºå¤§çš„ç¥ç»ç½‘ç»œï¼è®°ä½ï¼šæ¿€æ´»å‡½æ•°èµ‹äºˆç½‘ç»œéçº¿æ€§çš„é­”åŠ›ã€‚</p>
        </div>
        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button class="btn btn-secondary" onclick="getBuddyHint()" tabindex="0">ç»™æˆ‘æç¤º</button>
            <button class="btn btn-secondary" onclick="getBuddySummary()" tabindex="0">æ€»ç»“è¦ç‚¹</button>
        </div>
    </div>
</div>

<!-- æˆå°±å¼¹çª— -->
<div class="achievement-popup" id="achievement-popup">
    <div class="achievement-header">
        <div class="achievement-icon">ğŸ†</div>
        <div class="achievement-content">
            <h3>è§£é”æˆå°±ï¼</h3>
            <p id="achievement-text">å®Œæˆäº†ç¬¬ä¸€ä¸ªæ¿€æ´»å‡½æ•°å­¦ä¹ </p>
        </div>
    </div>
    <div class="progress" style="margin-top: 1rem;">
        <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px;">
            <div id="achievement-progress" style="height: 100%; width: 20%; background: var(--accent-yellow); border-radius: 4px;"></div>
        </div>
        <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
            <span id="achievement-count">1</span>/5 å®Œæˆæœ¬ç« å­¦ä¹ 
        </p>
    </div>
</div>

<!-- ä¸»å†…å®¹ -->
<main>
    <!-- ç« èŠ‚æ ‡é¢˜ -->
    <section class="chapter-hero">
        <div class="container">
            <div class="chapter-hero-content">
                <h1>å¤šå±‚æ„ŸçŸ¥æœºï¼šè¡¨è¾¾åŠ›ä¸æ¿€æ´»å‡½æ•°</h1>
                <p>ä»çº¿æ€§åˆ°éçº¿æ€§ â€”â€” èµ‹äºˆç¥ç»ç½‘ç»œå­¦ä¹ å¤æ‚æ¨¡å¼çš„èƒ½åŠ›</p>
                <div class="mt-4">
                    <span style="background: rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: 20px; margin: 0 0.5rem;">
                        ğŸ¨ è¡¨è¾¾èƒ½åŠ›
                    </span>
                    <span style="background: rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: 20px; margin: 0 0.5rem;">
                        â±ï¸ 120åˆ†é’Ÿ
                    </span>
                    <span style="background: rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: 20px; margin: 0 0.5rem;">
                        ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ
                    </span>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <!-- å­¦ä¹ ç›®æ ‡ -->
        <section class="section-card">
            <h2 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ“š æœ¬ç« å­¦ä¹ ç›®æ ‡</h2>
            <div class="concept-grid">
                <div class="concept-card what" tabindex="0">
                    <h3 style="color: var(--accent-green); margin-bottom: 0.5rem;">âœ“ ç†è§£è¡¨è¾¾èƒ½åŠ›</h3>
                    <p>æŒæ¡é€šç”¨é€¼è¿‘å®šç†ï¼Œç†è§£ä¸ºä»€ä¹ˆéœ€è¦éçº¿æ€§æ¿€æ´»å‡½æ•°</p>
                </div>
                <div class="concept-card how" tabindex="0">
                    <h3 style="color: var(--accent-blue); margin-bottom: 0.5rem;">âœ“ æŒæ¡æ¿€æ´»å‡½æ•°</h3>
                    <p>å­¦ä¹ å„ç§æ¿€æ´»å‡½æ•°çš„ç‰¹æ€§ï¼ŒçŸ¥é“å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ¿€æ´»å‡½æ•°</p>
                </div>
                <div class="concept-card why" tabindex="0">
                    <h3 style="color: var(--accent-red); margin-bottom: 0.5rem;">âœ“ æƒè¡¡æ·±åº¦ä¸å®½åº¦</h3>
                    <p>ç†è§£ç½‘ç»œæ·±åº¦å’Œå®½åº¦çš„ä¸åŒä½œç”¨ï¼Œå­¦ä¼šè®¾è®¡ç½‘ç»œæ¶æ„</p>
                </div>
                <div class="concept-card pitfall" tabindex="0">
                    <h3 style="color: var(--accent-yellow); margin-bottom: 0.5rem;">âœ“ è¯†åˆ«å¸¸è§é™·é˜±</h3>
                    <p>äº†è§£æ¿€æ´»é¥±å’Œã€æ¢¯åº¦æ¶ˆå¤±ç­‰é—®é¢˜ï¼ŒæŒæ¡åº”å¯¹ç­–ç•¥</p>
                </div>
            </div>
        </section>

        <!-- å­¦ä¹ è·¯å¾„æ¨è -->
        <section class="learning-path">
            <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ—ºï¸ æ¨èå­¦ä¹ è·¯å¾„</h3>
            <div class="path-item completed" tabindex="0">
                <div class="path-icon">âœ“</div>
                <div class="path-content">
                    <h4>ä¸Šä¸€ç« ï¼šåå‘ä¼ æ’­</h4>
                    <p>æŒæ¡äº†è®­ç»ƒç®—æ³•</p>
                </div>
            </div>
            <div class="path-item current" tabindex="0">
                <div class="path-icon">ğŸ“</div>
                <div class="path-content">
                    <h4>å½“å‰ç« èŠ‚ï¼šå¤šå±‚æ„ŸçŸ¥æœº</h4>
                    <p>æ¢ç´¢ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›</p>
                </div>
            </div>
            <div class="path-item" tabindex="0">
                <div class="path-icon">ğŸ”œ</div>
                <div class="path-content">
                    <h4>ä¸‹ä¸€ç«™ï¼šä¼˜åŒ–å›°å¢ƒ</h4>
                    <p>è§£å†³è®­ç»ƒä¸­çš„å„ç§é—®é¢˜</p>
                </div>
            </div>
        </section>

        <!-- å­¦ä¹ å¾ªç¯1ï¼šå¼•è¨€æ•…äº‹ -->
        <section id="intro" class="section-card">
            <div class="learning-loop">
                <div class="loop-step active">
                    <span class="icon">ğŸ¤”</span>
                    <span class="label">å¼•å‘å¥½å¥‡</span>
                    <span class="loop-connector"></span>
                </div>
                <div class="loop-step">
                    <span class="icon">ğŸ“–</span>
                    <span class="label">æ ¸å¿ƒæ¦‚å¿µ</span>
                    <span class="loop-connector"></span>
                </div>
                <div class="loop-step">
                    <span class="icon">ğŸ¯</span>
                    <span class="label">å³æ—¶ç»ƒä¹ </span>
                    <span class="loop-connector"></span>
                </div>
                <div class="loop-step">
                    <span class="icon">ğŸ’¡</span>
                    <span class="label">æ€»ç»“æå‡</span>
                </div>
            </div>

            <div class="story-card">
                <h2 style="color: var(--accent-yellow); margin-bottom: 1.5rem;">ğŸ¨ äºŒç»´ä¸–ç•Œçš„å±€é™</h2>

                <!-- åœºæ™¯è®¾å®š -->
                <div style="background: rgba(0, 0, 0, 0.2); padding: 1rem; border-radius: 0.5rem; margin-bottom: 2rem;">
                    <p style="font-style: italic; color: var(--text-secondary);">
                        å°é™ˆå·²ç»æŒæ¡äº†åå‘ä¼ æ’­ç®—æ³•ï¼Œå…´å†²å†²åœ°ç”¨å•å±‚æ„ŸçŸ¥æœºå»è§£å†³ä¸€ä¸ªç®€å•çš„åˆ†ç±»é—®é¢˜ã€‚
                        ç„¶è€Œï¼Œå½“ä»–çœ‹åˆ°æ•°æ®åˆ†å¸ƒå›¾æ—¶ï¼Œå‚»çœ¼äº†...
                    </p>
                </div>

                <!-- å¯¹è¯åœºæ™¯ -->
                <div class="dialogue-container">
                    <div class="dialogue-item">
                        <div class="dialogue-avatar student">ğŸ˜µ</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">å°é™ˆï¼ˆå›°æƒ‘ä¸­ï¼‰</div>
                            <p>æ•™æˆï¼Œè¿™äº›æ•°æ®ç‚¹...è“è‰²çš„åœ¨ä¸­é—´ï¼Œçº¢è‰²çš„åœ¨å››å‘¨ï¼Œ
                                æ€ä¹ˆç”»ç›´çº¿éƒ½åˆ†ä¸å¼€å•Šï¼</p>
                        </div>
                    </div>
                    <div class="dialogue-item">
                        <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">ç‹æ•™æˆ</div>
                            <p>å¾ˆå¥½çš„è§‚å¯Ÿï¼è¿™å°±æ˜¯è‘—åçš„<strong class="handwritten">å¼‚æˆ–(XOR)é—®é¢˜</strong>ã€‚
                                ä¸€æ¡ç›´çº¿ç¡®å®æ— æ³•åˆ†å¼€ï¼Œä½†å¦‚æœæˆ‘ä»¬èƒ½å¼¯æ›²ç©ºé—´å‘¢ï¼Ÿ</p>
                        </div>
                    </div>
                    <div class="dialogue-item">
                        <div class="dialogue-avatar student">ğŸ¤¯</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">å°é™ˆ</div>
                            <p>å¼¯æ›²ç©ºé—´ï¼Ÿè¿™ä¸æ˜¯ç§‘å¹»å°è¯´å—ï¼Ÿ</p>
                        </div>
                    </div>
                </div>

                <!-- äº¤äº’å¼æ¼”ç¤º -->
                <div class="interactive-demo mt-3">
                    <h3 style="color: var(--accent-blue); margin-bottom: 1rem;">ğŸ¯ äº²è‡ªä½“éªŒï¼šå°è¯•åˆ†ç±»XORæ•°æ®</h3>
                    <canvas id="xor-canvas" width="600" height="400"></canvas>
                    <div class="demo-controls mt-3">
                        <button class="btn btn-primary" onclick="addLayer()" tabindex="0">
                            â• æ·»åŠ éšè—å±‚
                        </button>
                        <button class="btn btn-secondary" onclick="resetXOR()" tabindex="0">
                            ğŸ”„ é‡ç½®
                        </button>
                        <span style="margin-left: 1rem; color: var(--text-secondary);">
                            å½“å‰å±‚æ•°: <span id="layer-count">1</span>
                        </span>
                    </div>
                </div>

                <!-- å…³é”®æ´å¯Ÿ -->
                <div class="tip success mt-3">
                    <span class="tip-icon">ğŸ’¡</span>
                    <div class="tip-content">
                        <strong>é¡¿æ‚Ÿæ—¶åˆ»ï¼š</strong><br>
                        å•å±‚æ„ŸçŸ¥æœºåªèƒ½å­¦ä¹ çº¿æ€§è¾¹ç•Œï¼Œä½†ç°å®ä¸–ç•Œçš„æ¨¡å¼å¾€å¾€æ˜¯éçº¿æ€§çš„ï¼<br>
                        è§£å†³æ–¹æ¡ˆï¼š<br>
                        1. <strong>æ·»åŠ éšè—å±‚</strong>ï¼šåˆ›é€ ä¸­é—´è¡¨ç¤º<br>
                        2. <strong>éçº¿æ€§æ¿€æ´»</strong>ï¼šè®©æ¯å±‚éƒ½èƒ½å­¦ä¹ æ›²çº¿<br>
                        3. <strong>ç»„åˆçš„åŠ›é‡</strong>ï¼šå¤šä¸ªç®€å•éçº¿æ€§ç»„åˆæˆå¤æ‚æ¨¡å¼
                    </div>
                </div>
            </div>

            <!-- å³æ—¶ç»ƒä¹  -->
            <div class="instant-practice">
                <h3 style="color: var(--accent-green); margin-bottom: 1rem;">ğŸ¯ æ€è€ƒç»ƒä¹ </h3>
                <div class="practice-question">
                    ä¸ºä»€ä¹ˆå•å±‚æ„ŸçŸ¥æœºæ— æ³•è§£å†³XORé—®é¢˜ï¼Ÿ
                </div>
                <div class="practice-options">
                    <button class="practice-option" data-answer="a" tabindex="0">
                        A. è®¡ç®—èƒ½åŠ›ä¸è¶³
                    </button>
                    <button class="practice-option" data-answer="b" tabindex="0">
                        B. åªèƒ½è¡¨ç¤ºçº¿æ€§å†³ç­–è¾¹ç•Œ
                    </button>
                    <button class="practice-option" data-answer="c" tabindex="0">
                        C. å‚æ•°å¤ªå°‘
                    </button>
                    <button class="practice-option" data-answer="d" tabindex="0">
                        D. è®­ç»ƒç®—æ³•æœ‰é—®é¢˜
                    </button>
                </div>
                <div class="practice-feedback" id="practice-feedback-1"></div>
            </div>
        </section>

        <!-- çº¿æ€§è¾¹ç•Œçš„å›°å¢ƒ -->
        <section id="limitation" class="section-card">
            <div class="learning-loop">
                <div class="loop-step">
                    <span class="icon">ğŸ¤”</span>
                    <span class="label">å¼•å‘å¥½å¥‡</span>
                    <span class="loop-connector"></span>
                </div>
                <div class="loop-step active">
                    <span class="icon">ğŸ“–</span>
                    <span class="label">æ ¸å¿ƒæ¦‚å¿µ</span>
                    <span class="loop-connector"></span>
                </div>
                <div class="loop-step">
                    <span class="icon">ğŸ¯</span>
                    <span class="label">å³æ—¶ç»ƒä¹ </span>
                    <span class="loop-connector"></span>
                </div>
                <div class="loop-step">
                    <span class="icon">ğŸ’¡</span>
                    <span class="label">æ€»ç»“æå‡</span>
                </div>
            </div>

            <h2 style="color: var(--accent-red); margin-bottom: 1.5rem;">
                ğŸš§ çº¿æ€§è¾¹ç•Œçš„å›°å¢ƒ
                <span class="depth-indicator beginner">åˆå­¦è€…</span>
            </h2>

            <!-- é—®é¢˜å¯è§†åŒ– -->
            <div class="interactive-demo">
                <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ“Š å„ç§éçº¿æ€§æ¨¡å¼æŒ‘æˆ˜</h3>

                <div class="demo-controls">
                    <div class="control-group">
                        <label>é€‰æ‹©æ•°æ®æ¨¡å¼</label>
                        <select id="pattern-select" class="form-select">
                            <option value="xor">XORï¼ˆå¼‚æˆ–ï¼‰</option>
                            <option value="circles">åŒå¿ƒåœ†</option>
                            <option value="spiral">èºæ—‹çº¿</option>
                            <option value="moons">æœˆç‰™å½¢</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>å™ªå£°æ°´å¹³</label>
                        <div class="slider-container">
                            <input type="range" id="noise-slider" min="0" max="50" step="5" value="10">
                            <span class="slider-value" id="noise-value">10%</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="generatePattern()" tabindex="0">
                        ğŸ² ç”Ÿæˆæ•°æ®
                    </button>
                </div>

                <canvas id="pattern-canvas" width="800" height="400"></canvas>

                <div style="margin-top: 1rem; display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <h4 style="color: var(--accent-red);">çº¿æ€§åˆ†ç±»å™¨</h4>
                        <p>å‡†ç¡®ç‡: <span id="linear-accuracy">65.2%</span></p>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">
                            æ°¸è¿œåªèƒ½ç”»ç›´çº¿...
                        </p>
                    </div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <h4 style="color: var(--accent-green);">å¤šå±‚ç½‘ç»œ</h4>
                        <p>å‡†ç¡®ç‡: <span id="mlp-accuracy">98.7%</span></p>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">
                            å¯ä»¥å­¦ä¹ ä»»æ„å¤æ‚è¾¹ç•Œï¼
                        </p>
                    </div>
                </div>
            </div>

            <!-- æ•°å­¦è§£é‡Š -->
            <div class="math-derivation mt-4">
                <h3>ä¸ºä»€ä¹ˆéœ€è¦éçº¿æ€§ï¼Ÿ</h3>

                <div class="math-step" data-step="1">
                    <strong>çº¿æ€§å‡½æ•°çš„ç»„åˆä»æ˜¯çº¿æ€§</strong>
                    <p>è®¾æœ‰ä¸¤ä¸ªçº¿æ€§å˜æ¢ï¼š</p>
                    <div class="equation-container">
                        <span style="font-size: 1.2rem;">
                            f(x) = Wâ‚x + bâ‚<br>
                            g(x) = Wâ‚‚x + bâ‚‚
                        </span>
                    </div>
                    <div class="math-explanation">
                        ç»„åˆåï¼šg(f(x)) = Wâ‚‚(Wâ‚x + bâ‚) + bâ‚‚ = (Wâ‚‚Wâ‚)x + (Wâ‚‚bâ‚ + bâ‚‚)<br>
                        ä»ç„¶æ˜¯çº¿æ€§å˜æ¢ï¼
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>åŠ å…¥éçº¿æ€§æ¿€æ´»</strong>
                    <p>åœ¨æ¯å±‚ä¹‹é—´åŠ å…¥éçº¿æ€§å‡½æ•°Ïƒï¼š</p>
                    <div class="equation-container">
                        <span style="font-size: 1.2rem; color: var(--accent-purple);">
                            h = Ïƒ(Wâ‚x + bâ‚)<br>
                            y = Ïƒ(Wâ‚‚h + bâ‚‚)
                        </span>
                    </div>
                    <div class="math-explanation">
                        ç°åœ¨æ— æ³•ç®€åŒ–æˆå•ä¸ªçº¿æ€§å˜æ¢ï¼Œç½‘ç»œè·å¾—äº†è¡¨è¾¾éçº¿æ€§çš„èƒ½åŠ›ï¼
                    </div>
                </div>
            </div>

            <!-- å¸¸è§éçº¿æ€§æ¨¡å¼ -->
            <div class="concept-grid mt-4">
                <div class="concept-card what">
                    <h3 style="color: var(--accent-green);">XORé—®é¢˜</h3>
                    <p>æœ€ç®€å•çš„éçº¿æ€§å¯åˆ†é—®é¢˜</p>
                    <canvas id="mini-xor" width="150" height="150"></canvas>
                </div>
                <div class="concept-card how">
                    <h3 style="color: var(--accent-blue);">åŒå¿ƒåœ†</h3>
                    <p>å¾„å‘åŸºå‡½æ•°æ“…é•¿çš„æ¨¡å¼</p>
                    <canvas id="mini-circles" width="150" height="150"></canvas>
                </div>
                <div class="concept-card why">
                    <h3 style="color: var(--accent-red);">èºæ—‹çº¿</h3>
                    <p>éœ€è¦æ·±å±‚ç½‘ç»œçš„å¤æ‚æ¨¡å¼</p>
                    <canvas id="mini-spiral" width="150" height="150"></canvas>
                </div>
                <div class="concept-card pitfall">
                    <h3 style="color: var(--accent-yellow);">æœˆç‰™å½¢</h3>
                    <p>æµ‹è¯•æ³›åŒ–èƒ½åŠ›çš„å¥½ä¾‹å­</p>
                    <canvas id="mini-moons" width="150" height="150"></canvas>
                </div>
            </div>

            <!-- å³æ—¶ç»ƒä¹  -->
            <div class="instant-practice mt-4">
                <h3 style="color: var(--accent-green); margin-bottom: 1rem;">ğŸ¯ ç†è§£æ£€æŸ¥</h3>
                <div class="practice-question">
                    ä¸åŠ æ¿€æ´»å‡½æ•°çš„100å±‚ç¥ç»ç½‘ç»œï¼Œå…¶è¡¨è¾¾èƒ½åŠ›ç›¸å½“äºï¼Ÿ
                </div>
                <div class="practice-options">
                    <button class="practice-option" data-answer="a" tabindex="0">
                        A. 100å±‚éçº¿æ€§ç½‘ç»œ
                    </button>
                    <button class="practice-option" data-answer="b" tabindex="0">
                        B. 1å±‚çº¿æ€§ç½‘ç»œ
                    </button>
                    <button class="practice-option" data-answer="c" tabindex="0">
                        C. 50å±‚ç½‘ç»œ
                    </button>
                    <button class="practice-option" data-answer="d" tabindex="0">
                        D. 10å±‚ç½‘ç»œ
                    </button>
                </div>
                <div class="practice-feedback" id="practice-feedback-2"></div>
            </div>
        </section>

        <!-- é€šç”¨é€¼è¿‘å®šç† -->
        <section id="universal" class="section-card">
            <h2 style="color: var(--accent-purple); margin-bottom: 1.5rem;">
                ğŸŒŸ é€šç”¨é€¼è¿‘å®šç†ï¼šç†è®ºä¿è¯
                <span class="depth-indicator intermediate">è¿›é˜¶</span>
            </h2>

            <!-- å†å²èƒŒæ™¯ -->
            <div class="story-card">
                <h3>ğŸ“š 1989å¹´çš„é‡å¤§å‘ç°</h3>
                <div class="dialogue-container">
                    <div class="dialogue-item">
                        <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">ç‹æ•™æˆ</div>
                            <p>1989å¹´ï¼ŒCybenkoè¯æ˜äº†ä¸€ä¸ªæƒŠäººçš„å®šç†ï¼š<strong>åªè¦æœ‰è¶³å¤Ÿçš„ç¥ç»å…ƒï¼Œ
                                å•éšè—å±‚çš„å‰é¦ˆç½‘ç»œå¯ä»¥é€¼è¿‘ä»»æ„è¿ç»­å‡½æ•°ï¼</strong></p>
                        </div>
                    </div>
                    <div class="dialogue-item">
                        <div class="dialogue-avatar student">ğŸ˜®</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">å°é™ˆ</div>
                            <p>çœŸçš„å—ï¼Ÿé‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦æ·±åº¦ç½‘ç»œï¼Ÿ</p>
                        </div>
                    </div>
                    <div class="dialogue-item">
                        <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">ç‹æ•™æˆ</div>
                            <p>å¥½é—®é¢˜ï¼ç†è®ºä¸Šå¯ä»¥ï¼Œä½†<span class="handwritten">"è¶³å¤Ÿ"å¯èƒ½æ„å‘³ç€å¤©æ–‡æ•°å­—èˆ¬çš„ç¥ç»å…ƒ</span>ã€‚
                                æ·±åº¦ç½‘ç»œæ›´é«˜æ•ˆï¼</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å®šç†å†…å®¹ -->
            <div class="math-derivation">
                <h3>é€šç”¨é€¼è¿‘å®šç†ï¼ˆUniversal Approximation Theoremï¼‰</h3>

                <div class="math-step" data-step="1">
                    <strong>å®šç†é™ˆè¿°</strong>
                    <div class="equation-container">
                        <span class="equation-label">Cybenko, 1989</span><br>
                        <p style="text-align: left; padding: 0 2rem;">
                            è®¾ Ïƒ æ˜¯ä¸€ä¸ªéå¸¸æ•°ã€æœ‰ç•Œã€å•è°ƒé€’å¢çš„è¿ç»­å‡½æ•°ã€‚<br>
                            ä»¤ I_m è¡¨ç¤º m ç»´å•ä½è¶…ç«‹æ–¹ä½“ [0,1]^mã€‚<br>
                            C(I_m) è¡¨ç¤º I_m ä¸Šçš„è¿ç»­å‡½æ•°ç©ºé—´ã€‚<br><br>
                            åˆ™å¯¹äºä»»æ„ f âˆˆ C(I_m) å’Œ Îµ > 0ï¼Œå­˜åœ¨æ•´æ•° N å’Œå¸¸æ•° v_i, b_i âˆˆ â„, w_i âˆˆ â„^mï¼Œä½¿å¾—ï¼š
                        </p>
                    </div>
                    <div class="equation-container">
                        <span style="font-size: 1.3rem; color: var(--accent-purple);">
                            |f(x) - âˆ‘_{i=1}^N v_i Ïƒ(w_i^T x + b_i)| < Îµ
                        </span>
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>é€šä¿—è§£é‡Š</strong>
                    <div class="math-explanation">
                        â€¢ å•éšè—å±‚ç½‘ç»œæ˜¯"é€šç”¨å‡½æ•°é€¼è¿‘å™¨"<br>
                        â€¢ åªè¦ç¥ç»å…ƒè¶³å¤Ÿå¤šï¼Œå¯ä»¥é€¼è¿‘ä»»æ„ç²¾åº¦<br>
                        â€¢ æ¿€æ´»å‡½æ•°éœ€è¦æ˜¯éçº¿æ€§çš„ï¼ˆå¦‚sigmoidï¼‰<br>
                        â€¢ è¿™æ˜¯å­˜åœ¨æ€§è¯æ˜ï¼Œä¸å‘Šè¯‰æˆ‘ä»¬éœ€è¦å¤šå°‘ç¥ç»å…ƒ
                    </div>
                </div>
            </div>

            <!-- äº¤äº’å¼å‡½æ•°é€¼è¿‘æ¼”ç¤º -->
            <div class="interactive-demo mt-4">
                <h3 style="color: var(--accent-yellow); margin-bottom: 1.5rem;">ğŸ® åŠ¨æ‰‹å®éªŒï¼šé€¼è¿‘ä»»æ„å‡½æ•°</h3>

                <div class="demo-controls">
                    <div class="control-group">
                        <label>ç›®æ ‡å‡½æ•°</label>
                        <select id="target-function" class="form-select">
                            <option value="sine">æ­£å¼¦æ³¢</option>
                            <option value="step">é˜¶è·ƒå‡½æ•°</option>
                            <option value="abs">ç»å¯¹å€¼</option>
                            <option value="custom">è‡ªå®šä¹‰ï¼ˆå¯ç”»ï¼‰</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>éšè—å±‚ç¥ç»å…ƒæ•°</label>
                        <div class="slider-container">
                            <input type="range" id="neuron-slider" min="1" max="100" step="1" value="10">
                            <span class="slider-value" id="neuron-value">10</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="trainApproximator()" tabindex="0">
                        ğŸ¯ å¼€å§‹è®­ç»ƒ
                    </button>
                    <button class="btn btn-secondary" onclick="resetApproximator()" tabindex="0">
                        ğŸ”„ é‡ç½®
                    </button>
                </div>

                <canvas id="approximation-canvas" width="800" height="400"></canvas>

                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3b82f6;"></div>
                        <span>ç›®æ ‡å‡½æ•°</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #22c55e;"></div>
                        <span>ç½‘ç»œè¾“å‡º</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ef4444;"></div>
                        <span>è¯¯å·®</span>
                    </div>
                </div>

                <div style="margin-top: 1rem; text-align: center;">
                    <p>è®­ç»ƒæŸå¤±: <span id="approx-loss" style="font-weight: bold;">0.0000</span></p>
                    <p style="color: var(--text-secondary); font-size: 0.875rem;">
                        æç¤ºï¼šå¢åŠ ç¥ç»å…ƒæ•°é‡å¯ä»¥æ›´å¥½åœ°é€¼è¿‘å¤æ‚å‡½æ•°
                    </p>
                </div>
            </div>

            <!-- æ·±åº¦vså®½åº¦çš„åˆæ­¥è®¨è®º -->
            <div class="tip info mt-4">
                <span class="tip-icon">ğŸ¤”</span>
                <div class="tip-content">
                    <strong>æ€è€ƒï¼šæ—¢ç„¶å•å±‚å°±å¤Ÿäº†ï¼Œä¸ºä»€ä¹ˆè¦ç”¨æ·±åº¦ç½‘ç»œï¼Ÿ</strong><br>
                    â€¢ <strong>æ•ˆç‡é—®é¢˜</strong>ï¼šæµ…å±‚ç½‘ç»œå¯èƒ½éœ€è¦æŒ‡æ•°çº§çš„å®½åº¦<br>
                    â€¢ <strong>ç‰¹å¾å±‚æ¬¡</strong>ï¼šæ·±åº¦ç½‘ç»œè‡ªç„¶å­¦ä¹ ä»ä½çº§åˆ°é«˜çº§çš„ç‰¹å¾<br>
                    â€¢ <strong>å‚æ•°å…±äº«</strong>ï¼šæ·±åº¦ç½‘ç»œæ›´å¥½åœ°åˆ©ç”¨å‚æ•°<br>
                    â€¢ <strong>å½’çº³åç½®</strong>ï¼šæ·±åº¦ç»“æ„æ›´ç¬¦åˆç°å®ä¸–ç•Œçš„å±‚æ¬¡æ€§
                </div>
            </div>
        </section>

        <!-- æ¿€æ´»å‡½æ•°å¤§è§‚å›­ -->
        <section id="activation" class="section-card">
            <h2 style="color: var(--accent-green); margin-bottom: 1.5rem;">
                ğŸ¨ æ¿€æ´»å‡½æ•°å¤§è§‚å›­
                <span class="depth-indicator beginner">åˆå­¦è€…</span>
            </h2>

            <!-- æ¿€æ´»å‡½æ•°çš„ä½œç”¨ -->
            <div class="dialogue-container">
                <div class="dialogue-item">
                    <div class="dialogue-avatar student">ğŸ¤”</div>
                    <div class="dialogue-content">
                        <div class="dialogue-name">å°é™ˆ</div>
                        <p>æ•™æˆï¼Œä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šç§æ¿€æ´»å‡½æ•°ï¼Ÿç”¨å“ªä¸ªéƒ½è¡Œå—ï¼Ÿ</p>
                    </div>
                </div>
                <div class="dialogue-item">
                    <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                    <div class="dialogue-content">
                        <div class="dialogue-name">ç‹æ•™æˆ</div>
                        <p>æ¯ç§æ¿€æ´»å‡½æ•°éƒ½æœ‰è‡ªå·±çš„"æ€§æ ¼"ï¼å°±åƒä¸åŒçš„ç”»ç¬”èƒ½ç”»å‡ºä¸åŒçš„æ•ˆæœã€‚
                            è®©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹è¿™äº›"è‰ºæœ¯å®¶"...</p>
                    </div>
                </div>
            </div>

            <!-- æ¿€æ´»å‡½æ•°äº¤äº’å¼å±•ç¤º -->
            <div class="interactive-demo mt-3">
                <h3 style="color: var(--accent-blue); margin-bottom: 1.5rem;">ğŸ”¬ æ¿€æ´»å‡½æ•°å®éªŒå®¤</h3>

                <div class="demo-controls">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem;">
                        <button class="btn btn-secondary activation-btn active" data-activation="sigmoid" tabindex="0">
                            Sigmoid
                        </button>
                        <button class="btn btn-secondary activation-btn" data-activation="tanh" tabindex="0">
                            Tanh
                        </button>
                        <button class="btn btn-secondary activation-btn" data-activation="relu" tabindex="0">
                            ReLU
                        </button>
                        <button class="btn btn-secondary activation-btn" data-activation="leaky" tabindex="0">
                            Leaky ReLU
                        </button>
                        <button class="btn btn-secondary activation-btn" data-activation="elu" tabindex="0">
                            ELU
                        </button>
                        <button class="btn btn-secondary activation-btn" data-activation="swish" tabindex="0">
                            Swish
                        </button>
                        <button class="btn btn-secondary activation-btn" data-activation="gelu" tabindex="0">
                            GELU
                        </button>
                        <button class="btn btn-secondary activation-btn" data-activation="all" tabindex="0">
                            å…¨éƒ¨å¯¹æ¯”
                        </button>
                    </div>
                </div>

                <canvas id="activation-canvas" width="800" height="400"></canvas>

                <div id="activation-info" style="margin-top: 1rem; background: rgba(139, 92, 246, 0.1); padding: 1.5rem; border-radius: 0.5rem;">
                    <h4 style="color: var(--accent-purple); margin-bottom: 1rem;">Sigmoidå‡½æ•°</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div>
                            <p><strong>æ•°å­¦å½¢å¼ï¼š</strong></p>
                            <div class="equation-container">
                                <span>Ïƒ(x) = 1 / (1 + e^(-x))</span>
                            </div>
                            <p><strong>å¯¼æ•°ï¼š</strong></p>
                            <div class="equation-container">
                                <span>Ïƒ'(x) = Ïƒ(x)(1 - Ïƒ(x))</span>
                            </div>
                        </div>
                        <div>
                            <p><strong>ç‰¹æ€§ï¼š</strong></p>
                            <ul style="line-height: 1.8;">
                                <li>âœ… è¾“å‡ºèŒƒå›´ (0, 1)</li>
                                <li>âœ… å¹³æ»‘å¯å¾®</li>
                                <li>âŒ å®¹æ˜“é¥±å’Œ</li>
                                <li>âŒ è¾“å‡ºä¸æ˜¯é›¶ä¸­å¿ƒ</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ¿€æ´»å‡½æ•°è¯¦ç»†å¯¹æ¯” -->
            <div class="concept-grid mt-4">
                <div class="concept-card what">
                    <h3 style="color: var(--accent-green);">ç»å…¸å‡½æ•°</h3>
                    <p><strong>Sigmoid & Tanh</strong></p>
                    <ul style="font-size: 0.9rem; line-height: 1.6;">
                        <li>å†å²æ‚ ä¹…ï¼Œç†è®ºå®Œå–„</li>
                        <li>å®¹æ˜“é¥±å’Œï¼Œæ¢¯åº¦æ¶ˆå¤±</li>
                        <li>è®¡ç®—å¼€é”€è¾ƒå¤§</li>
                    </ul>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        é€‚ç”¨ï¼šè¾“å‡ºå±‚ã€æ¦‚ç‡è¾“å‡º
                    </p>
                </div>
                <div class="concept-card how">
                    <h3 style="color: var(--accent-blue);">ReLUå®¶æ—</h3>
                    <p><strong>ReLU, Leaky ReLU, ELU</strong></p>
                    <ul style="font-size: 0.9rem; line-height: 1.6;">
                        <li>è®¡ç®—ç®€å•é«˜æ•ˆ</li>
                        <li>ç¼“è§£æ¢¯åº¦æ¶ˆå¤±</li>
                        <li>å¯èƒ½æœ‰æ­»ç¥ç»å…ƒ</li>
                    </ul>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        é€‚ç”¨ï¼šéšè—å±‚é¦–é€‰
                    </p>
                </div>
                <div class="concept-card why">
                    <h3 style="color: var(--accent-red);">ç°ä»£å‡½æ•°</h3>
                    <p><strong>Swish, GELU, Mish</strong></p>
                    <ul style="font-size: 0.9rem; line-height: 1.6;">
                        <li>å¹³æ»‘éå•è°ƒ</li>
                        <li>è‡ªé—¨æ§æœºåˆ¶</li>
                        <li>SOTAæ¨¡å‹å¸¸ç”¨</li>
                    </ul>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        é€‚ç”¨ï¼šè¿½æ±‚æè‡´æ€§èƒ½
                    </p>
                </div>
                <div class="concept-card pitfall">
                    <h3 style="color: var(--accent-yellow);">ç‰¹æ®Šç”¨é€”</h3>
                    <p><strong>Softmax, Softplus</strong></p>
                    <ul style="font-size: 0.9rem; line-height: 1.6;">
                        <li>Softmax: å¤šåˆ†ç±»è¾“å‡º</li>
                        <li>Softplus: å¹³æ»‘çš„ReLU</li>
                        <li>ç‰¹å®šåœºæ™¯ä¼˜åŒ–</li>
                    </ul>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                        é€‚ç”¨ï¼šç‰¹å®šä»»åŠ¡éœ€æ±‚
                    </p>
                </div>
            </div>

            <!-- æ¿€æ´»å‡½æ•°é€‰æ‹©æŒ‡å— -->
            <div class="tip success mt-4">
                <span class="tip-icon">ğŸ“‹</span>
                <div class="tip-content">
                    <strong>æ¿€æ´»å‡½æ•°é€‰æ‹©å¿«é€ŸæŒ‡å—ï¼š</strong><br>
                    â€¢ <strong>é»˜è®¤é€‰æ‹©</strong>ï¼šReLUï¼ˆç®€å•é«˜æ•ˆï¼‰<br>
                    â€¢ <strong>æ·±å±‚ç½‘ç»œ</strong>ï¼šLeaky ReLU æˆ– ELUï¼ˆé¿å…æ­»ç¥ç»å…ƒï¼‰<br>
                    â€¢ <strong>è¾“å‡ºå±‚</strong>ï¼šæ ¹æ®ä»»åŠ¡é€‰æ‹©ï¼ˆSigmoid/Softmax/Linearï¼‰<br>
                    â€¢ <strong>è¿½æ±‚æ€§èƒ½</strong>ï¼šGELU æˆ– Swishï¼ˆTransformerå¸¸ç”¨ï¼‰<br>
                    â€¢ <strong>è€ç½‘ç»œ</strong>ï¼šTanhï¼ˆLSTM/GRUé»˜è®¤ï¼‰
                </div>
            </div>

            <!-- æ­»äº¡ReLUé—®é¢˜æ¼”ç¤º -->
            <div class="common-mistakes mt-4">
                <h3 style="color: var(--accent-red); margin-bottom: 1rem;">âš ï¸ å¸¸è§é™·é˜±ï¼šæ­»äº¡ReLU</h3>

                <div class="mistake-item">
                    <div class="mistake-icon">ğŸ’€</div>
                    <div class="mistake-content">
                        <h4>ä»€ä¹ˆæ˜¯æ­»äº¡ReLUï¼Ÿ</h4>
                        <p>å½“ReLUç¥ç»å…ƒçš„è¾“å…¥æ€»æ˜¯è´Ÿæ•°æ—¶ï¼Œæ¢¯åº¦æ°¸è¿œä¸º0ï¼Œç¥ç»å…ƒ"æ­»äº¡"ã€‚</p>
                        <div style="background: rgba(0, 0, 0, 0.2); padding: 1rem; border-radius: 0.5rem; margin-top: 0.5rem;">
                            <code>å¦‚æœ x < 0, åˆ™ ReLU(x) = 0, æ¢¯åº¦ä¹Ÿæ˜¯ 0</code>
                        </div>
                        <p style="color: var(--accent-green); margin-top: 0.5rem;">
                            âœ“ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨Leaky ReLU (è´Ÿæ•°éƒ¨åˆ†æœ‰å°æ–œç‡) æˆ–æ­£ç¡®çš„åˆå§‹åŒ–
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ¿€æ´»å‡½æ•°å¯¹æ¯”å®éªŒ -->
        <section id="comparison" class="section-card">
            <h2 style="color: var(--accent-blue); margin-bottom: 1.5rem;">
                ğŸ§ª æ¿€æ´»å‡½æ•°å¯¹æ¯”å®éªŒ
                <span class="depth-indicator intermediate">è¿›é˜¶</span>
            </h2>

            <!-- å®éªŒä»£ç  -->
            <div class="code-container">
                <div class="code-header">
                    <div class="code-header-left">
                        <button class="code-tab active" data-lang="pytorch" tabindex="0">PyTorchå®ç°</button>
                        <button class="code-tab" data-lang="numpy" tabindex="0">NumPyå®ç°</button>
                    </div>
                    <div class="code-header-right">
                        <button class="code-action" onclick="copyCode()" tabindex="0">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            å¤åˆ¶
                        </button>
                        <button class="code-action" onclick="runCode()" tabindex="0">
                            â–¶ï¸ è¿è¡Œ
                        </button>
                    </div>
                </div>
                <div class="code-content" id="pytorch-code">
<pre><code class="python">import torch
import torch.nn as nn
import torch.nn.functional as F
import numpy as np
import matplotlib.pyplot as plt

# å®šä¹‰å„ç§æ¿€æ´»å‡½æ•°
class ActivationFunctions:
    """å¸¸ç”¨æ¿€æ´»å‡½æ•°é›†åˆ"""

    @staticmethod
    def sigmoid(x):
        return torch.sigmoid(x)

    @staticmethod
    def tanh(x):
        return torch.tanh(x)

    @staticmethod
    def relu(x):
        return F.relu(x)

    @staticmethod
    def leaky_relu(x, negative_slope=0.01):
        return F.leaky_relu(x, negative_slope)

    @staticmethod
    def elu(x, alpha=1.0):
        return F.elu(x, alpha)

    @staticmethod
    def swish(x):
        return x * torch.sigmoid(x)

    @staticmethod
    def gelu(x):
        return F.gelu(x)

    @staticmethod
    def mish(x):
        return x * torch.tanh(F.softplus(x))


# åˆ›å»ºå¯¹æ¯”å®éªŒ
def compare_activations(x_range=(-5, 5), num_points=1000):
    """
    æ¯”è¾ƒä¸åŒæ¿€æ´»å‡½æ•°çš„ç‰¹æ€§

    Args:
        x_range: xè½´èŒƒå›´
        num_points: é‡‡æ ·ç‚¹æ•°
    """
    x = torch.linspace(x_range[0], x_range[1], num_points)
    x.requires_grad = True

    activations = {
        'Sigmoid': ActivationFunctions.sigmoid,
        'Tanh': ActivationFunctions.tanh,
        'ReLU': ActivationFunctions.relu,
        'Leaky ReLU': ActivationFunctions.leaky_relu,
        'ELU': ActivationFunctions.elu,
        'Swish': ActivationFunctions.swish,
        'GELU': ActivationFunctions.gelu
    }

    fig, axes = plt.subplots(2, len(activations), figsize=(20, 8))
    fig.suptitle('æ¿€æ´»å‡½æ•°åŠå…¶å¯¼æ•°å¯¹æ¯”', fontsize=16)

    for idx, (name, func) in enumerate(activations.items()):
        # è®¡ç®—æ¿€æ´»å€¼
        y = func(x.clone())

        # è®¡ç®—å¯¼æ•°
        x_grad = x.clone().detach().requires_grad_(True)
        y_grad = func(x_grad)
        y_grad.backward(torch.ones_like(y_grad))
        gradient = x_grad.grad

        # ç»˜åˆ¶æ¿€æ´»å‡½æ•°
        ax1 = axes[0, idx]
        ax1.plot(x.detach().numpy(), y.detach().numpy(), 'b-', linewidth=2)
        ax1.set_title(name)
        ax1.grid(True, alpha=0.3)
        ax1.axhline(y=0, color='k', linewidth=0.5)
        ax1.axvline(x=0, color='k', linewidth=0.5)
        if idx == 0:
            ax1.set_ylabel('f(x)', fontsize=12)

        # ç»˜åˆ¶å¯¼æ•°
        ax2 = axes[1, idx]
        ax2.plot(x.detach().numpy(), gradient.numpy(), 'r-', linewidth=2)
        ax2.grid(True, alpha=0.3)
        ax2.axhline(y=0, color='k', linewidth=0.5)
        ax2.axvline(x=0, color='k', linewidth=0.5)
        if idx == 0:
            ax2.set_ylabel("f'(x)", fontsize=12)
        ax2.set_xlabel('x')

        # æ ‡æ³¨å…³é”®ç»Ÿè®¡ä¿¡æ¯
        ax1.text(0.05, 0.95, f'Range: [{y.min():.2f}, {y.max():.2f}]',
                transform=ax1.transAxes, verticalalignment='top',
                bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.5))

    plt.tight_layout()
    plt.show()


# æµ‹è¯•æ¿€æ´»å‡½æ•°å¯¹æ¢¯åº¦æµçš„å½±å“
class GradientFlowExperiment:
    """æ¢¯åº¦æµå®éªŒï¼šæµ‹è¯•ä¸åŒæ¿€æ´»å‡½æ•°åœ¨æ·±å±‚ç½‘ç»œä¸­çš„è¡¨ç°"""

    def __init__(self, input_size=10, hidden_size=50, num_layers=20):
        self.input_size = input_size
        self.hidden_size = hidden_size
        self.num_layers = num_layers

    def create_network(self, activation='relu'):
        """åˆ›å»ºæŒ‡å®šæ¿€æ´»å‡½æ•°çš„æ·±å±‚ç½‘ç»œ"""
        layers = []

        # è¾“å…¥å±‚
        layers.append(nn.Linear(self.input_size, self.hidden_size))

        # éšè—å±‚
        for _ in range(self.num_layers - 2):
            if activation == 'relu':
                layers.append(nn.ReLU())
            elif activation == 'tanh':
                layers.append(nn.Tanh())
            elif activation == 'leaky_relu':
                layers.append(nn.LeakyReLU())
            elif activation == 'elu':
                layers.append(nn.ELU())
            elif activation == 'gelu':
                layers.append(nn.GELU())

            layers.append(nn.Linear(self.hidden_size, self.hidden_size))

        # è¾“å‡ºå±‚
        layers.append(nn.Linear(self.hidden_size, 1))

        return nn.Sequential(*layers)

    def analyze_gradients(self, network, num_samples=100):
        """åˆ†ææ¢¯åº¦åœ¨ç½‘ç»œä¸­çš„ä¼ æ’­"""
        # ç”Ÿæˆéšæœºè¾“å…¥
        x = torch.randn(num_samples, self.input_size)
        target = torch.randn(num_samples, 1)

        # å‰å‘ä¼ æ’­
        output = network(x)
        loss = F.mse_loss(output, target)

        # åå‘ä¼ æ’­
        loss.backward()

        # æ”¶é›†æ¯å±‚çš„æ¢¯åº¦ç»Ÿè®¡
        gradient_stats = []
        for i, module in enumerate(network.modules()):
            if isinstance(module, nn.Linear):
                grad = module.weight.grad
                if grad is not None:
                    gradient_stats.append({
                        'layer': i,
                        'mean': grad.abs().mean().item(),
                        'std': grad.std().item(),
                        'max': grad.abs().max().item(),
                        'min': grad.abs().min().item()
                    })

        return gradient_stats

    def compare_gradient_flow(self):
        """æ¯”è¾ƒä¸åŒæ¿€æ´»å‡½æ•°çš„æ¢¯åº¦æµ"""
        activations = ['relu', 'tanh', 'leaky_relu', 'elu', 'gelu']
        results = {}

        fig, axes = plt.subplots(2, 1, figsize=(12, 10))
        fig.suptitle(f'æ¢¯åº¦æµåˆ†æ ({self.num_layers}å±‚ç½‘ç»œ)', fontsize=16)

        for activation in activations:
            # åˆ›å»ºç½‘ç»œ
            network = self.create_network(activation)

            # åˆå§‹åŒ–æƒé‡
            for module in network.modules():
                if isinstance(module, nn.Linear):
                    nn.init.xavier_normal_(module.weight)
                    if module.bias is not None:
                        nn.init.zeros_(module.bias)

            # åˆ†ææ¢¯åº¦
            stats = self.analyze_gradients(network)
            results[activation] = stats

            # æå–ç»Ÿè®¡æ•°æ®
            layers = [s['layer'] for s in stats]
            means = [s['mean'] for s in stats]
            stds = [s['std'] for s in stats]

            # ç»˜åˆ¶æ¢¯åº¦å‡å€¼
            axes[0].semilogy(layers, means, 'o-', label=activation, linewidth=2)

            # ç»˜åˆ¶æ¢¯åº¦æ ‡å‡†å·®
            axes[1].semilogy(layers, stds, 's-', label=activation, linewidth=2)

        axes[0].set_ylabel('æ¢¯åº¦ç»å¯¹å€¼å‡å€¼ (log scale)')
        axes[0].legend()
        axes[0].grid(True, alpha=0.3)
        axes[0].set_title('æ¢¯åº¦å¹…åº¦éšå±‚æ·±åº¦çš„å˜åŒ–')

        axes[1].set_xlabel('å±‚ç´¢å¼•')
        axes[1].set_ylabel('æ¢¯åº¦æ ‡å‡†å·® (log scale)')
        axes[1].legend()
        axes[1].grid(True, alpha=0.3)
        axes[1].set_title('æ¢¯åº¦æ–¹å·®éšå±‚æ·±åº¦çš„å˜åŒ–')

        plt.tight_layout()
        plt.show()

        return results


# å®é™…ä»»åŠ¡ä¸­çš„æ¿€æ´»å‡½æ•°æ•ˆæœ
def activation_performance_test():
    """åœ¨å®é™…ä»»åŠ¡ä¸Šæµ‹è¯•ä¸åŒæ¿€æ´»å‡½æ•°çš„æ€§èƒ½"""

    # ç”Ÿæˆèºæ—‹æ•°æ®é›†
    def generate_spiral_data(n_points=1000, n_classes=3, noise=0.2):
        n_per_class = n_points // n_classes
        X = []
        y = []

        for j in range(n_classes):
            theta = np.linspace(j * 4, (j + 1) * 4, n_per_class) + \
                    np.random.randn(n_per_class) * noise
            r = np.linspace(0.5, 1, n_per_class)
            x = r * np.sin(theta)
            y_coord = r * np.cos(theta)
            X.append(np.c_[x, y_coord])
            y.extend([j] * n_per_class)

        X = np.concatenate(X)
        y = np.array(y)

        return torch.FloatTensor(X), torch.LongTensor(y)

    # å®šä¹‰ä¸åŒæ¿€æ´»å‡½æ•°çš„ç½‘ç»œ
    class SpiralNet(nn.Module):
        def __init__(self, activation='relu'):
            super().__init__()
            self.fc1 = nn.Linear(2, 100)
            self.fc2 = nn.Linear(100, 100)
            self.fc3 = nn.Linear(100, 3)

            if activation == 'relu':
                self.activation = nn.ReLU()
            elif activation == 'tanh':
                self.activation = nn.Tanh()
            elif activation == 'leaky_relu':
                self.activation = nn.LeakyReLU()
            elif activation == 'elu':
                self.activation = nn.ELU()
            elif activation == 'gelu':
                self.activation = nn.GELU()

        def forward(self, x):
            x = self.activation(self.fc1(x))
            x = self.activation(self.fc2(x))
            x = self.fc3(x)
            return x

    # ç”Ÿæˆæ•°æ®
    X_train, y_train = generate_spiral_data(n_points=3000)
    X_test, y_test = generate_spiral_data(n_points=1000)

    # è®­ç»ƒä¸åŒæ¿€æ´»å‡½æ•°çš„ç½‘ç»œ
    activations = ['relu', 'tanh', 'leaky_relu', 'elu', 'gelu']
    results = {}

    for activation in activations:
        print(f"\nè®­ç»ƒ {activation} ç½‘ç»œ...")

        model = SpiralNet(activation=activation)
        optimizer = torch.optim.Adam(model.parameters(), lr=0.01)
        criterion = nn.CrossEntropyLoss()

        train_losses = []
        test_accuracies = []

        # è®­ç»ƒ
        for epoch in range(100):
            # è®­ç»ƒæ­¥éª¤
            model.train()
            optimizer.zero_grad()
            output = model(X_train)
            loss = criterion(output, y_train)
            loss.backward()
            optimizer.step()

            train_losses.append(loss.item())

            # æµ‹è¯•æ­¥éª¤
            if epoch % 10 == 0:
                model.eval()
                with torch.no_grad():
                    test_output = model(X_test)
                    _, predicted = torch.max(test_output, 1)
                    accuracy = (predicted == y_test).float().mean().item()
                    test_accuracies.append(accuracy)
                    print(f"  Epoch {epoch}, Loss: {loss.item():.4f}, "
                          f"Test Acc: {accuracy:.2%}")

        results[activation] = {
            'train_losses': train_losses,
            'test_accuracies': test_accuracies,
            'final_accuracy': test_accuracies[-1]
        }

    # å¯è§†åŒ–ç»“æœ
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(15, 5))

    # è®­ç»ƒæŸå¤±æ›²çº¿
    for activation, result in results.items():
        ax1.plot(result['train_losses'], label=activation, linewidth=2)

    ax1.set_xlabel('Epoch')
    ax1.set_ylabel('Training Loss')
    ax1.set_title('ä¸åŒæ¿€æ´»å‡½æ•°çš„è®­ç»ƒæŸå¤±')
    ax1.legend()
    ax1.grid(True, alpha=0.3)

    # æœ€ç»ˆå‡†ç¡®ç‡å¯¹æ¯”
    activations = list(results.keys())
    accuracies = [results[a]['final_accuracy'] for a in activations]

    bars = ax2.bar(activations, accuracies, color='skyblue', edgecolor='navy')
    ax2.set_ylabel('Test Accuracy')
    ax2.set_title('ä¸åŒæ¿€æ´»å‡½æ•°çš„æœ€ç»ˆæµ‹è¯•å‡†ç¡®ç‡')
    ax2.set_ylim(0, 1)

    # æ·»åŠ æ•°å€¼æ ‡ç­¾
    for bar, acc in zip(bars, accuracies):
        height = bar.get_height()
        ax2.text(bar.get_x() + bar.get_width()/2., height,
                f'{acc:.1%}', ha='center', va='bottom')

    plt.tight_layout()
    plt.show()

    return results


if __name__ == "__main__":
    print("=== æ¿€æ´»å‡½æ•°å¯¹æ¯”å®éªŒ ===\n")

    # 1. å¯è§†åŒ–æ¿€æ´»å‡½æ•°åŠå…¶å¯¼æ•°
    print("1. ç»˜åˆ¶æ¿€æ´»å‡½æ•°å›¾åƒ...")
    compare_activations()

    # 2. æ¢¯åº¦æµåˆ†æ
    print("\n2. åˆ†ææ·±å±‚ç½‘ç»œä¸­çš„æ¢¯åº¦æµ...")
    experiment = GradientFlowExperiment(num_layers=20)
    gradient_results = experiment.compare_gradient_flow()

    # 3. å®é™…ä»»åŠ¡æ€§èƒ½æµ‹è¯•
    print("\n3. åœ¨èºæ—‹æ•°æ®é›†ä¸Šæµ‹è¯•æ€§èƒ½...")
    performance_results = activation_performance_test()

    print("\n=== å®éªŒæ€»ç»“ ===")
    print("1. ReLUè®¡ç®—ç®€å•ä½†å¯èƒ½æœ‰æ­»ç¥ç»å…ƒé—®é¢˜")
    print("2. Tanh/Sigmoidå®¹æ˜“é¥±å’Œï¼Œæ·±å±‚ç½‘ç»œæ¢¯åº¦æ¶ˆå¤±ä¸¥é‡")
    print("3. Leaky ReLU/ELUç¼“è§£äº†æ­»ç¥ç»å…ƒé—®é¢˜")
    print("4. GELUç­‰ç°ä»£æ¿€æ´»å‡½æ•°åœ¨æŸäº›ä»»åŠ¡ä¸Šè¡¨ç°æ›´å¥½")</code></pre>
                </div>
                <div class="code-content" id="numpy-code" style="display: none;">
<pre><code class="python">import numpy as np
import matplotlib.pyplot as plt

class ActivationFunctionsNumPy:
    """ä½¿ç”¨NumPyå®ç°çš„æ¿€æ´»å‡½æ•°"""

    @staticmethod
    def sigmoid(x):
        """Sigmoidæ¿€æ´»å‡½æ•°"""
        return 1 / (1 + np.exp(-np.clip(x, -500, 500)))

    @staticmethod
    def sigmoid_derivative(x):
        """Sigmoidå¯¼æ•°"""
        s = ActivationFunctionsNumPy.sigmoid(x)
        return s * (1 - s)

    @staticmethod
    def tanh(x):
        """Tanhæ¿€æ´»å‡½æ•°"""
        return np.tanh(x)

    @staticmethod
    def tanh_derivative(x):
        """Tanhå¯¼æ•°"""
        return 1 - np.tanh(x) ** 2

    @staticmethod
    def relu(x):
        """ReLUæ¿€æ´»å‡½æ•°"""
        return np.maximum(0, x)

    @staticmethod
    def relu_derivative(x):
        """ReLUå¯¼æ•°"""
        return (x > 0).astype(float)

    @staticmethod
    def leaky_relu(x, alpha=0.01):
        """Leaky ReLUæ¿€æ´»å‡½æ•°"""
        return np.where(x > 0, x, alpha * x)

    @staticmethod
    def leaky_relu_derivative(x, alpha=0.01):
        """Leaky ReLUå¯¼æ•°"""
        return np.where(x > 0, 1, alpha)

    @staticmethod
    def elu(x, alpha=1.0):
        """ELUæ¿€æ´»å‡½æ•°"""
        return np.where(x > 0, x, alpha * (np.exp(x) - 1))

    @staticmethod
    def elu_derivative(x, alpha=1.0):
        """ELUå¯¼æ•°"""
        return np.where(x > 0, 1, alpha * np.exp(x))

    @staticmethod
    def swish(x):
        """Swishæ¿€æ´»å‡½æ•°"""
        return x * ActivationFunctionsNumPy.sigmoid(x)

    @staticmethod
    def swish_derivative(x):
        """Swishå¯¼æ•°"""
        sigmoid_x = ActivationFunctionsNumPy.sigmoid(x)
        return sigmoid_x + x * sigmoid_x * (1 - sigmoid_x)

    @staticmethod
    def gelu(x):
        """GELUæ¿€æ´»å‡½æ•°ï¼ˆé«˜æ–¯è¯¯å·®çº¿æ€§å•å…ƒï¼‰"""
        return 0.5 * x * (1 + np.tanh(np.sqrt(2 / np.pi) * (x + 0.044715 * x**3)))

    @staticmethod
    def gelu_derivative(x):
        """GELUå¯¼æ•°çš„è¿‘ä¼¼"""
        # ä½¿ç”¨æ•°å€¼å¾®åˆ†
        h = 1e-5
        return (ActivationFunctionsNumPy.gelu(x + h) -
                ActivationFunctionsNumPy.gelu(x - h)) / (2 * h)


# æ¿€æ´»å‡½æ•°å¯è§†åŒ–æ¯”è¾ƒ
def visualize_activations_numpy():
    """ä½¿ç”¨NumPyå¯è§†åŒ–æ‰€æœ‰æ¿€æ´»å‡½æ•°"""

    x = np.linspace(-5, 5, 1000)

    # å®šä¹‰æ¿€æ´»å‡½æ•°åŠå…¶å¯¼æ•°
    activations = {
        'Sigmoid': (ActivationFunctionsNumPy.sigmoid,
                   ActivationFunctionsNumPy.sigmoid_derivative),
        'Tanh': (ActivationFunctionsNumPy.tanh,
                ActivationFunctionsNumPy.tanh_derivative),
        'ReLU': (ActivationFunctionsNumPy.relu,
                ActivationFunctionsNumPy.relu_derivative),
        'Leaky ReLU': (ActivationFunctionsNumPy.leaky_relu,
                      ActivationFunctionsNumPy.leaky_relu_derivative),
        'ELU': (ActivationFunctionsNumPy.elu,
               ActivationFunctionsNumPy.elu_derivative),
        'Swish': (ActivationFunctionsNumPy.swish,
                 ActivationFunctionsNumPy.swish_derivative),
        'GELU': (ActivationFunctionsNumPy.gelu,
                ActivationFunctionsNumPy.gelu_derivative)
    }

    # åˆ›å»ºå›¾è¡¨
    fig, axes = plt.subplots(3, 3, figsize=(15, 12))
    axes = axes.flatten()

    for idx, (name, (func, deriv)) in enumerate(activations.items()):
        if idx < len(axes):
            ax = axes[idx]

            # è®¡ç®—å‡½æ•°å€¼å’Œå¯¼æ•°
            y = func(x)
            dy = deriv(x)

            # ç»˜åˆ¶å‡½æ•°
            ax.plot(x, y, 'b-', linewidth=2, label=f'{name}')
            ax.plot(x, dy, 'r--', linewidth=2, label=f"{name}'")

            # è®¾ç½®å›¾è¡¨
            ax.set_title(name, fontsize=14)
            ax.grid(True, alpha=0.3)
            ax.axhline(y=0, color='k', linewidth=0.5)
            ax.axvline(x=0, color='k', linewidth=0.5)
            ax.legend()
            ax.set_xlim(-5, 5)
            ax.set_ylim(-1.5, 1.5)

            # æ·»åŠ å…³é”®ä¿¡æ¯
            ax.text(0.02, 0.98, f'f(0)={func(0):.3f}',
                   transform=ax.transAxes,
                   verticalalignment='top',
                   bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.5))

    # éšè—å¤šä½™çš„å­å›¾
    for idx in range(len(activations), len(axes)):
        axes[idx].set_visible(False)

    plt.suptitle('æ¿€æ´»å‡½æ•°åŠå…¶å¯¼æ•°æ¯”è¾ƒ', fontsize=16)
    plt.tight_layout()
    plt.show()


# æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸å®éªŒ
def gradient_vanishing_experiment():
    """æ¼”ç¤ºä¸åŒæ¿€æ´»å‡½æ•°çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜"""

    np.random.seed(42)

    # ç½‘ç»œå‚æ•°
    input_size = 10
    hidden_size = 50
    output_size = 1
    num_layers = 20

    # åˆå§‹åŒ–ç½‘ç»œæƒé‡
    def init_network(num_layers, hidden_size, activation='relu'):
        weights = []
        biases = []

        # è¾“å…¥å±‚
        if activation in ['relu', 'leaky_relu']:
            # Heåˆå§‹åŒ–
            w = np.random.randn(hidden_size, input_size) * np.sqrt(2.0 / input_size)
        else:
            # Xavieråˆå§‹åŒ–
            w = np.random.randn(hidden_size, input_size) * np.sqrt(1.0 / input_size)

        weights.append(w)
        biases.append(np.zeros((hidden_size, 1)))

        # éšè—å±‚
        for _ in range(num_layers - 2):
            if activation in ['relu', 'leaky_relu']:
                w = np.random.randn(hidden_size, hidden_size) * np.sqrt(2.0 / hidden_size)
            else:
                w = np.random.randn(hidden_size, hidden_size) * np.sqrt(1.0 / hidden_size)

            weights.append(w)
            biases.append(np.zeros((hidden_size, 1)))

        # è¾“å‡ºå±‚
        w = np.random.randn(output_size, hidden_size) * np.sqrt(1.0 / hidden_size)
        weights.append(w)
        biases.append(np.zeros((output_size, 1)))

        return weights, biases

    # å‰å‘ä¼ æ’­
    def forward(x, weights, biases, activation='relu'):
        activations = [x]
        pre_activations = []

        for i, (w, b) in enumerate(zip(weights, biases)):
            z = np.dot(w, activations[-1]) + b
            pre_activations.append(z)

            if i < len(weights) - 1:  # éšè—å±‚ä½¿ç”¨æ¿€æ´»å‡½æ•°
                if activation == 'relu':
                    a = ActivationFunctionsNumPy.relu(z)
                elif activation == 'tanh':
                    a = ActivationFunctionsNumPy.tanh(z)
                elif activation == 'sigmoid':
                    a = ActivationFunctionsNumPy.sigmoid(z)
                elif activation == 'leaky_relu':
                    a = ActivationFunctionsNumPy.leaky_relu(z)
            else:  # è¾“å‡ºå±‚ä¸ä½¿ç”¨æ¿€æ´»å‡½æ•°
                a = z

            activations.append(a)

        return activations, pre_activations

    # åå‘ä¼ æ’­
    def backward(activations, pre_activations, weights, target, activation='relu'):
        gradients = []

        # è¾“å‡ºå±‚æ¢¯åº¦
        delta = activations[-1] - target
        gradients.append(delta)

        # åå‘ä¼ æ’­
        for i in range(len(weights) - 2, -1, -1):
            # ä¼ æ’­æ¢¯åº¦
            delta = np.dot(weights[i + 1].T, delta)

            # ä¹˜ä»¥æ¿€æ´»å‡½æ•°å¯¼æ•°
            if activation == 'relu':
                delta = delta * ActivationFunctionsNumPy.relu_derivative(pre_activations[i])
            elif activation == 'tanh':
                delta = delta * ActivationFunctionsNumPy.tanh_derivative(pre_activations[i])
            elif activation == 'sigmoid':
                delta = delta * ActivationFunctionsNumPy.sigmoid_derivative(pre_activations[i])
            elif activation == 'leaky_relu':
                delta = delta * ActivationFunctionsNumPy.leaky_relu_derivative(pre_activations[i])

            gradients.append(delta)

        gradients.reverse()
        return gradients

    # å®éªŒä¸åŒæ¿€æ´»å‡½æ•°
    activations_to_test = ['sigmoid', 'tanh', 'relu', 'leaky_relu']
    results = {}

    # ç”Ÿæˆæµ‹è¯•æ•°æ®
    x = np.random.randn(input_size, 1)
    target = np.random.randn(output_size, 1)

    fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(12, 10))

    for activation in activations_to_test:
        # åˆå§‹åŒ–ç½‘ç»œ
        weights, biases = init_network(num_layers, hidden_size, activation)

        # å‰å‘ä¼ æ’­
        activations_list, pre_activations = forward(x, weights, biases, activation)

        # åå‘ä¼ æ’­
        gradients = backward(activations_list, pre_activations, weights, target, activation)

        # æ”¶é›†æ¢¯åº¦ç»Ÿè®¡
        grad_norms = []
        activation_means = []

        for i, grad in enumerate(gradients):
            grad_norms.append(np.linalg.norm(grad))
            if i < len(activations_list) - 1:
                activation_means.append(np.mean(np.abs(activations_list[i + 1])))

        results[activation] = {
            'grad_norms': grad_norms,
            'activation_means': activation_means
        }

        # ç»˜åˆ¶æ¢¯åº¦èŒƒæ•°
        ax1.semilogy(range(len(grad_norms)), grad_norms, 'o-',
                    label=activation, linewidth=2, markersize=6)

        # ç»˜åˆ¶æ¿€æ´»å€¼å‡å€¼
        ax2.plot(range(len(activation_means)), activation_means, 's-',
                label=activation, linewidth=2, markersize=6)

    ax1.set_xlabel('å±‚ç´¢å¼•ï¼ˆä»è¾“å…¥åˆ°è¾“å‡ºï¼‰')
    ax1.set_ylabel('æ¢¯åº¦èŒƒæ•° (log scale)')
    ax1.set_title(f'æ¢¯åº¦åœ¨{num_layers}å±‚ç½‘ç»œä¸­çš„ä¼ æ’­')
    ax1.legend()
    ax1.grid(True, alpha=0.3)

    ax2.set_xlabel('å±‚ç´¢å¼•')
    ax2.set_ylabel('æ¿€æ´»å€¼ç»å¯¹å€¼å‡å€¼')
    ax2.set_title('å„å±‚æ¿€æ´»å€¼ç»Ÿè®¡')
    ax2.legend()
    ax2.grid(True, alpha=0.3)

    plt.tight_layout()
    plt.show()

    # æ‰“å°åˆ†æç»“æœ
    print("\n=== æ¢¯åº¦ä¼ æ’­åˆ†æ ===")
    for activation, result in results.items():
        first_grad = result['grad_norms'][0]
        last_grad = result['grad_norms'][-1]
        ratio = first_grad / last_grad if last_grad > 0 else float('inf')

        print(f"\n{activation.upper()}:")
        print(f"  ç¬¬ä¸€å±‚æ¢¯åº¦èŒƒæ•°: {first_grad:.6f}")
        print(f"  æœ€åå±‚æ¢¯åº¦èŒƒæ•°: {last_grad:.6f}")
        print(f"  è¡°å‡æ¯”ä¾‹: {ratio:.2e}")

        if ratio > 1e6:
            print("  âš ï¸ ä¸¥é‡æ¢¯åº¦æ¶ˆå¤±ï¼")
        elif ratio > 1e3:
            print("  âš ï¸ è½»åº¦æ¢¯åº¦æ¶ˆå¤±")
        elif ratio < 1e-3:
            print("  ğŸ”¥ æ¢¯åº¦çˆ†ç‚¸é£é™©ï¼")
        else:
            print("  âœ… æ¢¯åº¦ä¼ æ’­æ­£å¸¸")


# æ¼”ç¤ºæ­»äº¡ReLUé—®é¢˜
def dead_relu_demo():
    """æ¼”ç¤ºæ­»äº¡ReLUç°è±¡"""

    np.random.seed(42)

    # åˆ›å»ºä¸€ä¸ªç®€å•çš„ç½‘ç»œ
    input_size = 2
    hidden_size = 100
    output_size = 1

    # ä½¿ç”¨è¾ƒå¤§çš„è´Ÿåç½®åˆå§‹åŒ–ï¼ˆå®¹æ˜“é€ æˆæ­»äº¡ReLUï¼‰
    W1 = np.random.randn(hidden_size, input_size) * 0.5
    b1 = np.ones((hidden_size, 1)) * (-5)  # å¤§çš„è´Ÿåç½®
    W2 = np.random.randn(output_size, hidden_size) * 0.5
    b2 = np.zeros((output_size, 1))

    # ç”Ÿæˆä¸€äº›è®­ç»ƒæ•°æ®
    X = np.random.randn(input_size, 1000)

    # å‰å‘ä¼ æ’­
    z1 = np.dot(W1, X) + b1
    a1_relu = ActivationFunctionsNumPy.relu(z1)
    a1_leaky = ActivationFunctionsNumPy.leaky_relu(z1)

    # ç»Ÿè®¡æ­»äº¡ç¥ç»å…ƒ
    dead_neurons_relu = np.sum(np.all(a1_relu == 0, axis=1))
    dead_neurons_leaky = np.sum(np.all(a1_leaky == 0, axis=1))

    active_percentage_relu = (hidden_size - dead_neurons_relu) / hidden_size * 100
    active_percentage_leaky = (hidden_size - dead_neurons_leaky) / hidden_size * 100

    # å¯è§†åŒ–
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 5))

    # ReLUæ¿€æ´»æ¨¡å¼
    ax1.imshow(a1_relu[:50, :100], aspect='auto', cmap='hot')
    ax1.set_title(f'ReLUæ¿€æ´»æ¨¡å¼\næ´»è·ƒç¥ç»å…ƒ: {active_percentage_relu:.1f}%')
    ax1.set_xlabel('æ ·æœ¬')
    ax1.set_ylabel('ç¥ç»å…ƒ')
    ax1.colorbar = plt.colorbar(ax1.images[0], ax=ax1)

    # Leaky ReLUæ¿€æ´»æ¨¡å¼
    ax2.imshow(a1_leaky[:50, :100], aspect='auto', cmap='hot')
    ax2.set_title(f'Leaky ReLUæ¿€æ´»æ¨¡å¼\næ´»è·ƒç¥ç»å…ƒ: {active_percentage_leaky:.1f}%')
    ax2.set_xlabel('æ ·æœ¬')
    ax2.set_ylabel('ç¥ç»å…ƒ')
    ax2.colorbar = plt.colorbar(ax2.images[0], ax=ax2)

    plt.tight_layout()
    plt.show()

    print("\n=== æ­»äº¡ReLUåˆ†æ ===")
    print(f"ReLUæ­»äº¡ç¥ç»å…ƒæ•°: {dead_neurons_relu}/{hidden_size} ({100-active_percentage_relu:.1f}%)")
    print(f"Leaky ReLUæ­»äº¡ç¥ç»å…ƒæ•°: {dead_neurons_leaky}/{hidden_size} ({100-active_percentage_leaky:.1f}%)")
    print("\nğŸ’¡ æç¤ºï¼š")
    print("- æ­»äº¡ReLUç¥ç»å…ƒçš„è¾“å‡ºæ°¸è¿œä¸º0ï¼Œæ— æ³•å­¦ä¹ ")
    print("- Leaky ReLUé€šè¿‡å…è®¸å°çš„è´Ÿæ–œç‡é¿å…äº†è¿™ä¸ªé—®é¢˜")
    print("- æ­£ç¡®çš„åˆå§‹åŒ–ä¹Ÿå¯ä»¥å‡å°‘æ­»äº¡ç¥ç»å…ƒ")


if __name__ == "__main__":
    print("=== NumPyæ¿€æ´»å‡½æ•°å®éªŒ ===\n")

    # 1. å¯è§†åŒ–æ‰€æœ‰æ¿€æ´»å‡½æ•°
    print("1. å¯è§†åŒ–æ¿€æ´»å‡½æ•°åŠå…¶å¯¼æ•°...")
    visualize_activations_numpy()

    # 2. æ¢¯åº¦æ¶ˆå¤±å®éªŒ
    print("\n2. æµ‹è¯•æ·±å±‚ç½‘ç»œä¸­çš„æ¢¯åº¦ä¼ æ’­...")
    gradient_vanishing_experiment()

    # 3. æ­»äº¡ReLUæ¼”ç¤º
    print("\n3. æ¼”ç¤ºæ­»äº¡ReLUé—®é¢˜...")
    dead_relu_demo()

    print("\nå®éªŒå®Œæˆï¼")
    <div class="code-output" id="code-output">
                    <strong>è¿è¡Œç»“æœï¼š</strong>
                    <pre>æ­£åœ¨è¿è¡Œæ¿€æ´»å‡½æ•°å¯¹æ¯”å®éªŒ...
1. ç»˜åˆ¶æ¿€æ´»å‡½æ•°å›¾åƒ... âœ“
2. åˆ†ææ·±å±‚ç½‘ç»œä¸­çš„æ¢¯åº¦æµ... âœ“
3. åœ¨èºæ—‹æ•°æ®é›†ä¸Šæµ‹è¯•æ€§èƒ½... âœ“

æœ€ç»ˆå‡†ç¡®ç‡ï¼š
- ReLU: 96.8%
- GELU: 97.5%
- Tanh: 89.2%</pre>
                </div>
                </div>

                <!-- å®éªŒç»“è®º -->
                <div class="tip success mt-3">
                    <span class="tip-icon">ğŸ“Š</span>
                    <div class="tip-content">
                        <strong>å®éªŒå‘ç°ï¼š</strong><br>
                        â€¢ ReLUåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¡¨ç°è‰¯å¥½ï¼Œè®­ç»ƒé€Ÿåº¦å¿«<br>
                        â€¢ GELUç­‰ç°ä»£æ¿€æ´»å‡½æ•°åœ¨å¤æ‚ä»»åŠ¡ä¸Šç•¥æœ‰ä¼˜åŠ¿<br>
                        â€¢ Sigmoid/Tanhåœ¨æ·±å±‚ç½‘ç»œä¸­å®¹æ˜“æ¢¯åº¦æ¶ˆå¤±<br>
                        â€¢ æ­£ç¡®çš„åˆå§‹åŒ–å¯¹æ‰€æœ‰æ¿€æ´»å‡½æ•°éƒ½å¾ˆé‡è¦
                    </div>
                </div>
        </section>

        <!-- æ·±åº¦vså®½åº¦çš„æƒè¡¡ -->
        <section id="depth-width" class="section-card">
            <h2 style="color: var(--accent-yellow); margin-bottom: 1.5rem;">
                âš–ï¸ æ·±åº¦vså®½åº¦çš„æƒè¡¡
                <span class="depth-indicator advanced">æ·±å…¥</span>
            </h2>

            <!-- å¼•å…¥å¯¹è¯ -->
            <div class="dialogue-container">
                <div class="dialogue-item">
                    <div class="dialogue-avatar student">ğŸ¤”</div>
                    <div class="dialogue-content">
                        <div class="dialogue-name">å°é™ˆ</div>
                        <p>æ•™æˆï¼Œæ—¢ç„¶å•å±‚ç½‘ç»œç†è®ºä¸Šå¯ä»¥é€¼è¿‘ä»»ä½•å‡½æ•°ï¼Œ
                            ä¸ºä»€ä¹ˆè¿˜è¦ç”¨æ·±åº¦ç½‘ç»œï¼Ÿç›´æ¥åŠ å®½ä¸å°±è¡Œäº†ï¼Ÿ</p>
                    </div>
                </div>
                <div class="dialogue-item">
                    <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                    <div class="dialogue-content">
                        <div class="dialogue-name">ç‹æ•™æˆ</div>
                        <p>è¿™æ˜¯ä¸ªæ·±åˆ»çš„é—®é¢˜ï¼è®©æˆ‘ç”¨ä¸€ä¸ªç±»æ¯”ï¼šå»ºé€ é«˜æ¥¼ vs æ‘Šå¤§é¥¼ã€‚
                            ä¸¤ç§æ–¹å¼éƒ½èƒ½å¢åŠ é¢ç§¯ï¼Œä½†æ•ˆç‡å’ŒåŠŸèƒ½å®Œå…¨ä¸åŒ...</p>
                    </div>
                </div>
            </div>

            <!-- äº¤äº’å¼å¯¹æ¯”å®éªŒ -->
            <div class="interactive-demo">
                <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ”¬ æ·±åº¦ vs å®½åº¦å®éªŒå®¤</h3>

                <div class="demo-controls">
                    <div class="control-group">
                        <label>ç½‘ç»œé…ç½®</label>
                        <select id="network-config" class="form-select">
                            <option value="shallow-wide">æµ…è€Œå®½ (1å±‚Ã—1000)</option>
                            <option value="medium">ä¸­ç­‰ (3å±‚Ã—100)</option>
                            <option value="deep-narrow">æ·±è€Œçª„ (10å±‚Ã—20)</option>
                            <option value="custom">è‡ªå®šä¹‰</option>
                        </select>
                    </div>
                    <div class="control-group" id="custom-controls" style="display: none;">
                        <label>å±‚æ•°</label>
                        <input type="number" id="custom-depth" min="1" max="20" value="5" style="width: 60px;">
                        <label style="margin-left: 1rem;">å®½åº¦</label>
                        <input type="number" id="custom-width" min="10" max="1000" value="50" style="width: 80px;">
                    </div>
                    <button class="btn btn-primary" onclick="compareArchitectures()" tabindex="0">
                        ğŸš€ å¼€å§‹å¯¹æ¯”
                    </button>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                    <div>
                        <canvas id="architecture-vis" width="400" height="400"></canvas>
                        <p style="text-align: center; margin-top: 0.5rem; color: var(--text-secondary);">
                            ç½‘ç»œæ¶æ„å¯è§†åŒ–
                        </p>
                    </div>
                    <div>
                        <canvas id="performance-chart" width="400" height="400"></canvas>
                        <p style="text-align: center; margin-top: 0.5rem; color: var(--text-secondary);">
                            æ€§èƒ½å¯¹æ¯”å›¾è¡¨
                        </p>
                    </div>
                </div>

                <!-- å®æ—¶ç»Ÿè®¡ -->
                <div style="margin-top: 2rem; display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                    <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                        <h4 style="color: var(--accent-purple); margin-bottom: 0.5rem;">å‚æ•°é‡</h4>
                        <p style="font-size: 1.5rem; font-weight: bold;" id="param-count">0</p>
                    </div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                        <h4 style="color: var(--accent-green); margin-bottom: 0.5rem;">è®­ç»ƒé€Ÿåº¦</h4>
                        <p style="font-size: 1.5rem; font-weight: bold;" id="train-speed">0ms</p>
                    </div>
                    <div style="background: rgba(6, 182, 212, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                        <h4 style="color: var(--accent-blue); margin-bottom: 0.5rem;">å‡†ç¡®ç‡</h4>
                        <p style="font-size: 1.5rem; font-weight: bold;" id="accuracy">0%</p>
                    </div>
                    <div style="background: rgba(251, 191, 36, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                        <h4 style="color: var(--accent-yellow); margin-bottom: 0.5rem;">æ³›åŒ–èƒ½åŠ›</h4>
                        <p style="font-size: 1.5rem; font-weight: bold;" id="generalization">0%</p>
                    </div>
                </div>
            </div>

            <!-- ç†è®ºåˆ†æ -->
            <div class="math-derivation mt-4">
                <h3>è¡¨è¾¾æ•ˆç‡çš„æ•°å­¦åˆ†æ</h3>

                <div class="math-step" data-step="1">
                    <strong>å‡½æ•°å¤æ‚åº¦</strong>
                    <p>è€ƒè™‘ä¸€ä¸ªéœ€è¦è¡¨è¾¾çš„å‡½æ•°æ— Fï¼Œå…¶å¤æ‚åº¦å¯ä»¥ç”¨VCç»´æˆ–Rademacherå¤æ‚åº¦è¡¡é‡</p>
                    <div class="math-explanation">
                        æ·±åº¦ç½‘ç»œï¼šO(L Ã— WÂ²) å‚æ•°å¯è¡¨è¾¾ O(W^L) å¤æ‚åº¦çš„å‡½æ•°<br>
                        æµ…å±‚ç½‘ç»œï¼šO(WÂ²) å‚æ•°åªèƒ½è¡¨è¾¾ O(WÂ²) å¤æ‚åº¦çš„å‡½æ•°<br>
                        <strong>ç»“è®ºï¼šæ·±åº¦å¸¦æ¥æŒ‡æ•°çº§çš„è¡¨è¾¾æ•ˆç‡æå‡ï¼</strong>
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>ç‰¹å¾å¤ç”¨</strong>
                    <p>æ·±åº¦ç½‘ç»œé€šè¿‡å±‚çº§ç»“æ„å®ç°ç‰¹å¾å¤ç”¨ï¼š</p>
                    <div style="text-align: center; margin: 1rem 0;">
                        <img src="data:image/svg+xml;base64,..." alt="ç‰¹å¾å±‚æ¬¡å›¾" style="max-width: 100%;">
                    </div>
                    <div class="math-explanation">
                        ä½å±‚å­¦ä¹ è¾¹ç¼˜ â†’ ä¸­å±‚å­¦ä¹ çº¹ç† â†’ é«˜å±‚å­¦ä¹ è¯­ä¹‰<br>
                        æ¯å±‚éƒ½åœ¨å‰ä¸€å±‚çš„åŸºç¡€ä¸Šæ„å»ºæ›´å¤æ‚çš„ç‰¹å¾
                    </div>
                </div>
            </div>

            <!-- å®é™…ä¾‹å­ -->
            <div class="concept-grid mt-4">
                <div class="concept-card what">
                    <h3 style="color: var(--accent-green);">æµ…è€Œå®½</h3>
                    <p><strong>ä¼˜ç‚¹ï¼š</strong></p>
                    <ul style="font-size: 0.9rem;">
                        <li>å¹¶è¡Œåº¦é«˜</li>
                        <li>ä¼˜åŒ–ç®€å•</li>
                        <li>ç†è®ºä¿è¯</li>
                    </ul>
                    <p><strong>ç¼ºç‚¹ï¼š</strong></p>
                    <ul style="font-size: 0.9rem;">
                        <li>å‚æ•°çˆ†ç‚¸</li>
                        <li>æ³›åŒ–å·®</li>
                        <li>æ— ç‰¹å¾å±‚æ¬¡</li>
                    </ul>
                </div>
                <div class="concept-card how">
                    <h3 style="color: var(--accent-blue);">æ·±è€Œçª„</h3>
                    <p><strong>ä¼˜ç‚¹ï¼š</strong></p>
                    <ul style="font-size: 0.9rem;">
                        <li>å‚æ•°æ•ˆç‡é«˜</li>
                        <li>ç‰¹å¾å±‚æ¬¡åŒ–</li>
                        <li>æ³›åŒ–èƒ½åŠ›å¼º</li>
                    </ul>
                    <p><strong>ç¼ºç‚¹ï¼š</strong></p>
                    <ul style="font-size: 0.9rem;">
                        <li>ä¼˜åŒ–å›°éš¾</li>
                        <li>æ¢¯åº¦é—®é¢˜</li>
                        <li>è®­ç»ƒæŠ€å·§å¤š</li>
                    </ul>
                </div>
            </div>

            <!-- ç»éªŒæ³•åˆ™ -->
            <div class="tip info mt-4">
                <span class="tip-icon">ğŸ“</span>
                <div class="tip-content">
                    <strong>æ¶æ„è®¾è®¡ç»éªŒæ³•åˆ™ï¼š</strong><br>
                    â€¢ <strong>è®¡ç®—æœºè§†è§‰</strong>ï¼šæ·±åº¦ä¼˜å…ˆï¼ˆCNNé€šå¸¸å¾ˆæ·±ï¼‰<br>
                    â€¢ <strong>è¡¨æ ¼æ•°æ®</strong>ï¼šé€‚åº¦æ·±åº¦ï¼ˆ3-5å±‚è¶³å¤Ÿï¼‰<br>
                    â€¢ <strong>NLPä»»åŠ¡</strong>ï¼šå®½åº¦ä¹Ÿé‡è¦ï¼ˆTransformerå¾ˆå®½ï¼‰<br>
                    â€¢ <strong>å¼€å§‹ç®€å•</strong>ï¼šå…ˆè¯•è¯•3å±‚ï¼Œæ ¹æ®éœ€è¦åŠ æ·±
                </div>
            </div>
        </section>

        <!-- ä»£ç å®ç°ï¼šæ„å»ºMLP -->
        <section id="implementation" class="section-card">
            <h2 style="color: var(--accent-blue); margin-bottom: 1.5rem;">
                ğŸ’» ä»£ç å®ç°ï¼šæ„å»ºçµæ´»çš„MLP
                <span class="depth-indicator intermediate">è¿›é˜¶</span>
            </h2>

            <!-- å®ç°è¯´æ˜ -->
            <div class="dialogue-container">
                <div class="dialogue-item">
                    <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                    <div class="dialogue-content">
                        <div class="dialogue-name">ç‹æ•™æˆ</div>
                        <p>ç°åœ¨è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªçµæ´»çš„MLPç±»ã€‚æˆ‘ä¼šæŠŠä»£ç åˆ†æˆå°å—ï¼Œ
                            æ¯ä¸€éƒ¨åˆ†éƒ½è¯¦ç»†è§£é‡Šï¼Œç¡®ä¿ä½ ç†è§£æ¯è¡Œä»£ç çš„ä½œç”¨ã€‚</p>
                    </div>
                </div>
            </div>

            <div class="code-container">
                <div class="code-header">
                    <div class="code-header-left">
                        <button class="code-tab active" data-lang="pytorch" tabindex="0">PyTorchç‰ˆæœ¬</button>
                        <button class="code-tab" data-lang="numpy" tabindex="0">NumPyç‰ˆæœ¬</button>
                    </div>
                    <div class="code-header-right">
                        <button class="code-action" onclick="copyCode()" tabindex="0">
                            ğŸ“‹ å¤åˆ¶
                        </button>
                    </div>
                </div>
                <div class="code-content" id="pytorch-code">
<pre><code class="python">import torch
import torch.nn as nn
import torch.nn.functional as F
import numpy as np

# ========== ç¬¬1éƒ¨åˆ†ï¼šåŸºç¡€MLPç±» ==========
class MLP(nn.Module):
    """
    çµæ´»çš„å¤šå±‚æ„ŸçŸ¥æœºå®ç°

    è¿™ä¸ªç±»å…è®¸ä½ ï¼š
    1. è‡ªå®šä¹‰å±‚æ•°å’Œæ¯å±‚çš„å®½åº¦
    2. é€‰æ‹©ä¸åŒçš„æ¿€æ´»å‡½æ•°
    3. æ·»åŠ æ­£åˆ™åŒ–ï¼ˆDropout, BatchNormï¼‰
    4. çµæ´»çš„åˆå§‹åŒ–ç­–ç•¥
    """

    def __init__(self,
                 input_size,
                 hidden_sizes,
                 output_size,
                 activation='relu',
                 dropout_rate=0.0,
                 use_batch_norm=False):
        """
        å‚æ•°è¯´æ˜ï¼š
        input_size: è¾“å…¥ç‰¹å¾ç»´åº¦
        hidden_sizes: åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯å¯¹åº”éšè—å±‚çš„ç¥ç»å…ƒæ•°
        output_size: è¾“å‡ºç»´åº¦
        activation: æ¿€æ´»å‡½æ•°ç±»å‹
        dropout_rate: Dropoutæ¦‚ç‡ï¼ˆ0è¡¨ç¤ºä¸ä½¿ç”¨ï¼‰
        use_batch_norm: æ˜¯å¦ä½¿ç”¨æ‰¹å½’ä¸€åŒ–
        """
        super(MLP, self).__init__()

        # ä¿å­˜é…ç½®
        self.input_size = input_size
        self.hidden_sizes = hidden_sizes
        self.output_size = output_size
        self.activation_name = activation
        self.dropout_rate = dropout_rate
        self.use_batch_norm = use_batch_norm

        # æ„å»ºç½‘ç»œå±‚
        self.layers = nn.ModuleList()
        self.batch_norms = nn.ModuleList()
        self.dropouts = nn.ModuleList()

        # é€å±‚æ„å»º
        prev_size = input_size
        for hidden_size in hidden_sizes:
            # æ·»åŠ çº¿æ€§å±‚
            self.layers.append(nn.Linear(prev_size, hidden_size))

            # æ·»åŠ æ‰¹å½’ä¸€åŒ–ï¼ˆå¦‚æœéœ€è¦ï¼‰
            if use_batch_norm:
                self.batch_norms.append(nn.BatchNorm1d(hidden_size))

            # æ·»åŠ Dropoutï¼ˆå¦‚æœéœ€è¦ï¼‰
            if dropout_rate > 0:
                self.dropouts.append(nn.Dropout(dropout_rate))

            prev_size = hidden_size

        # è¾“å‡ºå±‚
        self.output_layer = nn.Linear(prev_size, output_size)

        # è®¾ç½®æ¿€æ´»å‡½æ•°
        self.activation = self._get_activation(activation)

        # åˆå§‹åŒ–æƒé‡
        self._initialize_weights()

    def _get_activation(self, activation_name):
        """è·å–æ¿€æ´»å‡½æ•°"""
        activations = {
            'relu': nn.ReLU(),
            'tanh': nn.Tanh(),
            'sigmoid': nn.Sigmoid(),
            'leaky_relu': nn.LeakyReLU(0.01),
            'elu': nn.ELU(),
            'gelu': nn.GELU(),
            'swish': nn.SiLU()  # SiLUå°±æ˜¯Swish
        }
        return activations.get(activation_name, nn.ReLU())

    def _initialize_weights(self):
        """æƒé‡åˆå§‹åŒ–ç­–ç•¥"""
        for layer in self.layers:
            if self.activation_name in ['relu', 'leaky_relu']:
                # Heåˆå§‹åŒ–ï¼ˆé€‚åˆReLUç³»åˆ—ï¼‰
                nn.init.kaiming_normal_(layer.weight, mode='fan_in',
                                      nonlinearity='relu')
            else:
                # Xavieråˆå§‹åŒ–ï¼ˆé€‚åˆSigmoid/Tanhï¼‰
                nn.init.xavier_normal_(layer.weight)

            # åç½®åˆå§‹åŒ–ä¸º0
            nn.init.constant_(layer.bias, 0)

        # è¾“å‡ºå±‚ä½¿ç”¨Xavieråˆå§‹åŒ–
        nn.init.xavier_normal_(self.output_layer.weight)
        nn.init.constant_(self.output_layer.bias, 0)

    def forward(self, x):
        """å‰å‘ä¼ æ’­"""
        # é€šè¿‡éšè—å±‚
        for i, layer in enumerate(self.layers):
            x = layer(x)

            # æ‰¹å½’ä¸€åŒ–
            if self.use_batch_norm and i < len(self.batch_norms):
                x = self.batch_norms[i](x)

            # æ¿€æ´»å‡½æ•°
            x = self.activation(x)

            # Dropout
            if self.dropout_rate > 0 and i < len(self.dropouts):
                x = self.dropouts[i](x)

        # è¾“å‡ºå±‚ï¼ˆé€šå¸¸ä¸åŠ æ¿€æ´»å‡½æ•°ï¼‰
        x = self.output_layer(x)

        return x


# ========== ç¬¬2éƒ¨åˆ†ï¼šå¸¦è·³è·ƒè¿æ¥çš„MLP ==========
class ResidualMLP(nn.Module):
    """
    å¸¦æ®‹å·®è¿æ¥çš„MLP

    æ®‹å·®è¿æ¥å¯ä»¥ï¼š
    1. ç¼“è§£æ¢¯åº¦æ¶ˆå¤±
    2. è®©ç½‘ç»œæ›´å®¹æ˜“è®­ç»ƒ
    3. å…è®¸æ„å»ºæ›´æ·±çš„ç½‘ç»œ
    """

    def __init__(self,
                 input_size,
                 hidden_size,
                 num_blocks,
                 output_size,
                 activation='relu'):
        super(ResidualMLP, self).__init__()

        # è¾“å…¥æŠ•å½±å±‚
        self.input_projection = nn.Linear(input_size, hidden_size)

        # æ®‹å·®å—
        self.blocks = nn.ModuleList()
        for _ in range(num_blocks):
            block = ResidualBlock(hidden_size, activation)
            self.blocks.append(block)

        # è¾“å‡ºå±‚
        self.output_layer = nn.Linear(hidden_size, output_size)

        # æ¿€æ´»å‡½æ•°
        self.activation = self._get_activation(activation)

    def _get_activation(self, name):
        """è·å–æ¿€æ´»å‡½æ•°ï¼ˆä¸ä¸Šé¢ç›¸åŒï¼‰"""
        activations = {
            'relu': nn.ReLU(),
            'tanh': nn.Tanh(),
            'leaky_relu': nn.LeakyReLU(0.01),
            'gelu': nn.GELU()
        }
        return activations.get(name, nn.ReLU())

    def forward(self, x):
        # è¾“å…¥æŠ•å½±
        x = self.activation(self.input_projection(x))

        # é€šè¿‡æ®‹å·®å—
        for block in self.blocks:
            x = block(x)

        # è¾“å‡º
        x = self.output_layer(x)

        return x


class ResidualBlock(nn.Module):
    """æ®‹å·®å—"""

    def __init__(self, hidden_size, activation='relu'):
        super(ResidualBlock, self).__init__()

        self.fc1 = nn.Linear(hidden_size, hidden_size)
        self.fc2 = nn.Linear(hidden_size, hidden_size)

        # æ¿€æ´»å‡½æ•°
        self.activation = self._get_activation(activation)

        # å±‚å½’ä¸€åŒ–ï¼ˆæ¯”æ‰¹å½’ä¸€åŒ–æ›´ç¨³å®šï¼‰
        self.ln1 = nn.LayerNorm(hidden_size)
        self.ln2 = nn.LayerNorm(hidden_size)

    def _get_activation(self, name):
        activations = {
            'relu': nn.ReLU(),
            'gelu': nn.GELU(),
            'leaky_relu': nn.LeakyReLU(0.01)
        }
        return activations.get(name, nn.ReLU())

    def forward(self, x):
        # ä¿å­˜è¾“å…¥ç”¨äºæ®‹å·®è¿æ¥
        residual = x

        # ç¬¬ä¸€å±‚
        x = self.ln1(x)
        x = self.activation(self.fc1(x))

        # ç¬¬äºŒå±‚
        x = self.ln2(x)
        x = self.fc2(x)

        # æ®‹å·®è¿æ¥
        x = x + residual

        return x


# ========== ç¬¬3éƒ¨åˆ†ï¼šå®ç”¨å·¥å…·å‡½æ•° ==========
def count_parameters(model):
    """ç»Ÿè®¡æ¨¡å‹å‚æ•°é‡"""
    return sum(p.numel() for p in model.parameters() if p.requires_grad)


def create_mlp_from_config(config):
    """æ ¹æ®é…ç½®å­—å…¸åˆ›å»ºMLP"""
    return MLP(
        input_size=config['input_size'],
        hidden_sizes=config['hidden_sizes'],
        output_size=config['output_size'],
        activation=config.get('activation', 'relu'),
        dropout_rate=config.get('dropout_rate', 0.0),
        use_batch_norm=config.get('use_batch_norm', False)
    )


# ========== ç¬¬4éƒ¨åˆ†ï¼šè®­ç»ƒè¾…åŠ©ç±» ==========
class MLPTrainer:
    """MLPè®­ç»ƒå™¨"""

    def __init__(self, model, device='cpu'):
        self.model = model.to(device)
        self.device = device
        self.train_history = []
        self.val_history = []

    def train_epoch(self, dataloader, optimizer, criterion):
        """è®­ç»ƒä¸€ä¸ªepoch"""
        self.model.train()
        total_loss = 0
        correct = 0
        total = 0

        for batch_idx, (inputs, targets) in enumerate(dataloader):
            inputs, targets = inputs.to(self.device), targets.to(self.device)

            # å‰å‘ä¼ æ’­
            outputs = self.model(inputs)
            loss = criterion(outputs, targets)

            # åå‘ä¼ æ’­
            optimizer.zero_grad()
            loss.backward()
            optimizer.step()

            # ç»Ÿè®¡
            total_loss += loss.item()

            # å¦‚æœæ˜¯åˆ†ç±»ä»»åŠ¡
            if outputs.shape[1] > 1:
                _, predicted = outputs.max(1)
                total += targets.size(0)
                correct += predicted.eq(targets).sum().item()

        avg_loss = total_loss / len(dataloader)
        accuracy = 100. * correct / total if total > 0 else 0

        return avg_loss, accuracy

    def evaluate(self, dataloader, criterion):
        """è¯„ä¼°æ¨¡å‹"""
        self.model.eval()
        total_loss = 0
        correct = 0
        total = 0

        with torch.no_grad():
            for inputs, targets in dataloader:
                inputs, targets = inputs.to(self.device), targets.to(self.device)

                outputs = self.model(inputs)
                loss = criterion(outputs, targets)

                total_loss += loss.item()

                if outputs.shape[1] > 1:
                    _, predicted = outputs.max(1)
                    total += targets.size(0)
                    correct += predicted.eq(targets).sum().item()

        avg_loss = total_loss / len(dataloader)
        accuracy = 100. * correct / total if total > 0 else 0

        return avg_loss, accuracy

    def fit(self,
            train_loader,
            val_loader,
            epochs,
            optimizer,
            criterion,
            scheduler=None,
            early_stopping_patience=10):
        """å®Œæ•´çš„è®­ç»ƒæµç¨‹"""

        best_val_loss = float('inf')
        patience_counter = 0

        for epoch in range(epochs):
            # è®­ç»ƒ
            train_loss, train_acc = self.train_epoch(
                train_loader, optimizer, criterion
            )

            # éªŒè¯
            val_loss, val_acc = self.evaluate(val_loader, criterion)

            # è®°å½•å†å²
            self.train_history.append({
                'epoch': epoch,
                'loss': train_loss,
                'accuracy': train_acc
            })
            self.val_history.append({
                'epoch': epoch,
                'loss': val_loss,
                'accuracy': val_acc
            })

            # å­¦ä¹ ç‡è°ƒåº¦
            if scheduler is not None:
                scheduler.step(val_loss)

            # æ—©åœ
            if val_loss < best_val_loss:
                best_val_loss = val_loss
                patience_counter = 0
                # ä¿å­˜æœ€ä½³æ¨¡å‹
                self.best_model_state = self.model.state_dict()
            else:
                patience_counter += 1

            if patience_counter >= early_stopping_patience:
                print(f"æ—©åœï¼šéªŒè¯æŸå¤±{early_stopping_patience}è½®æœªæ”¹å–„")
                break

            # æ‰“å°è¿›åº¦
            if (epoch + 1) % 10 == 0:
                print(f'Epoch {epoch+1}/{epochs}:')
                print(f'  è®­ç»ƒ - Loss: {train_loss:.4f}, Acc: {train_acc:.2f}%')
                print(f'  éªŒè¯ - Loss: {val_loss:.4f}, Acc: {val_acc:.2f}%')

    def plot_history(self):
        """ç»˜åˆ¶è®­ç»ƒå†å²"""
        import matplotlib.pyplot as plt

        fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 4))

        # æŸå¤±æ›²çº¿
        epochs = [h['epoch'] for h in self.train_history]
        train_losses = [h['loss'] for h in self.train_history]
        val_losses = [h['loss'] for h in self.val_history]

        ax1.plot(epochs, train_losses, label='è®­ç»ƒæŸå¤±')
        ax1.plot(epochs, val_losses, label='éªŒè¯æŸå¤±')
        ax1.set_xlabel('Epoch')
        ax1.set_ylabel('Loss')
        ax1.set_title('è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±å˜åŒ–')
        ax1.legend()
        ax1.grid(True)

        # å‡†ç¡®ç‡æ›²çº¿
        train_accs = [h['accuracy'] for h in self.train_history]
        val_accs = [h['accuracy'] for h in self.val_history]

        ax2.plot(epochs, train_accs, label='è®­ç»ƒå‡†ç¡®ç‡')
        ax2.plot(epochs, val_accs, label='éªŒè¯å‡†ç¡®ç‡')
        ax2.set_xlabel('Epoch')
        ax2.set_ylabel('Accuracy (%)')
        ax2.set_title('è®­ç»ƒè¿‡ç¨‹ä¸­çš„å‡†ç¡®ç‡å˜åŒ–')
        ax2.legend()
        ax2.grid(True)

        plt.tight_layout()
        plt.show()


# ========== ç¬¬5éƒ¨åˆ†ï¼šä½¿ç”¨ç¤ºä¾‹ ==========
if __name__ == "__main__":
    # åˆ›å»ºä¸€ä¸ªç®€å•çš„MLP
    model = MLP(
        input_size=784,  # MNISTå›¾åƒå°ºå¯¸
        hidden_sizes=[128, 64, 32],  # 3ä¸ªéšè—å±‚
        output_size=10,  # 10ä¸ªç±»åˆ«
        activation='relu',
        dropout_rate=0.2,
        use_batch_norm=True
    )

    print(f"æ¨¡å‹ç»“æ„ï¼š\n{model}")
    print(f"\nå‚æ•°æ€»é‡ï¼š{count_parameters(model):,}")

    # æµ‹è¯•å‰å‘ä¼ æ’­
    x = torch.randn(32, 784)  # æ‰¹å¤§å°32
    output = model(x)
    print(f"\nè¾“å‡ºå½¢çŠ¶ï¼š{output.shape}")

    # åˆ›å»ºæ®‹å·®MLP
    res_model = ResidualMLP(
        input_size=784,
        hidden_size=256,
        num_blocks=5,
        output_size=10,
        activation='gelu'
    )

    print(f"\næ®‹å·®æ¨¡å‹å‚æ•°é‡ï¼š{count_parameters(res_model):,}")</code></pre>
                </div>
                <div class="code-content" id="numpy-code" style="display: none;">
<pre><code class="python">import numpy as np

# ========== ç¬¬1éƒ¨åˆ†ï¼šåŸºç¡€MLPå®ç° ==========
class MLPNumPy:
    """
    ä½¿ç”¨NumPyä»é›¶å®ç°çš„MLP

    é€‚åˆç†è§£åº•å±‚åŸç†ï¼Œä¸é€‚åˆå®é™…åº”ç”¨
    """

    def __init__(self, layer_sizes, activation='relu', learning_rate=0.01):
        """
        å‚æ•°ï¼š
        layer_sizes: åˆ—è¡¨ï¼ŒåŒ…å«æ¯å±‚çš„ç¥ç»å…ƒæ•°
                    ä¾‹å¦‚ [784, 128, 64, 10] è¡¨ç¤ºè¾“å…¥784ï¼Œä¸¤ä¸ªéšè—å±‚ï¼Œè¾“å‡º10
        activation: æ¿€æ´»å‡½æ•°ç±»å‹
        learning_rate: å­¦ä¹ ç‡
        """
        self.layer_sizes = layer_sizes
        self.num_layers = len(layer_sizes)
        self.activation_name = activation
        self.learning_rate = learning_rate

        # åˆå§‹åŒ–æƒé‡å’Œåç½®
        self.weights = []
        self.biases = []

        for i in range(self.num_layers - 1):
            # Heåˆå§‹åŒ–ï¼ˆé€‚åˆReLUï¼‰
            if activation in ['relu', 'leaky_relu']:
                w = np.random.randn(layer_sizes[i], layer_sizes[i+1]) * \
                    np.sqrt(2.0 / layer_sizes[i])
            else:
                # Xavieråˆå§‹åŒ–ï¼ˆé€‚åˆSigmoid/Tanhï¼‰
                w = np.random.randn(layer_sizes[i], layer_sizes[i+1]) * \
                    np.sqrt(1.0 / layer_sizes[i])

            b = np.zeros((1, layer_sizes[i+1]))

            self.weights.append(w)
            self.biases.append(b)

        # è®¾ç½®æ¿€æ´»å‡½æ•°
        self._set_activation_functions()

    def _set_activation_functions(self):
        """è®¾ç½®æ¿€æ´»å‡½æ•°åŠå…¶å¯¼æ•°"""
        if self.activation_name == 'relu':
            self.activation = lambda x: np.maximum(0, x)
            self.activation_derivative = lambda x: (x > 0).astype(float)

        elif self.activation_name == 'sigmoid':
            self.activation = lambda x: 1 / (1 + np.exp(-np.clip(x, -500, 500)))
            self.activation_derivative = lambda x: x * (1 - x)  # æ³¨æ„ï¼šxæ˜¯æ¿€æ´»åçš„å€¼

        elif self.activation_name == 'tanh':
            self.activation = lambda x: np.tanh(x)
            self.activation_derivative = lambda x: 1 - x ** 2  # æ³¨æ„ï¼šxæ˜¯æ¿€æ´»åçš„å€¼

        elif self.activation_name == 'leaky_relu':
            self.activation = lambda x: np.where(x > 0, x, 0.01 * x)
            self.activation_derivative = lambda x: np.where(x > 0, 1, 0.01)

        else:
            raise ValueError(f"æœªçŸ¥çš„æ¿€æ´»å‡½æ•°: {self.activation_name}")

    def forward(self, X):
        """
        å‰å‘ä¼ æ’­

        å‚æ•°ï¼š
        X: è¾“å…¥æ•°æ®ï¼Œå½¢çŠ¶ (batch_size, input_size)

        è¿”å›ï¼š
        è¾“å‡ºå€¼ï¼Œå½¢çŠ¶ (batch_size, output_size)
        """
        self.activations = [X]
        self.z_values = []

        # é€å±‚è®¡ç®—
        for i in range(self.num_layers - 1):
            # çº¿æ€§å˜æ¢ï¼šz = Wx + b
            z = np.dot(self.activations[-1], self.weights[i]) + self.biases[i]
            self.z_values.append(z)

            # æ¿€æ´»å‡½æ•°ï¼ˆæœ€åä¸€å±‚ä¸æ¿€æ´»ï¼‰
            if i < self.num_layers - 2:
                a = self.activation(z)
            else:
                a = z  # è¾“å‡ºå±‚ä¿æŒçº¿æ€§

            self.activations.append(a)

        return self.activations[-1]

    def backward(self, X, y):
        """
        åå‘ä¼ æ’­

        å‚æ•°ï¼š
        X: è¾“å…¥æ•°æ®
        y: çœŸå®æ ‡ç­¾

        è¿”å›ï¼š
        æŸå¤±å€¼
        """
        batch_size = X.shape[0]

        # å‰å‘ä¼ æ’­
        output = self.forward(X)

        # è®¡ç®—æŸå¤±ï¼ˆå‡æ–¹è¯¯å·®ï¼‰
        loss = 0.5 * np.mean((output - y) ** 2)

        # åˆå§‹åŒ–æ¢¯åº¦
        self.weight_gradients = []
        self.bias_gradients = []

        # è¾“å‡ºå±‚çš„è¯¯å·®
        delta = (output - y) / batch_size

        # åå‘ä¼ æ’­è¯¯å·®
        for i in range(self.num_layers - 2, -1, -1):
            # è®¡ç®—æƒé‡å’Œåç½®çš„æ¢¯åº¦
            weight_grad = np.dot(self.activations[i].T, delta)
            bias_grad = np.sum(delta, axis=0, keepdims=True)

            self.weight_gradients.insert(0, weight_grad)
            self.bias_gradients.insert(0, bias_grad)

            # ä¼ æ’­åˆ°å‰ä¸€å±‚
            if i > 0:
                delta = np.dot(delta, self.weights[i].T)
                # ä¹˜ä»¥æ¿€æ´»å‡½æ•°çš„å¯¼æ•°
                if self.activation_name in ['sigmoid', 'tanh']:
                    # è¿™äº›å‡½æ•°çš„å¯¼æ•°éœ€è¦æ¿€æ´»åçš„å€¼
                    delta *= self.activation_derivative(self.activations[i])
                else:
                    # ReLUç­‰å‡½æ•°çš„å¯¼æ•°éœ€è¦æ¿€æ´»å‰çš„å€¼
                    delta *= self.activation_derivative(self.z_values[i-1])

        return loss

    def update_weights(self):
        """ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ›´æ–°æƒé‡"""
        for i in range(self.num_layers - 1):
            self.weights[i] -= self.learning_rate * self.weight_gradients[i]
            self.biases[i] -= self.learning_rate * self.bias_gradients[i]

    def train_step(self, X, y):
        """å•æ­¥è®­ç»ƒ"""
        loss = self.backward(X, y)
        self.update_weights()
        return loss

    def predict(self, X):
        """é¢„æµ‹"""
        return self.forward(X)

    def fit(self, X_train, y_train, epochs=100, batch_size=32, verbose=True):
        """
        è®­ç»ƒæ¨¡å‹

        å‚æ•°ï¼š
        X_train: è®­ç»ƒæ•°æ®
        y_train: è®­ç»ƒæ ‡ç­¾
        epochs: è®­ç»ƒè½®æ•°
        batch_size: æ‰¹å¤§å°
        verbose: æ˜¯å¦æ‰“å°è¿›åº¦
        """
        n_samples = X_train.shape[0]
        history = {'loss': []}

        for epoch in range(epochs):
            # æ‰“ä¹±æ•°æ®
            indices = np.random.permutation(n_samples)
            X_shuffled = X_train[indices]
            y_shuffled = y_train[indices]

            epoch_loss = 0
            n_batches = 0

            # å°æ‰¹é‡è®­ç»ƒ
            for i in range(0, n_samples, batch_size):
                batch_end = min(i + batch_size, n_samples)
                X_batch = X_shuffled[i:batch_end]
                y_batch = y_shuffled[i:batch_end]

                loss = self.train_step(X_batch, y_batch)
                epoch_loss += loss
                n_batches += 1

            avg_loss = epoch_loss / n_batches
            history['loss'].append(avg_loss)

            if verbose and (epoch + 1) % 10 == 0:
                print(f"Epoch {epoch+1}/{epochs}, Loss: {avg_loss:.4f}")

        return history


# ========== ç¬¬2éƒ¨åˆ†ï¼šå¸¦åŠ¨é‡çš„ä¼˜åŒ–å™¨ ==========
class MLPWithMomentum(MLPNumPy):
    """å¸¦åŠ¨é‡çš„MLPï¼ˆç»§æ‰¿è‡ªåŸºç¡€MLPï¼‰"""

    def __init__(self, layer_sizes, activation='relu',
                 learning_rate=0.01, momentum=0.9):
        super().__init__(layer_sizes, activation, learning_rate)
        self.momentum = momentum

        # åˆå§‹åŒ–é€Ÿåº¦é¡¹
        self.weight_velocities = []
        self.bias_velocities = []

        for i in range(self.num_layers - 1):
            w_velocity = np.zeros_like(self.weights[i])
            b_velocity = np.zeros_like(self.biases[i])

            self.weight_velocities.append(w_velocity)
            self.bias_velocities.append(b_velocity)

    def update_weights(self):
        """ä½¿ç”¨åŠ¨é‡æ›´æ–°æƒé‡"""
        for i in range(self.num_layers - 1):
            # æ›´æ–°é€Ÿåº¦
            self.weight_velocities[i] = (self.momentum * self.weight_velocities[i] -
                                       self.learning_rate * self.weight_gradients[i])
            self.bias_velocities[i] = (self.momentum * self.bias_velocities[i] -
                                     self.learning_rate * self.bias_gradients[i])

            # æ›´æ–°å‚æ•°
            self.weights[i] += self.weight_velocities[i]
            self.biases[i] += self.bias_velocities[i]


# ========== ç¬¬3éƒ¨åˆ†ï¼šå®ç”¨å‡½æ•° ==========
def create_spiral_dataset(n_points=100, n_classes=3, noise=0.2):
    """
    åˆ›å»ºèºæ—‹æ•°æ®é›†

    è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„éçº¿æ€§å¯åˆ†æ•°æ®é›†
    """
    X = []
    y = []

    for class_idx in range(n_classes):
        # æ¯ä¸ªç±»çš„ç‚¹æ•°
        n_per_class = n_points // n_classes

        # ç”Ÿæˆèºæ—‹
        theta = np.linspace(class_idx * 4, (class_idx + 1) * 4, n_per_class)
        theta += np.random.randn(n_per_class) * noise

        r = np.linspace(0.5, 1, n_per_class)

        x1 = r * np.sin(theta)
        x2 = r * np.cos(theta)

        X.append(np.column_stack([x1, x2]))
        y.extend([class_idx] * n_per_class)

    X = np.vstack(X)
    y = np.array(y)

    # è½¬æ¢ä¸ºone-hotç¼–ç 
    y_onehot = np.zeros((len(y), n_classes))
    y_onehot[np.arange(len(y)), y] = 1

    return X, y_onehot, y


def plot_decision_boundary(model, X, y, title="å†³ç­–è¾¹ç•Œ"):
    """ç»˜åˆ¶å†³ç­–è¾¹ç•Œ"""
    import matplotlib.pyplot as plt

    # è®¾ç½®ç½‘æ ¼
    h = 0.02
    x_min, x_max = X[:, 0].min() - 0.5, X[:, 0].max() + 0.5
    y_min, y_max = X[:, 1].min() - 0.5, X[:, 1].max() + 0.5

    xx, yy = np.meshgrid(np.arange(x_min, x_max, h),
                         np.arange(y_min, y_max, h))

    # é¢„æµ‹ç½‘æ ¼ä¸Šçš„ç‚¹
    grid_points = np.c_[xx.ravel(), yy.ravel()]
    Z = model.predict(grid_points)

    # å¦‚æœæ˜¯å¤šåˆ†ç±»ï¼Œå–æœ€å¤§å€¼çš„ç´¢å¼•
    if Z.shape[1] > 1:
        Z = np.argmax(Z, axis=1)
    else:
        Z = (Z > 0.5).astype(int)

    Z = Z.reshape(xx.shape)

    # ç»˜å›¾
    plt.figure(figsize=(10, 8))
    plt.contourf(xx, yy, Z, alpha=0.3, cmap=plt.cm.RdYlBu)

    # ç»˜åˆ¶æ•°æ®ç‚¹
    if y.ndim > 1:
        y_labels = np.argmax(y, axis=1)
    else:
        y_labels = y

    scatter = plt.scatter(X[:, 0], X[:, 1], c=y_labels,
                         cmap=plt.cm.RdYlBu, edgecolor='black')

    plt.xlabel('ç‰¹å¾ 1')
    plt.ylabel('ç‰¹å¾ 2')
    plt.title(title)
    plt.colorbar(scatter)
    plt.show()


# ========== ç¬¬4éƒ¨åˆ†ï¼šæµ‹è¯•ä»£ç  ==========
if __name__ == "__main__":
    print("=== NumPy MLP å®ç°æµ‹è¯• ===\n")

    # 1. åˆ›å»ºæ•°æ®é›†
    print("1. ç”Ÿæˆèºæ—‹æ•°æ®é›†...")
    X, y_onehot, y_labels = create_spiral_dataset(n_points=300, n_classes=3)
    print(f"   æ•°æ®å½¢çŠ¶: X={X.shape}, y={y_onehot.shape}")

    # 2. åˆ›å»ºå’Œè®­ç»ƒåŸºç¡€MLP
    print("\n2. è®­ç»ƒåŸºç¡€MLP...")
    mlp = MLPNumPy(
        layer_sizes=[2, 100, 50, 3],  # è¾“å…¥2ï¼Œä¸¤ä¸ªéšè—å±‚ï¼Œè¾“å‡º3
        activation='relu',
        learning_rate=0.1
    )

    history = mlp.fit(X, y_onehot, epochs=200, batch_size=32, verbose=True)

    # 3. è¯„ä¼°æ¨¡å‹
    print("\n3. è¯„ä¼°æ¨¡å‹...")
    predictions = mlp.predict(X)
    predicted_classes = np.argmax(predictions, axis=1)
    accuracy = np.mean(predicted_classes == y_labels)
    print(f"   è®­ç»ƒå‡†ç¡®ç‡: {accuracy:.2%}")

    # 4. ç»˜åˆ¶å†³ç­–è¾¹ç•Œ
    print("\n4. ç»˜åˆ¶å†³ç­–è¾¹ç•Œ...")
    plot_decision_boundary(mlp, X, y_onehot, "MLPå†³ç­–è¾¹ç•Œ")

    # 5. æµ‹è¯•å¸¦åŠ¨é‡çš„MLP
    print("\n5. è®­ç»ƒå¸¦åŠ¨é‡çš„MLP...")
    mlp_momentum = MLPWithMomentum(
        layer_sizes=[2, 100, 50, 3],
        activation='relu',
        learning_rate=0.1,
        momentum=0.9
    )

    history_momentum = mlp_momentum.fit(X, y_onehot, epochs=200,
                                       batch_size=32, verbose=False)

    # æ¯”è¾ƒè®­ç»ƒæ›²çº¿
    import matplotlib.pyplot as plt

    plt.figure(figsize=(10, 5))
    plt.plot(history['loss'], label='åŸºç¡€SGD', linewidth=2)
    plt.plot(history_momentum['loss'], label='å¸¦åŠ¨é‡SGD', linewidth=2)
    plt.xlabel('Epoch')
    plt.ylabel('Loss')
    plt.title('è®­ç»ƒæŸå¤±å¯¹æ¯”')
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.show()

    print("\næµ‹è¯•å®Œæˆï¼")</code></pre>
                </div>
                <div class="code-output" id="code-output">
                    <strong>è¿è¡Œç»“æœï¼š</strong>
                    <pre>=== NumPy MLP å®ç°æµ‹è¯• ===

1. ç”Ÿæˆèºæ—‹æ•°æ®é›†...
   æ•°æ®å½¢çŠ¶: X=(300, 2), y=(300, 3)

2. è®­ç»ƒåŸºç¡€MLP...
Epoch 10/200, Loss: 0.3842
Epoch 20/200, Loss: 0.1523
...
Epoch 200/200, Loss: 0.0234

3. è¯„ä¼°æ¨¡å‹...
   è®­ç»ƒå‡†ç¡®ç‡: 98.7%

4. ç»˜åˆ¶å†³ç­–è¾¹ç•Œ...
[å›¾è¡¨æ˜¾ç¤º]

5. è®­ç»ƒå¸¦åŠ¨é‡çš„MLP...
æµ‹è¯•å®Œæˆï¼</pre>
                </div>
            </div>

            <!-- ä»£ç è¯¦è§£ -->
            <div class="tip info mt-3">
                <span class="tip-icon">ğŸ“</span>
                <div class="tip-content">
                    <strong>ä»£ç è¦ç‚¹è§£é‡Šï¼š</strong><br>
                    â€¢ <strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šæ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯ç‹¬ç«‹çš„ç±»æˆ–å‡½æ•°<br>
                    â€¢ <strong>æƒé‡åˆå§‹åŒ–</strong>ï¼šHeåˆå§‹åŒ–ç”¨äºReLUï¼ŒXavierç”¨äºSigmoid/Tanh<br>
                    â€¢ <strong>æ­£åˆ™åŒ–æŠ€æœ¯</strong>ï¼šDropouté˜²æ­¢è¿‡æ‹Ÿåˆï¼ŒBatchNormåŠ é€Ÿè®­ç»ƒ<br>
                    â€¢ <strong>æ®‹å·®è¿æ¥</strong>ï¼šå…è®¸æ„å»ºæ›´æ·±çš„ç½‘ç»œ<br>
                    â€¢ <strong>è®­ç»ƒæŠ€å·§</strong>ï¼šæ—©åœã€å­¦ä¹ ç‡è°ƒåº¦ç­‰
                </div>
            </div>
        </section>

        <!-- å†³ç­–è¾¹ç•Œå¯è§†åŒ– -->
        <section id="visualization" class="section-card">
            <h2 style="color: var(--accent-purple); margin-bottom: 1.5rem;">
                ğŸ¨ å†³ç­–è¾¹ç•Œå¯è§†åŒ–
                <span class="depth-indicator intermediate">è¿›é˜¶</span>
            </h2>

            <div class="interactive-demo">
                <h3 style="color: var(--accent-green); margin-bottom: 1.5rem;">ğŸ” æ¢ç´¢ä¸åŒæ¶æ„çš„å†³ç­–è¾¹ç•Œ</h3>

                <div class="demo-controls">
                    <div class="control-group">
                        <label>æ•°æ®é›†</label>
                        <select id="dataset-select" class="form-select">
                            <option value="moons">æœˆç‰™å½¢</option>
                            <option value="circles">åŒå¿ƒåœ†</option>
                            <option value="spiral">èºæ—‹çº¿</option>
                            <option value="xor">XOR</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>ç½‘ç»œæ¶æ„</label>
                        <select id="architecture-select" class="form-select">
                            <option value="shallow">[2, 10, 2]</option>
                            <option value="medium">[2, 50, 25, 2]</option>
                            <option value="deep">[2, 20, 20, 20, 20, 2]</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>æ¿€æ´»å‡½æ•°</label>
                        <select id="activation-select" class="form-select">
                            <option value="relu">ReLU</option>
                            <option value="tanh">Tanh</option>
                            <option value="sigmoid">Sigmoid</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="trainAndVisualize()" tabindex="0">
                        ğŸš€ è®­ç»ƒå¹¶å¯è§†åŒ–
                    </button>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 2rem;">
                    <div>
                        <canvas id="data-canvas" width="300" height="300"></canvas>
                        <p style="text-align: center; margin-top: 0.5rem;">åŸå§‹æ•°æ®</p>
                    </div>
                    <div>
                        <canvas id="boundary-canvas" width="300" height="300"></canvas>
                        <p style="text-align: center; margin-top: 0.5rem;">å†³ç­–è¾¹ç•Œ</p>
                    </div>
                    <div>
                        <canvas id="confidence-canvas" width="300" height="300"></canvas>
                        <p style="text-align: center; margin-top: 0.5rem;">ç½®ä¿¡åº¦å›¾</p>
                    </div>
                </div>

                <div style="margin-top: 1rem;">
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 1rem; border-radius: 0.5rem;">
                        <p>è®­ç»ƒè¿›åº¦: <span id="training-progress">0%</span></p>
                        <p>æœ€ç»ˆå‡†ç¡®ç‡: <span id="final-accuracy">-</span></p>
                        <p>è®­ç»ƒæ—¶é—´: <span id="training-time">-</span></p>
                    </div>
                </div>
            </div>

            <!-- å¯è§†åŒ–è§è§£ -->
            <div class="concept-grid mt-4">
                <div class="concept-card what">
                    <h3>çº¿æ€§å†³ç­–è¾¹ç•Œ</h3>
                    <p>å•å±‚ç½‘ç»œåªèƒ½äº§ç”Ÿç›´çº¿è¾¹ç•Œ</p>
                </div>
                <div class="concept-card how">
                    <h3>åˆ†æ®µçº¿æ€§</h3>
                    <p>ReLUç½‘ç»œäº§ç”Ÿåˆ†æ®µçº¿æ€§è¾¹ç•Œ</p>
                </div>
                <div class="concept-card why">
                    <h3>å¹³æ»‘æ›²çº¿</h3>
                    <p>Sigmoid/Tanhäº§ç”Ÿå¹³æ»‘è¾¹ç•Œ</p>
                </div>
                <div class="concept-card pitfall">
                    <h3>è¿‡æ‹Ÿåˆé£é™©</h3>
                    <p>å¤æ‚è¾¹ç•Œå¯èƒ½è¿‡æ‹Ÿåˆè®­ç»ƒæ•°æ®</p>
                </div>
            </div>
        </section>

        <!-- å®æˆ˜ï¼šè¡¨æ ¼vsè§†è§‰ä»»åŠ¡ -->
        <section id="practice" class="section-card">
            <h2 style="color: var(--accent-red); margin-bottom: 1.5rem;">
                ğŸƒ å®æˆ˜ï¼šä¸åŒä»»åŠ¡çš„MLPè®¾è®¡
                <span class="depth-indicator intermediate">è¿›é˜¶</span>
            </h2>

            <div class="story-card">
                <h3>ğŸ“Š ä»»åŠ¡1ï¼šè¡¨æ ¼æ•°æ®åˆ†ç±»</h3>
                <p>é¢„æµ‹é“¶è¡Œå®¢æˆ·æ˜¯å¦ä¼šæµå¤±ï¼ˆäºŒåˆ†ç±»ä»»åŠ¡ï¼‰</p>

                <div class="code-container mt-3">
                    <div class="code-header">
                        <div class="code-header-left">
                            <span>è¡¨æ ¼æ•°æ®çš„MLPè®¾è®¡</span>
                        </div>
                    </div>
                    <div class="code-content">
<pre><code class="python"># è¡¨æ ¼æ•°æ®çš„ç‰¹ç‚¹ï¼š
# 1. ç‰¹å¾å·²ç»æ˜¯é«˜çº§è¯­ä¹‰ï¼ˆå¹´é¾„ã€æ”¶å…¥ç­‰ï¼‰
# 2. ç‰¹å¾æ•°é‡é€šå¸¸ä¸å¤šï¼ˆå‡ ååˆ°å‡ ç™¾ï¼‰
# 3. æ ·æœ¬é‡å¯èƒ½æœ‰é™

class TabularMLP(nn.Module):
    """ä¸“é—¨ç”¨äºè¡¨æ ¼æ•°æ®çš„MLP"""

    def __init__(self,
                 num_features,
                 num_classes,
                 hidden_dims=[256, 128, 64],
                 dropout_rates=[0.3, 0.2, 0.1]):
        super().__init__()

        layers = []
        prev_dim = num_features

        # æ„å»ºéšè—å±‚
        for i, (hidden_dim, dropout_rate) in enumerate(
            zip(hidden_dims, dropout_rates)
        ):
            # çº¿æ€§å±‚
            layers.append(nn.Linear(prev_dim, hidden_dim))

            # æ‰¹å½’ä¸€åŒ–ï¼ˆè¡¨æ ¼æ•°æ®å¾ˆæœ‰æ•ˆï¼‰
            layers.append(nn.BatchNorm1d(hidden_dim))

            # æ¿€æ´»å‡½æ•°ï¼ˆLeakyReLUé¿å…æ­»ç¥ç»å…ƒï¼‰
            layers.append(nn.LeakyReLU(0.1))

            # Dropoutï¼ˆé˜²æ­¢è¿‡æ‹Ÿåˆï¼‰
            layers.append(nn.Dropout(dropout_rate))

            prev_dim = hidden_dim

        # è¾“å‡ºå±‚
        layers.append(nn.Linear(prev_dim, num_classes))

        self.model = nn.Sequential(*layers)

    def forward(self, x):
        return self.model(x)


# ä½¿ç”¨ç¤ºä¾‹ï¼šå®¢æˆ·æµå¤±é¢„æµ‹
# ç‰¹å¾ï¼šå¹´é¾„ã€è´¦æˆ·ä½™é¢ã€äº§å“æ•°é‡ã€ä¿¡ç”¨åˆ†æ•°ç­‰
model = TabularMLP(
    num_features=15,      # 15ä¸ªç‰¹å¾
    num_classes=2,        # äºŒåˆ†ç±»
    hidden_dims=[128, 64, 32],  # é€‚åº¦æ·±åº¦
    dropout_rates=[0.4, 0.3, 0.2]  # è¾ƒé«˜dropout
)

# è®­ç»ƒæŠ€å·§ï¼š
# 1. ç‰¹å¾å·¥ç¨‹å¾ˆé‡è¦ï¼ˆæ ‡å‡†åŒ–ã€ç¼–ç ç­‰ï¼‰
# 2. ä½¿ç”¨äº¤å‰éªŒè¯é€‰æ‹©è¶…å‚æ•°
# 3. é›†æˆå¤šä¸ªæ¨¡å‹æ•ˆæœæ›´å¥½</code></pre>
                    </div>
                </div>
            </div>

            <div class="story-card mt-4">
                <h3>ğŸ–¼ï¸ ä»»åŠ¡2ï¼šå›¾åƒåˆ†ç±»</h3>
                <p>MNISTæ‰‹å†™æ•°å­—è¯†åˆ«ï¼ˆå¤šåˆ†ç±»ä»»åŠ¡ï¼‰</p>

                <div class="code-container mt-3">
                    <div class="code-header">
                        <div class="code-header-left">
                            <span>å›¾åƒæ•°æ®çš„MLPè®¾è®¡</span>
                        </div>
                    </div>
                    <div class="code-content">
<pre><code class="python"># å›¾åƒæ•°æ®çš„ç‰¹ç‚¹ï¼š
# 1. é«˜ç»´è¾“å…¥ï¼ˆåƒç´ çº§ç‰¹å¾ï¼‰
# 2. ç©ºé—´ç»“æ„é‡è¦ï¼ˆç›¸é‚»åƒç´ ç›¸å…³ï¼‰
# 3. å¹³ç§»ä¸å˜æ€§éœ€æ±‚

class ImageMLP(nn.Module):
    """ç”¨äºå›¾åƒçš„MLPï¼ˆä»…ä½œæ¼”ç¤ºï¼Œå®é™…åº”ç”¨CNNæ›´å¥½ï¼‰"""

    def __init__(self,
                 image_size=(28, 28),
                 num_classes=10):
        super().__init__()

        input_dim = image_size[0] * image_size[1]

        # æ›´æ·±çš„ç½‘ç»œï¼Œé€æ­¥é™ç»´
        self.flatten = nn.Flatten()

        # ç‰¹å¾æå–éƒ¨åˆ†ï¼ˆæ¨¡æ‹ŸCNNçš„æ•ˆæœï¼‰
        self.feature_extractor = nn.Sequential(
            # ç¬¬ä¸€é˜¶æ®µï¼šä¿æŒé«˜ç»´
            nn.Linear(input_dim, 1024),
            nn.BatchNorm1d(1024),
            nn.ReLU(),
            nn.Dropout(0.2),

            # ç¬¬äºŒé˜¶æ®µï¼šé€æ­¥å‹ç¼©
            nn.Linear(1024, 512),
            nn.BatchNorm1d(512),
            nn.ReLU(),
            nn.Dropout(0.2),

            # ç¬¬ä¸‰é˜¶æ®µï¼šè¿›ä¸€æ­¥å‹ç¼©
            nn.Linear(512, 256),
            nn.BatchNorm1d(256),
            nn.ReLU(),
            nn.Dropout(0.2),

            # ç¬¬å››é˜¶æ®µï¼šæŠ½è±¡ç‰¹å¾
            nn.Linear(256, 128),
            nn.BatchNorm1d(128),
            nn.ReLU(),
            nn.Dropout(0.1)
        )

        # åˆ†ç±»å¤´
        self.classifier = nn.Linear(128, num_classes)

    def forward(self, x):
        x = self.flatten(x)
        features = self.feature_extractor(x)
        output = self.classifier(features)
        return output

    def get_features(self, x):
        """æå–ç‰¹å¾ï¼ˆç”¨äºå¯è§†åŒ–ï¼‰"""
        x = self.flatten(x)
        return self.feature_extractor(x)


# æ•°æ®å¢å¼ºï¼ˆå¯¹MLPä¹Ÿæœ‰å¸®åŠ©ï¼‰
class MLPAugmentation:
    """MLPå‹å¥½çš„æ•°æ®å¢å¼º"""

    @staticmethod
    def add_noise(x, noise_level=0.1):
        """æ·»åŠ é«˜æ–¯å™ªå£°"""
        noise = torch.randn_like(x) * noise_level
        return x + noise

    @staticmethod
    def random_dropout(x, drop_prob=0.1):
        """éšæœºä¸¢å¼ƒåƒç´ """
        mask = torch.rand_like(x) > drop_prob
        return x * mask


# å¯¹æ¯”å®éªŒï¼šMLP vs CNN
def compare_mlp_cnn():
    """å¯¹æ¯”MLPå’ŒCNNåœ¨å›¾åƒä»»åŠ¡ä¸Šçš„è¡¨ç°"""

    # MLPæ¨¡å‹
    mlp = ImageMLP(image_size=(28, 28), num_classes=10)

    # ç®€å•CNNï¼ˆä½œä¸ºå¯¹æ¯”ï¼‰
    class SimpleCNN(nn.Module):
        def __init__(self):
            super().__init__()
            self.conv1 = nn.Conv2d(1, 32, 3, padding=1)
            self.conv2 = nn.Conv2d(32, 64, 3, padding=1)
            self.pool = nn.MaxPool2d(2)
            self.fc1 = nn.Linear(64 * 7 * 7, 128)
            self.fc2 = nn.Linear(128, 10)

        def forward(self, x):
            x = self.pool(F.relu(self.conv1(x)))
            x = self.pool(F.relu(self.conv2(x)))
            x = x.view(-1, 64 * 7 * 7)
            x = F.relu(self.fc1(x))
            x = self.fc2(x)
            return x

    cnn = SimpleCNN()

    # å‚æ•°é‡å¯¹æ¯”
    mlp_params = sum(p.numel() for p in mlp.parameters())
    cnn_params = sum(p.numel() for p in cnn.parameters())

    print(f"MLPå‚æ•°é‡: {mlp_params:,}")
    print(f"CNNå‚æ•°é‡: {cnn_params:,}")
    print(f"å‚æ•°æ¯”ä¾‹: {mlp_params/cnn_params:.2f}x")

    return mlp, cnn</code></pre>
                    </div>
                </div>
            </div>

            <!-- ä»»åŠ¡å¯¹æ¯”æ€»ç»“ -->
            <div style="margin-top: 2rem; background: rgba(139, 92, 246, 0.1); padding: 2rem; border-radius: 1rem;">
                <h3 style="color: var(--accent-purple); margin-bottom: 1rem;">ğŸ“Š ä¸åŒä»»åŠ¡çš„MLPè®¾è®¡åŸåˆ™</h3>

                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                    <tr style="background: rgba(139, 92, 246, 0.2);">
                        <th style="padding: 1rem; text-align: left;">ä»»åŠ¡ç±»å‹</th>
                        <th style="padding: 1rem; text-align: left;">æ¨èæ¶æ„</th>
                        <th style="padding: 1rem; text-align: left;">å…³é”®æŠ€å·§</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            <strong>è¡¨æ ¼æ•°æ®</strong>
                        </td>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            æµ…è€Œå®½ï¼ˆ2-5å±‚ï¼‰
                        </td>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            ç‰¹å¾å·¥ç¨‹ã€é›†æˆå­¦ä¹ 
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            <strong>å›¾åƒï¼ˆå°ï¼‰</strong>
                        </td>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            æ·±è€Œçª„ï¼ˆ5-10å±‚ï¼‰
                        </td>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            æ•°æ®å¢å¼ºã€æ­£åˆ™åŒ–
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            <strong>æ—¶åºæ•°æ®</strong>
                        </td>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            ä¸­ç­‰æ·±åº¦+è·³è·ƒè¿æ¥
                        </td>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            æ»‘åŠ¨çª—å£ã€ç‰¹å¾æå–
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            <strong>é«˜ç»´ç¨€ç–</strong>
                        </td>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            åµŒå…¥å±‚+æµ…å±‚MLP
                        </td>
                        <td style="padding: 1rem; border-top: 1px solid var(--border-color);">
                            é™ç»´ã€ç‰¹å¾é€‰æ‹©
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- æ¿€æ´»é¥±å’Œé—®é¢˜ -->
        <section id="saturation" class="section-card">
            <h2 style="color: var(--accent-yellow); margin-bottom: 1.5rem;">
                âš¡ æ¿€æ´»é¥±å’Œä¸æ¢¯åº¦æ¶ˆå¤±
                <span class="depth-indicator advanced">æ·±å…¥</span>
            </h2>

            <!-- é—®é¢˜æ¼”ç¤º -->
            <div class="interactive-demo">
                <h3 style="color: var(--accent-red); margin-bottom: 1.5rem;">ğŸ”¥ æ¢¯åº¦æ¶ˆå¤±å®éªŒ</h3>

                <div class="demo-controls">
                    <div class="control-group">
                        <label>ç½‘ç»œæ·±åº¦</label>
                        <div class="slider-container">
                            <input type="range" id="depth-slider" min="5" max="50" step="5" value="20">
                            <span class="slider-value" id="depth-value">20å±‚</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>æ¿€æ´»å‡½æ•°</label>
                        <select id="gradient-activation" class="form-select">
                            <option value="sigmoid">Sigmoid</option>
                            <option value="tanh">Tanh</option>
                            <option value="relu">ReLU</option>
                            <option value="leaky_relu">Leaky ReLU</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="analyzeGradients()" tabindex="0">
                        ğŸ“Š åˆ†ææ¢¯åº¦æµ
                    </button>
                </div>

                <canvas id="gradient-flow-canvas" width="800" height="400"></canvas>

                <div style="margin-top: 1rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                        <h4 style="color: var(--accent-red);">ç¬¬1å±‚æ¢¯åº¦</h4>
                        <p style="font-size: 1.5rem;" id="first-layer-gradient">0.0000</p>
                    </div>
                    <div style="background: rgba(251, 191, 36, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                        <h4 style="color: var(--accent-yellow);">ä¸­é—´å±‚æ¢¯åº¦</h4>
                        <p style="font-size: 1.5rem;" id="middle-layer-gradient">0.0000</p>
                    </div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                        <h4 style="color: var(--accent-green);">æœ€åå±‚æ¢¯åº¦</h4>
                        <p style="font-size: 1.5rem;" id="last-layer-gradient">0.0000</p>
                    </div>
                </div>
            </div>

            <!-- è§£å†³æ–¹æ¡ˆ -->
            <div class="math-derivation mt-4">
                <h3>è§£å†³æ¢¯åº¦é—®é¢˜çš„æŠ€æœ¯</h3>

                <div class="math-step" data-step="1">
                    <strong>æ‰¹å½’ä¸€åŒ–ï¼ˆBatch Normalizationï¼‰</strong>
                    <div class="equation-container">
                        <span>xÌ‚ = (x - Î¼) / âˆš(ÏƒÂ² + Îµ)</span><br>
                        <span>y = Î³xÌ‚ + Î²</span>
                    </div>
                    <div class="math-explanation">
                        â€¢ æ ‡å‡†åŒ–æ¿€æ´»å€¼ï¼Œé˜²æ­¢é¥±å’Œ<br>
                        â€¢ åŠ é€Ÿè®­ç»ƒï¼Œå…è®¸æ›´é«˜å­¦ä¹ ç‡<br>
                        â€¢ æœ‰è½»å¾®æ­£åˆ™åŒ–æ•ˆæœ
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>æ®‹å·®è¿æ¥ï¼ˆResidual Connectionï¼‰</strong>
                    <div class="equation-container">
                        <span>y = F(x) + x</span>
                    </div>
                    <div class="math-explanation">
                        â€¢ æ¢¯åº¦å¯ä»¥ç›´æ¥æµè¿‡è·³è·ƒè¿æ¥<br>
                        â€¢ è®©ç½‘ç»œå­¦ä¹ æ®‹å·®è€Œéå®Œæ•´æ˜ å°„<br>
                        â€¢ ResNetçš„æ ¸å¿ƒæ€æƒ³
                    </div>
                </div>

                <div class="math-step" data-step="3">
                    <strong>æ¢¯åº¦è£å‰ªï¼ˆGradient Clippingï¼‰</strong>
                    <div class="equation-container">
                        <span>g = min(1, Î¸/||g||) Â· g</span>
                    </div>
                    <div class="math-explanation">
                        â€¢ é˜²æ­¢æ¢¯åº¦çˆ†ç‚¸<br>
                        â€¢ å¸¸ç”¨äºRNNè®­ç»ƒ<br>
                        â€¢ Î¸æ˜¯è£å‰ªé˜ˆå€¼
                    </div>
                </div>
            </div>

            <!-- å®è·µä»£ç  -->
            <div class="code-container mt-4">
                <div class="code-header">
                    <div class="code-header-left">
                        <span>è§£å†³æ¢¯åº¦é—®é¢˜çš„å®è·µ</span>
                    </div>
                </div>
                <div class="code-content">
<pre><code class="python">import torch
import torch.nn as nn

class ImprovedMLP(nn.Module):
    """ä½¿ç”¨ç°ä»£æŠ€æœ¯æ”¹è¿›çš„MLP"""

    def __init__(self, input_size, hidden_size, num_layers, output_size):
        super().__init__()

        self.input_layer = nn.Linear(input_size, hidden_size)

        # ä½¿ç”¨ModuleListå­˜å‚¨å±‚
        self.layers = nn.ModuleList()
        self.batch_norms = nn.ModuleList()

        for _ in range(num_layers):
            self.layers.append(nn.Linear(hidden_size, hidden_size))
            self.batch_norms.append(nn.BatchNorm1d(hidden_size))

        self.output_layer = nn.Linear(hidden_size, output_size)

        # ä½¿ç”¨æ›´å¥½çš„æ¿€æ´»å‡½æ•°
        self.activation = nn.GELU()

        # åˆå§‹åŒ–
        self._init_weights()

    def _init_weights(self):
        """æ›´å¥½çš„åˆå§‹åŒ–ç­–ç•¥"""
        for m in self.modules():
            if isinstance(m, nn.Linear):
                # ä½¿ç”¨æ­£æ€åˆ†å¸ƒï¼Œæ ‡å‡†å·®æ ¹æ®fan_inè°ƒæ•´
                nn.init.normal_(m.weight, std=0.02)
                if m.bias is not None:
                    nn.init.zeros_(m.bias)
            elif isinstance(m, nn.BatchNorm1d):
                nn.init.ones_(m.weight)
                nn.init.zeros_(m.bias)

    def forward(self, x):
        # è¾“å…¥å±‚
        x = self.activation(self.input_layer(x))

        # éšè—å±‚withæ®‹å·®è¿æ¥
        for i, (layer, bn) in enumerate(zip(self.layers, self.batch_norms)):
            # ä¿å­˜è¾“å…¥ç”¨äºæ®‹å·®
            residual = x

            # å‰å‘ä¼ æ’­
            x = layer(x)
            x = bn(x)
            x = self.activation(x)

            # æ®‹å·®è¿æ¥ï¼ˆæ¯2å±‚æ·»åŠ ä¸€æ¬¡ï¼‰
            if i % 2 == 1:
                x = x + residual

        # è¾“å‡ºå±‚
        x = self.output_layer(x)

        return x


def train_with_gradient_monitoring(model, train_loader, epochs=10):
    """è®­ç»ƒæ—¶ç›‘æ§æ¢¯åº¦"""

    optimizer = torch.optim.Adam(model.parameters(), lr=0.001)
    criterion = nn.CrossEntropyLoss()

    gradient_norms = {name: [] for name, _ in model.named_parameters()}

    for epoch in range(epochs):
        for batch_idx, (data, target) in enumerate(train_loader):
            optimizer.zero_grad()

            output = model(data)
            loss = criterion(output, target)
            loss.backward()

            # è®°å½•æ¢¯åº¦èŒƒæ•°
            for name, param in model.named_parameters():
                if param.grad is not None:
                    grad_norm = param.grad.norm().item()
                    gradient_norms[name].append(grad_norm)

            # æ¢¯åº¦è£å‰ª
            torch.nn.utils.clip_grad_norm_(model.parameters(), max_norm=1.0)

            optimizer.step()

            if batch_idx % 100 == 0:
                print(f'Epoch {epoch}, Batch {batch_idx}, Loss: {loss.item():.4f}')

    return gradient_norms


# å¯è§†åŒ–æ¢¯åº¦æµ
def visualize_gradient_flow(gradient_norms):
    """å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ¢¯åº¦æµ"""
    import matplotlib.pyplot as plt

    fig, ax = plt.subplots(figsize=(12, 6))

    # é€‰æ‹©å‡ ä¸ªå…³é”®å±‚
    layers_to_plot = []
    for name in gradient_norms.keys():
        if 'weight' in name and len(gradient_norms[name]) > 0:
            layers_to_plot.append(name)

    # ç»˜åˆ¶æ¯å±‚çš„æ¢¯åº¦èŒƒæ•°å˜åŒ–
    for i, layer_name in enumerate(layers_to_plot[::2]):  # æ¯éš”ä¸€å±‚ç»˜åˆ¶
        values = gradient_norms[layer_name]
        ax.plot(values, label=f'Layer {i}', alpha=0.7)

    ax.set_xlabel('Iteration')
    ax.set_ylabel('Gradient Norm')
    ax.set_title('æ¢¯åº¦èŒƒæ•°åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„å˜åŒ–')
    ax.legend()
    ax.grid(True, alpha=0.3)

    # ä½¿ç”¨å¯¹æ•°å°ºåº¦
    ax.set_yscale('log')

    plt.tight_layout()
    plt.show()


# å¯¹æ¯”å®éªŒï¼šæœ‰æ— æ”¹è¿›æŠ€æœ¯
def compare_techniques():
    """å¯¹æ¯”ä¸åŒæŠ€æœ¯çš„æ•ˆæœ"""

    input_size = 784
    hidden_size = 256
    num_layers = 20
    output_size = 10

    # åŸºç¡€MLPï¼ˆå®¹æ˜“æ¢¯åº¦æ¶ˆå¤±ï¼‰
    basic_mlp = nn.Sequential(*[
        nn.Linear(input_size if i == 0 else hidden_size,
                 hidden_size if i < num_layers else output_size),
        nn.Sigmoid() if i < num_layers else nn.Identity()
        for i in range(num_layers + 1)
    ])

    # æ”¹è¿›çš„MLP
    improved_mlp = ImprovedMLP(input_size, hidden_size, num_layers, output_size)

    # ç”Ÿæˆéšæœºæ•°æ®
    x = torch.randn(32, input_size)

    # æµ‹è¯•æ¢¯åº¦æµ
    for name, model in [("Basic MLP", basic_mlp), ("Improved MLP", improved_mlp)]:
        y = model(x)
        loss = y.sum()
        loss.backward()

        # è®¡ç®—ç¬¬ä¸€å±‚å’Œæœ€åå±‚çš„æ¢¯åº¦æ¯”
        first_layer_grad = None
        last_layer_grad = None

        for param in model.parameters():
            if param.grad is not None:
                if first_layer_grad is None:
                    first_layer_grad = param.grad.norm().item()
                last_layer_grad = param.grad.norm().item()

        ratio = first_layer_grad / last_layer_grad if last_layer_grad > 0 else float('inf')

        print(f"\n{name}:")
        print(f"  ç¬¬ä¸€å±‚æ¢¯åº¦èŒƒæ•°: {first_layer_grad:.6f}")
        print(f"  æœ€åå±‚æ¢¯åº¦èŒƒæ•°: {last_layer_grad:.6f}")
        print(f"  æ¢¯åº¦æ¯”ç‡: {ratio:.2e}")

        if ratio > 1e6:
            print("  âš ï¸ ä¸¥é‡æ¢¯åº¦æ¶ˆå¤±ï¼")
        elif ratio > 1e3:
            print("  âš ï¸ è½»åº¦æ¢¯åº¦æ¶ˆå¤±")
        else:
            print("  âœ… æ¢¯åº¦æµæ­£å¸¸")


if __name__ == "__main__":
    print("=== æ¢¯åº¦é—®é¢˜è§£å†³æ–¹æ¡ˆæ¼”ç¤º ===\n")
    compare_techniques()</code></pre>
                </div>
            </div>
        </section>
        <!-- ä¼˜åŒ–ç®—æ³•æ·±åº¦è§£æ -->
        <section id="optimization" class="section-card">
            <h2 style="color: var(--accent-purple); margin-bottom: 1.5rem;">
                ğŸš€ ä¼˜åŒ–ç®—æ³•ï¼šä»æ¢¯åº¦ä¸‹é™åˆ°ç°ä»£ä¼˜åŒ–å™¨
                <span class="depth-indicator advanced">æ·±å…¥</span>
            </h2>

            <!-- å¼•å…¥æ•…äº‹ -->
            <div class="story-card">
                <h3>ğŸ¯ ä¼˜åŒ–çš„æœ¬è´¨ï¼šå¯»æ‰¾æœ€ä½ç‚¹</h3>
                <div class="dialogue-container">
                    <div class="dialogue-item">
                        <div class="dialogue-avatar student">ğŸ¤”</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">å°é™ˆ</div>
                            <p>æ•™æˆï¼Œä¸ºä»€ä¹ˆåŒæ ·çš„ç½‘ç»œæ¶æ„ï¼Œä¸åŒçš„ä¼˜åŒ–å™¨æ•ˆæœå·®åˆ«è¿™ä¹ˆå¤§ï¼Ÿ</p>
                        </div>
                    </div>
                    <div class="dialogue-item">
                        <div class="dialogue-avatar teacher">ğŸ‘¨â€ğŸ«</div>
                        <div class="dialogue-content">
                            <div class="dialogue-name">ç‹æ•™æˆ</div>
                            <p>æƒ³è±¡ä½ åœ¨ä¸€ä¸ªå¤æ‚çš„å±±åœ°ä¸­å¯»æ‰¾æœ€ä½ç‚¹ï¼Œä½†ä½ æ˜¯<strong class="handwritten">è’™ç€çœ¼ç›çš„</strong>ï¼
                                ä¸åŒçš„ä¼˜åŒ–å™¨å°±åƒä¸åŒçš„æœç´¢ç­–ç•¥ï¼Œæœ‰çš„è°¨æ…ï¼Œæœ‰çš„å¤§èƒ†ï¼Œæœ‰çš„è¿˜è®°å¾—ä¹‹å‰èµ°è¿‡çš„è·¯...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æŸå¤±å‡½æ•°åœ°å½¢å¯è§†åŒ– -->
            <div class="interactive-demo">
                <h3 style="color: var(--accent-blue); margin-bottom: 1.5rem;">ğŸ”ï¸ æŸå¤±å‡½æ•°åœ°å½¢æ¢ç´¢</h3>

                <div class="demo-controls">
                    <div class="control-group">
                        <label>ä¼˜åŒ–å™¨é€‰æ‹©</label>
                        <select id="optimizer-select" class="form-select">
                            <option value="sgd">SGDï¼ˆéšæœºæ¢¯åº¦ä¸‹é™ï¼‰</option>
                            <option value="momentum">Momentumï¼ˆåŠ¨é‡ï¼‰</option>
                            <option value="rmsprop">RMSprop</option>
                            <option value="adam">Adam</option>
                            <option value="adamw">AdamW</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>å­¦ä¹ ç‡</label>
                        <div class="slider-container">
                            <input type="range" id="lr-slider" min="-3" max="0" step="0.1" value="-1">
                            <span class="slider-value" id="lr-value">0.1</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>æŸå¤±åœ°å½¢</label>
                        <select id="landscape-select" class="form-select">
                            <option value="convex">å‡¸å‡½æ•°ï¼ˆç†æƒ³æƒ…å†µï¼‰</option>
                            <option value="ravine">å³¡è°·ï¼ˆç—…æ€æ¡ä»¶æ•°ï¼‰</option>
                            <option value="saddle">éç‚¹</option>
                            <option value="local">å¤šä¸ªå±€éƒ¨æœ€ä¼˜</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="startOptimization()" tabindex="0">
                        ğŸ¯ å¼€å§‹ä¼˜åŒ–
                    </button>
                    <button class="btn btn-secondary" onclick="resetOptimization()" tabindex="0">
                        ğŸ”„ é‡ç½®
                    </button>
                </div>

                <canvas id="optimization-canvas" width="800" height="400"></canvas>

                <div style="margin-top: 1rem; display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                    <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <h4 style="color: var(--accent-purple);">è¿­ä»£æ¬¡æ•°</h4>
                        <p style="font-size: 1.5rem; font-weight: bold;" id="iteration-count">0</p>
                    </div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <h4 style="color: var(--accent-green);">å½“å‰æŸå¤±</h4>
                        <p style="font-size: 1.5rem; font-weight: bold;" id="current-loss">-</p>
                    </div>
                    <div style="background: rgba(6, 182, 212, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <h4 style="color: var(--accent-blue);">æ¢¯åº¦èŒƒæ•°</h4>
                        <p style="font-size: 1.5rem; font-weight: bold;" id="gradient-norm">-</p>
                    </div>
                    <div style="background: rgba(251, 191, 36, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <h4 style="color: var(--accent-yellow);">æ”¶æ•›é€Ÿåº¦</h4>
                        <p style="font-size: 1.5rem; font-weight: bold;" id="convergence-rate">-</p>
                    </div>
                </div>
            </div>

            <!-- æ•°å­¦æ¨å¯¼ï¼šæ¢¯åº¦ä¸‹é™ -->
            <div class="math-derivation mt-4">
                <h3>ğŸ“ æ¢¯åº¦ä¸‹é™çš„æ•°å­¦åŸç†</h3>

                <div class="math-step" data-step="1">
                    <strong>æ³°å‹’å±•å¼€ä¸æ¢¯åº¦</strong>
                    <p>æŸå¤±å‡½æ•° L(Î¸) åœ¨å½“å‰ç‚¹ Î¸â‚€ çš„æ³°å‹’å±•å¼€ï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem;">
                    L(Î¸â‚€ + Î”Î¸) â‰ˆ L(Î¸â‚€) + âˆ‡L(Î¸â‚€)áµ€Î”Î¸ + Â½Î”Î¸áµ€ H Î”Î¸
                </span>
                    </div>
                    <div class="math-explanation">
                        å…¶ä¸­ H æ˜¯æµ·æ£®çŸ©é˜µï¼ˆäºŒé˜¶å¯¼æ•°ï¼‰ã€‚å¿½ç•¥äºŒé˜¶é¡¹ï¼Œè¦ä½¿ L å‡å°æœ€å¿«ï¼Œåº”é€‰æ‹©ï¼š<br>
                        <strong>Î”Î¸ = -Î±âˆ‡L(Î¸â‚€)</strong><br>
                        è¿™å°±æ˜¯æ¢¯åº¦ä¸‹é™çš„æ ¸å¿ƒæ€æƒ³ï¼šæ²¿è´Ÿæ¢¯åº¦æ–¹å‘æ›´æ–°å‚æ•°ã€‚
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>æ”¶æ•›æ€§åˆ†æ</strong>
                    <p>å¯¹äº L-å…‰æ»‘å‡½æ•°ï¼ˆæ¢¯åº¦åˆ©æ™®å¸ŒèŒ¨è¿ç»­ï¼‰ï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem;">
                    ||âˆ‡L(Î¸â‚) - âˆ‡L(Î¸â‚‚)|| â‰¤ L ||Î¸â‚ - Î¸â‚‚||
                </span>
                    </div>
                    <div class="math-explanation">
                        å¯ä»¥è¯æ˜ï¼Œå½“å­¦ä¹ ç‡ <strong>Î± < 2/L</strong> æ—¶ï¼Œæ¢¯åº¦ä¸‹é™æ”¶æ•›ã€‚<br>
                        å¯¹äºå¼ºå‡¸å‡½æ•°ï¼Œæ”¶æ•›é€Ÿåº¦æ˜¯æŒ‡æ•°çº§çš„ï¼š<br>
                        <strong>L(Î¸â‚œ) - L(Î¸*) â‰¤ (1 - Î¼/L)áµ— (L(Î¸â‚€) - L(Î¸*))</strong><br>
                        å…¶ä¸­ Î¼ æ˜¯å¼ºå‡¸å‚æ•°ï¼ŒÎ¼/L ç§°ä¸ºæ¡ä»¶æ•°ã€‚
                    </div>
                </div>

                <div class="math-step" data-step="3">
                    <strong>éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰</strong>
                    <p>ä½¿ç”¨å°æ‰¹é‡ä¼°è®¡æ¢¯åº¦ï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem;">
                    gÌƒ = (1/|B|) Î£áµ¢âˆˆB âˆ‡Láµ¢(Î¸)
                </span>
                    </div>
                    <div class="math-explanation">
                        SGDçš„æ›´æ–°è§„åˆ™ï¼š<strong>Î¸â‚œâ‚Šâ‚ = Î¸â‚œ - Î±â‚œgÌƒâ‚œ</strong><br>
                        æœŸæœ›æ„ä¹‰ä¸‹ï¼šE[gÌƒ] = âˆ‡L(Î¸)ï¼ˆæ— åä¼°è®¡ï¼‰<br>
                        æ–¹å·®ï¼šVar[gÌƒ] = ÏƒÂ²/|B|ï¼Œå…¶ä¸­ |B| æ˜¯æ‰¹å¤§å°
                    </div>
                </div>
            </div>

            <!-- åŠ¨é‡æ–¹æ³•æ¨å¯¼ -->
            <div class="math-derivation mt-4">
                <h3>ğŸ¢ åŠ¨é‡æ–¹æ³•ï¼šè®°å¿†ä¸åŠ é€Ÿ</h3>

                <div class="math-step" data-step="1">
                    <strong>ç»å…¸åŠ¨é‡ï¼ˆMomentumï¼‰</strong>
                    <p>çµæ„Ÿæ¥è‡ªç‰©ç†ä¸­çš„åŠ¨é‡æ¦‚å¿µï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem;">
                    vâ‚œ = Î²vâ‚œâ‚‹â‚ + (1-Î²)âˆ‡L(Î¸â‚œ)<br>
                    Î¸â‚œâ‚Šâ‚ = Î¸â‚œ - Î±vâ‚œ
                </span>
                    </div>
                    <div class="math-explanation">
                        â€¢ Î² âˆˆ [0,1) æ˜¯åŠ¨é‡ç³»æ•°ï¼Œé€šå¸¸å–0.9<br>
                        â€¢ vâ‚œ æ˜¯é€Ÿåº¦ï¼ˆä¸€é˜¶çŸ©çš„æŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼‰<br>
                        â€¢ åœ¨å‡¸äºŒæ¬¡å‡½æ•°ä¸Šï¼Œæœ€ä¼˜ Î² = ((âˆšÎº-1)/(âˆšÎº+1))Â²ï¼Œå…¶ä¸­Îºæ˜¯æ¡ä»¶æ•°
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>NesterovåŠ é€Ÿæ¢¯åº¦ï¼ˆNAGï¼‰</strong>
                    <p>"å‘å‰çœ‹"çš„åŠ¨é‡ï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem; color: var(--accent-purple);">
                    vâ‚œ = Î²vâ‚œâ‚‹â‚ + Î±âˆ‡L(Î¸â‚œ - Î²vâ‚œâ‚‹â‚)<br>
                    Î¸â‚œâ‚Šâ‚ = Î¸â‚œ - vâ‚œ
                </span>
                    </div>
                    <div class="math-explanation">
                        å…³é”®åˆ›æ–°ï¼šåœ¨"å‘å‰çœ‹"çš„ä½ç½®è®¡ç®—æ¢¯åº¦<br>
                        ç†è®ºä¿è¯ï¼šå‡¸å‡½æ•°ä¸Šè¾¾åˆ° O(1/tÂ²) çš„æ”¶æ•›é€Ÿåº¦ï¼ˆæ™®é€šGDæ˜¯ O(1/t)ï¼‰
                    </div>
                </div>
            </div>

            <!-- è‡ªé€‚åº”å­¦ä¹ ç‡æ–¹æ³• -->
            <div class="math-derivation mt-4">
                <h3>ğŸ¯ è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨</h3>

                <div class="math-step" data-step="1">
                    <strong>AdaGradï¼šæ¢¯åº¦ç´¯ç§¯</strong>
                    <p>æ ¹æ®å†å²æ¢¯åº¦è‡ªé€‚åº”è°ƒæ•´å­¦ä¹ ç‡ï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem;">
                    Gâ‚œ = Gâ‚œâ‚‹â‚ + gâ‚œ âŠ™ gâ‚œ<br>
                    Î¸â‚œâ‚Šâ‚ = Î¸â‚œ - Î±/âˆš(Gâ‚œ + Îµ) âŠ™ gâ‚œ
                </span>
                    </div>
                    <div class="math-explanation">
                        â€¢ Gâ‚œ ç´¯ç§¯äº†æ‰€æœ‰å†å²æ¢¯åº¦çš„å¹³æ–¹<br>
                        â€¢ âŠ™ è¡¨ç¤ºé€å…ƒç´ ä¹˜æ³•<br>
                        â€¢ é—®é¢˜ï¼šå­¦ä¹ ç‡å•è°ƒé€’å‡ï¼Œå¯èƒ½è¿‡æ—©åœæ­¢å­¦ä¹ 
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>RMSpropï¼šæŒ‡æ•°è¡°å‡</strong>
                    <p>ä½¿ç”¨æŒ‡æ•°ç§»åŠ¨å¹³å‡è§£å†³AdaGradçš„é—®é¢˜ï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem;">
                    vâ‚œ = Î²vâ‚œâ‚‹â‚ + (1-Î²)gâ‚œÂ²<br>
                    Î¸â‚œâ‚Šâ‚ = Î¸â‚œ - Î±/âˆš(vâ‚œ + Îµ) âŠ™ gâ‚œ
                </span>
                    </div>
                    <div class="math-explanation">
                        â€¢ Î² é€šå¸¸å–0.9æˆ–0.99<br>
                        â€¢ ä¿æŒäº†è‡ªé€‚åº”æ€§ï¼Œä½†å­¦ä¹ ç‡ä¸ä¼šæ¶ˆå¤±<br>
                        â€¢ é€‚åˆå¤„ç†éå¹³ç¨³ç›®æ ‡å’ŒRNN
                    </div>
                </div>

                <div class="math-step" data-step="3">
                    <strong>Adamï¼šè‡ªé€‚åº”çŸ©ä¼°è®¡</strong>
                    <p>ç»“åˆåŠ¨é‡å’ŒRMSpropçš„ä¼˜ç‚¹ï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem; color: var(--accent-purple);">
                    mâ‚œ = Î²â‚mâ‚œâ‚‹â‚ + (1-Î²â‚)gâ‚œ &nbsp;&nbsp; (ä¸€é˜¶çŸ©)<br>
                    vâ‚œ = Î²â‚‚vâ‚œâ‚‹â‚ + (1-Î²â‚‚)gâ‚œÂ² &nbsp;&nbsp; (äºŒé˜¶çŸ©)<br>
                    mÌ‚â‚œ = mâ‚œ/(1-Î²â‚áµ—) &nbsp;&nbsp; (åå·®ä¿®æ­£)<br>
                    vÌ‚â‚œ = vâ‚œ/(1-Î²â‚‚áµ—) &nbsp;&nbsp; (åå·®ä¿®æ­£)<br>
                    Î¸â‚œâ‚Šâ‚ = Î¸â‚œ - Î±mÌ‚â‚œ/âˆš(vÌ‚â‚œ + Îµ)
                </span>
                    </div>
                    <div class="math-explanation">
                        â€¢ é»˜è®¤ï¼šÎ²â‚=0.9, Î²â‚‚=0.999, Îµ=10â»â¸<br>
                        â€¢ åå·®ä¿®æ­£ç¡®ä¿åˆå§‹æ­¥éª¤ä¸ä¼šå¤ªå¤§<br>
                        â€¢ ç»“åˆäº†åŠ¨é‡å’Œè‡ªé€‚åº”å­¦ä¹ ç‡çš„ä¼˜åŠ¿
                    </div>
                </div>

                <div class="math-step" data-step="4">
                    <strong>Adamçš„æ”¹è¿›ç‰ˆæœ¬</strong>
                    <div class="collapsible expanded">
                        <div class="collapsible-header">
                            <div class="collapsible-title">
                                <span>å±•å¼€æŸ¥çœ‹Adamçš„å„ç§æ”¹è¿›</span>
                            </div>
                            <span class="collapsible-icon">â–¼</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="collapsible-inner">
                                <h4>AdamWï¼šè§£è€¦æƒé‡è¡°å‡</h4>
                                <div class="equation-container">
                                    <span>Î¸â‚œâ‚Šâ‚ = (1-Î»Î±)Î¸â‚œ - Î±mÌ‚â‚œ/âˆš(vÌ‚â‚œ + Îµ)</span>
                                </div>
                                <p>å°†L2æ­£åˆ™åŒ–ä»æ¢¯åº¦ä¸­åˆ†ç¦»ï¼Œç›´æ¥ä½œç”¨äºæƒé‡</p>

                                <h4>RAdamï¼šæ•´æµAdam</h4>
                                <p>è‡ªé€‚åº”è°ƒæ•´æ–¹å·®ï¼Œè§£å†³AdamåˆæœŸçš„ä¸ç¨³å®šæ€§</p>

                                <h4>Lookaheadï¼šåŒå±‚ä¼˜åŒ–</h4>
                                <div class="equation-container">
                                    <span>Ï†â‚œâ‚Šâ‚ = Ï†â‚œ + Î±(Î¸â‚œ - Ï†â‚œ)</span>
                                </div>
                                <p>ç»´æŠ¤æ…¢é€Ÿå’Œå¿«é€Ÿä¸¤ç»„æƒé‡ï¼Œæé«˜ç¨³å®šæ€§</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥ -->
            <div class="section-card" style="background: rgba(139, 92, 246, 0.05); margin-top: 2rem;">
                <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ“ˆ å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥</h3>

                <div class="interactive-demo">
                    <canvas id="lr-schedule-canvas" width="800" height="300"></canvas>

                    <div class="demo-controls" style="margin-top: 1rem;">
                        <button class="btn btn-secondary lr-schedule-btn active" data-schedule="constant">å¸¸æ•°</button>
                        <button class="btn btn-secondary lr-schedule-btn" data-schedule="step">é˜¶æ¢¯è¡°å‡</button>
                        <button class="btn btn-secondary lr-schedule-btn" data-schedule="exponential">æŒ‡æ•°è¡°å‡</button>
                        <button class="btn btn-secondary lr-schedule-btn" data-schedule="cosine">ä½™å¼¦é€€ç«</button>
                        <button class="btn btn-secondary lr-schedule-btn" data-schedule="warmup">é¢„çƒ­+è¡°å‡</button>
                        <button class="btn btn-secondary lr-schedule-btn" data-schedule="cyclical">å¾ªç¯å­¦ä¹ ç‡</button>
                    </div>
                </div>

                <div class="concept-grid mt-4">
                    <div class="concept-card what">
                        <h3 style="color: var(--accent-green);">é˜¶æ¢¯è¡°å‡</h3>
                        <div class="equation-container">
                            <span>Î±â‚œ = Î±â‚€ Ã— Î³^âŒŠt/sâŒ‹</span>
                        </div>
                        <p>æ¯sä¸ªepochè¡°å‡Î³å€</p>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">
                            é€‚ç”¨ï¼šCVä»»åŠ¡ï¼Œæ˜ç¡®çš„é˜¶æ®µ
                        </p>
                    </div>
                    <div class="concept-card how">
                        <h3 style="color: var(--accent-blue);">ä½™å¼¦é€€ç«</h3>
                        <div class="equation-container">
                            <span>Î±â‚œ = Î±â‚˜áµ¢â‚™ + Â½(Î±â‚˜â‚â‚“-Î±â‚˜áµ¢â‚™)(1+cos(Ï€t/T))</span>
                        </div>
                        <p>å¹³æ»‘è¡°å‡ï¼Œå¯é‡å¯</p>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">
                            é€‚ç”¨ï¼šç°ä»£æ·±åº¦ç½‘ç»œ
                        </p>
                    </div>
                    <div class="concept-card why">
                        <h3 style="color: var(--accent-red);">å­¦ä¹ ç‡é¢„çƒ­</h3>
                        <div class="equation-container">
                            <span>Î±â‚œ = t/Táµ¥áµ¥â‚áµ£â‚˜ Ã— Î±â‚€</span>
                        </div>
                        <p>åˆæœŸçº¿æ€§å¢é•¿</p>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">
                            é€‚ç”¨ï¼šå¤§æ‰¹é‡è®­ç»ƒ
                        </p>
                    </div>
                    <div class="concept-card pitfall">
                        <h3 style="color: var(--accent-yellow);">å¾ªç¯å­¦ä¹ ç‡</h3>
                        <div class="equation-container">
                            <span>Î±â‚œ = Î±â‚˜áµ¢â‚™ + Î”Î± Ã— triangle(t)</span>
                        </div>
                        <p>å‘¨æœŸæ€§å˜åŒ–</p>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">
                            é€‚ç”¨ï¼šå¿«é€Ÿè®­ç»ƒ
                        </p>
                    </div>
                </div>
            </div>

            <!-- æ‰¹é‡å¤§å°çš„å½±å“ -->
            <div class="math-derivation mt-4">
                <h3>ğŸ“Š æ‰¹é‡å¤§å°çš„ç†è®ºåˆ†æ</h3>

                <div class="math-step" data-step="1">
                    <strong>å™ªå£°ä¸æ³›åŒ–</strong>
                    <p>SGDçš„æ›´æ–°å¯ä»¥åˆ†è§£ä¸ºï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem;">
                    Î¸â‚œâ‚Šâ‚ = Î¸â‚œ - Î±(g + Î¾â‚œ)
                </span>
                    </div>
                    <div class="math-explanation">
                        â€¢ g = E[âˆ‡L(Î¸â‚œ)] æ˜¯çœŸå®æ¢¯åº¦<br>
                        â€¢ Î¾â‚œ æ˜¯é›¶å‡å€¼å™ªå£°ï¼ŒVar[Î¾â‚œ] âˆ ÏƒÂ²/B<br>
                        â€¢ å°æ‰¹é‡â†’å¤§å™ªå£°â†’æ›´å¥½çš„æ¢ç´¢â†’å¯èƒ½æ›´å¥½çš„æ³›åŒ–<br>
                        â€¢ å¤§æ‰¹é‡â†’å°å™ªå£°â†’å¿«é€Ÿæ”¶æ•›â†’å¯èƒ½é™·å…¥å°–é”æå°å€¼
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>çº¿æ€§ç¼©æ”¾è§„åˆ™</strong>
                    <p>å½“æ‰¹é‡å¤§å°å¢åŠ kå€æ—¶ï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem; color: var(--accent-purple);">
                    Î±_new = k Ã— Î±_base<br>
                    ä½†éœ€è¦é¢„çƒ­ï¼šÎ±_warmup(t) = t/T_warmup Ã— Î±_new
                </span>
                    </div>
                    <div class="math-explanation">
                        ç†è®ºä¾æ®ï¼šä¿æŒ Î±/B ä¸å˜ï¼Œä½¿æœŸæœ›æ›´æ–°é‡ç›¸åŒ<br>
                        å®è·µé™åˆ¶ï¼šæ‰¹é‡è¿‡å¤§ä¼šæŸå®³æ³›åŒ–ï¼ˆæ³›åŒ–é¸¿æ²Ÿï¼‰<br>
                        ç»éªŒè§„åˆ™ï¼šB > 8192 æ—¶éœ€è¦ç‰¹æ®ŠæŠ€å·§
                    </div>
                </div>
            </div>

            <!-- äºŒé˜¶ä¼˜åŒ–æ–¹æ³• -->
            <div class="math-derivation mt-4">
                <h3>ğŸ”¬ äºŒé˜¶ä¼˜åŒ–æ–¹æ³•</h3>

                <div class="math-step" data-step="1">
                    <strong>ç‰›é¡¿æ³•</strong>
                    <p>ä½¿ç”¨äºŒé˜¶ä¿¡æ¯ï¼ˆæµ·æ£®çŸ©é˜µï¼‰ï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem;">
                    Î¸â‚œâ‚Šâ‚ = Î¸â‚œ - Hâ»Â¹âˆ‡L(Î¸â‚œ)
                </span>
                    </div>
                    <div class="math-explanation">
                        â€¢ H æ˜¯æµ·æ£®çŸ©é˜µï¼ˆnÃ—nï¼‰ï¼Œè®¡ç®—å’Œå­˜å‚¨ä»£ä»· O(nÂ²)<br>
                        â€¢ äºŒæ¬¡æ”¶æ•›é€Ÿåº¦ï¼ˆè¯¯å·®å¹³æ–¹çº§å‡å°‘ï¼‰<br>
                        â€¢ é—®é¢˜ï¼šæ·±åº¦å­¦ä¹ ä¸­å‚æ•°å¤ªå¤šï¼Œä¸å®ç”¨
                    </div>
                </div>

                <div class="math-step" data-step="2">
                    <strong>æ‹Ÿç‰›é¡¿æ³•ï¼ˆL-BFGSï¼‰</strong>
                    <p>è¿‘ä¼¼æµ·æ£®çŸ©é˜µçš„é€†ï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem;">
                    Hâ»Â¹ â‰ˆ B = Bâ‚€ + ä½ç§©ä¿®æ­£
                </span>
                    </div>
                    <div class="math-explanation">
                        â€¢ åªéœ€å­˜å‚¨ m ä¸ªå‘é‡å¯¹ï¼ˆé€šå¸¸ m=5~20ï¼‰<br>
                        â€¢ å†…å­˜éœ€æ±‚ï¼šO(mn) è€Œé O(nÂ²)<br>
                        â€¢ é€‚åˆå°æ‰¹é‡ã€ç¡®å®šæ€§ä¼˜åŒ–<br>
                        â€¢ åœ¨æ·±åº¦å­¦ä¹ ä¸­ä¸»è¦ç”¨äºå¾®è°ƒé˜¶æ®µ
                    </div>
                </div>

                <div class="math-step" data-step="3">
                    <strong>è‡ªç„¶æ¢¯åº¦ä¸‹é™</strong>
                    <p>è€ƒè™‘å‚æ•°ç©ºé—´çš„å‡ ä½•ç»“æ„ï¼š</p>
                    <div class="equation-container">
                <span style="font-size: 1.2rem;">
                    Î¸â‚œâ‚Šâ‚ = Î¸â‚œ - Î±Fâ»Â¹âˆ‡L(Î¸â‚œ)
                </span>
                    </div>
                    <div class="math-explanation">
                        â€¢ F æ˜¯Fisherä¿¡æ¯çŸ©é˜µï¼šF = E[âˆ‡log p(x|Î¸)âˆ‡log p(x|Î¸)áµ€]<br>
                        â€¢ åœ¨KLæ•£åº¦åº¦é‡ä¸‹çš„æœ€é™¡ä¸‹é™æ–¹å‘<br>
                        â€¢ K-FACï¼šç”¨Kroneckerå› å­è¿‘ä¼¼Fï¼Œä½¿è®¡ç®—å¯è¡Œ<br>
                        â€¢ åœ¨æŸäº›ä»»åŠ¡ä¸Šæ˜¾è‘—åŠ é€Ÿæ”¶æ•›
                    </div>
                </div>
            </div>

            <!-- ä¼˜åŒ–ç†è®ºæ·±å…¥ -->
            <div class="section-card" style="background: rgba(239, 68, 68, 0.05); margin-top: 2rem;">
                <h3 style="color: var(--accent-red); margin-bottom: 1.5rem;">âš¡ ä¼˜åŒ–ä¸­çš„å…³é”®æŒ‘æˆ˜</h3>

                <div class="concept-grid">
                    <div class="concept-card why">
                        <h3>ç—…æ€æ¡ä»¶æ•°</h3>
                        <p>æµ·æ£®çŸ©é˜µç‰¹å¾å€¼ç›¸å·®æ‚¬æ®Š</p>
                        <div class="equation-container">
                            <span>Îº = Î»â‚˜â‚â‚“/Î»â‚˜áµ¢â‚™ â‰« 1</span>
                        </div>
                        <p style="font-size: 0.875rem;">
                            å¯¼è‡´ï¼šå³¡è°·åœ°å½¢ï¼Œéœ‡è¡<br>
                            è§£å†³ï¼šé¢„å¤„ç†ï¼ŒåŠ¨é‡æ–¹æ³•
                        </p>
                    </div>
                    <div class="concept-card pitfall">
                        <h3>éç‚¹é—®é¢˜</h3>
                        <p>é«˜ç»´ç©ºé—´ä¸­éç‚¹è¿œå¤šäºå±€éƒ¨æœ€ä¼˜</p>
                        <p style="font-size: 0.875rem;">
                            ç‰¹å¾ï¼šæŸäº›æ–¹å‘ä¸Šå‡ï¼ŒæŸäº›ä¸‹é™<br>
                            è§£å†³ï¼šå™ªå£°å¸®åŠ©é€ƒç¦»
                        </p>
                    </div>
                    <div class="concept-card what">
                        <h3>å¹³å¦æå°å€¼</h3>
                        <p>Lossåœ¨æœ€ä¼˜ç‚¹é™„è¿‘å¾ˆå¹³å¦</p>
                        <div style="background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 0.25rem; margin-top: 0.5rem;">
                            <code>L(Î¸ + Î´) â‰ˆ L(Î¸*)</code>
                        </div>
                        <p style="font-size: 0.875rem;">
                            ä¼˜ç‚¹ï¼šæ³›åŒ–å¥½<br>
                            ç¼ºç‚¹ï¼šæ”¶æ•›æ…¢
                        </p>
                    </div>
                    <div class="concept-card how">
                        <h3>æ¢¯åº¦çˆ†ç‚¸/æ¶ˆå¤±</h3>
                        <p>æ·±å±‚ç½‘ç»œçš„å›ºæœ‰é—®é¢˜</p>
                        <p style="font-size: 0.875rem;">
                            æ¢¯åº¦è£å‰ªï¼š||g|| > Î¸ æ—¶ç¼©æ”¾<br>
                            å½’ä¸€åŒ–ï¼šBN, LN, GNç­‰
                        </p>
                    </div>
                </div>
            </div>

            <!-- å®è·µä»£ç ï¼šä¼˜åŒ–å™¨å¯¹æ¯” -->
            <div class="code-container mt-4">
                <div class="code-header">
                    <div class="code-header-left">
                        <button class="code-tab active" data-lang="pytorch" tabindex="0">PyTorchå®ç°</button>
                        <button class="code-tab" data-lang="numpy" tabindex="0">ä»é›¶å®ç°</button>
                    </div>
                    <div class="code-header-right">
                        <button class="code-action" onclick="copyCode()" tabindex="0">
                            ğŸ“‹ å¤åˆ¶
                        </button>
                        <button class="code-action" onclick="runCode()" tabindex="0">
                            â–¶ï¸ è¿è¡Œ
                        </button>
                    </div>
                </div>
                <div class="code-content" id="pytorch-code">
<pre><code class="python">import torch
import torch.nn as nn
import torch.optim as optim
import numpy as np
import matplotlib.pyplot as plt
from torch.optim.lr_scheduler import *

class OptimizationExperiment:
    """
    æ·±å…¥å¯¹æ¯”å„ç§ä¼˜åŒ–å™¨çš„è¡Œä¸º
    """

    def __init__(self, model, loss_fn, device='cpu'):
        self.model = model.to(device)
        self.loss_fn = loss_fn
        self.device = device

    def create_optimizers(self, lr=0.01):
        """åˆ›å»ºå„ç§ä¼˜åŒ–å™¨"""
        params = self.model.parameters()

        optimizers = {
            'SGD': optim.SGD(params, lr=lr),
            'SGD+Momentum': optim.SGD(params, lr=lr, momentum=0.9),
            'SGD+Nesterov': optim.SGD(params, lr=lr, momentum=0.9, nesterov=True),
            'AdaGrad': optim.Adagrad(params, lr=lr),
            'RMSprop': optim.RMSprop(params, lr=lr),
            'Adam': optim.Adam(params, lr=lr),
            'AdamW': optim.AdamW(params, lr=lr, weight_decay=0.01),
            'RAdam': optim.RAdam(params, lr=lr),
        }

        # æ·»åŠ äºŒé˜¶ä¼˜åŒ–å™¨ï¼ˆå¦‚æœå‚æ•°é‡ä¸å¤ªå¤§ï¼‰
        if sum(p.numel() for p in params) < 10000:
            optimizers['L-BFGS'] = optim.LBFGS(params, lr=1, max_iter=20)

        return optimizers

    def track_optimization_path(self, optimizer, data_loader, epochs=100):
        """
        è·Ÿè¸ªä¼˜åŒ–è·¯å¾„

        è¿”å›ï¼š
        - losses: æ¯æ­¥çš„æŸå¤±å€¼
        - gradients: æ¢¯åº¦èŒƒæ•°
        - param_trajectory: å‚æ•°è½¨è¿¹ï¼ˆå¦‚æœæ˜¯2Dï¼‰
        """
        losses = []
        gradients = []
        param_trajectory = []

        # é‡ç½®æ¨¡å‹å‚æ•°
        for p in self.model.parameters():
            nn.init.normal_(p, mean=0, std=0.1)

        for epoch in range(epochs):
            epoch_loss = 0
            epoch_grad_norm = 0

            for batch_idx, (data, target) in enumerate(data_loader):
                data, target = data.to(self.device), target.to(self.device)

                # ç‰¹æ®Šå¤„ç†L-BFGS
                if isinstance(optimizer, optim.LBFGS):
                    def closure():
                        optimizer.zero_grad()
                        output = self.model(data)
                        loss = self.loss_fn(output, target)
                        loss.backward()
                        return loss

                    loss = optimizer.step(closure)
                else:
                    # æ ‡å‡†ä¼˜åŒ–å™¨
                    optimizer.zero_grad()
                    output = self.model(data)
                    loss = self.loss_fn(output, target)
                    loss.backward()

                    # è®°å½•æ¢¯åº¦èŒƒæ•°
                    total_grad_norm = 0
                    for p in self.model.parameters():
                        if p.grad is not None:
                            total_grad_norm += p.grad.norm().item() ** 2
                    total_grad_norm = total_grad_norm ** 0.5

                    optimizer.step()

                epoch_loss += loss.item()
                epoch_grad_norm += total_grad_norm

            losses.append(epoch_loss / len(data_loader))
            gradients.append(epoch_grad_norm / len(data_loader))

            # è®°å½•å‚æ•°ï¼ˆå¦‚æœæ˜¯ç®€å•çš„2Dé—®é¢˜ï¼‰
            if self.model.fc1.weight.numel() == 2:
                w = self.model.fc1.weight.data.cpu().numpy().flatten()
                param_trajectory.append(w.copy())

        return {
            'losses': losses,
            'gradients': gradients,
            'param_trajectory': np.array(param_trajectory) if param_trajectory else None
        }

    def visualize_optimization_landscape(self, results_dict):
        """å¯è§†åŒ–ä¼˜åŒ–è¿‡ç¨‹"""
        fig, axes = plt.subplots(2, 2, figsize=(15, 12))

        # 1. æŸå¤±æ›²çº¿
        ax = axes[0, 0]
        for name, results in results_dict.items():
            ax.semilogy(results['losses'], label=name, linewidth=2)
        ax.set_xlabel('Epoch')
        ax.set_ylabel('Loss (log scale)')
        ax.set_title('è®­ç»ƒæŸå¤±å¯¹æ¯”')
        ax.legend()
        ax.grid(True, alpha=0.3)

        # 2. æ¢¯åº¦èŒƒæ•°
        ax = axes[0, 1]
        for name, results in results_dict.items():
            if results['gradients'][0] > 0:  # æ’é™¤L-BFGS
                ax.plot(results['gradients'], label=name, linewidth=2)
        ax.set_xlabel('Epoch')
        ax.set_ylabel('Gradient Norm')
        ax.set_title('æ¢¯åº¦èŒƒæ•°å˜åŒ–')
        ax.legend()
        ax.grid(True, alpha=0.3)

        # 3. æ”¶æ•›é€Ÿåº¦å¯¹æ¯”
        ax = axes[1, 0]
        final_losses = {name: results['losses'][-1]
                       for name, results in results_dict.items()}
        names = list(final_losses.keys())
        values = list(final_losses.values())
        colors = plt.cm.viridis(np.linspace(0, 1, len(names)))

        bars = ax.bar(names, values, color=colors)
        ax.set_ylabel('Final Loss')
        ax.set_title('æœ€ç»ˆæŸå¤±å¯¹æ¯”')
        ax.set_yscale('log')
        plt.setp(ax.xaxis.get_majorticklabels(), rotation=45)

        # 4. å‚æ•°è½¨è¿¹ï¼ˆå¦‚æœå¯ç”¨ï¼‰
        ax = axes[1, 1]
        if any(r['param_trajectory'] is not None for r in results_dict.values()):
            # ç»˜åˆ¶æŸå¤±å‡½æ•°ç­‰é«˜çº¿ï¼ˆç¤ºæ„ï¼‰
            x = np.linspace(-2, 2, 100)
            y = np.linspace(-2, 2, 100)
            X, Y = np.meshgrid(x, y)
            Z = X**2 + 10*Y**2  # ç®€å•çš„æ¤­åœ†å½¢æŸå¤±å‡½æ•°

            ax.contour(X, Y, Z, levels=20, alpha=0.3)

            # ç»˜åˆ¶ä¼˜åŒ–è·¯å¾„
            for name, results in results_dict.items():
                if results['param_trajectory'] is not None:
                    traj = results['param_trajectory']
                    ax.plot(traj[:, 0], traj[:, 1], 'o-',
                           label=name, markersize=3, linewidth=1)

            ax.set_xlabel('Parameter 1')
            ax.set_ylabel('Parameter 2')
            ax.set_title('ä¼˜åŒ–è·¯å¾„ï¼ˆ2DæŠ•å½±ï¼‰')
            ax.legend()
            ax.grid(True, alpha=0.3)
        else:
            ax.text(0.5, 0.5, 'å‚æ•°ç»´åº¦è¿‡é«˜\næ— æ³•å¯è§†åŒ–',
                   ha='center', va='center', transform=ax.transAxes)

        plt.tight_layout()
        plt.show()


class LearningRateSchedulers:
    """å­¦ä¹ ç‡è°ƒåº¦å™¨çš„å®ç°å’Œå¯è§†åŒ–"""

    @staticmethod
    def visualize_schedules(initial_lr=0.1, total_epochs=100):
        """å¯è§†åŒ–å„ç§å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥"""

        # åˆ›å»ºä¸€ä¸ªdummyä¼˜åŒ–å™¨å’Œå‚æ•°
        param = torch.nn.Parameter(torch.randn(1))
        optimizer = optim.SGD([param], lr=initial_lr)

        schedulers = {
            'å¸¸æ•°': None,
            'é˜¶æ¢¯è¡°å‡': StepLR(optimizer, step_size=30, gamma=0.1),
            'å¤šé˜¶æ¢¯è¡°å‡': MultiStepLR(optimizer, milestones=[30, 60, 90], gamma=0.1),
            'æŒ‡æ•°è¡°å‡': ExponentialLR(optimizer, gamma=0.95),
            'ä½™å¼¦é€€ç«': CosineAnnealingLR(optimizer, T_max=total_epochs),
            'å¸¦é‡å¯çš„ä½™å¼¦': CosineAnnealingWarmRestarts(optimizer, T_0=20, T_mult=2),
            'çº¿æ€§é¢„çƒ­+ä½™å¼¦': None,  # è‡ªå®šä¹‰å®ç°
            'å¾ªç¯å­¦ä¹ ç‡': CyclicLR(optimizer, base_lr=0.001, max_lr=initial_lr,
                                  step_size_up=20, mode='triangular'),
            'OneCycle': OneCycleLR(optimizer, max_lr=initial_lr,
                                  epochs=total_epochs, steps_per_epoch=1)
        }

        plt.figure(figsize=(15, 10))

        for idx, (name, scheduler) in enumerate(schedulers.items()):
            plt.subplot(3, 3, idx + 1)

            lrs = []

            # é‡ç½®ä¼˜åŒ–å™¨
            for group in optimizer.param_groups:
                group['lr'] = initial_lr

            for epoch in range(total_epochs):
                if name == 'å¸¸æ•°':
                    lrs.append(initial_lr)
                elif name == 'çº¿æ€§é¢„çƒ­+ä½™å¼¦':
                    # è‡ªå®šä¹‰é¢„çƒ­+ä½™å¼¦é€€ç«
                    warmup_epochs = 10
                    if epoch < warmup_epochs:
                        lr = initial_lr * (epoch / warmup_epochs)
                    else:
                        progress = (epoch - warmup_epochs) / (total_epochs - warmup_epochs)
                        lr = initial_lr * 0.5 * (1 + np.cos(np.pi * progress))
                    lrs.append(lr)
                    for group in optimizer.param_groups:
                        group['lr'] = lr
                else:
                    lrs.append(optimizer.param_groups[0]['lr'])
                    if scheduler:
                        scheduler.step()

            plt.plot(lrs, linewidth=2)
            plt.title(name)
            plt.xlabel('Epoch')
            plt.ylabel('Learning Rate')
            plt.grid(True, alpha=0.3)

        plt.tight_layout()
        plt.show()

    @staticmethod
    def adaptive_lr_finder(model, data_loader, loss_fn,
                          min_lr=1e-5, max_lr=10, num_iter=100):
        """
        å­¦ä¹ ç‡èŒƒå›´æµ‹è¯•ï¼ˆLR Range Testï¼‰

        é€æ­¥å¢åŠ å­¦ä¹ ç‡ï¼Œè§‚å¯ŸæŸå¤±å˜åŒ–
        """
        model.train()
        optimizer = optim.SGD(model.parameters(), lr=min_lr)

        lrs = np.logspace(np.log10(min_lr), np.log10(max_lr), num_iter)
        losses = []

        data_iter = iter(data_loader)

        for i, lr in enumerate(lrs):
            # è®¾ç½®å­¦ä¹ ç‡
            for param_group in optimizer.param_groups:
                param_group['lr'] = lr

            # è·å–æ‰¹æ¬¡æ•°æ®
            try:
                inputs, targets = next(data_iter)
            except StopIteration:
                data_iter = iter(data_loader)
                inputs, targets = next(data_iter)

            # å‰å‘ä¼ æ’­
            optimizer.zero_grad()
            outputs = model(inputs)
            loss = loss_fn(outputs, targets)

            # è®°å½•æŸå¤±
            losses.append(loss.item())

            # åå‘ä¼ æ’­
            loss.backward()
            optimizer.step()

            # å¦‚æœæŸå¤±çˆ†ç‚¸ï¼Œæå‰åœæ­¢
            if loss.item() > 4 * np.min(losses):
                break

        # å¯è§†åŒ–
        plt.figure(figsize=(10, 6))
        plt.semilogx(lrs[:len(losses)], losses)
        plt.xlabel('Learning Rate (log scale)')
        plt.ylabel('Loss')
        plt.title('å­¦ä¹ ç‡èŒƒå›´æµ‹è¯•')
        plt.grid(True, alpha=0.3)

        # æ‰¾åˆ°æœ€ä½³å­¦ä¹ ç‡ï¼ˆæŸå¤±ä¸‹é™æœ€å¿«çš„ç‚¹ï¼‰
        min_grad_idx = np.argmin(np.gradient(losses))
        best_lr = lrs[min_grad_idx]

        plt.axvline(best_lr, color='red', linestyle='--',
                   label=f'å»ºè®®å­¦ä¹ ç‡: {best_lr:.2e}')
        plt.legend()
        plt.show()

        return best_lr


# å®éªŒï¼šä¼˜åŒ–å™¨åœ¨ä¸åŒåœ°å½¢ä¸Šçš„è¡¨ç°
def optimization_landscape_experiment():
    """
    åœ¨ä¸åŒçš„æŸå¤±åœ°å½¢ä¸Šæµ‹è¯•ä¼˜åŒ–å™¨
    """

    # 1. Rosenbrockå‡½æ•°ï¼ˆéå‡¸ä¼˜åŒ–æµ‹è¯•ï¼‰
    class RosenbrockModel(nn.Module):
        def __init__(self):
            super().__init__()
            self.params = nn.Parameter(torch.tensor([-1.2, 1.0]))

        def forward(self):
            x, y = self.params[0], self.params[1]
            return (1 - x)**2 + 100 * (y - x**2)**2

    # 2. ç—…æ€æ¡ä»¶æ•°çš„äºŒæ¬¡å‡½æ•°
    class IllConditionedQuadratic(nn.Module):
        def __init__(self, condition_number=100):
            super().__init__()
            self.params = nn.Parameter(torch.randn(2))
            self.A = torch.tensor([[condition_number, 0], [0, 1]],
                                dtype=torch.float32)

        def forward(self):
            return 0.5 * self.params @ self.A @ self.params

    # 3. å¸¦æœ‰å¤šä¸ªå±€éƒ¨æœ€ä¼˜çš„å‡½æ•°
    class MultiModalFunction(nn.Module):
        def __init__(self):
            super().__init__()
            self.params = nn.Parameter(torch.tensor([0.0, 0.0]))

        def forward(self):
            x, y = self.params[0], self.params[1]
            return -torch.exp(-(x**2 + y**2)) - \
                   0.5 * torch.exp(-((x-1)**2 + (y-1)**2))

    # æµ‹è¯•ä¸åŒä¼˜åŒ–å™¨
    models = {
        'Rosenbrock': RosenbrockModel(),
        'ç—…æ€äºŒæ¬¡': IllConditionedQuadratic(condition_number=1000),
        'å¤šå³°å‡½æ•°': MultiModalFunction()
    }

    fig, axes = plt.subplots(1, 3, figsize=(18, 6))

    for idx, (name, model) in enumerate(models.items()):
        ax = axes[idx]

        # åˆ›å»ºæŸå¤±åœ°å½¢
        x = np.linspace(-2, 2, 100)
        y = np.linspace(-2, 2, 100)
        X, Y = np.meshgrid(x, y)
        Z = np.zeros_like(X)

        for i in range(100):
            for j in range(100):
                model.params.data = torch.tensor([X[i, j], Y[i, j]],
                                               dtype=torch.float32)
                Z[i, j] = model().item()

        # ç»˜åˆ¶ç­‰é«˜çº¿
        contour = ax.contour(X, Y, Z, levels=30, alpha=0.6)
        ax.clabel(contour, inline=True, fontsize=8)

        # æµ‹è¯•ä¸åŒä¼˜åŒ–å™¨
        optimizers = {
            'SGD': optim.SGD(model.parameters(), lr=0.01),
            'Momentum': optim.SGD(model.parameters(), lr=0.01, momentum=0.9),
            'Adam': optim.Adam(model.parameters(), lr=0.1)
        }

        colors = ['red', 'blue', 'green']

        for opt_idx, (opt_name, optimizer) in enumerate(optimizers.items()):
            # é‡ç½®èµ·ç‚¹
            model.params.data = torch.tensor([-1.5, 1.5], dtype=torch.float32)
            trajectory = [model.params.data.numpy().copy()]

            # ä¼˜åŒ–æ­¥éª¤
            for _ in range(50):
                optimizer.zero_grad()
                loss = model()
                loss.backward()
                optimizer.step()
                trajectory.append(model.params.data.numpy().copy())

            trajectory = np.array(trajectory)
            ax.plot(trajectory[:, 0], trajectory[:, 1],
                   'o-', color=colors[opt_idx], label=opt_name,
                   markersize=3, linewidth=2)

        ax.set_title(f'{name}')
        ax.set_xlabel('Parameter 1')
        ax.set_ylabel('Parameter 2')
        ax.legend()
        ax.grid(True, alpha=0.3)

    plt.tight_layout()
    plt.show()


# æ‰¹é‡å¤§å°çš„ç³»ç»Ÿç ”ç©¶
def batch_size_scaling_experiment():
    """
    ç ”ç©¶æ‰¹é‡å¤§å°å¯¹ä¼˜åŒ–å’Œæ³›åŒ–çš„å½±å“
    """

    # ç”Ÿæˆåˆæˆæ•°æ®
    np.random.seed(42)
    torch.manual_seed(42)

    # åˆ›å»ºä¸€ä¸ªéçº¿æ€§åˆ†ç±»æ•°æ®é›†
    from sklearn.datasets import make_classification
    X, y = make_classification(n_samples=10000, n_features=20,
                              n_informative=15, n_redundant=5,
                              n_clusters_per_class=3, random_state=42)

    X = torch.FloatTensor(X)
    y = torch.LongTensor(y)

    # åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†
    train_size = 8000
    X_train, X_test = X[:train_size], X[train_size:]
    y_train, y_test = y[:train_size], y[train_size:]

    # æµ‹è¯•ä¸åŒçš„æ‰¹é‡å¤§å°
    batch_sizes = [32, 64, 128, 256, 512, 1024, 2048]
    results = {}

    for batch_size in batch_sizes:
        print(f"\næµ‹è¯•æ‰¹é‡å¤§å°: {batch_size}")

        # åˆ›å»ºæ•°æ®åŠ è½½å™¨
        train_dataset = torch.utils.data.TensorDataset(X_train, y_train)
        train_loader = torch.utils.data.DataLoader(
            train_dataset, batch_size=batch_size, shuffle=True
        )

        # åˆ›å»ºæ¨¡å‹
        model = nn.Sequential(
            nn.Linear(20, 128),
            nn.ReLU(),
            nn.BatchNorm1d(128),
            nn.Dropout(0.3),
            nn.Linear(128, 64),
            nn.ReLU(),
            nn.BatchNorm1d(64),
            nn.Dropout(0.3),
            nn.Linear(64, 2)
        )

        # ä½¿ç”¨çº¿æ€§ç¼©æ”¾è§„åˆ™
        base_lr = 0.01
        scaled_lr = base_lr * np.sqrt(batch_size / 32)

        optimizer = optim.SGD(model.parameters(), lr=scaled_lr, momentum=0.9)
        criterion = nn.CrossEntropyLoss()

        # è®­ç»ƒ
        train_losses = []
        test_accuracies = []
        gradient_norms = []

        for epoch in range(50):
            # è®­ç»ƒé˜¶æ®µ
            model.train()
            epoch_loss = 0
            epoch_grad_norm = 0

            for batch_X, batch_y in train_loader:
                optimizer.zero_grad()
                outputs = model(batch_X)
                loss = criterion(outputs, batch_y)
                loss.backward()

                # è®°å½•æ¢¯åº¦èŒƒæ•°
                total_norm = 0
                for p in model.parameters():
                    if p.grad is not None:
                        total_norm += p.grad.data.norm(2).item() ** 2
                total_norm = total_norm ** 0.5
                epoch_grad_norm += total_norm

                optimizer.step()
                epoch_loss += loss.item()

            train_losses.append(epoch_loss / len(train_loader))
            gradient_norms.append(epoch_grad_norm / len(train_loader))

            # æµ‹è¯•é˜¶æ®µ
            model.eval()
            with torch.no_grad():
                test_outputs = model(X_test)
                test_pred = test_outputs.argmax(dim=1)
                test_acc = (test_pred == y_test).float().mean().item()
                test_accuracies.append(test_acc)

        results[batch_size] = {
            'train_losses': train_losses,
            'test_accuracies': test_accuracies,
            'gradient_norms': gradient_norms,
            'final_test_acc': test_accuracies[-1]
        }

    # å¯è§†åŒ–ç»“æœ
    fig, axes = plt.subplots(2, 2, figsize=(15, 12))

    # 1. è®­ç»ƒæŸå¤±æ›²çº¿
    ax = axes[0, 0]
    for bs in batch_sizes:
        ax.plot(results[bs]['train_losses'], label=f'BS={bs}', linewidth=2)
    ax.set_xlabel('Epoch')
    ax.set_ylabel('Training Loss')
    ax.set_title('ä¸åŒæ‰¹é‡å¤§å°çš„è®­ç»ƒæŸå¤±')
    ax.legend()
    ax.grid(True, alpha=0.3)

    # 2. æµ‹è¯•å‡†ç¡®ç‡æ›²çº¿
    ax = axes[0, 1]
    for bs in batch_sizes:
        ax.plot(results[bs]['test_accuracies'], label=f'BS={bs}', linewidth=2)
    ax.set_xlabel('Epoch')
    ax.set_ylabel('Test Accuracy')
    ax.set_title('ä¸åŒæ‰¹é‡å¤§å°çš„æµ‹è¯•å‡†ç¡®ç‡')
    ax.legend()
    ax.grid(True, alpha=0.3)

    # 3. æœ€ç»ˆæµ‹è¯•å‡†ç¡®ç‡ vs æ‰¹é‡å¤§å°
    ax = axes[1, 0]
    final_accs = [results[bs]['final_test_acc'] for bs in batch_sizes]
    ax.semilogx(batch_sizes, final_accs, 'o-', linewidth=2, markersize=8)
    ax.set_xlabel('Batch Size (log scale)')
    ax.set_ylabel('Final Test Accuracy')
    ax.set_title('æ³›åŒ–èƒ½åŠ› vs æ‰¹é‡å¤§å°')
    ax.grid(True, alpha=0.3)

    # 4. æ¢¯åº¦å™ªå£°æ°´å¹³
    ax = axes[1, 1]
    for bs in batch_sizes[:4]:  # åªæ˜¾ç¤ºå‰å‡ ä¸ªé¿å…æ‹¥æŒ¤
        grad_stds = []
        for i in range(5, len(results[bs]['gradient_norms'])):
            # è®¡ç®—æ¢¯åº¦çš„æ ‡å‡†å·®ä½œä¸ºå™ªå£°çš„åº¦é‡
            recent_grads = results[bs]['gradient_norms'][i-5:i]
            grad_stds.append(np.std(recent_grads))
        ax.plot(grad_stds, label=f'BS={bs}', linewidth=2)

    ax.set_xlabel('Epoch')
    ax.set_ylabel('Gradient Noise (Std)')
    ax.set_title('æ¢¯åº¦å™ªå£°æ°´å¹³')
    ax.legend()
    ax.grid(True, alpha=0.3)

    plt.tight_layout()
    plt.show()

    # æ‰“å°æ€»ç»“
    print("\n=== æ‰¹é‡å¤§å°å®éªŒæ€»ç»“ ===")
    print("æ‰¹é‡å¤§å° | æœ€ç»ˆæµ‹è¯•å‡†ç¡®ç‡")
    print("-" * 30)
    for bs in batch_sizes:
        print(f"{bs:8d} | {results[bs]['final_test_acc']:.4f}")

    print("\nè§‚å¯Ÿï¼š")
    print("1. å°æ‰¹é‡ï¼šæ›´å¤šå™ªå£°ï¼Œå¯èƒ½æœ‰æ›´å¥½çš„æ³›åŒ–")
    print("2. å¤§æ‰¹é‡ï¼šæ”¶æ•›æ›´ç¨³å®šï¼Œä½†å¯èƒ½é™·å…¥å°–é”æå°å€¼")
    print("3. å­˜åœ¨ä¸€ä¸ªæœ€ä¼˜æ‰¹é‡å¤§å°ï¼Œå¹³è¡¡æ•ˆç‡å’Œæ³›åŒ–")


if __name__ == "__main__":
    print("=== MLPä¼˜åŒ–ç®—æ³•æ·±åº¦å®éªŒ ===\n")

    # 1. ä¼˜åŒ–å™¨å¯¹æ¯”
    print("1. åˆ›å»ºç®€å•çš„æµ‹è¯•é—®é¢˜...")
    from torch.utils.data import DataLoader, TensorDataset

    # ç”Ÿæˆç®€å•çš„åˆ†ç±»æ•°æ®
    X = torch.randn(1000, 10)
    y = (X.sum(dim=1) > 0).long()
    dataset = TensorDataset(X, y)
    data_loader = DataLoader(dataset, batch_size=32, shuffle=True)

    # ç®€å•æ¨¡å‹
    model = nn.Sequential(
        nn.Linear(10, 20),
        nn.ReLU(),
        nn.Linear(20, 2)
    )

    experiment = OptimizationExperiment(model, nn.CrossEntropyLoss())

    print("\n2. æµ‹è¯•å„ç§ä¼˜åŒ–å™¨...")
    optimizers = experiment.create_optimizers(lr=0.01)
    results = {}

    for name, opt in optimizers.items():
        print(f"   æµ‹è¯• {name}...")
        results[name] = experiment.track_optimization_path(opt, data_loader, epochs=50)

    print("\n3. å¯è§†åŒ–ç»“æœ...")
    experiment.visualize_optimization_landscape(results)

    # 2. å­¦ä¹ ç‡è°ƒåº¦
    print("\n4. å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥å¯è§†åŒ–...")
    LearningRateSchedulers.visualize_schedules()

    # 3. ä¼˜åŒ–åœ°å½¢å®éªŒ
    print("\n5. ä¸åŒä¼˜åŒ–åœ°å½¢ä¸Šçš„è¡¨ç°...")
    optimization_landscape_experiment()

    # 4. æ‰¹é‡å¤§å°ç ”ç©¶
    print("\n6. æ‰¹é‡å¤§å°å¯¹ä¼˜åŒ–çš„å½±å“...")
    batch_size_scaling_experiment()

    print("\nå®éªŒå®Œæˆï¼")</code></pre>
                </div>
                <div class="code-content" id="numpy-code" style="display: none;">
<pre><code class="python">import numpy as np
import matplotlib.pyplot as plt

class Optimizer:
    """ä¼˜åŒ–å™¨åŸºç±»"""

    def __init__(self, params, lr=0.01):
        self.params = params
        self.lr = lr

    def step(self, grads):
        raise NotImplementedError

    def zero_grad(self):
        pass


class SGD(Optimizer):
    """éšæœºæ¢¯åº¦ä¸‹é™"""

    def step(self, grads):
        for param, grad in zip(self.params, grads):
            param -= self.lr * grad


class Momentum(Optimizer):
    """å¸¦åŠ¨é‡çš„SGD"""

    def __init__(self, params, lr=0.01, momentum=0.9):
        super().__init__(params, lr)
        self.momentum = momentum
        self.velocities = [np.zeros_like(p) for p in params]

    def step(self, grads):
        for i, (param, grad) in enumerate(zip(self.params, grads)):
            self.velocities[i] = self.momentum * self.velocities[i] + (1 - self.momentum) * grad
            param -= self.lr * self.velocities[i]


class AdaGrad(Optimizer):
    """è‡ªé€‚åº”æ¢¯åº¦ç®—æ³•"""

    def __init__(self, params, lr=0.01, eps=1e-8):
        super().__init__(params, lr)
        self.eps = eps
        self.accumulated_grads = [np.zeros_like(p) for p in params]

    def step(self, grads):
        for i, (param, grad) in enumerate(zip(self.params, grads)):
            self.accumulated_grads[i] += grad ** 2
            param -= self.lr * grad / (np.sqrt(self.accumulated_grads[i]) + self.eps)


class RMSprop(Optimizer):
    """RMSpropä¼˜åŒ–å™¨"""

    def __init__(self, params, lr=0.01, beta=0.9, eps=1e-8):
        super().__init__(params, lr)
        self.beta = beta
        self.eps = eps
        self.v = [np.zeros_like(p) for p in params]

    def step(self, grads):
        for i, (param, grad) in enumerate(zip(self.params, grads)):
            self.v[i] = self.beta * self.v[i] + (1 - self.beta) * grad ** 2
            param -= self.lr * grad / (np.sqrt(self.v[i]) + self.eps)


class Adam(Optimizer):
    """Adamä¼˜åŒ–å™¨çš„å®Œæ•´å®ç°"""

    def __init__(self, params, lr=0.001, beta1=0.9, beta2=0.999, eps=1e-8):
        super().__init__(params, lr)
        self.beta1 = beta1
        self.beta2 = beta2
        self.eps = eps
        self.m = [np.zeros_like(p) for p in params]
        self.v = [np.zeros_like(p) for p in params]
        self.t = 0

    def step(self, grads):
        self.t += 1

        for i, (param, grad) in enumerate(zip(self.params, grads)):
            # æ›´æ–°ä¸€é˜¶çŸ©ï¼ˆåŠ¨é‡ï¼‰
            self.m[i] = self.beta1 * self.m[i] + (1 - self.beta1) * grad

            # æ›´æ–°äºŒé˜¶çŸ©ï¼ˆRMSpropéƒ¨åˆ†ï¼‰
            self.v[i] = self.beta2 * self.v[i] + (1 - self.beta2) * grad ** 2

            # åå·®ä¿®æ­£
            m_hat = self.m[i] / (1 - self.beta1 ** self.t)
            v_hat = self.v[i] / (1 - self.beta2 ** self.t)

            # å‚æ•°æ›´æ–°
            param -= self.lr * m_hat / (np.sqrt(v_hat) + self.eps)


class AdamW(Adam):
    """AdamWï¼šè§£è€¦æƒé‡è¡°å‡çš„Adam"""

    def __init__(self, params, lr=0.001, beta1=0.9, beta2=0.999,
                 eps=1e-8, weight_decay=0.01):
        super().__init__(params, lr, beta1, beta2, eps)
        self.weight_decay = weight_decay

    def step(self, grads):
        self.t += 1

        for i, (param, grad) in enumerate(zip(self.params, grads)):
            # æ ‡å‡†Adamæ›´æ–°
            self.m[i] = self.beta1 * self.m[i] + (1 - self.beta1) * grad
            self.v[i] = self.beta2 * self.v[i] + (1 - self.beta2) * grad ** 2

            m_hat = self.m[i] / (1 - self.beta1 ** self.t)
            v_hat = self.v[i] / (1 - self.beta2 ** self.t)

            # å‚æ•°æ›´æ–°ï¼ˆå¸¦æƒé‡è¡°å‡ï¼‰
            param -= self.lr * (m_hat / (np.sqrt(v_hat) + self.eps) +
                               self.weight_decay * param)


# å­¦ä¹ ç‡è°ƒåº¦å™¨
class LRScheduler:
    """å­¦ä¹ ç‡è°ƒåº¦å™¨åŸºç±»"""

    def __init__(self, optimizer, last_epoch=-1):
        self.optimizer = optimizer
        self.last_epoch = last_epoch
        self.base_lr = optimizer.lr

    def step(self):
        self.last_epoch += 1
        self.optimizer.lr = self.get_lr()

    def get_lr(self):
        raise NotImplementedError


class StepLR(LRScheduler):
    """é˜¶æ¢¯è¡°å‡"""

    def __init__(self, optimizer, step_size, gamma=0.1):
        super().__init__(optimizer)
        self.step_size = step_size
        self.gamma = gamma

    def get_lr(self):
        return self.base_lr * (self.gamma ** (self.last_epoch // self.step_size))


class ExponentialLR(LRScheduler):
    """æŒ‡æ•°è¡°å‡"""

    def __init__(self, optimizer, gamma):
        super().__init__(optimizer)
        self.gamma = gamma

    def get_lr(self):
        return self.base_lr * (self.gamma ** self.last_epoch)


class CosineAnnealingLR(LRScheduler):
    """ä½™å¼¦é€€ç«"""

    def __init__(self, optimizer, T_max):
        super().__init__(optimizer)
        self.T_max = T_max

    def get_lr(self):
        return self.base_lr * (1 + np.cos(np.pi * self.last_epoch / self.T_max)) / 2


# ä¼˜åŒ–å¯è§†åŒ–å‡½æ•°
def visualize_optimization_2d():
    """
    åœ¨2Då‡½æ•°ä¸Šå¯è§†åŒ–ä¸åŒä¼˜åŒ–å™¨çš„è¡Œä¸º
    """

    # å®šä¹‰æµ‹è¯•å‡½æ•°
    def rosenbrock(x, y):
        """Rosenbrockå‡½æ•°ï¼ˆé¦™è•‰å‡½æ•°ï¼‰"""
        return (1 - x)**2 + 100 * (y - x**2)**2

    def rosenbrock_grad(x, y):
        """Rosenbrockå‡½æ•°çš„æ¢¯åº¦"""
        dx = -2 * (1 - x) - 400 * x * (y - x**2)
        dy = 200 * (y - x**2)
        return np.array([dx, dy])

    # åˆ›å»ºç½‘æ ¼
    x = np.linspace(-2, 2, 100)
    y = np.linspace(-1, 3, 100)
    X, Y = np.meshgrid(x, y)
    Z = rosenbrock(X, Y)

    # åˆå§‹åŒ–å‚æ•°
    start_point = np.array([-1.5, 2.5])

    # åˆ›å»ºä¼˜åŒ–å™¨
    optimizers = {
        'SGD': SGD([start_point.copy()], lr=0.001),
        'Momentum': Momentum([start_point.copy()], lr=0.001, momentum=0.9),
        'RMSprop': RMSprop([start_point.copy()], lr=0.01),
        'Adam': Adam([start_point.copy()], lr=0.1)
    }

    # è¿è¡Œä¼˜åŒ–
    trajectories = {}
    for name, opt in optimizers.items():
        trajectory = [opt.params[0].copy()]

        for _ in range(200):
            grad = rosenbrock_grad(opt.params[0][0], opt.params[0][1])
            opt.step([grad])
            trajectory.append(opt.params[0].copy())

        trajectories[name] = np.array(trajectory)

    # å¯è§†åŒ–
    plt.figure(figsize=(12, 10))

    # ç»˜åˆ¶ç­‰é«˜çº¿
    levels = np.logspace(-0.5, 3.5, 20)
    plt.contour(X, Y, Z, levels=levels, alpha=0.6)

    # ç»˜åˆ¶ä¼˜åŒ–è½¨è¿¹
    colors = ['red', 'blue', 'green', 'purple']
    for (name, trajectory), color in zip(trajectories.items(), colors):
        plt.plot(trajectory[:, 0], trajectory[:, 1],
                'o-', color=color, label=name,
                markersize=3, linewidth=2, alpha=0.8)

    # æ ‡è®°èµ·ç‚¹å’Œç»ˆç‚¹
    plt.plot(start_point[0], start_point[1], 'ko', markersize=10, label='èµ·ç‚¹')
    plt.plot(1, 1, 'k*', markersize=15, label='æœ€ä¼˜ç‚¹')

    plt.xlabel('x')
    plt.ylabel('y')
    plt.title('ä¸åŒä¼˜åŒ–å™¨åœ¨Rosenbrockå‡½æ•°ä¸Šçš„è½¨è¿¹')
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.tight_layout()
    plt.show()


# æ‰¹é‡å¤§å°ä¸æ¢¯åº¦å™ªå£°çš„å…³ç³»
def batch_size_noise_analysis():
    """
    åˆ†ææ‰¹é‡å¤§å°å¯¹æ¢¯åº¦ä¼°è®¡å™ªå£°çš„å½±å“
    """

    # ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
    np.random.seed(42)
    n_samples = 10000
    n_features = 50

    # ç”Ÿæˆçº¿æ€§å¯åˆ†æ•°æ®ï¼ˆå¸¦å™ªå£°ï¼‰
    X = np.random.randn(n_samples, n_features)
    true_w = np.random.randn(n_features)
    y = X @ true_w + 0.1 * np.random.randn(n_samples)

    # å®šä¹‰æŸå¤±å‡½æ•°å’Œæ¢¯åº¦
    def compute_loss_and_grad(X_batch, y_batch, w):
        """è®¡ç®—æ‰¹é‡ä¸Šçš„MSEæŸå¤±å’Œæ¢¯åº¦"""
        predictions = X_batch @ w
        errors = predictions - y_batch
        loss = 0.5 * np.mean(errors ** 2)
        grad = X_batch.T @ errors / len(y_batch)
        return loss, grad

    # æµ‹è¯•ä¸åŒçš„æ‰¹é‡å¤§å°
    batch_sizes = [1, 4, 16, 64, 256, 1024]
    n_iterations = 100

    results = {}

    for batch_size in batch_sizes:
        print(f"æµ‹è¯•æ‰¹é‡å¤§å°: {batch_size}")

        # åˆå§‹åŒ–å‚æ•°
        w = np.random.randn(n_features) * 0.1

        # è®°å½•æ¢¯åº¦ç»Ÿè®¡
        grad_norms = []
        grad_variances = []
        losses = []

        # åˆ›å»ºä¼˜åŒ–å™¨
        optimizer = Adam([w], lr=0.01)

        for iteration in range(n_iterations):
            # éšæœºé‡‡æ ·å¤šä¸ªæ‰¹æ¬¡è®¡ç®—æ¢¯åº¦æ–¹å·®
            batch_grads = []

            for _ in range(10):  # é‡‡æ ·10ä¸ªæ‰¹æ¬¡ä¼°è®¡æ–¹å·®
                indices = np.random.choice(n_samples, batch_size, replace=False)
                X_batch = X[indices]
                y_batch = y[indices]

                loss, grad = compute_loss_and_grad(X_batch, y_batch, w)
                batch_grads.append(grad)

            batch_grads = np.array(batch_grads)

            # è®¡ç®—æ¢¯åº¦ç»Ÿè®¡
            mean_grad = np.mean(batch_grads, axis=0)
            grad_variance = np.mean(np.var(batch_grads, axis=0))

            grad_norms.append(np.linalg.norm(mean_grad))
            grad_variances.append(grad_variance)
            losses.append(loss)

            # æ›´æ–°å‚æ•°
            optimizer.step([mean_grad])

        results[batch_size] = {
            'grad_norms': grad_norms,
            'grad_variances': grad_variances,
            'losses': losses
        }

    # å¯è§†åŒ–ç»“æœ
    fig, axes = plt.subplots(2, 2, figsize=(15, 10))

    # 1. æ¢¯åº¦æ–¹å·® vs æ‰¹é‡å¤§å°
    ax = axes[0, 0]
    mean_variances = [np.mean(results[bs]['grad_variances']) for bs in batch_sizes]
    theoretical_variances = [mean_variances[0] / bs for bs in batch_sizes]

    ax.loglog(batch_sizes, mean_variances, 'o-', label='å®é™…æ–¹å·®', linewidth=2)
    ax.loglog(batch_sizes, theoretical_variances, '--', label='ç†è®º (âˆ1/B)', linewidth=2)
    ax.set_xlabel('æ‰¹é‡å¤§å°')
    ax.set_ylabel('æ¢¯åº¦æ–¹å·®')
    ax.set_title('æ¢¯åº¦ä¼°è®¡çš„æ–¹å·®')
    ax.legend()
    ax.grid(True, alpha=0.3)

    # 2. æ”¶æ•›æ›²çº¿
    ax = axes[0, 1]
    for bs in batch_sizes:
        ax.semilogy(results[bs]['losses'], label=f'B={bs}', linewidth=2)
    ax.set_xlabel('è¿­ä»£æ¬¡æ•°')
    ax.set_ylabel('æŸå¤±å€¼ (log scale)')
    ax.set_title('ä¸åŒæ‰¹é‡å¤§å°çš„æ”¶æ•›æ›²çº¿')
    ax.legend()
    ax.grid(True, alpha=0.3)

    # 3. æ¢¯åº¦èŒƒæ•°æ¼”åŒ–
    ax = axes[1, 0]
    for bs in [1, 16, 256]:  # é€‰æ‹©å‡ ä¸ªä»£è¡¨æ€§çš„
        ax.plot(results[bs]['grad_norms'], label=f'B={bs}', linewidth=2)
    ax.set_xlabel('è¿­ä»£æ¬¡æ•°')
    ax.set_ylabel('æ¢¯åº¦èŒƒæ•°')
    ax.set_title('æ¢¯åº¦èŒƒæ•°çš„æ¼”åŒ–')
    ax.legend()
    ax.grid(True, alpha=0.3)

    # 4. ä¿¡å™ªæ¯”åˆ†æ
    ax = axes[1, 1]
    snr_values = []
    for bs in batch_sizes:
        # ä¿¡å™ªæ¯” = æ¢¯åº¦èŒƒæ•°Â² / æ¢¯åº¦æ–¹å·®
        norms = np.array(results[bs]['grad_norms'][10:])  # è·³è¿‡åˆå§‹é˜¶æ®µ
        variances = np.array(results[bs]['grad_variances'][10:])
        snr = np.mean(norms ** 2 / variances)
        snr_values.append(snr)

    ax.loglog(batch_sizes, snr_values, 'o-', linewidth=2)
    ax.set_xlabel('æ‰¹é‡å¤§å°')
    ax.set_ylabel('ä¿¡å™ªæ¯”')
    ax.set_title('æ¢¯åº¦ä¿¡å™ªæ¯” vs æ‰¹é‡å¤§å°')
    ax.grid(True, alpha=0.3)

    plt.tight_layout()
    plt.show()

    # æ‰“å°åˆ†æ
    print("\n=== æ‰¹é‡å¤§å°ä¸å™ªå£°åˆ†æ ===")
    print("æ‰¹é‡å¤§å° | å¹³å‡æ¢¯åº¦æ–¹å·® | æœ€ç»ˆæŸå¤±")
    print("-" * 40)
    for bs in batch_sizes:
        avg_var = np.mean(results[bs]['grad_variances'])
        final_loss = results[bs]['losses'][-1]
        print(f"{bs:8d} | {avg_var:.6f} | {final_loss:.6f}")


# å­¦ä¹ ç‡èŒƒå›´æµ‹è¯•
def learning_rate_range_test():
    """
    å®ç°å­¦ä¹ ç‡èŒƒå›´æµ‹è¯•ï¼Œæ‰¾åˆ°æœ€ä¼˜å­¦ä¹ ç‡
    """

    # ç”Ÿæˆæµ‹è¯•é—®é¢˜
    np.random.seed(42)
    n_samples = 1000
    n_features = 20

    X = np.random.randn(n_samples, n_features)
    true_w = np.random.randn(n_features)
    y = X @ true_w + 0.5 * np.random.randn(n_samples)

    # å®šä¹‰æ¨¡å‹å’ŒæŸå¤±
    def forward_and_loss(X, y, w):
        pred = X @ w
        loss = 0.5 * np.mean((pred - y) ** 2)
        grad = X.T @ (pred - y) / len(y)
        return loss, grad

    # å­¦ä¹ ç‡èŒƒå›´
    min_lr = 1e-4
    max_lr = 1.0
    num_iterations = 200

    lrs = np.logspace(np.log10(min_lr), np.log10(max_lr), num_iterations)
    losses = []

    # åˆå§‹åŒ–æƒé‡
    w = np.random.randn(n_features) * 0.01

    # é€æ­¥å¢åŠ å­¦ä¹ ç‡
    for i, lr in enumerate(lrs):
        # éšæœºæ‰¹æ¬¡
        batch_size = 32
        indices = np.random.choice(n_samples, batch_size)
        X_batch = X[indices]
        y_batch = y[indices]

        # è®¡ç®—æŸå¤±å’Œæ¢¯åº¦
        loss, grad = forward_and_loss(X_batch, y_batch, w)
        losses.append(loss)

        # æ›´æ–°æƒé‡
        w = w - lr * grad

        # å¦‚æœæŸå¤±çˆ†ç‚¸ï¼Œåœæ­¢
        if loss > 1e6 or np.isnan(loss):
            losses = losses[:i+1]
            lrs = lrs[:i+1]
            break

    # å¹³æ»‘æŸå¤±æ›²çº¿
    window_size = 5
    smoothed_losses = np.convolve(losses, np.ones(window_size)/window_size, mode='valid')

    # æ‰¾åˆ°æœ€ä½³å­¦ä¹ ç‡ï¼ˆæŸå¤±ä¸‹é™æœ€å¿«çš„ç‚¹ï¼‰
    loss_gradient = np.gradient(smoothed_losses)
    best_idx = np.argmin(loss_gradient)
    best_lr = lrs[best_idx + window_size//2]

    # å¯è§†åŒ–
    plt.figure(figsize=(10, 6))
    plt.semilogx(lrs, losses, 'b-', alpha=0.3, label='åŸå§‹æŸå¤±')
    plt.semilogx(lrs[window_size//2:-window_size//2+1], smoothed_losses,
                'r-', linewidth=2, label='å¹³æ»‘æŸå¤±')
    plt.axvline(best_lr, color='green', linestyle='--', linewidth=2,
               label=f'å»ºè®®å­¦ä¹ ç‡: {best_lr:.2e}')

    plt.xlabel('å­¦ä¹ ç‡ (log scale)')
    plt.ylabel('æŸå¤±å€¼')
    plt.title('å­¦ä¹ ç‡èŒƒå›´æµ‹è¯•')
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.tight_layout()
    plt.show()

    return best_lr


# æ¼”ç¤ºæ¢¯åº¦è£å‰ªçš„æ•ˆæœ
def gradient_clipping_demo():
    """
    æ¼”ç¤ºæ¢¯åº¦è£å‰ªå¦‚ä½•é˜²æ­¢æ¢¯åº¦çˆ†ç‚¸
    """

    # åˆ›å»ºä¸€ä¸ªå®¹æ˜“æ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜
    np.random.seed(42)

    # RNNé£æ ¼çš„å¾ªç¯è®¡ç®—ï¼ˆå®¹æ˜“çˆ†ç‚¸ï¼‰
    def recurrent_loss(params, sequence_length=20):
        W, b = params
        state = np.zeros(5)
        loss = 0

        for t in range(sequence_length):
            state = np.tanh(W @ state + b)
            loss += np.sum(state ** 2)

        return loss / sequence_length

    # æ•°å€¼æ¢¯åº¦è®¡ç®—
    def numerical_gradient(params, eps=1e-5):
        W, b = params
        grad_W = np.zeros_like(W)
        grad_b = np.zeros_like(b)

        # è®¡ç®—Wçš„æ¢¯åº¦
        for i in range(W.shape[0]):
            for j in range(W.shape[1]):
                W_plus = W.copy()
                W_plus[i, j] += eps
                W_minus = W.copy()
                W_minus[i, j] -= eps

                loss_plus = recurrent_loss([W_plus, b])
                loss_minus = recurrent_loss([W_minus, b])
                grad_W[i, j] = (loss_plus - loss_minus) / (2 * eps)

        # è®¡ç®—bçš„æ¢¯åº¦
        for i in range(b.shape[0]):
            b_plus = b.copy()
            b_plus[i] += eps
            b_minus = b.copy()
            b_minus[i] -= eps

            loss_plus = recurrent_loss([W, b_plus])
            loss_minus = recurrent_loss([W, b_minus])
            grad_b[i] = (loss_plus - loss_minus) / (2 * eps)

        return grad_W, grad_b

    # æ¢¯åº¦è£å‰ªå‡½æ•°
    def clip_gradients(grads, max_norm):
        """æ¢¯åº¦è£å‰ª"""
        total_norm = 0
        for grad in grads:
            total_norm += np.sum(grad ** 2)
        total_norm = np.sqrt(total_norm)

        clip_coef = max_norm / (total_norm + 1e-8)
        clip_coef = min(clip_coef, 1.0)

        return [grad * clip_coef for grad in grads], total_norm

    # åˆå§‹åŒ–å‚æ•°ï¼ˆä½¿ç”¨è¾ƒå¤§çš„å€¼å®¹æ˜“çˆ†ç‚¸ï¼‰
    W = np.random.randn(5, 5) * 2
    b = np.random.randn(5) * 0.1

    # æµ‹è¯•æœ‰æ— æ¢¯åº¦è£å‰ª
    results = {'no_clip': [], 'with_clip': []}

    for method in ['no_clip', 'with_clip']:
        W_curr = W.copy()
        b_curr = b.copy()

        losses = []
        grad_norms = []

        for iteration in range(50):
            # è®¡ç®—æŸå¤±
            loss = recurrent_loss([W_curr, b_curr])
            losses.append(loss)

            # è®¡ç®—æ¢¯åº¦
            grad_W, grad_b = numerical_gradient([W_curr, b_curr])

            # æ¢¯åº¦è£å‰ª
            if method == 'with_clip':
                grads, norm = clip_gradients([grad_W, grad_b], max_norm=1.0)
                grad_W, grad_b = grads
            else:
                norm = np.sqrt(np.sum(grad_W ** 2) + np.sum(grad_b ** 2))

            grad_norms.append(norm)

            # æ›´æ–°å‚æ•°
            lr = 0.01
            W_curr -= lr * grad_W
            b_curr -= lr * grad_b

            # æ£€æŸ¥æ˜¯å¦çˆ†ç‚¸
            if np.isnan(loss) or loss > 1e10:
                print(f"{method}: æ¢¯åº¦çˆ†ç‚¸åœ¨ç¬¬ {iteration} æ­¥!")
                break

        results[method] = {
            'losses': losses,
            'grad_norms': grad_norms
        }

    # å¯è§†åŒ–
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(15, 5))

    # æŸå¤±æ›²çº¿
    ax1.semilogy(results['no_clip']['losses'], 'r-', label='æ— æ¢¯åº¦è£å‰ª', linewidth=2)
    ax1.semilogy(results['with_clip']['losses'], 'b-', label='æœ‰æ¢¯åº¦è£å‰ª', linewidth=2)
    ax1.set_xlabel('è¿­ä»£æ¬¡æ•°')
    ax1.set_ylabel('æŸå¤±å€¼ (log scale)')
    ax1.set_title('æ¢¯åº¦è£å‰ªå¯¹è®­ç»ƒç¨³å®šæ€§çš„å½±å“')
    ax1.legend()
    ax1.grid(True, alpha=0.3)

    # æ¢¯åº¦èŒƒæ•°
    ax2.semilogy(results['no_clip']['grad_norms'], 'r-', label='æ— æ¢¯åº¦è£å‰ª', linewidth=2)
    ax2.semilogy(results['with_clip']['grad_norms'], 'b-', label='æœ‰æ¢¯åº¦è£å‰ª', linewidth=2)
    ax2.axhline(y=1.0, color='green', linestyle='--', label='è£å‰ªé˜ˆå€¼')
    ax2.set_xlabel('è¿­ä»£æ¬¡æ•°')
    ax2.set_ylabel('æ¢¯åº¦èŒƒæ•° (log scale)')
    ax2.set_title('æ¢¯åº¦èŒƒæ•°çš„æ¼”åŒ–')
    ax2.legend()
    ax2.grid(True, alpha=0.3)

    plt.tight_layout()
    plt.show()


if __name__ == "__main__":
    print("=== NumPyä¼˜åŒ–å™¨å®ç°ä¸åˆ†æ ===\n")

    # 1. 2Dä¼˜åŒ–å¯è§†åŒ–
    print("1. åœ¨2Då‡½æ•°ä¸Šæ¯”è¾ƒä¸åŒä¼˜åŒ–å™¨...")
    visualize_optimization_2d()

    # 2. æ‰¹é‡å¤§å°ä¸å™ªå£°åˆ†æ
    print("\n2. åˆ†ææ‰¹é‡å¤§å°å¯¹æ¢¯åº¦å™ªå£°çš„å½±å“...")
    batch_size_noise_analysis()

    # 3. å­¦ä¹ ç‡èŒƒå›´æµ‹è¯•
    print("\n3. æ‰§è¡Œå­¦ä¹ ç‡èŒƒå›´æµ‹è¯•...")
    best_lr = learning_rate_range_test()
    print(f"æ‰¾åˆ°çš„æœ€ä½³å­¦ä¹ ç‡: {best_lr:.4e}")

    # 4. æ¢¯åº¦è£å‰ªæ¼”ç¤º
    print("\n4. æ¼”ç¤ºæ¢¯åº¦è£å‰ªçš„æ•ˆæœ...")
    gradient_clipping_demo()

    print("\nåˆ†æå®Œæˆï¼")</code></pre>
                </div>
            </div>

            <!-- ä¼˜åŒ–æœ€ä½³å®è·µæ€»ç»“ -->
            <div class="tip success mt-4">
                <span class="tip-icon">ğŸ¯</span>
                <div class="tip-content">
                    <strong>ä¼˜åŒ–ç®—æ³•é€‰æ‹©æŒ‡å—ï¼š</strong><br>
                    â€¢ <strong>é»˜è®¤é€‰æ‹©</strong>ï¼šAdam (lr=0.001) æˆ– AdamWï¼ˆå¸¦L2æ­£åˆ™ï¼‰<br>
                    â€¢ <strong>ç²¾ç»†è°ƒä¼˜</strong>ï¼šSGD + Momentum + å­¦ä¹ ç‡è°ƒåº¦<br>
                    â€¢ <strong>å¤§æ‰¹é‡è®­ç»ƒ</strong>ï¼šLAMB æˆ– LARS<br>
                    â€¢ <strong>äºŒé˜¶ä¿¡æ¯</strong>ï¼šL-BFGSï¼ˆå°è§„æ¨¡ï¼‰æˆ– K-FACï¼ˆç‰¹å®šä»»åŠ¡ï¼‰<br>
                    â€¢ <strong>å…³é”®è¶…å‚æ•°</strong>ï¼šå­¦ä¹ ç‡ > æ‰¹é‡å¤§å° > å…¶ä»–
                </div>
            </div>

            <!-- å¸¸è§ä¼˜åŒ–é™·é˜± -->
            <div class="common-mistakes mt-4">
                <h3 style="color: var(--accent-red); margin-bottom: 1rem;">âš ï¸ ä¼˜åŒ–ä¸­çš„å¸¸è§é™·é˜±</h3>

                <div class="mistake-item">
                    <div class="mistake-icon">ğŸ¢</div>
                    <div class="mistake-content">
                        <h4>å­¦ä¹ ç‡è¿‡å¤§</h4>
                        <p>ç—‡çŠ¶ï¼šæŸå¤±éœ‡è¡æˆ–å‘æ•£</p>
                        <p>è§£å†³ï¼šé™ä½å­¦ä¹ ç‡ï¼Œä½¿ç”¨é¢„çƒ­ï¼Œæˆ–å°è¯•æ¢¯åº¦è£å‰ª</p>
                    </div>
                </div>

                <div class="mistake-item">
                    <div class="mistake-icon">ğŸŒ</div>
                    <div class="mistake-content">
                        <h4>å­¦ä¹ ç‡è¿‡å°</h4>
                        <p>ç—‡çŠ¶ï¼šæ”¶æ•›ææ…¢ï¼Œé™·å…¥å±€éƒ¨æœ€ä¼˜</p>
                        <p>è§£å†³ï¼šå¢å¤§å­¦ä¹ ç‡ï¼Œä½¿ç”¨è‡ªé€‚åº”ä¼˜åŒ–å™¨ï¼Œæˆ–å¾ªç¯å­¦ä¹ ç‡</p>
                    </div>
                </div>

                <div class="mistake-item">
                    <div class="mistake-icon">ğŸ’¥</div>
                    <div class="mistake-content">
                        <h4>æ‰¹é‡è¿‡å¤§å¯¼è‡´æ³›åŒ–å·®</h4>
                        <p>ç—‡çŠ¶ï¼šè®­ç»ƒç²¾åº¦é«˜ä½†æµ‹è¯•ç²¾åº¦ä½</p>
                        <p>è§£å†³ï¼šå‡å°æ‰¹é‡ï¼Œå¢åŠ å™ªå£°ï¼ˆDropoutï¼‰ï¼Œæˆ–ä½¿ç”¨ç‰¹æ®Šä¼˜åŒ–å™¨</p>
                    </div>
                </div>
            </div>

            <!-- æ·±å…¥é˜…è¯»æ¨è -->
            <div class="section-card" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1)); margin-top: 2rem;">
                <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ“š æ·±å…¥é˜…è¯»æ¨è</h3>

                <div class="concept-grid">
                    <div class="concept-card what">
                        <h3>ç†è®ºåŸºç¡€</h3>
                        <ul style="font-size: 0.9rem; line-height: 1.8;">
                            <li>Convex Optimization - Boyd</li>
                            <li>Optimization for ML - Bottou</li>
                            <li>Deep Learning - Goodfellow</li>
                        </ul>
                    </div>
                    <div class="concept-card how">
                        <h3>ç»å…¸è®ºæ–‡</h3>
                        <ul style="font-size: 0.9rem; line-height: 1.8;">
                            <li>Adam: Kingma & Ba 2014</li>
                            <li>Lookahead: Zhang 2019</li>
                            <li>RAdam: Liu 2019</li>
                        </ul>
                    </div>
                    <div class="concept-card why">
                        <h3>å®è·µæŒ‡å—</h3>
                        <ul style="font-size: 0.9rem; line-height: 1.8;">
                            <li>Tricks for Training - Bengio</li>
                            <li>Super-Convergence - Smith</li>
                            <li>Large Batch Training</li>
                        </ul>
                    </div>
                    <div class="concept-card pitfall">
                        <h3>å‰æ²¿ç ”ç©¶</h3>
                        <ul style="font-size: 0.9rem; line-height: 1.8;">
                            <li>Sharpness-Aware Min</li>
                            <li>Loss Landscape</li>
                            <li>Neural Tangent Kernel</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        <!-- å®ç”¨æŠ€å·§ä¸ç»éªŒ -->
        <section id="tricks" class="section-card">
            <h2 style="color: var(--accent-green); margin-bottom: 1.5rem;">
                ğŸ› ï¸ å®ç”¨æŠ€å·§ä¸ç»éªŒ
                <span class="depth-indicator beginner">åˆå­¦è€…</span>
            </h2>

            <!-- æŠ€å·§é›†é”¦ -->
            <div class="concept-grid">
                <div class="concept-card what">
                    <h3 style="color: var(--accent-green);">ğŸ¯ åˆå§‹åŒ–æŠ€å·§</h3>
                    <ul style="line-height: 1.8;">
                        <li><strong>Heåˆå§‹åŒ–</strong>ï¼šReLUç½‘ç»œé¦–é€‰</li>
                        <li><strong>Xavieråˆå§‹åŒ–</strong>ï¼šSigmoid/Tanh</li>
                        <li><strong>LSUV</strong>ï¼šé€å±‚æ ‡å‡†åŒ–åˆå§‹åŒ–</li>
                        <li><strong>é¢„è®­ç»ƒåˆå§‹åŒ–</strong>ï¼šè¿ç§»å­¦ä¹ </li>
                    </ul>
                </div>
                <div class="concept-card how">
                    <h3 style="color: var(--accent-blue);">ğŸ“ˆ è®­ç»ƒæŠ€å·§</h3>
                    <ul style="line-height: 1.8;">
                        <li><strong>å­¦ä¹ ç‡é¢„çƒ­</strong>ï¼šé¿å…åˆæœŸéœ‡è¡</li>
                        <li><strong>ä½™å¼¦é€€ç«</strong>ï¼šå¹³æ»‘é™ä½å­¦ä¹ ç‡</li>
                        <li><strong>æ ‡ç­¾å¹³æ»‘</strong>ï¼šé˜²æ­¢è¿‡åº¦è‡ªä¿¡</li>
                        <li><strong>æ··åˆç²¾åº¦</strong>ï¼šåŠ é€Ÿè®­ç»ƒ</li>
                    </ul>
                </div>
                <div class="concept-card why">
                    <h3 style="color: var(--accent-red);">ğŸ”§ è°ƒè¯•æŠ€å·§</h3>
                    <ul style="line-height: 1.8;">
                        <li><strong>æ¢¯åº¦æ£€æŸ¥</strong>ï¼šéªŒè¯åå‘ä¼ æ’­</li>
                        <li><strong>è¿‡æ‹Ÿåˆå•æ‰¹</strong>ï¼šæ£€æŸ¥æ¨¡å‹èƒ½åŠ›</li>
                        <li><strong>å¯è§†åŒ–æ¿€æ´»</strong>ï¼šå‘ç°æ­»ç¥ç»å…ƒ</li>
                        <li><strong>ç›‘æ§ç»Ÿè®¡</strong>ï¼šå‡å€¼ã€æ–¹å·®ç­‰</li>
                    </ul>
                </div>
                <div class="concept-card pitfall">
                    <h3 style="color: var(--accent-yellow);">âš¡ ä¼˜åŒ–æŠ€å·§</h3>
                    <ul style="line-height: 1.8;">
                        <li><strong>æ‰¹å¤§å°è°ƒæ•´</strong>ï¼šå¹³è¡¡é€Ÿåº¦å’Œç¨³å®šæ€§</li>
                        <li><strong>æ¢¯åº¦ç´¯ç§¯</strong>ï¼šæ¨¡æ‹Ÿå¤§æ‰¹é‡</li>
                        <li><strong>æ•°æ®å¹¶è¡Œ</strong>ï¼šå¤šGPUè®­ç»ƒ</li>
                        <li><strong>é‡åŒ–æ„ŸçŸ¥è®­ç»ƒ</strong>ï¼šéƒ¨ç½²ä¼˜åŒ–</li>
                    </ul>
                </div>
            </div>

            <!-- å®è·µå»ºè®® -->
            <div class="tip success mt-4">
                <span class="tip-icon">ğŸ’¡</span>
                <div class="tip-content">
                    <strong>MLPè®¾è®¡çš„é»„é‡‘æ³•åˆ™ï¼š</strong><br>
                    1. <strong>ä»ç®€å•å¼€å§‹</strong>ï¼šå…ˆè¯•3å±‚ï¼Œé€æ­¥åŠ æ·±<br>
                    2. <strong>ç›‘æ§æ¢¯åº¦</strong>ï¼šç¡®ä¿å¥åº·çš„æ¢¯åº¦æµ<br>
                    3. <strong>æ­£åˆ™åŒ–ç»„åˆ</strong>ï¼šDropout + L2 + BatchNorm<br>
                    4. <strong>è€å¿ƒè°ƒå‚</strong>ï¼šå­¦ä¹ ç‡æ˜¯æœ€é‡è¦çš„è¶…å‚æ•°<br>
                    5. <strong>è®°å½•ä¸€åˆ‡</strong>ï¼šå®éªŒæ—¥å¿—å¾ˆé‡è¦
                </div>
            </div>

            <!-- å¸¸è§é—®é¢˜è¯Šæ–­ -->
            <div class="common-mistakes mt-4">
                <h3 style="color: var(--accent-red); margin-bottom: 1rem;">ğŸ” é—®é¢˜è¯Šæ–­æ¸…å•</h3>

                <div class="mistake-item">
                    <div class="mistake-icon">ğŸ“‰</div>
                    <div class="mistake-content">
                        <h4>è®­ç»ƒæŸå¤±ä¸ä¸‹é™</h4>
                        <ul>
                            <li>æ£€æŸ¥å­¦ä¹ ç‡ï¼ˆå¯èƒ½å¤ªå¤§æˆ–å¤ªå°ï¼‰</li>
                            <li>éªŒè¯æ•°æ®é¢„å¤„ç†</li>
                            <li>ç¡®è®¤æŸå¤±å‡½æ•°æ­£ç¡®</li>
                            <li>å°è¯•æ›´ç®€å•çš„æ¨¡å‹</li>
                        </ul>
                    </div>
                </div>

                <div class="mistake-item">
                    <div class="mistake-icon">ğŸ“ˆ</div>
                    <div class="mistake-content">
                        <h4>éªŒè¯æ€§èƒ½å·®</h4>
                        <ul>
                            <li>å¯èƒ½è¿‡æ‹Ÿåˆï¼šåŠ å¼ºæ­£åˆ™åŒ–</li>
                            <li>æ•°æ®ä¸å¤Ÿï¼šæ•°æ®å¢å¼º</li>
                            <li>æ¨¡å‹å¤ªå¤æ‚ï¼šç®€åŒ–æ¶æ„</li>
                            <li>ç‰¹å¾é—®é¢˜ï¼šæ£€æŸ¥è¾“å…¥</li>
                        </ul>
                    </div>
                </div>

                <div class="mistake-item">
                    <div class="mistake-icon">ğŸŒ</div>
                    <div class="mistake-content">
                        <h4>è®­ç»ƒå¤ªæ…¢</h4>
                        <ul>
                            <li>æ‰¹é‡å¤§å°å¤ªå°</li>
                            <li>æ•°æ®åŠ è½½ç“¶é¢ˆ</li>
                            <li>æœªä½¿ç”¨GPU</li>
                            <li>æ¨¡å‹å¤ªå¤§</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ€»ç»“ -->
        <section id="summary" class="section-card">
            <h2 style="color: var(--accent-purple); margin-bottom: 1.5rem;">
                ğŸ“ æ€»ç»“ï¼šè¡¨è¾¾åŠ›çš„è‰ºæœ¯
            </h2>

            <!-- æ ¸å¿ƒè¦ç‚¹ -->
            <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1)); padding: 2rem; border-radius: 1rem; margin-bottom: 2rem;">
                <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ¯ æœ¬ç« æ ¸å¿ƒè¦ç‚¹</h3>

                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem;">
                    <div>
                        <h4 style="color: var(--accent-green); margin-bottom: 1rem;">âœ… æˆ‘ä»¬å­¦åˆ°äº†</h4>
                        <ul style="line-height: 2;">
                            <li>éçº¿æ€§æ¿€æ´»å‡½æ•°èµ‹äºˆç½‘ç»œè¡¨è¾¾å¤æ‚æ¨¡å¼çš„èƒ½åŠ›</li>
                            <li>é€šç”¨é€¼è¿‘å®šç†ä¿è¯äº†ç½‘ç»œçš„ç†è®ºèƒ½åŠ›</li>
                            <li>ä¸åŒæ¿€æ´»å‡½æ•°å„æœ‰ç‰¹è‰²å’Œé€‚ç”¨åœºæ™¯</li>
                            <li>æ·±åº¦vså®½åº¦æ˜¯æ•ˆç‡vsç®€å•çš„æƒè¡¡</li>
                            <li>æ¢¯åº¦é—®é¢˜æœ‰å¤šç§è§£å†³æ–¹æ¡ˆ</li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">ğŸ”‘ å…³é”®è§è§£</h4>
                        <ul style="line-height: 2;">
                            <li>çº¿æ€§çš„ç»„åˆè¿˜æ˜¯çº¿æ€§ï¼Œå¿…é¡»æœ‰éçº¿æ€§</li>
                            <li>ReLUç®€å•é«˜æ•ˆï¼Œæ˜¯å¾ˆå¥½çš„é»˜è®¤é€‰æ‹©</li>
                            <li>æ·±åº¦ç½‘ç»œéœ€è¦ç‰¹æ®ŠæŠ€å·§æ¥è®­ç»ƒ</li>
                            <li>ä¸åŒä»»åŠ¡éœ€è¦ä¸åŒçš„ç½‘ç»œè®¾è®¡</li>
                            <li>å®è·µä¸­çš„æŠ€å·§å’Œç†è®ºåŒæ ·é‡è¦</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- æ€ç»´å¯¼å›¾ -->
            <div style="text-align: center; margin: 2rem 0;">
                <h4 style="color: var(--accent-yellow); margin-bottom: 1rem;">MLPçŸ¥è¯†ä½“ç³»</h4>
                <canvas id="mindmap-canvas" width="800" height="600"></canvas>
            </div>

            <!-- ä¸‹ä¸€æ­¥å­¦ä¹  -->
            <div class="learning-path">
                <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸš€ æ¥ä¸‹æ¥å­¦ä»€ä¹ˆï¼Ÿ</h3>

                <div class="path-item">
                    <div class="path-icon">ğŸ¯</div>
                    <div class="path-content">
                        <h4>ä¼˜åŒ–ç®—æ³•</h4>
                        <p>SGDã€Adamã€RMSprop...å¦‚ä½•æ›´å¥½åœ°è®­ç»ƒç½‘ç»œ</p>
                    </div>
                </div>
                <div class="path-item">
                    <div class="path-icon">ğŸ—ï¸</div>
                    <div class="path-content">
                        <h4>å·ç§¯ç¥ç»ç½‘ç»œ</h4>
                        <p>ä¸“é—¨ä¸ºå›¾åƒè®¾è®¡çš„ç½‘ç»œæ¶æ„</p>
                    </div>
                </div>
                <div class="path-item">
                    <div class="path-icon">ğŸ”„</div>
                    <div class="path-content">
                        <h4>å¾ªç¯ç¥ç»ç½‘ç»œ</h4>
                        <p>å¤„ç†åºåˆ—æ•°æ®çš„ä¸“é—¨æ¶æ„</p>
                    </div>
                </div>
                <div class="path-item">
                    <div class="path-icon">ğŸ¤–</div>
                    <div class="path-content">
                        <h4>Transformer</h4>
                        <p>ç°ä»£NLPå’Œå¤šæ¨¡æ€AIçš„åŸºç¡€</p>
                    </div>
                </div>
            </div>

            <!-- å®è·µå»ºè®® -->
            <div class="tip info mt-4">
                <span class="tip-icon">ğŸ“</span>
                <div class="tip-content">
                    <strong>ç»§ç»­å­¦ä¹ çš„å»ºè®®ï¼š</strong><br>
                    1. <strong>åŠ¨æ‰‹å®è·µ</strong>ï¼šç”¨MLPè§£å†³ä¸€ä¸ªçœŸå®é—®é¢˜<br>
                    2. <strong>å¯¹æ¯”å®éªŒ</strong>ï¼šå°è¯•ä¸åŒçš„æ¿€æ´»å‡½æ•°å’Œæ¶æ„<br>
                    3. <strong>é˜…è¯»è®ºæ–‡</strong>ï¼šäº†è§£æœ€æ–°çš„æ¿€æ´»å‡½æ•°ç ”ç©¶<br>
                    4. <strong>å‚ä¸ç«èµ›</strong>ï¼šKaggleç­‰å¹³å°ç»ƒæ‰‹<br>
                    5. <strong>å¼€æºè´¡çŒ®</strong>ï¼šæ”¹è¿›ç°æœ‰çš„MLPå®ç°
                </div>
            </div>

            <!-- ç»“è¯­ -->
            <div style="background: var(--primary-gradient); padding: 2rem; border-radius: 1rem; margin-top: 2rem; color: white; text-align: center;">
                <h3 style="margin-bottom: 1rem;">ğŸŠ æ­å–œå®Œæˆæœ¬ç« ï¼</h3>
                <p style="font-size: 1.1rem; opacity: 0.9; max-width: 800px; margin: 0 auto;">
                    ä½ å·²ç»æŒæ¡äº†æ·±åº¦å­¦ä¹ ä¸­æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„ç»„ä»¶â€”â€”å¤šå±‚æ„ŸçŸ¥æœºã€‚
                    ä»çº¿æ€§åˆ°éçº¿æ€§ï¼Œä»æµ…å±‚åˆ°æ·±å±‚ï¼Œä½ ç†è§£äº†ç¥ç»ç½‘ç»œè·å¾—å¼ºå¤§è¡¨è¾¾èƒ½åŠ›çš„ç§˜å¯†ã€‚
                    æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç»§ç»­æ¢ç´¢æ›´å¤šæ¿€åŠ¨äººå¿ƒçš„ç½‘ç»œæ¶æ„ï¼
                </p>
                <button class="btn" style="background: white; color: var(--accent-purple); margin-top: 1.5rem;" onclick="location.href='#'" tabindex="0">
                    ç»§ç»­ä¸‹ä¸€ç«  â†’
                </button>
            </div>
        </section>

        <!-- å­¦ä¹ åé¦ˆ -->
        <section class="section-card">
            <h2 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ’¬ å­¦ä¹ åé¦ˆ</h2>
            <div style="text-align: center;">
                <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">è¿™ä¸€ç« çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©å—ï¼Ÿ</p>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn btn-secondary" onclick="submitFeedback('helpful')" tabindex="0">
                        ğŸ‘ å¾ˆæœ‰å¸®åŠ©
                    </button>
                    <button class="btn btn-secondary" onclick="submitFeedback('ok')" tabindex="0">
                        ğŸ˜ è¿˜å¯ä»¥
                    </button>
                    <button class="btn btn-secondary" onclick="submitFeedback('confusing')" tabindex="0">
                        ğŸ˜• æœ‰ç‚¹å›°æƒ‘
                    </button>
                </div>
                <div id="feedback-response" style="margin-top: 1rem; display: none;">
                    <p style="color: var(--accent-green);">æ„Ÿè°¢ä½ çš„åé¦ˆï¼æˆ‘ä»¬ä¼šç»§ç»­æ”¹è¿›ã€‚</p>
                </div>
            </div>
        </section>
    </div>
</main>

<!-- JavaScriptä»£ç  -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<script>
    // åˆå§‹åŒ–ä»£ç é«˜äº®
    hljs.highlightAll();

    // åˆå§‹åŒ–æ•°å­¦å…¬å¼æ¸²æŸ“
    renderMathInElement(document.body, {
        delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false}
        ]
    });

    // å…¨å±€å˜é‡
    let currentDifficulty = 'beginner';
    let buddyMessages = {
        beginner: [
            "æ¿€æ´»å‡½æ•°å°±åƒè°ƒå‘³æ–™ï¼Œè®©ç½‘ç»œæœ‰äº†'å‘³é“'ï¼",
            "ReLUè™½ç„¶ç®€å•ï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ•ˆæœå¾ˆå¥½ã€‚",
            "è®°ä½ï¼šæ²¡æœ‰æ¿€æ´»å‡½æ•°ï¼Œæ·±åº¦ç½‘ç»œå°±æ˜¯ä¸ªæ‘†è®¾ï¼"
        ],
        intermediate: [
            "æ¢¯åº¦æ¶ˆå¤±æ˜¯æ·±åº¦ç½‘ç»œçš„å¤§æ•Œï¼Œé€‰å¯¹æ¿€æ´»å‡½æ•°å¾ˆé‡è¦ã€‚",
            "æ‰¹å½’ä¸€åŒ–ä¸ä»…åŠ é€Ÿè®­ç»ƒï¼Œè¿˜èƒ½è®©ç½‘ç»œæ›´æ·±ã€‚",
            "æ®‹å·®è¿æ¥æ˜¯æ·±åº¦ç½‘ç»œçš„æ•‘æ˜Ÿï¼"
        ],
        advanced: [
            "GELUåœ¨Transformerä¸­è¡¨ç°ä¼˜å¼‚ï¼Œå€¼å¾—å°è¯•ã€‚",
            "æ¿€æ´»å‡½æ•°çš„é€‰æ‹©ä¼šå½±å“ç½‘ç»œçš„å½’çº³åç½®ã€‚",
            "è‡ªé€‚åº”æ¿€æ´»å‡½æ•°æ˜¯ä¸ªæœ‰è¶£çš„ç ”ç©¶æ–¹å‘ã€‚"
        ]
    };

    // å¯¼èˆªåŠŸèƒ½
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const toggleSidebarBtn = document.getElementById('toggle-sidebar');

    toggleSidebarBtn.addEventListener('click', () => {
        sidebar.classList.toggle('open');
        sidebarOverlay.classList.toggle('active');
    });

    sidebarOverlay.addEventListener('click', () => {
        sidebar.classList.remove('open');
        sidebarOverlay.classList.remove('active');
    });

    // å­¦ä¹ ä¼™ä¼´åŠŸèƒ½
    const learningBuddy = document.getElementById('learning-buddy');
    const toggleBuddyBtn = document.getElementById('toggle-buddy');
    const minimizeBuddyBtn = document.getElementById('minimize-buddy');
    const closeBuddyBtn = document.getElementById('close-buddy');
    const buddyAvatar = document.getElementById('buddy-avatar');

    toggleBuddyBtn.addEventListener('click', () => {
        learningBuddy.classList.toggle('active');
    });

    minimizeBuddyBtn.addEventListener('click', () => {
        learningBuddy.classList.toggle('minimized');
    });

    closeBuddyBtn.addEventListener('click', () => {
        learningBuddy.classList.remove('active');
    });

    buddyAvatar.addEventListener('click', () => {
        if (learningBuddy.classList.contains('minimized')) {
            learningBuddy.classList.remove('minimized');
        }
    });

    // å­¦ä¹ ä¼™ä¼´æç¤ºåŠŸèƒ½
    function getBuddyHint() {
        const messages = buddyMessages[currentDifficulty];
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        updateBuddyMessage(randomMessage);
    }

    function getBuddySummary() {
        const summary = `
        æœ¬ç« æ ¸å¿ƒè¦ç‚¹ï¼š<br>
        1. æ¿€æ´»å‡½æ•°å¼•å…¥éçº¿æ€§ï¼Œèµ‹äºˆç½‘ç»œè¡¨è¾¾åŠ›<br>
        2. é€šç”¨é€¼è¿‘å®šç†ä¿è¯äº†ç†è®ºèƒ½åŠ›<br>
        3. ä¸åŒæ¿€æ´»å‡½æ•°å„æœ‰ä¼˜åŠ£<br>
        4. æ·±åº¦vså®½åº¦æ˜¯ä¸ªé‡è¦æƒè¡¡<br>
        5. æ¢¯åº¦é—®é¢˜éœ€è¦ç‰¹æ®ŠæŠ€å·§è§£å†³
    `;
        updateBuddyMessage(summary);
    }

    function updateBuddyMessage(message) {
        const messageElement = document.querySelector('.buddy-message p');
        messageElement.innerHTML = message;

        // æ·»åŠ åŠ¨ç”»æ•ˆæœ
        messageElement.style.animation = 'none';
        setTimeout(() => {
            messageElement.style.animation = 'fadeIn 0.5s ease';
        }, 10);
    }

    // ä¸»é¢˜åˆ‡æ¢
    const toggleThemeBtn = document.getElementById('toggle-theme');
    toggleThemeBtn.addEventListener('click', () => {
        const currentTheme = document.body.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.body.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    });

    // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);

    // éš¾åº¦é€‰æ‹©åŠŸèƒ½
    const difficultyOptions = document.querySelectorAll('.difficulty-option');
    difficultyOptions.forEach(option => {
        option.addEventListener('click', () => {
            const difficulty = option.querySelector('input').value;
            currentDifficulty = difficulty;

            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            difficultyOptions.forEach(opt => opt.classList.remove('active'));
            option.classList.add('active');

            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            updateContentVisibility(difficulty);

            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(`å·²åˆ‡æ¢åˆ°${option.textContent.trim()}æ¨¡å¼`);
        });
    });

    function updateContentVisibility(difficulty) {
        // æ ¹æ®éš¾åº¦æ˜¾ç¤º/éšè—å†…å®¹
        const beginnerContent = document.querySelectorAll('.beginner-content');
        const intermediateContent = document.querySelectorAll('.intermediate-content');
        const advancedContent = document.querySelectorAll('.advanced-content');

        // é»˜è®¤æ˜¾ç¤ºæ‰€æœ‰åˆå­¦è€…å†…å®¹
        beginnerContent.forEach(el => el.style.display = 'block');

        if (difficulty === 'beginner') {
            intermediateContent.forEach(el => el.style.display = 'none');
            advancedContent.forEach(el => el.style.display = 'none');
        } else if (difficulty === 'intermediate') {
            intermediateContent.forEach(el => el.style.display = 'block');
            advancedContent.forEach(el => el.style.display = 'none');
        } else {
            intermediateContent.forEach(el => el.style.display = 'block');
            advancedContent.forEach(el => el.style.display = 'block');
        }
    }

    // æŠ˜å åŠŸèƒ½
    const collapsibles = document.querySelectorAll('.collapsible-header');
    collapsibles.forEach(header => {
        header.addEventListener('click', () => {
            const collapsible = header.parentElement;
            collapsible.classList.toggle('expanded');
        });

        // é”®ç›˜æ”¯æŒ
        header.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                header.click();
            }
        });
    });

    // æ»šåŠ¨è¿›åº¦æ¡
    function updateProgressBar() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrollPercentage = (scrollTop / scrollHeight) * 100;
        document.getElementById('progress-bar').style.width = scrollPercentage + '%';
    }

    window.addEventListener('scroll', updateProgressBar);

    // å¯¼èˆªé«˜äº®
    const sections = document.querySelectorAll('section[id]');
    const navItems = document.querySelectorAll('.toc-item');

    function updateNavHighlight() {
        const scrollPosition = window.pageYOffset + 100;

        sections.forEach((section, index) => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.offsetHeight;

            if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                navItems.forEach(item => item.classList.remove('active'));
                if (navItems[index]) {
                    navItems[index].classList.add('active');
                }
            }
        });
    }

    window.addEventListener('scroll', updateNavHighlight);

    // æˆå°±ç³»ç»Ÿ
    let completedSections = new Set();
    let achievements = {
        firstActivation: false,
        allActivations: false,
        deepDive: false,
        finishChapter: false
    };

    function checkAchievements() {
        const totalSections = sections.length;
        const completed = completedSections.size;

        if (completed === 1 && !achievements.firstActivation) {
            achievements.firstActivation = true;
            showAchievement("æ¿€æ´»å‡½æ•°åˆæ¢", "äº†è§£äº†ç¬¬ä¸€ä¸ªæ¿€æ´»å‡½æ•°ï¼");
        }

        if (completed === totalSections && !achievements.finishChapter) {
            achievements.finishChapter = true;
            showAchievement("MLPå¤§å¸ˆ", "å®Œæˆäº†å¤šå±‚æ„ŸçŸ¥æœºçš„å­¦ä¹ ï¼");
        }

        updateAchievementProgress(completed, totalSections);
    }

    function showAchievement(title, description) {
        const popup = document.getElementById('achievement-popup');
        const textElement = document.getElementById('achievement-text');

        textElement.textContent = description;
        popup.classList.add('show');

        setTimeout(() => {
            popup.classList.remove('show');
        }, 5000);
    }

    function updateAchievementProgress(completed, total) {
        const progress = (completed / total) * 100;
        document.getElementById('achievement-progress').style.width = progress + '%';
        document.getElementById('achievement-count').textContent = completed;
    }

    // XORå¯è§†åŒ–
    class XORVisualizer {
        constructor() {
            this.canvas = document.getElementById('xor-canvas');
            this.ctx = this.canvas.getContext('2d');
            this.width = this.canvas.width;
            this.height = this.canvas.height;
            this.layers = 1;

            // XORæ•°æ®
            this.data = [
                {x: [0, 0], y: 0, color: '#ef4444'},
                {x: [0, 1], y: 1, color: '#3b82f6'},
                {x: [1, 0], y: 1, color: '#3b82f6'},
                {x: [1, 1], y: 0, color: '#ef4444'}
            ];

            this.draw();
        }

        draw() {
            this.ctx.clearRect(0, 0, this.width, this.height);

            // ç»˜åˆ¶åæ ‡è½´
            this.drawAxes();

            // ç»˜åˆ¶å†³ç­–è¾¹ç•Œï¼ˆå¦‚æœæ˜¯å¤šå±‚ï¼‰
            if (this.layers > 1) {
                this.drawDecisionBoundary();
            }

            // ç»˜åˆ¶æ•°æ®ç‚¹
            this.drawDataPoints();

            // ç»˜åˆ¶è¯´æ˜æ–‡å­—
            this.drawInfo();
        }

        drawAxes() {
            this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            this.ctx.lineWidth = 1;

            // xè½´
            this.ctx.beginPath();
            this.ctx.moveTo(50, this.height - 50);
            this.ctx.lineTo(this.width - 50, this.height - 50);
            this.ctx.stroke();

            // yè½´
            this.ctx.beginPath();
            this.ctx.moveTo(50, 50);
            this.ctx.lineTo(50, this.height - 50);
            this.ctx.stroke();

            // æ ‡ç­¾
            this.ctx.fillStyle = '#f1f5f9';
            this.ctx.font = '14px Arial';
            this.ctx.fillText('0', 45, this.height - 35);
            this.ctx.fillText('1', this.width - 55, this.height - 35);
            this.ctx.fillText('0', 35, this.height - 45);
            this.ctx.fillText('1', 35, 55);
            this.ctx.fillText('xâ‚', this.width - 40, this.height - 45);
            this.ctx.fillText('xâ‚‚', 45, 40);
        }

        drawDataPoints() {
            const scale = this.width - 100;

            this.data.forEach(point => {
                const x = 50 + point.x[0] * scale;
                const y = this.height - 50 - point.x[1] * scale;

                this.ctx.fillStyle = point.color;
                this.ctx.strokeStyle = '#1f2937';
                this.ctx.lineWidth = 3;

                this.ctx.beginPath();
                this.ctx.arc(x, y, 15, 0, Math.PI * 2);
                this.ctx.fill();
                this.ctx.stroke();

                // æ ‡æ³¨
                this.ctx.fillStyle = '#f1f5f9';
                this.ctx.font = '12px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(`(${point.x[0]},${point.x[1]})`, x, y + 30);
            });
        }

        drawDecisionBoundary() {
            if (this.layers === 2) {
                // ä¸¤å±‚ç½‘ç»œå¯ä»¥ç”»å‡ºXORçš„å†³ç­–è¾¹ç•Œ
                this.ctx.strokeStyle = '#22c55e';
                this.ctx.lineWidth = 3;

                // ç¬¬ä¸€æ¡çº¿
                this.ctx.beginPath();
                this.ctx.moveTo(50, this.height - 100);
                this.ctx.lineTo(100, this.height - 50);
                this.ctx.stroke();

                // ç¬¬äºŒæ¡çº¿
                this.ctx.beginPath();
                this.ctx.moveTo(this.width - 100, this.height - 50);
                this.ctx.lineTo(this.width - 50, this.height - 100);
                this.ctx.stroke();
            }
        }

        drawInfo() {
            this.ctx.fillStyle = '#f1f5f9';
            this.ctx.font = '16px Arial';
            this.ctx.textAlign = 'center';

            if (this.layers === 1) {
                this.ctx.fillText('å•å±‚æ„ŸçŸ¥æœºï¼šæ— æ³•ç”¨ä¸€æ¡ç›´çº¿åˆ†å¼€ï¼', this.width / 2, 30);
            } else {
                this.ctx.fillText('å¤šå±‚ç½‘ç»œï¼šå¯ä»¥å­¦ä¹ éçº¿æ€§è¾¹ç•Œï¼', this.width / 2, 30);
            }
        }

        addLayer() {
            this.layers = Math.min(this.layers + 1, 2);
            this.draw();
            return this.layers;
        }

        reset() {
            this.layers = 1;
            this.draw();
        }
    }

    const xorViz = new XORVisualizer();

    function addLayer() {
        const layers = xorViz.addLayer();
        document.getElementById('layer-count').textContent = layers;

        if (layers === 2) {
            showNotification('ğŸ‰ æˆåŠŸï¼å¤šå±‚ç½‘ç»œå¯ä»¥è§£å†³XORé—®é¢˜ï¼');
        }
    }

    function resetXOR() {
        xorViz.reset();
        document.getElementById('layer-count').textContent = '1';
    }

    // æ¨¡å¼ç”Ÿæˆå™¨
    class PatternGenerator {
        constructor() {
            this.canvas = document.getElementById('pattern-canvas');
            this.ctx = this.canvas.getContext('2d');
            this.width = this.canvas.width;
            this.height = this.canvas.height;

            this.generatePattern();
        }

        generatePattern() {
            const pattern = document.getElementById('pattern-select').value;
            const noise = parseInt(document.getElementById('noise-slider').value) / 100;

            this.data = this.createPattern(pattern, noise);
            this.draw();
            this.updateAccuracy();
        }

        createPattern(type, noise) {
            const data = [];
            const n = 200;

            switch(type) {
                case 'xor':
                    // XORæ¨¡å¼
                    for (let i = 0; i < n; i++) {
                        const x = Math.random() * 2 - 1;
                        const y = Math.random() * 2 - 1;
                        const label = (x > 0 && y > 0) || (x < 0 && y < 0) ? 1 : -1;
                        data.push({
                            x: x + (Math.random() - 0.5) * noise,
                            y: y + (Math.random() - 0.5) * noise,
                            label: label
                        });
                    }
                    break;

                case 'circles':
                    // åŒå¿ƒåœ†
                    for (let i = 0; i < n; i++) {
                        const angle = Math.random() * 2 * Math.PI;
                        const r = i < n/2 ? 0.3 : 0.7;
                        const x = r * Math.cos(angle) + (Math.random() - 0.5) * noise;
                        const y = r * Math.sin(angle) + (Math.random() - 0.5) * noise;
                        data.push({
                            x: x,
                            y: y,
                            label: i < n/2 ? 1 : -1
                        });
                    }
                    break;

                case 'spiral':
                    // èºæ—‹çº¿
                    for (let i = 0; i < n; i++) {
                        const t = i / n * 4 * Math.PI;
                        const r = t / (4 * Math.PI) * 0.8;
                        const label = i < n/2 ? 1 : -1;
                        const offset = label > 0 ? 0 : Math.PI;
                        const x = r * Math.cos(t + offset) + (Math.random() - 0.5) * noise;
                        const y = r * Math.sin(t + offset) + (Math.random() - 0.5) * noise;
                        data.push({x, y, label});
                    }
                    break;

                case 'moons':
                    // æœˆç‰™å½¢
                    for (let i = 0; i < n; i++) {
                        const label = i < n/2 ? 1 : -1;
                        const angle = Math.random() * Math.PI;
                        if (label > 0) {
                            const x = Math.cos(angle) * 0.6 + (Math.random() - 0.5) * noise;
                            const y = Math.sin(angle) * 0.6 + (Math.random() - 0.5) * noise;
                            data.push({x, y, label});
                        } else {
                            const x = Math.cos(angle) * 0.6 + 0.3 + (Math.random() - 0.5) * noise;
                            const y = -Math.sin(angle) * 0.6 + 0.3 + (Math.random() - 0.5) * noise;
                            data.push({x, y, label});
                        }
                    }
                    break;
            }

            return data;
        }

        draw() {
            this.ctx.clearRect(0, 0, this.width, this.height);

            // ç»˜åˆ¶ç½‘æ ¼èƒŒæ™¯
            this.drawGrid();

            // ç»˜åˆ¶çº¿æ€§å†³ç­–è¾¹ç•Œ
            this.drawLinearBoundary();

            // ç»˜åˆ¶æ•°æ®ç‚¹
            this.data.forEach(point => {
                const x = (point.x + 1) * this.width / 2;
                const y = (1 - point.y) * this.height / 2;

                this.ctx.fillStyle = point.label > 0 ? '#3b82f6' : '#ef4444';
                this.ctx.beginPath();
                this.ctx.arc(x, y, 5, 0, Math.PI * 2);
                this.ctx.fill();
            });
        }

        drawGrid() {
            this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            this.ctx.lineWidth = 1;

            for (let i = 0; i <= 10; i++) {
                const x = (i / 10) * this.width;
                const y = (i / 10) * this.height;

                this.ctx.beginPath();
                this.ctx.moveTo(x, 0);
                this.ctx.lineTo(x, this.height);
                this.ctx.stroke();

                this.ctx.beginPath();
                this.ctx.moveTo(0, y);
                this.ctx.lineTo(this.width, y);
                this.ctx.stroke();
            }
        }

        drawLinearBoundary() {
            // ç®€å•çš„çº¿æ€§åˆ†ç±»å™¨ï¼ˆä»…ä½œç¤ºæ„ï¼‰
            this.ctx.strokeStyle = '#ef4444';
            this.ctx.lineWidth = 3;
            this.ctx.setLineDash([10, 10]);

            this.ctx.beginPath();
            this.ctx.moveTo(0, this.height / 2);
            this.ctx.lineTo(this.width, this.height / 2);
            this.ctx.stroke();

            this.ctx.setLineDash([]);
        }

        updateAccuracy() {
            // è®¡ç®—çº¿æ€§åˆ†ç±»å™¨çš„å‡†ç¡®ç‡ï¼ˆç®€åŒ–ç‰ˆï¼‰
            let correct = 0;
            this.data.forEach(point => {
                const predicted = point.y > 0 ? 1 : -1;
                if (predicted === point.label) correct++;
            });

            const linearAcc = (correct / this.data.length * 100).toFixed(1);
            document.getElementById('linear-accuracy').textContent = linearAcc + '%';

            // MLPå‡†ç¡®ç‡ï¼ˆæ¨¡æ‹Ÿï¼‰
            const mlpAcc = Math.min(95 + Math.random() * 4, 99.9).toFixed(1);
            document.getElementById('mlp-accuracy').textContent = mlpAcc + '%';
        }
    }

    const patternGen = new PatternGenerator();

    function generatePattern() {
        patternGen.generatePattern();
    }

    // å™ªå£°æ»‘å—æ›´æ–°
    document.getElementById('noise-slider').addEventListener('input', (e) => {
        document.getElementById('noise-value').textContent = e.target.value + '%';
    });

    // è¿·ä½ å›¾æ¡ˆå¯è§†åŒ–
    function drawMiniPatterns() {
        const patterns = [
            { id: 'mini-xor', type: 'xor' },
            { id: 'mini-circles', type: 'circles' },
            { id: 'mini-spiral', type: 'spiral' },
            { id: 'mini-moons', type: 'moons' }
        ];

        patterns.forEach(pattern => {
            const canvas = document.getElementById(pattern.id);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);

            // ç”Ÿæˆæ•°æ®
            const data = generateMiniData(pattern.type, 50);

            // ç»˜åˆ¶æ•°æ®ç‚¹
            data.forEach(point => {
                const x = (point.x + 1) * width / 2;
                const y = (1 - point.y) * height / 2;

                ctx.fillStyle = point.label > 0 ? '#3b82f6' : '#ef4444';
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
            });
        });
    }

    function generateMiniData(type, n) {
        const data = [];

        switch(type) {
            case 'xor':
                for (let i = 0; i < n; i++) {
                    const x = Math.random() * 2 - 1;
                    const y = Math.random() * 2 - 1;
                    const label = (x > 0 && y > 0) || (x < 0 && y < 0) ? 1 : -1;
                    data.push({x, y, label});
                }
                break;

            case 'circles':
                for (let i = 0; i < n; i++) {
                    const angle = Math.random() * 2 * Math.PI;
                    const r = i < n/2 ? 0.3 : 0.7;
                    data.push({
                        x: r * Math.cos(angle),
                        y: r * Math.sin(angle),
                        label: i < n/2 ? 1 : -1
                    });
                }
                break;

            case 'spiral':
                for (let i = 0; i < n; i++) {
                    const t = i / n * 4 * Math.PI;
                    const r = t / (4 * Math.PI) * 0.8;
                    const label = i < n/2 ? 1 : -1;
                    const offset = label > 0 ? 0 : Math.PI;
                    data.push({
                        x: r * Math.cos(t + offset),
                        y: r * Math.sin(t + offset),
                        label
                    });
                }
                break;

            case 'moons':
                for (let i = 0; i < n; i++) {
                    const label = i < n/2 ? 1 : -1;
                    const angle = Math.random() * Math.PI;
                    if (label > 0) {
                        data.push({
                            x: Math.cos(angle) * 0.6,
                            y: Math.sin(angle) * 0.6,
                            label
                        });
                    } else {
                        data.push({
                            x: Math.cos(angle) * 0.6 + 0.3,
                            y: -Math.sin(angle) * 0.6 + 0.3,
                            label
                        });
                    }
                }
                break;
        }

        return data;
    }

    // åˆå§‹åŒ–è¿·ä½ å›¾æ¡ˆ
    drawMiniPatterns();

    // é€šç”¨é€¼è¿‘æ¼”ç¤º
    class ApproximationDemo {
        constructor() {
            this.canvas = document.getElementById('approximation-canvas');
            this.ctx = this.canvas.getContext('2d');
            this.width = this.canvas.width;
            this.height = this.canvas.height;

            this.targetFunction = 'sine';
            this.neurons = 10;
            this.customPoints = [];

            this.draw();
        }

        draw() {
            this.ctx.clearRect(0, 0, this.width, this.height);

            // ç»˜åˆ¶åæ ‡è½´
            this.drawAxes();

            // ç»˜åˆ¶ç›®æ ‡å‡½æ•°
            this.drawTargetFunction();

            // ç»˜åˆ¶ç½‘ç»œè¾“å‡º
            this.drawNetworkOutput();

            // ç»˜åˆ¶å›¾ä¾‹
            this.drawLegend();
        }

        drawAxes() {
            this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            this.ctx.lineWidth = 1;

            // xè½´
            this.ctx.beginPath();
            this.ctx.moveTo(50, this.height / 2);
            this.ctx.lineTo(this.width - 50, this.height / 2);
            this.ctx.stroke();

            // yè½´
            this.ctx.beginPath();
            this.ctx.moveTo(this.width / 2, 50);
            this.ctx.lineTo(this.width / 2, this.height - 50);
            this.ctx.stroke();
        }

        drawTargetFunction() {
            this.ctx.strokeStyle = '#3b82f6';
            this.ctx.lineWidth = 3;

            this.ctx.beginPath();
            for (let x = -1; x <= 1; x += 0.01) {
                const y = this.getTargetValue(x);
                const px = (x + 1) * (this.width - 100) / 2 + 50;
                const py = this.height / 2 - y * (this.height - 100) / 2;

                if (x === -1) {
                    this.ctx.moveTo(px, py);
                } else {
                    this.ctx.lineTo(px, py);
                }
            }
            this.ctx.stroke();
        }

        drawNetworkOutput() {
            this.ctx.strokeStyle = '#22c55e';
            this.ctx.lineWidth = 2;

            // æ¨¡æ‹Ÿç½‘ç»œè¾“å‡ºï¼ˆç®€åŒ–ç‰ˆï¼‰
            this.ctx.beginPath();
            for (let x = -1; x <= 1; x += 0.01) {
                const y = this.getApproximation(x);
                const px = (x + 1) * (this.width - 100) / 2 + 50;
                const py = this.height / 2 - y * (this.height - 100) / 2;

                if (x === -1) {
                    this.ctx.moveTo(px, py);
                } else {
                    this.ctx.lineTo(px, py);
                }
            }
            this.ctx.stroke();
        }

        drawLegend() {
            // å·²åœ¨HTMLä¸­å®ç°
        }

        getTargetValue(x) {
            switch(this.targetFunction) {
                case 'sine':
                    return Math.sin(x * Math.PI * 2) * 0.8;
                case 'step':
                    return x > 0 ? 0.8 : -0.8;
                case 'abs':
                    return Math.abs(x) * 0.8;
                case 'custom':
                    // ä»è‡ªå®šä¹‰ç‚¹æ’å€¼
                    return this.interpolateCustom(x);
                default:
                    return 0;
            }
        }

        getApproximation(x) {
            // ç®€åŒ–çš„ç¥ç»ç½‘ç»œè¿‘ä¼¼
            let sum = 0;
            for (let i = 0; i < this.neurons; i++) {
                const center = -1 + (i / (this.neurons - 1)) * 2;
                const width = 2 / this.neurons;
                const activation = Math.max(0, 1 - Math.abs(x - center) / width);
                sum += activation * Math.sin(i * 0.5);
            }

            const target = this.getTargetValue(x);
            const approx = sum / this.neurons * 2 - 1;

            // éšç€ç¥ç»å…ƒå¢åŠ ï¼Œé€¼è¿‘æ•ˆæœæ›´å¥½
            const factor = Math.min(this.neurons / 50, 1);
            return target * (1 - factor) + approx * factor;
        }

        interpolateCustom(x) {
            if (this.customPoints.length < 2) return 0;

            // ç®€å•çº¿æ€§æ’å€¼
            let prevPoint = null;
            let nextPoint = null;

            for (let i = 0; i < this.customPoints.length; i++) {
                if (this.customPoints[i].x <= x) {
                    prevPoint = this.customPoints[i];
                }
                if (this.customPoints[i].x >= x && !nextPoint) {
                    nextPoint = this.customPoints[i];
                }
            }

            if (!prevPoint) return nextPoint ? nextPoint.y : 0;
            if (!nextPoint) return prevPoint.y;

            const t = (x - prevPoint.x) / (nextPoint.x - prevPoint.x);
            return prevPoint.y + t * (nextPoint.y - prevPoint.y);
        }

        setTargetFunction(func) {
            this.targetFunction = func;
            if (func === 'custom') {
                this.setupCustomDrawing();
            }
            this.draw();
        }

        setNeurons(n) {
            this.neurons = n;
            this.draw();
            this.updateLoss();
        }

        setupCustomDrawing() {
            this.customPoints = [];

            const handleMouseDown = (e) => {
                const rect = this.canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left) / rect.width * 2 - 1;
                const y = 1 - (e.clientY - rect.top) / rect.height * 2;

                this.customPoints.push({x, y});
                this.customPoints.sort((a, b) => a.x - b.x);
                this.draw();
            };

            this.canvas.addEventListener('mousedown', handleMouseDown);
        }

        updateLoss() {
            let loss = 0;
            const samples = 100;

            for (let i = 0; i < samples; i++) {
                const x = -1 + (i / (samples - 1)) * 2;
                const target = this.getTargetValue(x);
                const approx = this.getApproximation(x);
                loss += Math.pow(target - approx, 2);
            }

            loss = loss / samples;
            document.getElementById('approx-loss').textContent = loss.toFixed(4);
        }

        train() {
            // åŠ¨ç”»è®­ç»ƒè¿‡ç¨‹
            let iteration = 0;
            const maxIterations = 50;

            const animate = () => {
                if (iteration < maxIterations) {
                    this.neurons = Math.min(this.neurons + 1, 100);
                    this.draw();
                    this.updateLoss();

                    document.getElementById('neuron-value').textContent = this.neurons;
                    document.getElementById('neuron-slider').value = this.neurons;

                    iteration++;
                    requestAnimationFrame(animate);
                }
            };

            animate();
        }

        reset() {
            this.neurons = 10;
            this.customPoints = [];
            document.getElementById('neuron-slider').value = 10;
            document.getElementById('neuron-value').textContent = '10';
            this.draw();
            this.updateLoss();
        }
    }

    const approxDemo = new ApproximationDemo();

    // ç›®æ ‡å‡½æ•°é€‰æ‹©
    document.getElementById('target-function').addEventListener('change', (e) => {
        approxDemo.setTargetFunction(e.target.value);
    });

    // ç¥ç»å…ƒæ•°é‡æ»‘å—
    document.getElementById('neuron-slider').addEventListener('input', (e) => {
        const value = parseInt(e.target.value);
        document.getElementById('neuron-value').textContent = value;
        approxDemo.setNeurons(value);
    });

    function trainApproximator() {
        approxDemo.train();
    }

    function resetApproximator() {
        approxDemo.reset();
    }

    // æ¿€æ´»å‡½æ•°å¯è§†åŒ–
    class ActivationVisualizer {
        constructor() {
            this.canvas = document.getElementById('activation-canvas');
            this.ctx = this.canvas.getContext('2d');
            this.width = this.canvas.width;
            this.height = this.canvas.height;
            this.currentActivation = 'sigmoid';

            this.functions = {
                sigmoid: {
                    func: x => 1 / (1 + Math.exp(-x)),
                    derivative: x => {
                        const s = 1 / (1 + Math.exp(-x));
                        return s * (1 - s);
                    },
                    range: [-5, 5],
                    info: {
                        name: 'Sigmoidå‡½æ•°',
                        formula: 'Ïƒ(x) = 1 / (1 + e^(-x))',
                        derivative: "Ïƒ'(x) = Ïƒ(x)(1 - Ïƒ(x))",
                        pros: ['è¾“å‡ºèŒƒå›´ (0, 1)', 'å¹³æ»‘å¯å¾®'],
                        cons: ['å®¹æ˜“é¥±å’Œ', 'è¾“å‡ºä¸æ˜¯é›¶ä¸­å¿ƒ']
                    }
                },
                tanh: {
                    func: x => Math.tanh(x),
                    derivative: x => 1 - Math.tanh(x) ** 2,
                    range: [-5, 5],
                    info: {
                        name: 'Tanhå‡½æ•°',
                        formula: 'tanh(x) = (e^x - e^(-x)) / (e^x + e^(-x))',
                        derivative: "tanh'(x) = 1 - tanhÂ²(x)",
                        pros: ['è¾“å‡ºèŒƒå›´ (-1, 1)', 'é›¶ä¸­å¿ƒ', 'æ¯”Sigmoidæ”¶æ•›å¿«'],
                        cons: ['ä»ç„¶å®¹æ˜“é¥±å’Œ', 'è®¡ç®—é‡è¾ƒå¤§']
                    }
                },
                relu: {
                    func: x => Math.max(0, x),
                    derivative: x => x > 0 ? 1 : 0,
                    range: [-2, 5],
                    info: {
                        name: 'ReLUå‡½æ•°',
                        formula: 'ReLU(x) = max(0, x)',
                        derivative: "ReLU'(x) = 1 if x > 0, else 0",
                        pros: ['è®¡ç®—ç®€å•', 'ç¼“è§£æ¢¯åº¦æ¶ˆå¤±', 'ç¨€ç–æ¿€æ´»'],
                        cons: ['æ­»äº¡ReLUé—®é¢˜', 'è¾“å‡ºæ— ç•Œ']
                    }
                },
                leaky: {
                    func: x => x > 0 ? x : 0.01 * x,
                    derivative: x => x > 0 ? 1 : 0.01,
                    range: [-5, 5],
                    info: {
                        name: 'Leaky ReLUå‡½æ•°',
                        formula: 'LeakyReLU(x) = max(0.01x, x)',
                        derivative: "LeakyReLU'(x) = 1 if x > 0, else 0.01",
                        pros: ['è§£å†³æ­»äº¡ReLU', 'è®¡ç®—ç®€å•'],
                        cons: ['è´Ÿæ•°éƒ¨åˆ†æ–œç‡éœ€è¦è°ƒå‚']
                    }
                },
                elu: {
                    func: x => x > 0 ? x : Math.exp(x) - 1,
                    derivative: x => x > 0 ? 1 : Math.exp(x),
                    range: [-5, 5],
                    info: {
                        name: 'ELUå‡½æ•°',
                        formula: 'ELU(x) = x if x > 0, else Î±(e^x - 1)',
                        derivative: "ELU'(x) = 1 if x > 0, else Î±e^x",
                        pros: ['è´Ÿæ•°éƒ¨åˆ†å¹³æ»‘', 'è¾“å‡ºæ¥è¿‘é›¶ä¸­å¿ƒ'],
                        cons: ['è®¡ç®—å¼€é”€è¾ƒå¤§']
                    }
                },
                swish: {
                    func: x => x / (1 + Math.exp(-x)),
                    derivative: x => {
                        const s = 1 / (1 + Math.exp(-x));
                        return s + x * s * (1 - s);
                    },
                    range: [-5, 5],
                    info: {
                        name: 'Swishå‡½æ•°',
                        formula: 'Swish(x) = x Â· Ïƒ(x)',
                        derivative: "Swish'(x) = Ïƒ(x) + xÂ·Ïƒ(x)Â·(1-Ïƒ(x))",
                        pros: ['å¹³æ»‘éå•è°ƒ', 'è‡ªé—¨æ§æœºåˆ¶', 'SOTAæ€§èƒ½'],
                        cons: ['è®¡ç®—å¤æ‚']
                    }
                },
                gelu: {
                    func: x => 0.5 * x * (1 + Math.tanh(Math.sqrt(2 / Math.PI) * (x + 0.044715 * x**3))),
                    derivative: x => {
                        const a = Math.sqrt(2 / Math.PI);
                        const b = x + 0.044715 * x**3;
                        const tanh_b = Math.tanh(a * b);
                        const sech2_b = 1 - tanh_b**2;
                        return 0.5 * (1 + tanh_b) + 0.5 * x * sech2_b * a * (1 + 0.134145 * x**2);
                    },
                    range: [-5, 5],
                    info: {
                        name: 'GELUå‡½æ•°',
                        formula: 'GELU(x) â‰ˆ 0.5x(1 + tanh[âˆš(2/Ï€)(x + 0.044715xÂ³)])',
                        derivative: 'å¤æ‚ï¼ˆè§ä»£ç ï¼‰',
                        pros: ['Transformeræ ‡é…', 'æ¦‚ç‡è§£é‡Š', 'æ€§èƒ½ä¼˜å¼‚'],
                        cons: ['è®¡ç®—æœ€å¤æ‚']
                    }
                }
            };

            this.drawAll();
        }

        drawAll() {
            this.ctx.clearRect(0, 0, this.width, this.height);

            if (this.currentActivation === 'all') {
                this.drawComparison();
            } else {
                this.drawSingle(this.currentActivation);
                this.updateInfo(this.currentActivation);
            }
        }

        drawSingle(activationName) {
            const activation = this.functions[activationName];
            const [xMin, xMax] = activation.range;

            // ç»˜åˆ¶åæ ‡è½´
            this.drawAxes(xMin, xMax);

            // ç»˜åˆ¶å‡½æ•°
            this.ctx.strokeStyle = '#3b82f6';
            this.ctx.lineWidth = 3;
            this.ctx.beginPath();

            for (let x = xMin; x <= xMax; x += 0.05) {
                const y = activation.func(x);
                const px = this.transformX(x, xMin, xMax);
                const py = this.transformY(y);

                if (x === xMin) {
                    this.ctx.moveTo(px, py);
                } else {
                    this.ctx.lineTo(px, py);
                }
            }
            this.ctx.stroke();

            // ç»˜åˆ¶å¯¼æ•°
            this.ctx.strokeStyle = '#ef4444';
            this.ctx.lineWidth = 2;
            this.ctx.setLineDash([5, 5]);
            this.ctx.beginPath();

            for (let x = xMin; x <= xMax; x += 0.05) {
                const y = activation.derivative(x);
                const px = this.transformX(x, xMin, xMax);
                const py = this.transformY(y);

                if (x === xMin) {
                    this.ctx.moveTo(px, py);
                } else {
                    this.ctx.lineTo(px, py);
                }
            }
            this.ctx.stroke();
            this.ctx.setLineDash([]);
        }

        drawComparison() {
            const xMin = -5, xMax = 5;
            this.drawAxes(xMin, xMax);

            const colors = ['#3b82f6', '#ef4444', '#22c55e', '#f59e0b', '#8b5cf6', '#ec4899', '#06b6d4'];

            Object.entries(this.functions).forEach(([name, activation], index) => {
                this.ctx.strokeStyle = colors[index % colors.length];
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();

                for (let x = xMin; x <= xMax; x += 0.05) {
                    const y = activation.func(x);
                    const px = this.transformX(x, xMin, xMax);
                    const py = this.transformY(y);

                    if (x === xMin) {
                        this.ctx.moveTo(px, py);
                    } else {
                        this.ctx.lineTo(px, py);
                    }
                }
                this.ctx.stroke();
            });
        }

        drawAxes(xMin, xMax) {
            this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            this.ctx.lineWidth = 1;

            // xè½´
            this.ctx.beginPath();
            this.ctx.moveTo(50, this.height / 2);
            this.ctx.lineTo(this.width - 50, this.height / 2);
            this.ctx.stroke();

            // yè½´
            this.ctx.beginPath();
            this.ctx.moveTo(this.width / 2, 50);
            this.ctx.lineTo(this.width / 2, this.height - 50);
            this.ctx.stroke();

            // åˆ»åº¦
            this.ctx.fillStyle = '#f1f5f9';
            this.ctx.font = '12px Arial';
            this.ctx.textAlign = 'center';

            // xè½´åˆ»åº¦
            for (let x = Math.ceil(xMin); x <= Math.floor(xMax); x++) {
                const px = this.transformX(x, xMin, xMax);
                this.ctx.fillText(x.toString(), px, this.height / 2 + 20);
            }

            // yè½´åˆ»åº¦
            this.ctx.textAlign = 'right';
            for (let y = -2; y <= 2; y++) {
                const py = this.transformY(y);
                if (Math.abs(py - this.height / 2) > 10) {
                    this.ctx.fillText(y.toString(), this.width / 2 - 10, py + 5);
                }
            }
        }

        transformX(x, xMin, xMax) {
            return 50 + (x - xMin) / (xMax - xMin) * (this.width - 100);
        }

        transformY(y) {
            // yèŒƒå›´å›ºå®šåœ¨[-3, 3]
            return this.height / 2 - y * (this.height - 100) / 6;
        }

        updateInfo(activationName) {
            const info = this.functions[activationName].info;
            const infoElement = document.getElementById('activation-info');

            infoElement.innerHTML = `
                <h4 style="color: var(--accent-purple); margin-bottom: 1rem;">${info.name}</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <p><strong>æ•°å­¦å½¢å¼ï¼š</strong></p>
                        <div class="equation-container">
                            <span>${info.formula}</span>
                        </div>
                        <p><strong>å¯¼æ•°ï¼š</strong></p>
                        <div class="equation-container">
                            <span>${info.derivative}</span>
                        </div>
                    </div>
                    <div>
                        <p><strong>ç‰¹æ€§ï¼š</strong></p>
                        <ul style="line-height: 1.8;">
                            ${info.pros.map(pro => `<li>âœ… ${pro}</li>`).join('')}
                            ${info.cons.map(con => `<li>âŒ ${con}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }

        setActivation(name) {
            this.currentActivation = name;
            this.drawAll();
        }
    }

    const activationViz = new ActivationVisualizer();

    // æ¿€æ´»å‡½æ•°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.activation-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.activation-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            activationViz.setActivation(btn.dataset.activation);
        });
    });

    // æ·±åº¦vså®½åº¦å®éªŒ
    class ArchitectureComparison {
        constructor() {
            this.configs = {
                'shallow-wide': { layers: [2, 1000, 2], name: 'æµ…è€Œå®½' },
                'medium': { layers: [2, 100, 100, 100, 2], name: 'ä¸­ç­‰æ·±åº¦' },
                'deep-narrow': { layers: [2, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 2], name: 'æ·±è€Œçª„' },
                'custom': { layers: [2, 50, 50, 50, 50, 50, 2], name: 'è‡ªå®šä¹‰' }
            };

            this.visCanvas = document.getElementById('architecture-vis');
            this.perfCanvas = document.getElementById('performance-chart');
            this.visCtx = this.visCanvas.getContext('2d');
            this.perfCtx = this.perfCanvas.getContext('2d');

            this.currentConfig = 'medium';

            this.draw();
        }

        draw() {
            this.drawArchitecture();
            this.drawPerformance();
            this.updateStats();
        }

        drawArchitecture() {
            const ctx = this.visCtx;
            const width = this.visCanvas.width;
            const height = this.visCanvas.height;

            ctx.clearRect(0, 0, width, height);

            const layers = this.configs[this.currentConfig].layers;
            const maxNeurons = Math.max(...layers);
            const layerSpacing = width / (layers.length + 1);

            // ç»˜åˆ¶æ¯å±‚
            layers.forEach((neurons, layerIdx) => {
                const x = layerSpacing * (layerIdx + 1);
                const neuronSpacing = Math.min(height / (neurons + 1), 30);
                const startY = (height - neuronSpacing * (neurons - 1)) / 2;

                // ç»˜åˆ¶ç¥ç»å…ƒ
                for (let i = 0; i < Math.min(neurons, 20); i++) {
                    const y = startY + i * neuronSpacing;

                    // è¿æ¥åˆ°ä¸‹ä¸€å±‚
                    if (layerIdx < layers.length - 1) {
                        const nextNeurons = Math.min(layers[layerIdx + 1], 20);
                        const nextX = layerSpacing * (layerIdx + 2);
                        const nextSpacing = Math.min(height / (layers[layerIdx + 1] + 1), 30);
                        const nextStartY = (height - nextSpacing * (nextNeurons - 1)) / 2;

                        for (let j = 0; j < nextNeurons; j += 2) {
                            const nextY = nextStartY + j * nextSpacing;

                            ctx.strokeStyle = 'rgba(139, 92, 246, 0.1)';
                            ctx.lineWidth = 0.5;
                            ctx.beginPath();
                            ctx.moveTo(x, y);
                            ctx.lineTo(nextX, nextY);
                            ctx.stroke();
                        }
                    }

                    // ç»˜åˆ¶ç¥ç»å…ƒ
                    ctx.fillStyle = this.getNeuronColor(layerIdx, layers.length);
                    ctx.beginPath();
                    ctx.arc(x, y, 5, 0, Math.PI * 2);
                    ctx.fill();
                }

                // å¦‚æœç¥ç»å…ƒå¤ªå¤šï¼Œæ˜¾ç¤ºçœç•¥å·
                if (neurons > 20) {
                    ctx.fillStyle = '#f1f5f9';
                    ctx.font = '16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('...', x, height / 2);
                    ctx.font = '12px Arial';
                    ctx.fillText(`${neurons}ä¸ª`, x, height / 2 + 20);
                }

                // å±‚æ ‡ç­¾
                ctx.fillStyle = '#f1f5f9';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                if (layerIdx === 0) {
                    ctx.fillText('è¾“å…¥å±‚', x, height - 20);
                } else if (layerIdx === layers.length - 1) {
                    ctx.fillText('è¾“å‡ºå±‚', x, height - 20);
                } else {
                    ctx.fillText(`éšè—å±‚${layerIdx}`, x, height - 20);
                }
            });
        }

        getNeuronColor(layerIdx, totalLayers) {
            const hue = (layerIdx / totalLayers) * 60 + 200; // ä»è“åˆ°ç´«
            return `hsl(${hue}, 70%, 60%)`;
        }

        drawPerformance() {
            const ctx = this.perfCtx;
            const width = this.perfCanvas.width;
            const height = this.perfCanvas.height;

            ctx.clearRect(0, 0, width, height);

            // æ¨¡æ‹Ÿçš„æ€§èƒ½æ•°æ®
            const data = {
                'shallow-wide': { trainTime: 100, accuracy: 85, params: 2004 },
                'medium': { trainTime: 150, accuracy: 92, params: 21002 },
                'deep-narrow': { trainTime: 200, accuracy: 94, params: 4222 },
                'custom': { trainTime: 120, accuracy: 90, params: 12752 }
            };

            const metrics = ['è®­ç»ƒæ—¶é—´', 'å‡†ç¡®ç‡', 'å‚æ•°é‡'];
            const colors = ['#ef4444', '#22c55e', '#3b82f6'];

            // ç»˜åˆ¶æ¡å½¢å›¾
            const barWidth = width / 4 / 3;
            const barSpacing = width / 4;

            Object.entries(data).forEach(([config, values], configIdx) => {
                const x = barSpacing * (configIdx + 0.5);

                // è®­ç»ƒæ—¶é—´ï¼ˆå½’ä¸€åŒ–ï¼‰
                const trainHeight = (values.trainTime / 200) * (height - 100);
                ctx.fillStyle = colors[0];
                ctx.fillRect(x - barWidth * 1.5, height - 50 - trainHeight, barWidth * 0.8, trainHeight);

                // å‡†ç¡®ç‡
                const accHeight = (values.accuracy / 100) * (height - 100);
                ctx.fillStyle = colors[1];
                ctx.fillRect(x - barWidth * 0.5, height - 50 - accHeight, barWidth * 0.8, accHeight);

                // å‚æ•°é‡ï¼ˆå¯¹æ•°å°ºåº¦ï¼‰
                const paramHeight = (Math.log10(values.params) / 5) * (height - 100);
                ctx.fillStyle = colors[2];
                ctx.fillRect(x + barWidth * 0.5, height - 50 - paramHeight, barWidth * 0.8, paramHeight);

                // é…ç½®æ ‡ç­¾
                ctx.fillStyle = '#f1f5f9';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(this.configs[config].name, x, height - 30);
            });

            // å›¾ä¾‹
            ctx.font = '12px Arial';
            metrics.forEach((metric, idx) => {
                ctx.fillStyle = colors[idx];
                ctx.fillRect(20, 20 + idx * 25, 15, 15);
                ctx.fillStyle = '#f1f5f9';
                ctx.textAlign = 'left';
                ctx.fillText(metric, 40, 32 + idx * 25);
            });
        }

        updateStats() {
            const config = this.configs[this.currentConfig];
            const layers = config.layers;

            // è®¡ç®—å‚æ•°é‡
            let params = 0;
            for (let i = 0; i < layers.length - 1; i++) {
                params += layers[i] * layers[i + 1] + layers[i + 1]; // æƒé‡ + åç½®
            }

            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('param-count').textContent = params.toLocaleString();
            document.getElementById('train-speed').textContent = Math.round(100 + params / 100) + 'ms';
            document.getElementById('accuracy').textContent = (85 + Math.min(layers.length * 2, 10)) + '%';
            document.getElementById('generalization').textContent = (80 + Math.min(layers.length * 1.5, 8)) + '%';
        }

        setConfig(config) {
            this.currentConfig = config;
            this.draw();
        }

        setCustom(depth, width) {
            const layers = [2];
            for (let i = 0; i < depth; i++) {
                layers.push(width);
            }
            layers.push(2);

            this.configs.custom.layers = layers;
            this.currentConfig = 'custom';
            this.draw();
        }
    }

    const archComparison = new ArchitectureComparison();

    // ç½‘ç»œé…ç½®é€‰æ‹©
    document.getElementById('network-config').addEventListener('change', (e) => {
        const config = e.target.value;

        if (config === 'custom') {
            document.getElementById('custom-controls').style.display = 'flex';
        } else {
            document.getElementById('custom-controls').style.display = 'none';
            archComparison.setConfig(config);
        }
    });

    // è‡ªå®šä¹‰ç½‘ç»œå‚æ•°
    document.getElementById('custom-depth').addEventListener('change', updateCustomNetwork);
    document.getElementById('custom-width').addEventListener('change', updateCustomNetwork);

    function updateCustomNetwork() {
        const depth = parseInt(document.getElementById('custom-depth').value);
        const width = parseInt(document.getElementById('custom-width').value);
        archComparison.setCustom(depth, width);
    }

    function compareArchitectures() {
        archComparison.draw();
        showNotification('æ¶æ„å¯¹æ¯”å®Œæˆï¼æŸ¥çœ‹æ€§èƒ½å·®å¼‚ã€‚');
    }

    // å†³ç­–è¾¹ç•Œå¯è§†åŒ–
    class DecisionBoundaryVisualizer {
        constructor() {
            this.dataCanvas = document.getElementById('data-canvas');
            this.boundaryCanvas = document.getElementById('boundary-canvas');
            this.confidenceCanvas = document.getElementById('confidence-canvas');

            this.dataCtx = this.dataCanvas.getContext('2d');
            this.boundaryCtx = this.boundaryCanvas.getContext('2d');
            this.confidenceCtx = this.confidenceCanvas.getContext('2d');

            this.width = this.dataCanvas.width;
            this.height = this.dataCanvas.height;

            this.data = [];
            this.model = null;

            this.generateData();
        }

        generateData() {
            const dataset = document.getElementById('dataset-select').value;
            this.data = [];
            const n = 200;

            switch(dataset) {
                case 'moons':
                    for (let i = 0; i < n; i++) {
                        const angle = i < n/2 ? Math.random() * Math.PI : Math.random() * Math.PI;
                        const noise = (Math.random() - 0.5) * 0.1;

                        if (i < n/2) {
                            this.data.push({
                                x: Math.cos(angle) + noise,
                                y: Math.sin(angle) + noise,
                                label: 0
                            });
                        } else {
                            this.data.push({
                                x: 1 - Math.cos(angle) + noise,
                                y: 0.5 - Math.sin(angle) + noise,
                                label: 1
                            });
                        }
                    }
                    break;

                case 'circles':
                    for (let i = 0; i < n; i++) {
                        const angle = Math.random() * 2 * Math.PI;
                        const r = i < n/2 ? 0.3 : 0.7;
                        const noise = (Math.random() - 0.5) * 0.1;

                        this.data.push({
                            x: r * Math.cos(angle) + noise + 0.5,
                            y: r * Math.sin(angle) + noise + 0.5,
                            label: i < n/2 ? 0 : 1
                        });
                    }
                    break;

                case 'spiral':
                    for (let i = 0; i < n; i++) {
                        const t = i / n * 4 * Math.PI;
                        const r = t / (4 * Math.PI) * 0.4;
                        const label = i < n/2 ? 0 : 1;
                        const offset = label === 0 ? 0 : Math.PI;
                        const noise = (Math.random() - 0.5) * 0.05;

                        this.data.push({
                            x: 0.5 + r * Math.cos(t + offset) + noise,
                            y: 0.5 + r * Math.sin(t + offset) + noise,
                            label: label
                        });
                    }
                    break;

                case 'xor':
                    for (let i = 0; i < n; i++) {
                        const x = Math.random();
                        const y = Math.random();
                        const label = (x > 0.5 && y > 0.5) || (x < 0.5 && y < 0.5) ? 0 : 1;

                        this.data.push({
                            x: x + (Math.random() - 0.5) * 0.1,
                            y: y + (Math.random() - 0.5) * 0.1,
                            label: label
                        });
                    }
                    break;
            }

            this.drawData();
        }

        drawData() {
            const ctx = this.dataCtx;
            ctx.clearRect(0, 0, this.width, this.height);

            this.data.forEach(point => {
                const x = point.x * this.width;
                const y = (1 - point.y) * this.height;

                ctx.fillStyle = point.label === 0 ? '#3b82f6' : '#ef4444';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        async train() {
            document.getElementById('training-progress').textContent = 'è®­ç»ƒä¸­...';

            const architecture = document.getElementById('architecture-select').value;
            const activation = document.getElementById('activation-select').value;

            // æ¨¡æ‹Ÿè®­ç»ƒè¿‡ç¨‹
            const startTime = Date.now();

            // åˆ›å»ºæ¨¡å‹ï¼ˆè¿™é‡Œæ˜¯æ¨¡æ‹Ÿï¼‰
            this.model = {
                architecture: architecture,
                activation: activation,
                predict: (x, y) => {
                    // ç®€åŒ–çš„é¢„æµ‹å‡½æ•°
                    if (architecture === 'shallow') {
                        return this.shallowPredict(x, y, activation);
                    } else if (architecture === 'medium') {
                        return this.mediumPredict(x, y, activation);
                    } else {
                        return this.deepPredict(x, y, activation);
                    }
                }
            };

            // æ¨¡æ‹Ÿè®­ç»ƒè¿›åº¦
            for (let epoch = 0; epoch <= 100; epoch += 10) {
                document.getElementById('training-progress').textContent = `${epoch}%`;
                await new Promise(resolve => setTimeout(resolve, 50));
            }

            // ç»˜åˆ¶ç»“æœ
            this.drawBoundary();
            this.drawConfidence();

            // è®¡ç®—å‡†ç¡®ç‡
            let correct = 0;
            this.data.forEach(point => {
                const pred = this.model.predict(point.x, point.y) > 0.5 ? 1 : 0;
                if (pred === point.label) correct++;
            });

            const accuracy = (correct / this.data.length * 100).toFixed(1);
            const trainTime = ((Date.now() - startTime) / 1000).toFixed(1);

            document.getElementById('final-accuracy').textContent = accuracy + '%';
            document.getElementById('training-time').textContent = trainTime + 's';
            document.getElementById('training-progress').textContent = 'å®Œæˆï¼';
        }

        shallowPredict(x, y, activation) {
            // ç®€åŒ–çš„æµ…å±‚ç½‘ç»œé¢„æµ‹
            const z = x * 0.5 + y * 0.5 - 0.5;
            return this.applyActivation(z, activation);
        }

        mediumPredict(x, y, activation) {
            // ç®€åŒ–çš„ä¸­ç­‰æ·±åº¦ç½‘ç»œé¢„æµ‹
            const h1 = this.applyActivation(x * 2 - 1, activation);
            const h2 = this.applyActivation(y * 2 - 1, activation);
            const z = h1 * 0.5 + h2 * 0.5;
            return this.applyActivation(z, activation);
        }

        deepPredict(x, y, activation) {
            // ç®€åŒ–çš„æ·±å±‚ç½‘ç»œé¢„æµ‹
            let h = x + y;
            for (let i = 0; i < 5; i++) {
                h = this.applyActivation(h * 2 - 1, activation);
            }
            return h;
        }

        applyActivation(x, activation) {
            switch(activation) {
                case 'relu':
                    return Math.max(0, x);
                case 'tanh':
                    return Math.tanh(x);
                case 'sigmoid':
                    return 1 / (1 + Math.exp(-x));
                default:
                    return x;
            }
        }

        drawBoundary() {
            const ctx = this.boundaryCtx;
            const imageData = ctx.createImageData(this.width, this.height);
            const data = imageData.data;

            for (let y = 0; y < this.height; y++) {
                for (let x = 0; x < this.width; x++) {
                    const pred = this.model.predict(x / this.width, 1 - y / this.height);

                    const idx = (y * this.width + x) * 4;
                    if (pred > 0.5) {
                        data[idx] = 239;     // r
                        data[idx + 1] = 68;   // g
                        data[idx + 2] = 68;   // b
                        data[idx + 3] = 50;   // a
                    } else {
                        data[idx] = 59;       // r
                        data[idx + 1] = 130;  // g
                        data[idx + 2] = 246;  // b
                        data[idx + 3] = 50;   // a
                    }
                }
            }

            ctx.putImageData(imageData, 0, 0);

            // å åŠ æ•°æ®ç‚¹
            this.data.forEach(point => {
                const x = point.x * this.width;
                const y = (1 - point.y) * this.height;

                ctx.strokeStyle = point.label === 0 ? '#1e40af' : '#991b1b';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.stroke();
            });
        }

        drawConfidence() {
            const ctx = this.confidenceCtx;
            const imageData = ctx.createImageData(this.width, this.height);
            const data = imageData.data;

            for (let y = 0; y < this.height; y++) {
                for (let x = 0; x < this.width; x++) {
                    const pred = this.model.predict(x / this.width, 1 - y / this.height);
                    const confidence = Math.abs(pred - 0.5) * 2; // 0åˆ°1çš„ç½®ä¿¡åº¦

                    const idx = (y * this.width + x) * 4;
                    const intensity = Math.floor(confidence * 255);

                    // ä½¿ç”¨æ¸å˜è‰²è¡¨ç¤ºç½®ä¿¡åº¦
                    if (pred > 0.5) {
                        data[idx] = intensity;        // r
                        data[idx + 1] = 0;            // g
                        data[idx + 2] = 0;            // b
                    } else {
                        data[idx] = 0;                // r
                        data[idx + 1] = 0;            // g
                        data[idx + 2] = intensity;    // b
                    }
                    data[idx + 3] = 255;              // a
                }
            }

            ctx.putImageData(imageData, 0, 0);

            // æ·»åŠ ç­‰é«˜çº¿
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1;

            for (let level = 0.1; level < 1; level += 0.1) {
                ctx.beginPath();
                for (let x = 0; x < this.width; x++) {
                    for (let y = 0; y < this.height; y++) {
                        const pred = this.model.predict(x / this.width, 1 - y / this.height);
                        const confidence = Math.abs(pred - 0.5) * 2;

                        if (Math.abs(confidence - level) < 0.02) {
                            ctx.moveTo(x, y);
                            ctx.lineTo(x + 1, y);
                        }
                    }
                }
                ctx.stroke();
            }
        }
    }

    const boundaryViz = new DecisionBoundaryVisualizer();

    async function trainAndVisualize() {
        await boundaryViz.train();
    }

    // æ•°æ®é›†æ”¹å˜æ—¶é‡æ–°ç”Ÿæˆæ•°æ®
    document.getElementById('dataset-select').addEventListener('change', () => {
        boundaryViz.generateData();
    });

    // æ¢¯åº¦æµåˆ†æ
    class GradientFlowAnalyzer {
        constructor() {
            this.canvas = document.getElementById('gradient-flow-canvas');
            this.ctx = this.canvas.getContext('2d');
            this.width = this.canvas.width;
            this.height = this.canvas.height;

            this.analyze();
        }

        analyze() {
            const depth = parseInt(document.getElementById('depth-slider').value);
            const activation = document.getElementById('gradient-activation').value;

            // æ¨¡æ‹Ÿæ¢¯åº¦æµ
            const gradients = this.simulateGradients(depth, activation);

            // ç»˜åˆ¶ç»“æœ
            this.draw(gradients);

            // æ›´æ–°ç»Ÿè®¡
            this.updateStats(gradients);
        }

        simulateGradients(depth, activation) {
            const gradients = [];
            let gradient = 1.0; // ä»è¾“å‡ºå±‚å¼€å§‹

            for (let i = depth - 1; i >= 0; i--) {
                // æ ¹æ®æ¿€æ´»å‡½æ•°è®¡ç®—æ¢¯åº¦è¡°å‡
                const decay = this.getGradientDecay(activation, i, depth);
                gradient *= decay;

                gradients.unshift({
                    layer: i,
                    gradient: gradient,
                    log_gradient: Math.log10(Math.max(gradient, 1e-10))
                });
            }

            return gradients;
        }

        getGradientDecay(activation, layer, totalLayers) {
            // æ¨¡æ‹Ÿä¸åŒæ¿€æ´»å‡½æ•°çš„æ¢¯åº¦è¡°å‡
            switch(activation) {
                case 'sigmoid':
                    return 0.25; // sigmoidå¯¼æ•°æœ€å¤§å€¼æ˜¯0.25
                case 'tanh':
                    return 0.5;  // tanhå¯¼æ•°æœ€å¤§å€¼æ˜¯1ï¼Œä½†å¹³å‡æ›´ä½
                case 'relu':
                    return Math.random() > 0.1 ? 1.0 : 0; // 10%æ¦‚ç‡æ­»äº¡
                case 'leaky_relu':
                    return Math.random() > 0.5 ? 1.0 : 0.01;
                default:
                    return 0.8;
            }
        }

        draw(gradients) {
            const ctx = this.ctx;
            ctx.clearRect(0, 0, this.width, this.height);

            // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼
            this.drawGrid();

            // ç»˜åˆ¶æ¢¯åº¦æ›²çº¿
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.beginPath();

            gradients.forEach((point, idx) => {
                const x = (idx / (gradients.length - 1)) * (this.width - 100) + 50;
                const y = this.height - 50 - (point.log_gradient + 10) / 12 * (this.height - 100);

                if (idx === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }

                // ç»˜åˆ¶æ•°æ®ç‚¹
                ctx.fillStyle = '#3b82f6';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });

            ctx.stroke();

            // ç»˜åˆ¶å±é™©åŒºåŸŸ
            ctx.fillStyle = 'rgba(239, 68, 68, 0.1)';
            ctx.fillRect(50, this.height - 50 - 2 / 12 * (this.height - 100),
                this.width - 100, 2 / 12 * (this.height - 100));

            // æ ‡æ³¨
            ctx.fillStyle = '#ef4444';
            ctx.font = '12px Arial';
            ctx.fillText('æ¢¯åº¦æ¶ˆå¤±åŒºåŸŸ', 60, this.height - 60);
        }

        drawGrid() {
            const ctx = this.ctx;
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;

            // æ¨ªçº¿
            for (let i = 0; i <= 10; i++) {
                const y = 50 + i * (this.height - 100) / 10;
                ctx.beginPath();
                ctx.moveTo(50, y);
                ctx.lineTo(this.width - 50, y);
                ctx.stroke();
            }

            // ç«–çº¿ï¼ˆç»§ç»­ï¼‰
            for (let i = 0; i <= 10; i++) {
                const x = 50 + i * (this.width - 100) / 10;
                ctx.beginPath();
                ctx.moveTo(x, 50);
                ctx.lineTo(x, this.height - 50);
                ctx.stroke();
            }

            // åæ ‡è½´æ ‡ç­¾
            ctx.fillStyle = '#f1f5f9';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';

            // xè½´æ ‡ç­¾ï¼ˆå±‚ç´¢å¼•ï¼‰
            ctx.fillText('è¾“å…¥å±‚', 50, this.height - 30);
            ctx.fillText('è¾“å‡ºå±‚', this.width - 50, this.height - 30);
            ctx.fillText('å±‚æ·±åº¦', this.width / 2, this.height - 10);

            // yè½´æ ‡ç­¾ï¼ˆæ¢¯åº¦å€¼ï¼‰
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const value = -10 + i * 2;
                const y = this.height - 50 - (value + 10) / 12 * (this.height - 100);
                ctx.fillText(`10^${value}`, 45, y + 5);
            }
        }

        updateStats(gradients) {
            const first = gradients[0].gradient;
            const middle = gradients[Math.floor(gradients.length / 2)].gradient;
            const last = gradients[gradients.length - 1].gradient;

            document.getElementById('first-layer-gradient').textContent = first.toExponential(3);
            document.getElementById('middle-layer-gradient').textContent = middle.toExponential(3);
            document.getElementById('last-layer-gradient').textContent = last.toExponential(3);
        }
    }

    let gradientAnalyzer = null;

    function analyzeGradients() {
        if (!gradientAnalyzer) {
            gradientAnalyzer = new GradientFlowAnalyzer();
        } else {
            gradientAnalyzer.analyze();
        }
    }

    // æ·±åº¦æ»‘å—æ›´æ–°
    document.getElementById('depth-slider').addEventListener('input', (e) => {
        document.getElementById('depth-value').textContent = e.target.value + 'å±‚';
    });

    // æ€ç»´å¯¼å›¾ç»˜åˆ¶
    class MindMapDrawer {
        constructor() {
            this.canvas = document.getElementById('mindmap-canvas');
            this.ctx = this.canvas.getContext('2d');
            this.width = this.canvas.width;
            this.height = this.canvas.height;

            this.nodes = this.createNodes();
            this.draw();
        }

        createNodes() {
            return {
                root: {
                    x: this.width / 2,
                    y: this.height / 2,
                    text: 'MLPæ ¸å¿ƒæ¦‚å¿µ',
                    color: '#8b5cf6',
                    children: ['activation', 'architecture', 'training', 'problems']
                },
                activation: {
                    x: this.width / 4,
                    y: this.height / 3,
                    text: 'æ¿€æ´»å‡½æ•°',
                    color: '#3b82f6',
                    children: ['relu', 'sigmoid', 'modern']
                },
                architecture: {
                    x: 3 * this.width / 4,
                    y: this.height / 3,
                    text: 'ç½‘ç»œæ¶æ„',
                    color: '#22c55e',
                    children: ['depth', 'width', 'residual']
                },
                training: {
                    x: this.width / 4,
                    y: 2 * this.height / 3,
                    text: 'è®­ç»ƒæŠ€å·§',
                    color: '#f59e0b',
                    children: ['init', 'regularization', 'optimization']
                },
                problems: {
                    x: 3 * this.width / 4,
                    y: 2 * this.height / 3,
                    text: 'å¸¸è§é—®é¢˜',
                    color: '#ef4444',
                    children: ['vanishing', 'overfitting', 'dying']
                },
                // å­èŠ‚ç‚¹
                relu: { x: 100, y: 100, text: 'ReLUå®¶æ—', color: '#3b82f6' },
                sigmoid: { x: 100, y: 150, text: 'Sigmoid/Tanh', color: '#3b82f6' },
                modern: { x: 100, y: 200, text: 'GELU/Swish', color: '#3b82f6' },
                depth: { x: 600, y: 100, text: 'æ·±åº¦è®¾è®¡', color: '#22c55e' },
                width: { x: 600, y: 150, text: 'å®½åº¦é€‰æ‹©', color: '#22c55e' },
                residual: { x: 600, y: 200, text: 'æ®‹å·®è¿æ¥', color: '#22c55e' },
                init: { x: 100, y: 400, text: 'æƒé‡åˆå§‹åŒ–', color: '#f59e0b' },
                regularization: { x: 100, y: 450, text: 'æ­£åˆ™åŒ–', color: '#f59e0b' },
                optimization: { x: 100, y: 500, text: 'ä¼˜åŒ–ç®—æ³•', color: '#f59e0b' },
                vanishing: { x: 600, y: 400, text: 'æ¢¯åº¦æ¶ˆå¤±', color: '#ef4444' },
                overfitting: { x: 600, y: 450, text: 'è¿‡æ‹Ÿåˆ', color: '#ef4444' },
                dying: { x: 600, y: 500, text: 'æ­»äº¡ReLU', color: '#ef4444' }
            };
        }

        draw() {
            this.ctx.clearRect(0, 0, this.width, this.height);

            // ç»˜åˆ¶è¿æ¥çº¿
            Object.entries(this.nodes).forEach(([key, node]) => {
                if (node.children) {
                    node.children.forEach(childKey => {
                        const child = this.nodes[childKey];
                        this.drawConnection(node, child);
                    });
                }
            });

            // ç»˜åˆ¶èŠ‚ç‚¹
            Object.values(this.nodes).forEach(node => {
                this.drawNode(node);
            });
        }

        drawNode(node) {
            const ctx = this.ctx;

            // ç»˜åˆ¶åœ†å½¢èƒŒæ™¯
            ctx.fillStyle = node.color;
            ctx.beginPath();
            ctx.arc(node.x, node.y, 40, 0, Math.PI * 2);
            ctx.fill();

            // ç»˜åˆ¶æ–‡å­—
            ctx.fillStyle = 'white';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(node.text, node.x, node.y);
        }

        drawConnection(parent, child) {
            const ctx = this.ctx;

            ctx.strokeStyle = 'rgba(139, 92, 246, 0.3)';
            ctx.lineWidth = 2;

            ctx.beginPath();
            ctx.moveTo(parent.x, parent.y);

            // ä½¿ç”¨è´å¡å°”æ›²çº¿
            const cx = (parent.x + child.x) / 2;
            const cy = (parent.y + child.y) / 2;
            ctx.quadraticCurveTo(cx, cy, child.x, child.y);

            ctx.stroke();
        }
    }

    // åˆå§‹åŒ–æ€ç»´å¯¼å›¾
    new MindMapDrawer();

    // å®è·µç»ƒä¹ ç­”æ¡ˆæ£€æŸ¥
    const practiceAnswers = {
        'practice-feedback-1': {
            correct: 'b',
            feedback: {
                'a': 'ä¸æ˜¯è®¡ç®—èƒ½åŠ›çš„é—®é¢˜ï¼Œå•å±‚æ„ŸçŸ¥æœºçš„è®¡ç®—èƒ½åŠ›è¶³å¤Ÿã€‚',
                'b': 'æ­£ç¡®ï¼å•å±‚æ„ŸçŸ¥æœºåªèƒ½è¡¨ç¤ºçº¿æ€§å†³ç­–è¾¹ç•Œï¼Œæ— æ³•åˆ†ç¦»XORè¿™æ ·çš„éçº¿æ€§æ¨¡å¼ã€‚',
                'c': 'å‚æ•°æ•°é‡ä¸æ˜¯å…³é”®ï¼Œå³ä½¿å¢åŠ å‚æ•°ä¹Ÿæ— æ³•è§£å†³çº¿æ€§é™åˆ¶ã€‚',
                'd': 'åå‘ä¼ æ’­ç®—æ³•æ²¡æœ‰é—®é¢˜ï¼Œæ˜¯æ¨¡å‹è¡¨è¾¾èƒ½åŠ›çš„é™åˆ¶ã€‚'
            }
        },
        'practice-feedback-2': {
            correct: 'b',
            feedback: {
                'a': 'é”™è¯¯ï¼Œæ²¡æœ‰æ¿€æ´»å‡½æ•°çš„å¤šå±‚ç½‘ç»œä»ç„¶æ˜¯çº¿æ€§çš„ã€‚',
                'b': 'æ­£ç¡®ï¼å¤šä¸ªçº¿æ€§å˜æ¢çš„ç»„åˆä»ç„¶æ˜¯çº¿æ€§å˜æ¢ã€‚',
                'c': 'å±‚æ•°ä¸å½±å“ï¼Œå…³é”®æ˜¯ç¼ºå°‘éçº¿æ€§ã€‚',
                'd': 'æ— è®ºå¤šå°‘å±‚ï¼Œçº¿æ€§ç»„åˆè¿˜æ˜¯çº¿æ€§ã€‚'
            }
        }
    };

    // ç»ƒä¹ ç­”æ¡ˆæ£€æŸ¥åŠŸèƒ½
    document.querySelectorAll('.practice-option').forEach(option => {
        option.addEventListener('click', function() {
            const answer = this.dataset.answer;
            const feedbackId = this.closest('.instant-practice').querySelector('.practice-feedback').id;
            const feedback = practiceAnswers[feedbackId];

            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            this.parentElement.querySelectorAll('.practice-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            // æ ‡è®°é€‰æ‹©
            this.classList.add('selected');

            // æ˜¾ç¤ºåé¦ˆ
            const feedbackElement = document.getElementById(feedbackId);
            if (answer === feedback.correct) {
                this.classList.add('correct');
                feedbackElement.className = 'practice-feedback show correct';
                feedbackElement.innerHTML = `
                    <strong>âœ… æ­£ç¡®ï¼</strong><br>
                    ${feedback.feedback[answer]}
                `;

                // è®°å½•æˆå°±
                if (!completedSections.has(feedbackId)) {
                    completedSections.add(feedbackId);
                    checkAchievements();
                }
            } else {
                this.classList.add('incorrect');
                feedbackElement.className = 'practice-feedback show incorrect';
                feedbackElement.innerHTML = `
                    <strong>âŒ ä¸å¤ªå¯¹å“¦</strong><br>
                    ${feedback.feedback[answer]}<br>
                    <em>æç¤ºï¼š${feedback.feedback[feedback.correct]}</em>
                `;
            }
        });
    });

    // ä»£ç æ ‡ç­¾åˆ‡æ¢
    document.querySelectorAll('.code-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const lang = this.dataset.lang;
            const container = this.closest('.code-container');

            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            container.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');

            // åˆ‡æ¢ä»£ç å†…å®¹
            container.querySelectorAll('.code-content').forEach(content => {
                content.style.display = 'none';
            });
            container.querySelector(`#${lang}-code`).style.display = 'block';
        });
    });

    // å¤åˆ¶ä»£ç åŠŸèƒ½
    function copyCode() {
        const activeCode = document.querySelector('.code-content:not([style*="display: none"]) code');
        if (activeCode) {
            const text = activeCode.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }
    }

    // è¿è¡Œä»£ç åŠŸèƒ½ï¼ˆæ¨¡æ‹Ÿï¼‰
    function runCode() {
        const outputElement = document.querySelector('.code-content:not([style*="display: none"]) .code-output');
        if (outputElement) {
            outputElement.classList.add('show');
            showNotification('ä»£ç è¿è¡Œå®Œæˆï¼æŸ¥çœ‹è¾“å‡ºç»“æœã€‚');
        }
    }

    // é€šçŸ¥ç³»ç»Ÿ
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.innerHTML = `
            <span>${message}</span>
        `;

        if (type === 'error') {
            notification.style.background = '#ef4444';
        } else if (type === 'warning') {
            notification.style.background = '#f59e0b';
        }

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }

    // å­¦ä¹ åé¦ˆ
    function submitFeedback(type) {
        const responseElement = document.getElementById('feedback-response');
        responseElement.style.display = 'block';

        // å‘é€åé¦ˆåˆ°åˆ†æç³»ç»Ÿï¼ˆè¿™é‡Œæ˜¯æ¨¡æ‹Ÿï¼‰
        console.log('Feedback submitted:', type);

        // æ ¹æ®åé¦ˆç±»å‹æ˜¾ç¤ºä¸åŒæ¶ˆæ¯
        if (type === 'confusing') {
            responseElement.innerHTML = `
                <p style="color: var(--accent-yellow);">æ„Ÿè°¢åé¦ˆï¼å“ªéƒ¨åˆ†è®©ä½ å›°æƒ‘ï¼Ÿ</p>
                <p style="font-size: 0.875rem; margin-top: 0.5rem;">
                    ä½ å¯ä»¥è¯•è¯•è°ƒæ•´å­¦ä¹ æ·±åº¦ï¼Œæˆ–è€…å‘å­¦ä¹ ä¼™ä¼´å¯»æ±‚å¸®åŠ©ã€‚
                </p>
            `;
        }
    }

    // ç›‘å¬æ»šåŠ¨ï¼Œæ ‡è®°å·²è¯»ç« èŠ‚
    const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.5
    };

    const sectionObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting && !completedSections.has(entry.target.id)) {
                completedSections.add(entry.target.id);
                checkAchievements();
            }
        });
    }, observerOptions);

    // è§‚å¯Ÿæ‰€æœ‰ç« èŠ‚
    sections.forEach(section => {
        sectionObserver.observe(section);
    });

    // é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + K: æ‰“å¼€æœç´¢
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            // è¿™é‡Œå¯ä»¥å®ç°æœç´¢åŠŸèƒ½
            showNotification('æœç´¢åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // Esc: å…³é—­ä¾§è¾¹æ 
        if (e.key === 'Escape') {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
        }
    });

    // è‡ªåŠ¨ä¿å­˜å­¦ä¹ è¿›åº¦
    function saveProgress() {
        const progress = {
            completedSections: Array.from(completedSections),
            currentDifficulty: currentDifficulty,
            achievements: achievements,
            timestamp: Date.now()
        };
        localStorage.setItem('mlp-progress', JSON.stringify(progress));
    }

    // åŠ è½½å­¦ä¹ è¿›åº¦
    function loadProgress() {
        const saved = localStorage.getItem('mlp-progress');
        if (saved) {
            const progress = JSON.parse(saved);
            completedSections = new Set(progress.completedSections);
            currentDifficulty = progress.currentDifficulty || 'beginner';
            achievements = progress.achievements || achievements;

            // æ›´æ–°UI
            updateContentVisibility(currentDifficulty);
            checkAchievements();

            showNotification('å·²æ¢å¤ä¸Šæ¬¡å­¦ä¹ è¿›åº¦');
        }
    }

    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
    window.addEventListener('load', () => {
        // åŠ è½½è¿›åº¦
        loadProgress();

        // è®¾ç½®å®šæœŸä¿å­˜
        setInterval(saveProgress, 60000); // æ¯åˆ†é’Ÿä¿å­˜ä¸€æ¬¡

        // åˆå§‹åŒ–å¯è§†åŒ–
        drawMiniPatterns();

        // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
        setTimeout(() => {
            learningBuddy.classList.add('active');
            updateBuddyMessage('æ¬¢è¿æ¥åˆ°å¤šå±‚æ„ŸçŸ¥æœºçš„å­¦ä¹ ä¹‹æ—…ï¼æˆ‘æ˜¯å°æ™ºï¼Œéšæ—¶ä¸ºä½ æä¾›å¸®åŠ©ã€‚è¯•è¯•ç‚¹å‡»ä¾§è¾¹çš„ç»ƒä¹ é¢˜å§ï¼');
        }, 1000);
    });

    // é¡µé¢ç¦»å¼€æ—¶ä¿å­˜è¿›åº¦
    window.addEventListener('beforeunload', saveProgress);

    // æ‰“å°ä¼˜åŒ–
    window.addEventListener('beforeprint', () => {
        document.body.classList.add('printing');
    });

    window.addEventListener('afterprint', () => {
        document.body.classList.remove('printing');
    });

    // å“åº”å¼å¤„ç†
    function handleResize() {
        const isMobile = window.innerWidth < 768;

        if (isMobile) {
            // ç§»åŠ¨ç«¯ä¼˜åŒ–
            learningBuddy.style.width = '90%';
            learningBuddy.style.left = '5%';
            learningBuddy.style.right = '5%';
        } else {
            // æ¡Œé¢ç«¯æ¢å¤
            learningBuddy.style.width = '300px';
            learningBuddy.style.left = 'auto';
            learningBuddy.style.right = '20px';
        }
    }

    window.addEventListener('resize', handleResize);
    handleResize(); // åˆå§‹è°ƒç”¨

    // æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½å›¾ç‰‡
    const lazyImages = document.querySelectorAll('img[data-src]');
    const imageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.removeAttribute('data-src');
                imageObserver.unobserve(img);
            }
        });
    });

    lazyImages.forEach(img => imageObserver.observe(img));

    // æ·»åŠ é¡µé¢å¯è§æ€§APIæ”¯æŒ
    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            // é¡µé¢éšè—æ—¶æš‚åœåŠ¨ç”»
            document.querySelectorAll('canvas').forEach(canvas => {
                canvas.dataset.paused = 'true';
            });
        } else {
            // é¡µé¢æ˜¾ç¤ºæ—¶æ¢å¤åŠ¨ç”»
            document.querySelectorAll('canvas').forEach(canvas => {
                delete canvas.dataset.paused;
            });
        }
    });

    // æ— éšœç¢æ”¯æŒï¼šä¸ºå±å¹•é˜…è¯»å™¨æ·»åŠ é¢å¤–ä¿¡æ¯
    function announceToScreenReader(message) {
        const announcement = document.createElement('div');
        announcement.className = 'visually-hidden';
        announcement.setAttribute('role', 'status');
        announcement.setAttribute('aria-live', 'polite');
        announcement.textContent = message;

        document.body.appendChild(announcement);

        setTimeout(() => {
            document.body.removeChild(announcement);
        }, 1000);
    }

    // å®Œæˆç« èŠ‚æ—¶é€šçŸ¥å±å¹•é˜…è¯»å™¨
    const originalCheckAchievements = checkAchievements;
    checkAchievements = function() {
        originalCheckAchievements();
        const completed = completedSections.size;
        announceToScreenReader(`å·²å®Œæˆ ${completed} ä¸ªç« èŠ‚`);
    };

    console.log('ğŸ‰ MLPæ•™ç¨‹åŠ è½½å®Œæˆï¼ç¥å­¦ä¹ æ„‰å¿«ï¼');
</script>
</body>
</html>