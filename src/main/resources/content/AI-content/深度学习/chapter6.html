<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬6ç« ï¼šç°ä»£CNN - æ·±åº¦ã€å®½åº¦ä¸æ·å¾„ | æ·±åº¦å­¦ä¹ æ¶æ„é©å‘½</title>
    <meta name="description" content="ä»VGGåˆ°ResNetï¼Œæ¢ç´¢å¦‚ä½•é€šè¿‡æ®‹å·®å­¦ä¹ çªç ´æ·±åº¦æé™ï¼Œç†è§£ç°ä»£CNNæ¶æ„çš„è®¾è®¡è‰ºæœ¯">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <style>
        /* ===== CSSå˜é‡å®šä¹‰ ===== */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --resnet-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --depth-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --bg-dark: #0f172a;
            --bg-section: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --accent-red: #ef4444;
            --accent-green: #22c55e;
            --accent-blue: #06b6d4;
            --accent-yellow: #fbbf24;
            --accent-purple: #8b5cf6;
            --accent-pink: #ec4899;
            --accent-orange: #f97316;
            --accent-cyan: #06b6d4;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.3);
            --animation-duration: 0.3s;
            --content-max-width: 1200px;
        }

        /* äº®è‰²ä¸»é¢˜ */
        [data-theme="light"] {
            --bg-dark: #ffffff;
            --bg-section: #f8fafc;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        /* ===== å…¨å±€æ ·å¼ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color var(--animation-duration) ease;
        }

        /* ===== å¸ƒå±€ç»„ä»¶ ===== */
        .container {
            max-width: var(--content-max-width);
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* ===== å¯¼èˆªæ  ===== */
        .nav-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border-bottom: 1px solid var(--border-color);
            transition: transform 0.3s ease;
        }

        .nav-header.hidden {
            transform: translateY(-100%);
        }

        .nav-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 0;
        }

        .nav-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-title h1 {
            font-size: 1.25rem;
            font-weight: 600;
            background: var(--resnet-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn-control {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .btn-control:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .nav-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
        }

        .progress-bar {
            height: 100%;
            background: var(--resnet-gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ===== ä¾§è¾¹å¯¼èˆª ===== */
        .sidebar {
            position: fixed;
            left: -300px;
            top: 60px;
            bottom: 0;
            width: 300px;
            background: var(--bg-section);
            border-right: 1px solid var(--border-color);
            padding: 2rem;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 999;
        }

        .sidebar.open {
            transform: translateX(300px);
        }

        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 998;
        }

        .sidebar-overlay.active {
            display: block;
        }

        .toc-item {
            display: block;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
            margin-bottom: 0.25rem;
        }

        .toc-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .toc-item.active {
            background: var(--resnet-gradient);
            color: white;
        }

        /* ===== ä¸»å†…å®¹åŒº ===== */
        main {
            margin-top: 80px;
            padding-bottom: 4rem;
        }

        /* ===== ç« èŠ‚å¡ç‰‡ ===== */
        .chapter-hero {
            background: var(--resnet-gradient);
            padding: 4rem 0;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }

        .chapter-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: pulse 10s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        .chapter-hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: white;
        }

        .chapter-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: fadeInUp 0.8s ease;
        }

        .chapter-hero p {
            font-size: 1.25rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            animation: fadeInUp 0.8s ease 0.2s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== å†…å®¹åŒºå— ===== */
        .section-card {
            background: var(--bg-section);
            border-radius: 1rem;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            transition: transform var(--animation-duration) ease;
        }

        .section-card:hover {
            transform: translateY(-2px);
        }

        /* ===== æ•…äº‹å¡ç‰‡ ===== */
        .story-card {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.15), rgba(245, 87, 108, 0.1));
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 2px solid rgba(240, 147, 251, 0.2);
            position: relative;
            overflow: hidden;
        }

        .story-card::before {
            content: 'ğŸ—ï¸';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 5rem;
            opacity: 0.1;
            transform: rotate(15deg);
        }

        /* ===== å¯¹è¯æ¡† ===== */
        .dialogue-box {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid var(--accent-pink);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
            position: relative;
        }

        .dialogue-box .speaker {
            font-weight: bold;
            color: var(--accent-pink);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dialogue-box .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        /* ===== æ¦‚å¿µç½‘æ ¼ ===== */
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .concept-card {
            padding: 1.5rem;
            border-radius: 0.75rem;
            transition: all var(--animation-duration) ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .concept-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--resnet-gradient);
            transform: scaleX(0);
            transition: transform var(--animation-duration) ease;
        }

        .concept-card:hover::before {
            transform: scaleX(1);
        }

        .concept-card.why {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .concept-card.what {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .concept-card.how {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .concept-card.pitfall {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        /* ===== æ•°å­¦å®¹å™¨ - å¢å¼ºç‰ˆ ===== */
        .math-container {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.1), rgba(245, 87, 108, 0.05));
            border: 2px solid rgba(240, 147, 251, 0.3);
            border-radius: 1rem;
            padding: 2.5rem;
            margin: 2rem 0;
            position: relative;
            overflow: hidden;
        }

        .math-container::before {
            content: 'âˆ‡';
            position: absolute;
            top: -30px;
            right: 20px;
            font-size: 6rem;
            opacity: 0.05;
            font-family: 'Times New Roman', serif;
        }

        /* ç¾åŒ–çš„æ•°å­¦å…¬å¼ */
        .math-formula {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
            font-size: 1.2rem;
            overflow-x: auto;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .math-formula-title {
            position: absolute;
            top: -12px;
            left: 2rem;
            background: var(--bg-section);
            padding: 0 1rem;
            font-size: 0.875rem;
            color: var(--accent-pink);
            font-weight: 600;
        }

        /* ===== æ®‹å·®å—å¯è§†åŒ– ===== */
        .residual-block-viz {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            position: relative;
        }

        .residual-path {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .residual-main {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
        }

        .residual-layer {
            background: rgba(240, 147, 251, 0.2);
            border: 2px solid rgba(240, 147, 251, 0.5);
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
            position: relative;
            transition: all 0.3s ease;
        }

        .residual-layer:hover {
            transform: scale(1.05);
            background: rgba(240, 147, 251, 0.3);
            box-shadow: 0 8px 16px rgba(240, 147, 251, 0.2);
        }

        .residual-skip {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-green);
            transform: translateY(-50%);
            z-index: -1;
        }

        .residual-skip::before,
        .residual-skip::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--accent-green);
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
        }

        .residual-skip::before {
            left: -5px;
        }

        .residual-skip::after {
            right: -5px;
        }

        /* ===== æ·±åº¦å¯¹æ¯”å›¾ ===== */
        .depth-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .depth-item {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            transition: all 0.3s ease;
        }

        .depth-item:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.08);
        }

        .depth-bar {
            width: 60px;
            margin: 0 auto 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            overflow: hidden;
            position: relative;
        }

        .depth-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--depth-gradient);
            transition: height 1s ease;
        }

        /* ===== æ¶æ„æ¼”åŒ–æ—¶é—´çº¿ ===== */
        .timeline {
            position: relative;
            padding: 2rem 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border-color);
            transform: translateX(-50%);
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin: 2rem 0;
            position: relative;
        }

        .timeline-item:nth-child(even) {
            flex-direction: row-reverse;
        }

        .timeline-content {
            width: 45%;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .timeline-content:hover {
            transform: scale(1.02);
            background: rgba(255, 255, 255, 0.08);
        }

        .timeline-dot {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: var(--resnet-gradient);
            border-radius: 50%;
            border: 3px solid var(--bg-dark);
            z-index: 10;
        }

        .timeline-year {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: -30px;
            font-weight: bold;
            color: var(--accent-pink);
        }

        /* ===== æ¢¯åº¦æµåŠ¨ç”» ===== */
        .gradient-flow-container {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
        }

        .gradient-path {
            stroke-dasharray: 5, 5;
            animation: flow 2s linear infinite;
        }

        @keyframes flow {
            to {
                stroke-dashoffset: -10;
            }
        }

        /* ===== è®­ç»ƒæ›²çº¿ ===== */
        .training-curves {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .curve-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            padding: 1.5rem;
            position: relative;
        }

        .curve-title {
            font-weight: 600;
            color: var(--accent-cyan);
            margin-bottom: 1rem;
            text-align: center;
        }

        /* ===== æ€è€ƒç›’å­ ===== */
        .think-box {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(124, 58, 237, 0.1));
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
        }

        .think-box::before {
            content: 'ğŸ¤”';
            position: absolute;
            top: -15px;
            left: 30px;
            font-size: 2rem;
            background: var(--bg-section);
            padding: 0 10px;
        }

        /* ===== ä»£ç å®¹å™¨ ===== */
        .code-container {
            margin: 2rem 0;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .code-header {
            background: #1a1a2e;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .code-header-right {
            display: flex;
            gap: 0.5rem;
        }

        .code-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
        }

        .code-tab.active {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .code-action {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .code-action:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .code-content {
            background: #0d1117;
            overflow-x: auto;
            position: relative;
        }

        .code-content pre {
            margin: 0;
            padding: 1.5rem;
        }

        .code-content code {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .code-output {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.875rem;
            display: none;
        }

        .code-output.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== å¯è§†åŒ–å®¹å™¨ ===== */
        .visualization-container {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
        }

        .viz-controls {
            display: flex;
            gap: 2rem;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .viz-control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .viz-control-group label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        input[type="range"] {
            width: 150px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--resnet-gradient);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider-value {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-family: monospace;
            min-width: 50px;
            text-align: center;
        }

        canvas {
            display: block;
            margin: 0 auto;
            border-radius: 0.5rem;
            background: rgba(0, 0, 0, 0.2);
        }

        /* ===== å‚æ•°å¯¹æ¯”è¡¨æ ¼ ===== */
        .comparison-table {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            overflow: hidden;
            margin: 2rem 0;
            box-shadow: var(--shadow-lg);
        }

        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th {
            background: var(--resnet-gradient);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }

        .comparison-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .comparison-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .comparison-table .highlight {
            color: var(--accent-green);
            font-weight: bold;
        }

        /* ===== æ¶æ„å¯¹æ¯” ===== */
        .arch-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .arch-model {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            position: relative;
            transition: all 0.3s ease;
        }

        .arch-model:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.08);
        }

        .model-layers {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin: 1rem 0;
            height: 200px;
            justify-content: flex-end;
        }

        .model-layer {
            background: var(--depth-gradient);
            height: 4px;
            border-radius: 2px;
            opacity: 0.8;
        }

        /* ===== æŒ‰é’®æ ·å¼ ===== */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--resnet-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(240, 147, 251, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* ===== æç¤ºæ¡† ===== */
        .tip {
            display: flex;
            gap: 1rem;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin: 1.5rem 0;
        }

        .tip-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .tip-content {
            flex: 1;
        }

        .tip.info {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .tip.warning {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .tip.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .tip.success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        /* ===== åŠ¨ä½œæ¸…å• ===== */
        .action-checklist {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin: 0.5rem 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            transition: all var(--animation-duration) ease;
        }

        .checklist-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(4px);
        }

        .checklist-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--accent-yellow);
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .checklist-checkbox.checked {
            background: var(--accent-yellow);
        }

        .checklist-checkbox.checked::after {
            content: 'âœ“';
            color: var(--bg-dark);
            font-weight: bold;
        }

        /* ===== å“åº”å¼è®¾è®¡ ===== */
        @media (max-width: 1024px) {
            .chapter-hero h1 {
                font-size: 2.5rem;
            }

            .concept-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .timeline-item,
            .timeline-item:nth-child(even) {
                flex-direction: column;
            }

            .timeline-content {
                width: 100%;
            }

            .training-curves {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .nav-title h1 {
                font-size: 1rem;
            }

            .section-card {
                padding: 1.5rem;
            }

            .chapter-hero {
                padding: 3rem 0;
            }

            .chapter-hero h1 {
                font-size: 2rem;
            }

            .chapter-hero p {
                font-size: 1rem;
            }

            .viz-controls {
                flex-direction: column;
                align-items: stretch;
            }

            input[type="range"] {
                width: 100%;
            }

            .comparison-table {
                overflow-x: auto;
            }

            .comparison-table table {
                min-width: 600px;
            }

            .arch-comparison {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ===== å·¥å…·ç±» ===== */
        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }

        /* ===== åŠ è½½åŠ¨ç”» ===== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-pink);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== åŠ¨ç”»å…³é”®å¸§ ===== */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* å­¦ä¹ ä¼™ä¼´æ ·å¼ */
        .learning-buddy {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background: var(--bg-section);
            border: 2px solid var(--accent-pink);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            z-index: 900;
            transform: translateY(400px);
            transition: transform 0.5s ease;
        }

        .learning-buddy.active {
            transform: translateY(0);
        }

        .learning-buddy.minimized {
            width: auto;
            padding: 0;
            border-radius: 50%;
            overflow: hidden;
        }

        .learning-buddy.minimized .buddy-content {
            display: none;
        }

        .learning-buddy.minimized .buddy-avatar {
            margin: 0;
            cursor: pointer;
        }

        .buddy-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .buddy-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            flex-shrink: 0;
        }

        .buddy-controls {
            display: flex;
            gap: 0.5rem;
        }

        .buddy-control-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .buddy-control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .buddy-message {
            background: rgba(240, 147, 251, 0.1);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .buddy-message::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(240, 147, 251, 0.1);
        }

        /* æˆå°±å¼¹çª—æ ·å¼ */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: -400px;
            width: 350px;
            background: var(--bg-section);
            border: 2px solid var(--accent-yellow);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: right 0.5s ease;
        }

        .achievement-popup.show {
            right: 20px;
        }

        .achievement-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .achievement-icon {
            width: 60px;
            height: 60px;
            background: var(--accent-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .achievement-content h3 {
            color: var(--accent-yellow);
            margin-bottom: 0.25rem;
        }

        /* æ·»åŠ å­¦ä¹ ä¼™ä¼´æŒ‰é’®åˆ°å¯¼èˆªæ  */
        #toggle-buddy {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        #toggle-buddy:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        /* ä¸€å¥è¯ç†è§£åŒºåŸŸä¸“ç”¨æ ·å¼ */
        .key-concept-card {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            border-radius: 1.5rem;
            padding: 3rem;
            margin: 0 auto;
            max-width: 1000px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* æ¢¯åº¦æµSVGæ ·å¼ */
        .gradient-flow-svg {
            width: 100%;
            height: 300px;
        }

        .flow-node {
            fill: rgba(240, 147, 251, 0.8);
            stroke: #f093fb;
            stroke-width: 2;
            transition: all 0.3s ease;
        }

        .flow-node:hover {
            fill: rgba(240, 147, 251, 1);
            transform: scale(1.1);
        }

        .flow-path {
            stroke: #f5576c;
            stroke-width: 3;
            fill: none;
            opacity: 0.8;
        }

        .skip-connection {
            stroke: #22c55e;
            stroke-width: 4;
            fill: none;
            stroke-dasharray: 10, 5;
            animation: dash 2s linear infinite;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: -15;
            }
        }

        /* ç½‘ç»œæ·±åº¦å¯è§†åŒ– */
        .network-depth-viz {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 300px;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 1rem;
            margin: 2rem 0;
        }

        .network-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .network-bar {
            width: 60px;
            background: var(--depth-gradient);
            border-radius: 0.5rem 0.5rem 0 0;
            position: relative;
            transition: all 0.5s ease;
        }

        .network-bar::after {
            content: attr(data-depth);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            color: var(--accent-cyan);
        }

        .network-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 0.5rem;
        }

        /* ç‰¹å¾é‡ç”¨å¯è§†åŒ– */
        .feature-reuse-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .feature-cell {
            aspect-ratio: 1;
            background: rgba(240, 147, 251, 0.2);
            border-radius: 0.25rem;
            position: relative;
            transition: all 0.3s ease;
        }

        .feature-cell.active {
            background: rgba(240, 147, 251, 0.8);
            transform: scale(1.1);
            z-index: 10;
        }

        .feature-cell.connected {
            background: rgba(34, 197, 94, 0.5);
        }

        /* è®­ç»ƒåŠ¨æ€å›¾è¡¨ */
        .training-chart {
            position: relative;
            height: 250px;
            margin: 1rem 0;
        }

        .chart-grid {
            position: absolute;
            inset: 0;
            border-left: 2px solid var(--border-color);
            border-bottom: 2px solid var(--border-color);
        }

        .chart-line {
            stroke-width: 3;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .chart-line.plain {
            stroke: #ef4444;
        }

        .chart-line.resnet {
            stroke: #22c55e;
        }

        .chart-point {
            r: 4;
            transition: r 0.3s ease;
        }

        .chart-point:hover {
            r: 6;
        }

        /* Inception æ¨¡å—å¯è§†åŒ– */
        .inception-module {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 1rem;
            margin: 2rem 0;
        }

        .inception-branch {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background: rgba(79, 172, 254, 0.1);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .inception-branch:hover {
            transform: translateY(-4px);
            background: rgba(79, 172, 254, 0.2);
        }

        .inception-op {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* æ ‡å‡†åŒ–æ¯”è¾ƒ */
        .norm-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .norm-method {
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .norm-method::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--resnet-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .norm-method:hover::before {
            transform: scaleX(1);
        }

        .norm-formula {
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            color: var(--accent-cyan);
            margin: 1rem 0;
            padding: 0.5rem;
            background: rgba(6, 182, 212, 0.1);
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>

<!-- å¯¼èˆªæ  -->
<nav class="nav-header" role="navigation" aria-label="ä¸»å¯¼èˆª">
    <div class="container">
        <div class="nav-content">
            <div class="nav-title">
                <button id="toggle-sidebar" class="btn-control" aria-label="åˆ‡æ¢ä¾§è¾¹æ ">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <h1>ç¬¬6ç« ï¼šç°ä»£CNNæ¶æ„</h1>
            </div>
            <div class="nav-controls">
                <button id="toggle-buddy" class="btn-control" aria-label="å­¦ä¹ åŠ©æ‰‹">
                    ğŸ—ï¸
                </button>
                <button id="toggle-animations" class="btn-control" aria-label="åˆ‡æ¢åŠ¨ç”»">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M10 8l6 4-6 4V8z"></path>
                    </svg>
                </button>
                <button id="toggle-theme" class="btn-control" aria-label="åˆ‡æ¢ä¸»é¢˜">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div class="nav-progress">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
    </div>
</nav>

<!-- ä¾§è¾¹æ  -->
<aside class="sidebar" id="sidebar">
    <h3 style="margin-bottom: 1.5rem; color: var(--accent-pink);">ç›®å½•å¯¼èˆª</h3>
    <nav>
        <a href="#intro" class="toc-item active">æ·±åº¦çš„è¯…å’’</a>
        <a href="#degradation" class="toc-item">é€€åŒ–é—®é¢˜ï¼šæ·±åº¦çš„ç“¶é¢ˆ</a>
        <a href="#residual" class="toc-item">æ®‹å·®å­¦ä¹ ï¼šä¼˜é›…çš„æ·å¾„</a>
        <a href="#resnet" class="toc-item">ResNetï¼šæ·±åº¦é©å‘½</a>
        <a href="#densenet" class="toc-item">DenseNetï¼šå¯†é›†è¿æ¥</a>
        <a href="#inception" class="toc-item">Inceptionï¼šå¹¶è¡Œä¹‹ç¾</a>
        <a href="#bottleneck" class="toc-item">ç“¶é¢ˆè®¾è®¡ï¼šæ•ˆç‡ä¸æ€§èƒ½</a>
        <a href="#normalization" class="toc-item">å½’ä¸€åŒ–æŠ€æœ¯æ¼”è¿›</a>
        <a href="#architecture-art" class="toc-item">æ¶æ„è®¾è®¡çš„è‰ºæœ¯</a>
        <a href="#practice" class="toc-item">å®æˆ˜ï¼šæ„å»ºResNet</a>
        <a href="#summary" class="toc-item">æ€»ç»“ä¸å±•æœ›</a>
    </nav>
</aside>

<!-- ä¾§è¾¹æ é®ç½© -->
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<!-- ä¸»å†…å®¹ -->
<main>
    <!-- ç« èŠ‚æ ‡é¢˜ -->
    <section class="chapter-hero">
        <!-- èƒŒæ™¯è£…é¥° -->
        <div style="position: absolute; top: -50%; right: -10%; width: 600px; height: 600px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
        <div style="position: absolute; bottom: -30%; left: -5%; width: 400px; height: 400px; background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%); border-radius: 50%;"></div>

        <div class="container">
            <div class="chapter-hero-content">
                <h1>æ·±åº¦ã€å®½åº¦ä¸æ·å¾„ï¼šç°ä»£CNNæ¶æ„çš„è‰ºæœ¯</h1>
                <p>å½“æ·±åº¦æˆä¸ºéšœç¢ï¼Œæ·å¾„æˆä¸ºçªç ´çš„å…³é”®...</p>

                <!-- æ ‡ç­¾ -->
                <div style="display: flex; justify-content: center; gap: 1.5rem; flex-wrap: wrap;">
                    <span style="background: rgba(255, 255, 255, 0.25); padding: 0.75rem 1.5rem; border-radius: 30px; display: flex; align-items: center; gap: 0.5rem; backdrop-filter: blur(10px); font-size: 1.1rem;">
                        <span style="font-size: 1.3rem;">ğŸ—ï¸</span> æ¶æ„é©æ–°
                    </span>
                    <span style="background: rgba(255, 255, 255, 0.25); padding: 0.75rem 1.5rem; border-radius: 30px; display: flex; align-items: center; gap: 0.5rem; backdrop-filter: blur(10px); font-size: 1.1rem;">
                        <span style="font-size: 1.3rem;">â±ï¸</span> 180åˆ†é’Ÿ
                    </span>
                    <span style="background: rgba(255, 255, 255, 0.25); padding: 0.75rem 1.5rem; border-radius: 30px; display: flex; align-items: center; gap: 0.5rem; backdrop-filter: blur(10px); font-size: 1.1rem;">
                        <span style="font-size: 1.3rem;">ğŸ¯</span> æ·±åº¦çªç ´
                    </span>
                </div>
            </div>
        </div>
    </section>

    <!-- ä¸€å¥è¯ç†è§£æ®‹å·®ç½‘ç»œ -->
    <section style="background: var(--bg-dark); padding: 4rem 0 2rem 0; position: relative;">
        <div class="container">
            <div class="key-concept-card">
                <h2 style="color: white; font-size: 1.8rem; margin-bottom: 2rem; text-align: center; display: flex; align-items: center; justify-content: center; gap: 1rem;">
                    <span style="font-size: 2rem;">ğŸ’¡</span>
                    ä¸€å¥è¯ç†è§£æ®‹å·®ç½‘ç»œ
                </h2>

                <p style="color: #e2e8f0; font-size: 1.3rem; line-height: 1.8; text-align: center; margin-bottom: 3rem;">
                    æ®‹å·®ç½‘ç»œè®©ç¥ç»ç½‘ç»œå­¦ä¹ "å˜åŒ–é‡"è€Œä¸æ˜¯"ç»å¯¹å€¼"ï¼Œ<br>
                    é€šè¿‡è·³è·ƒè¿æ¥è®©æ¢¯åº¦ç›´æ¥æµå‘æµ…å±‚ï¼Œ<br>
                    <span style="color: #fbbf24; font-weight: 600;">å°±åƒç»™æ·±å±‚ç½‘ç»œè£…ä¸Šäº†"ç”µæ¢¯"ï¼Œä¿¡æ¯å¯ä»¥è·³è¿‡ä¸­é—´å±‚ç›´è¾¾ç›®çš„åœ°ã€‚</span>
                </p>

                <!-- å››ä¸ªæ ¸å¿ƒæ¦‚å¿µ -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 2rem; margin-bottom: 3rem;">
                    <div style="text-align: center;">
                        <div style="width: 80px; height: 80px; margin: 0 auto 1rem; background: rgba(255,255,255,0.1); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; border: 1px solid rgba(255,255,255,0.2);">
                            â•
                        </div>
                        <h4 style="color: white; margin-bottom: 0.5rem; font-size: 1rem;">æ’ç­‰æ˜ å°„</h4>
                        <p style="color: #94a3b8; font-size: 0.85rem; line-height: 1.4;">
                            æœ€å·®æƒ…å†µä¸‹<br>ä»€ä¹ˆéƒ½ä¸å­¦
                        </p>
                    </div>

                    <div style="text-align: center;">
                        <div style="width: 80px; height: 80px; margin: 0 auto 1rem; background: rgba(255,255,255,0.1); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; border: 1px solid rgba(255,255,255,0.2);">
                            ğŸ”„
                        </div>
                        <h4 style="color: white; margin-bottom: 0.5rem; font-size: 1rem;">æ®‹å·®å­¦ä¹ </h4>
                        <p style="color: #94a3b8; font-size: 0.85rem; line-height: 1.4;">
                            å­¦ä¹ F(x)=H(x)-x<br>æ¯”å­¦H(x)å®¹æ˜“
                        </p>
                    </div>

                    <div style="text-align: center;">
                        <div style="width: 80px; height: 80px; margin: 0 auto 1rem; background: rgba(255,255,255,0.1); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; border: 1px solid rgba(255,255,255,0.2);">
                            âš¡
                        </div>
                        <h4 style="color: white; margin-bottom: 0.5rem; font-size: 1rem;">æ¢¯åº¦é«˜é€Ÿè·¯</h4>
                        <p style="color: #94a3b8; font-size: 0.85rem; line-height: 1.4;">
                            æ¢¯åº¦ç›´æ¥ä¼ æ’­<br>é¿å…æ¶ˆå¤±/çˆ†ç‚¸
                        </p>
                    </div>

                    <div style="text-align: center;">
                        <div style="width: 80px; height: 80px; margin: 0 auto 1rem; background: rgba(255,255,255,0.1); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; border: 1px solid rgba(255,255,255,0.2);">
                            ğŸ“ˆ
                        </div>
                        <h4 style="color: white; margin-bottom: 0.5rem; font-size: 1rem;">è¶…æ·±ç½‘ç»œ</h4>
                        <p style="color: #94a3b8; font-size: 0.85rem; line-height: 1.4;">
                            è½»æ¾è®­ç»ƒ<br>1000å±‚ç½‘ç»œ
                        </p>
                    </div>
                </div>

                <!-- é€šä¿—æ˜“æ‡‚çš„æ€»ç»“ -->
                <div style="background: rgba(251, 191, 36, 0.15); border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 1rem; padding: 2rem; position: relative;">
                    <div style="position: absolute; top: -15px; left: 30px; background: #475569; padding: 0 15px; border-radius: 20px; font-size: 1.2rem;">
                        ğŸŒŸ é€šä¿—åœ°è¯´
                    </div>

                    <p style="color: #f1f5f9; font-size: 1.15rem; line-height: 1.8; margin: 0;">
                        <strong>æƒ³è±¡ä½ åœ¨çˆ¬ä¸€åº§å¾ˆé«˜çš„å±±ï¼š</strong>
                    </p>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
                        <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 0.75rem;">
                            <h5 style="color: #fbbf24; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span>ğŸš¶</span> ä¼ ç»Ÿæ–¹å¼ï¼šä¸€æ­¥æ­¥çˆ¬
                            </h5>
                            <p style="color: #cbd5e1; font-size: 0.95rem; line-height: 1.6;">
                                æ¯ä¸€å±‚éƒ½è¦å®Œæ•´å­¦ä¹ æ‰€æœ‰ä¿¡æ¯ï¼Œè¶Šé«˜è¶Šç´¯ï¼Œæœ€åå¯èƒ½çˆ¬ä¸åŠ¨ï¼ˆæ¢¯åº¦æ¶ˆå¤±ï¼‰
                            </p>
                        </div>

                        <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 0.75rem;">
                            <h5 style="color: #fbbf24; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span>ğŸš¡</span> ResNetæ–¹å¼ï¼šåç¼†è½¦
                            </h5>
                            <p style="color: #cbd5e1; font-size: 0.95rem; line-height: 1.6;">
                                æœ‰ç›´è¾¾çš„"ç¼†è½¦"ï¼ˆè·³è·ƒè¿æ¥ï¼‰ï¼Œå¯ä»¥è½»æ¾åˆ°è¾¾é«˜å¤„ï¼Œä¸­é—´æƒ³åœå°±åœ
                            </p>
                        </div>

                        <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 0.75rem;">
                            <h5 style="color: #fbbf24; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span>ğŸ¯</span> å­¦ä¹ ç›®æ ‡å˜ç®€å•
                            </h5>
                            <p style="color: #cbd5e1; font-size: 0.95rem; line-height: 1.6;">
                                ä¸ç”¨å­¦"æˆ‘åœ¨å“ª"ï¼ˆH(x)ï¼‰ï¼Œåªéœ€å­¦"æˆ‘è¦èµ°å¤šè¿œ"ï¼ˆF(x)ï¼‰
                            </p>
                        </div>

                        <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 0.75rem;">
                            <h5 style="color: #fbbf24; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span>ğŸ”’</span> å®‰å…¨ä¿éšœ
                            </h5>
                            <p style="color: #cbd5e1; font-size: 0.95rem; line-height: 1.6;">
                                å³ä½¿æŸå±‚ä»€ä¹ˆéƒ½æ²¡å­¦åˆ°ï¼Œè‡³å°‘èƒ½ä¿æŒåŸæ ·ï¼ˆæ’ç­‰æ˜ å°„ï¼‰ï¼Œä¸ä¼šæ›´å·®
                            </p>
                        </div>
                    </div>

                    <div style="background: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e; padding: 1rem 1.5rem; margin-top: 1.5rem; border-radius: 0 0.5rem 0.5rem 0;">
                        <p style="color: #f1f5f9; font-size: 1.05rem; margin: 0; line-height: 1.6;">
                            <strong>ğŸ’¡ ResNetçš„å¤©æ‰ä¹‹å¤„ï¼š</strong>
                            å®ƒä¸æ˜¯è®©ç½‘ç»œå˜å¾—æ›´å¤æ‚ï¼Œè€Œæ˜¯è®©è®­ç»ƒå˜å¾—æ›´ç®€å•ã€‚é€šè¿‡"åŠ æ³•"è¿™ä¸ªç®€å•æ“ä½œï¼Œ
                            è§£å†³äº†æ·±åº¦å­¦ä¹ æœ€æ£˜æ‰‹çš„é—®é¢˜â€”â€”å¦‚ä½•è®­ç»ƒéå¸¸æ·±çš„ç½‘ç»œã€‚
                        </p>
                    </div>
                </div>
            </div>

            <!-- æœ€ç®€æ´çš„ä¸€å¥è¯æ€»ç»“ -->
            <div style="text-align: center; margin-top: 3rem;">
                <p style="font-size: 1.3rem; color: var(--accent-pink); font-weight: 600; padding: 1rem 2rem; background: rgba(240, 147, 251, 0.1); border-radius: 50px; display: inline-block; border: 2px solid rgba(240, 147, 251, 0.3);">
                    ğŸ¯ ç®€å•è¯´ï¼šResNeté€šè¿‡"æŠ„è¿‘è·¯"è®©æ·±åº¦ç½‘ç»œå˜å¾—å¯è®­ç»ƒï¼Œå¼€å¯äº†è¶…æ·±ç½‘ç»œæ—¶ä»£
                </p>
            </div>
        </div>
    </section>

    <!-- ç« èŠ‚å†…å®¹å¼€å§‹ -->
    <div style="background: var(--bg-dark); padding-top: 2rem;">
        <div class="container">

            <!-- å­¦ä¹ ç›®æ ‡ -->
            <section class="section-card">
                <h2 style="color: var(--accent-pink); margin-bottom: 1.5rem;">ğŸ“š æœ¬ç« å­¦ä¹ ç›®æ ‡</h2>
                <div class="concept-grid">
                    <div class="concept-card what">
                        <h3 style="color: var(--accent-green); margin-bottom: 0.5rem;">âœ“ ç†è§£é€€åŒ–é—®é¢˜</h3>
                        <p>æ·±å…¥ç†è§£ä¸ºä»€ä¹ˆæ›´æ·±çš„ç½‘ç»œåè€Œè¡¨ç°æ›´å·®</p>
                    </div>
                    <div class="concept-card how">
                        <h3 style="color: var(--accent-blue); margin-bottom: 0.5rem;">âœ“ æŒæ¡æ®‹å·®å­¦ä¹ </h3>
                        <p>å­¦ä¼šè®¾è®¡å’Œå®ç°å„ç§æ®‹å·®ç»“æ„</p>
                    </div>
                    <div class="concept-card why">
                        <h3 style="color: var(--accent-red); margin-bottom: 0.5rem;">âœ“ ç°ä»£æ¶æ„æ¯”è¾ƒ</h3>
                        <p>å¯¹æ¯”ResNetã€DenseNetã€Inceptionç­‰è®¾è®¡æ€æƒ³</p>
                    </div>
                    <div class="concept-card pitfall">
                        <h3 style="color: var(--accent-yellow); margin-bottom: 0.5rem;">âœ“ æ¶æ„è®¾è®¡è‰ºæœ¯</h3>
                        <p>ç†è§£å¦‚ä½•æ ¹æ®ä»»åŠ¡è®¾è®¡é«˜æ•ˆçš„ç½‘ç»œæ¶æ„</p>
                    </div>
                </div>
            </section>

            <!-- åºç« ï¼šæ·±åº¦çš„è¯…å’’ -->
            <section id="intro" class="section-card">
                <div class="story-card">
                    <h2 style="color: var(--accent-pink); margin-bottom: 1.5rem;">ğŸŒŒ 2014å¹´å†¬å¤©ï¼Œå¾®è½¯äºšç ”é™¢çš„ä¸çœ å¤œ</h2>

                    <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                        å‡Œæ™¨ä¸¤ç‚¹ï¼Œå®éªŒå®¤é‡Œåªå‰©ä¸‹ç”µè„‘é£æ‰‡çš„å—¡å—¡å£°ã€‚ä½•å‡¯æ˜ç›¯ç€å±å¹•ä¸Šçš„è®­ç»ƒæ›²çº¿ï¼Œçœ‰å¤´ç´§é”...
                    </p>

                    <div class="dialogue-box">
                        <div class="speaker">
                            <div class="avatar" style="background: linear-gradient(135deg, #f093fb, #f5576c);">ğŸ§‘â€ğŸ”¬</div>
                            ä½•å‡¯æ˜ï¼ˆç ”ç©¶å‘˜ï¼‰ï¼š
                        </div>
                        <div>"è¿™ä¸å¯èƒ½ï¼56å±‚çš„ç½‘ç»œç«Ÿç„¶æ¯”20å±‚çš„è¿˜å·®ï¼Ÿæˆ‘ä»¬ä¸€å®šé—æ¼äº†ä»€ä¹ˆ..."</div>
                    </div>

                    <div style="background: #000; color: #0f0; font-family: monospace; padding: 1.5rem; border-radius: 0.5rem; margin: 1rem 0;">
                        Training VGG-20: <br>
                        Epoch 50/100 - Loss: 0.35 - Acc: 91.2%<br>
                        <br>
                        Training VGG-56: <br>
                        Epoch 50/100 - Loss: 0.72 - Acc: 86.3% ğŸ˜±<br>
                        <span style="color: #f00;">[WARNING] Deeper network performs worse!</span>
                    </div>

                    <div class="dialogue-box mt-3">
                        <div class="speaker">
                            <div class="avatar" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">ğŸ‘¨â€ğŸ«</div>
                            å­™å‰‘ï¼ˆå¯¼å¸ˆï¼‰ï¼š
                        </div>
                        <div>"å‡¯æ˜ï¼Œä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œä¹Ÿè®¸é—®é¢˜ä¸åœ¨äºä¼˜åŒ–ï¼Œè€Œåœ¨äºæˆ‘ä»¬å¯¹æ·±åº¦çš„ç†è§£ï¼Ÿ"</div>
                    </div>

                    <div class="think-box">
                        <h3 style="color: var(--accent-purple); margin-bottom: 1rem;">ğŸ’­ å…³é”®æ´å¯Ÿ</h3>
                        <p>å¦‚æœä¸€ä¸ª56å±‚çš„ç½‘ç»œè‡³å°‘å¯ä»¥é€šè¿‡å‰20å±‚å­¦ä¹ æœ‰ç”¨ç‰¹å¾ï¼Œå36å±‚ä»€ä¹ˆéƒ½ä¸åšï¼ˆæ’ç­‰æ˜ å°„ï¼‰ï¼Œ
                            é‚£å®ƒçš„æ€§èƒ½åº”è¯¥è‡³å°‘å’Œ20å±‚ç½‘ç»œä¸€æ ·å¥½ã€‚ä½†äº‹å®å¹¶éå¦‚æ­¤ï¼Œè¿™è¯´æ˜æ·±å±‚ç½‘ç»œåœ¨ä¼˜åŒ–ä¸Šå­˜åœ¨æ ¹æœ¬æ€§é—®é¢˜ã€‚</p>
                        <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);">
                            è¿™ä¸ªç®€å•çš„è§‚å¯Ÿï¼Œå°†å¼•å‘æ·±åº¦å­¦ä¹ å†å²ä¸Šæœ€é‡è¦çš„çªç ´ä¹‹ä¸€...
                        </p>
                    </div>

                    <div class="dialogue-box mt-3">
                        <div class="speaker">
                            <div class="avatar" style="background: linear-gradient(135deg, #f093fb, #f5576c);">ğŸ§‘â€ğŸ”¬</div>
                            ä½•å‡¯æ˜ï¼ˆçµå…‰ä¸€ç°ï¼‰ï¼š
                        </div>
                        <div>"ç­‰ç­‰ï¼å¦‚æœæˆ‘ä»¬è®©ç½‘ç»œå­¦ä¹ çš„ä¸æ˜¯H(x)ï¼Œè€Œæ˜¯H(x)-xä¼šæ€æ ·ï¼Ÿè®©ç½‘ç»œå­¦ä¹ 'æ®‹å·®'è€Œä¸æ˜¯å®Œæ•´çš„æ˜ å°„ï¼"</div>
                    </div>

                    <div class="tip info">
                        <span class="tip-icon">ğŸ’¡</span>
                        <div class="tip-content">
                            <strong>å†å²æ—¶åˆ»ï¼š</strong><br>
                            2015å¹´12æœˆ10æ—¥ï¼ŒResNetè®ºæ–‡å‘è¡¨ï¼Œç«‹å³éœ‡æ’¼äº†æ•´ä¸ªæ·±åº¦å­¦ä¹ ç¤¾åŒºã€‚
                            è¿™ä¸ªç®€å•çš„æƒ³æ³•ä¸ä»…èµ¢å¾—äº†ImageNet 2015å† å†›ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå½»åº•æ”¹å˜äº†æˆ‘ä»¬å¯¹æ·±åº¦ç½‘ç»œçš„ç†è§£ã€‚
                        </div>
                    </div>
                </div>
            </section>

            <!-- ç¬¬ä¸€æ­¥ï¼šé€€åŒ–é—®é¢˜ -->
            <section id="degradation" class="section-card">
                <h2 style="color: var(--accent-red); margin-bottom: 1.5rem;">ğŸ“‰ é€€åŒ–é—®é¢˜ï¼šæ·±åº¦ç½‘ç»œçš„é˜¿å–€ç‰æ–¯ä¹‹è¸µ</h2>

                <!-- å®éªŒç»“æœå±•ç¤º -->
                <div class="visualization-container">
                    <h3 style="color: var(--accent-orange); margin-bottom: 1.5rem;">ğŸ”¬ å…³é”®å®éªŒï¼šæ·±åº¦ vs æ€§èƒ½</h3>

                    <div class="training-curves">
                        <div class="curve-container">
                            <div class="curve-title">è®­ç»ƒè¯¯å·®</div>
                            <canvas id="training-error-curve" width="400" height="250"></canvas>
                        </div>
                        <div class="curve-container">
                            <div class="curve-title">æµ‹è¯•è¯¯å·®</div>
                            <canvas id="test-error-curve" width="400" height="250"></canvas>
                        </div>
                    </div>

                    <div class="tip error mt-3">
                        <span class="tip-icon">âš ï¸</span>
                        <div class="tip-content">
                            <strong>åç›´è§‰çš„å‘ç°ï¼š</strong><br>
                            â€¢ 56å±‚ç½‘ç»œçš„è®­ç»ƒè¯¯å·®æ¯”20å±‚ç½‘ç»œæ›´é«˜<br>
                            â€¢ è¿™ä¸æ˜¯è¿‡æ‹Ÿåˆï¼ˆè®­ç»ƒå’Œæµ‹è¯•è¯¯å·®éƒ½é«˜ï¼‰<br>
                            â€¢ æ·±å±‚ç½‘ç»œåœ¨ä¼˜åŒ–ä¸Šé‡åˆ°äº†æ ¹æœ¬æ€§å›°éš¾
                        </div>
                    </div>
                </div>

                <!-- é€€åŒ–é—®é¢˜åˆ†æ -->
                <div class="concept-grid mt-3">
                    <div class="concept-card why">
                        <h3 style="color: var(--accent-red); margin-bottom: 1rem;">é—®é¢˜1ï¼šæ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸</h3>
                        <p>
                            éšç€ç½‘ç»œåŠ æ·±ï¼Œæ¢¯åº¦åœ¨åå‘ä¼ æ’­æ—¶ä¼šæŒ‡æ•°çº§åœ°å‡å°æˆ–å¢å¤§ï¼Œ
                            å¯¼è‡´æµ…å±‚å‡ ä¹æ— æ³•æ›´æ–°æˆ–æ›´æ–°è¿‡åº¦ã€‚
                        </p>
                        <div class="math-formula" style="margin-top: 1rem;">
                            <div style="font-size: 1rem;">
                                âˆ‚L/âˆ‚wâ‚ = âˆ‚L/âˆ‚y Â· âˆáµ¢â‚Œâ‚â¿ (âˆ‚háµ¢/âˆ‚háµ¢â‚‹â‚)
                            </div>
                        </div>
                    </div>

                    <div class="concept-card pitfall">
                        <h3 style="color: var(--accent-yellow); margin-bottom: 1rem;">é—®é¢˜2ï¼šä¼˜åŒ–å›°éš¾</h3>
                        <p>
                            æ·±å±‚ç½‘ç»œçš„æŸå¤±æ›²é¢æ›´åŠ å¤æ‚ï¼Œå­˜åœ¨å¤§é‡éç‚¹å’Œå±€éƒ¨æœ€å°å€¼ï¼Œ
                            ä¼˜åŒ–å™¨å¾ˆéš¾æ‰¾åˆ°å¥½çš„å‚æ•°ã€‚
                        </p>
                    </div>

                    <div class="concept-card what">
                        <h3 style="color: var(--accent-green); margin-bottom: 1rem;">é—®é¢˜3ï¼šè¡¨è¾¾èƒ½åŠ›æ‚–è®º</h3>
                        <p>
                            ç†è®ºä¸Šæ·±å±‚ç½‘ç»œè¡¨è¾¾èƒ½åŠ›æ›´å¼ºï¼Œä½†å®è·µä¸­å´æ— æ³•è¾¾åˆ°æµ…å±‚ç½‘ç»œçš„æ€§èƒ½ï¼Œ
                            è¿™è¯´æ˜é—®é¢˜åœ¨äºä¼˜åŒ–è€Œéè¡¨è¾¾èƒ½åŠ›ã€‚
                        </p>
                    </div>

                    <div class="concept-card how">
                        <h3 style="color: var(--accent-blue); margin-bottom: 1rem;">é—®é¢˜4ï¼šæ’ç­‰æ˜ å°„å›°éš¾</h3>
                        <p>
                            å¯¹äºæ·±å±‚ç½‘ç»œï¼Œå³ä½¿æ˜¯å­¦ä¹ ç®€å•çš„æ’ç­‰æ˜ å°„ H(x) = x éƒ½å˜å¾—å›°éš¾ï¼Œ
                            è¿™æš´éœ²äº†ç°æœ‰æ¶æ„çš„æ ¹æœ¬ç¼ºé™·ã€‚
                        </p>
                    </div>
                </div>

                <!-- æ¢¯åº¦æµå¯è§†åŒ– -->
                <div class="gradient-flow-container">
                    <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸŒŠ æ¢¯åº¦æµåŠ¨å¯è§†åŒ–</h3>
                    <svg class="gradient-flow-svg" viewBox="0 0 800 300">
                        <!-- Plain Network -->
                        <text x="100" y="30" fill="var(--text-primary)" font-size="14" font-weight="bold">æ™®é€šç½‘ç»œ</text>
                        <g id="plain-network">
                            <!-- å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </g>

                        <!-- ResNet -->
                        <text x="100" y="180" fill="var(--text-primary)" font-size="14" font-weight="bold">æ®‹å·®ç½‘ç»œ</text>
                        <g id="resnet-network">
                            <!-- å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </g>
                    </svg>
                </div>
            </section>

            <!-- ç¬¬äºŒæ­¥ï¼šæ®‹å·®å­¦ä¹  -->
            <section id="residual" class="section-card">
                <h2 style="color: var(--accent-green); margin-bottom: 1.5rem;">ğŸ”„ æ®‹å·®å­¦ä¹ ï¼šæ”¹å˜æ¸¸æˆè§„åˆ™çš„æƒ³æ³•</h2>

                <div class="math-container">
                    <h3 style="color: var(--accent-pink); margin-bottom: 1.5rem;">ğŸ“ æ ¸å¿ƒæ•°å­¦åŸç†</h3>

                    <div class="math-formula">
                        <div class="math-formula-title">ä¼ ç»Ÿå­¦ä¹ ç›®æ ‡</div>
                        <div style="font-size: 1.5rem; margin: 2rem 0;">
                            H(x) = æœŸæœ›çš„åº•å±‚æ˜ å°„
                        </div>
                    </div>

                    <div class="math-formula">
                        <div class="math-formula-title">æ®‹å·®å­¦ä¹ ç›®æ ‡</div>
                        <div style="font-size: 1.5rem; margin: 2rem 0;">
                            F(x) = H(x) - x
                        </div>
                        <div style="font-size: 1.2rem; color: var(--text-secondary);">
                            å› æ­¤ï¼šH(x) = F(x) + x
                        </div>
                    </div>

                    <div class="math-explanation">
                        <strong>å…³é”®æ´å¯Ÿï¼š</strong><br>
                        â€¢ å¦‚æœæ’ç­‰æ˜ å°„æ˜¯æœ€ä¼˜çš„ï¼Œé‚£ä¹ˆF(x) = 0æ¯”H(x) = xæ›´å®¹æ˜“å­¦ä¹ <br>
                        â€¢ å³ä½¿F(x)å­¦ä¹ å¤±è´¥ï¼ˆå…¨é›¶ï¼‰ï¼Œè‡³å°‘èƒ½ä¿è¯H(x) = xï¼ˆæ’ç­‰æ˜ å°„ï¼‰<br>
                        â€¢ è¿™ä¸ºæ·±å±‚ç½‘ç»œæä¾›äº†ä¸€ä¸ª"å®‰å…¨çš„é»˜è®¤é€‰é¡¹"
                    </div>
                </div>

                <!-- æ®‹å·®å—å¯è§†åŒ– -->
                <div class="residual-block-viz">
                    <div style="position: relative;">
                        <div class="residual-skip" style="width: 400px;"></div>
                        <div class="residual-path">
                            <div class="residual-layer" style="background: rgba(255, 255, 255, 0.1); border: 2px dashed var(--border-color);">
                                x (è¾“å…¥)
                            </div>
                            <div class="residual-main">
                                <div class="residual-layer">
                                    Conv + BN + ReLU
                                </div>
                                <div class="residual-layer">
                                    Conv + BN
                                </div>
                            </div>
                            <div class="residual-layer" style="background: rgba(34, 197, 94, 0.2); border-color: var(--accent-green);">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span>F(x) + x</span>
                                    <span style="font-size: 1.5rem;">â†’</span>
                                    <span>ReLU</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å‰å‘å’Œåå‘ä¼ æ’­åˆ†æ -->
                <div class="math-container mt-3">
                    <h3 style="color: var(--accent-cyan); margin-bottom: 1.5rem;">ğŸ”€ æ¢¯åº¦ä¼ æ’­åˆ†æ</h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div>
                            <h4 style="color: var(--accent-green); text-align: center; margin-bottom: 1rem;">å‰å‘ä¼ æ’­</h4>
                            <div class="math-formula">
                                <div style="text-align: left; padding: 1rem;">
                                    y = x + F(x, Wáµ¢)<br><br>
                                    â€¢ ä¿¡æ¯é€šè¿‡ä¸¤æ¡è·¯å¾„æµåŠ¨<br>
                                    â€¢ è·³è·ƒè¿æ¥ä¿è¯ä¿¡æ¯ä¼ é€’<br>
                                    â€¢ F(x)å¯ä»¥å­¦ä¹ ç»†å¾®è°ƒæ•´
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 style="color: var(--accent-red); text-align: center; margin-bottom: 1rem;">åå‘ä¼ æ’­</h4>
                            <div class="math-formula">
                                <div style="text-align: left; padding: 1rem;">
                                    âˆ‚L/âˆ‚x = âˆ‚L/âˆ‚y Â· (1 + âˆ‚F/âˆ‚x)<br><br>
                                    â€¢ æ¢¯åº¦è‡³å°‘ä¸º âˆ‚L/âˆ‚y<br>
                                    â€¢ é¿å…æ¢¯åº¦æ¶ˆå¤±<br>
                                    â€¢ æ·±å±‚æ¢¯åº¦ç›´è¾¾æµ…å±‚
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tip success mt-3">
                        <span class="tip-icon">ğŸ¯</span>
                        <div class="tip-content">
                            <strong>å…³é”®ä¼˜åŠ¿ï¼š</strong><br>
                            æ®‹å·®è¿æ¥ä¸­çš„"1"é¡¹ä¿è¯äº†æ¢¯åº¦å¯ä»¥æ— æŸåœ°ä¼ æ’­åˆ°ä»»æ„æ·±çš„å±‚ï¼Œ
                            è¿™æ˜¯ResNetèƒ½å¤Ÿè®­ç»ƒè¶…æ·±ç½‘ç»œçš„æ•°å­¦åŸºç¡€ã€‚
                        </div>
                    </div>
                </div>

                <!-- æ®‹å·®å­¦ä¹ çš„ç›´è§‚ç†è§£ -->
                <div class="story-card mt-3">
                    <h3 style="color: var(--accent-yellow); margin-bottom: 1rem;">ğŸ¨ ç”»å®¶çš„æ¯”å–»</h3>

                    <div class="dialogue-box">
                        <div class="speaker">
                            <div class="avatar" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">ğŸ‘¨â€ğŸ«</div>
                            å­™å‰‘ï¼š
                        </div>
                        <div>"æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªç”»å®¶ï¼Œè¦ç”»ä¸€å¹…è‚–åƒç”»..."</div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 1.5rem; border-radius: 0.5rem;">
                            <h4 style="color: var(--accent-red); margin-bottom: 0.5rem;">ä¼ ç»Ÿæ–¹å¼</h4>
                            <p>ä»ç©ºç™½ç”»å¸ƒå¼€å§‹ï¼Œä¸€ç¬”ä¸€ç¬”ç”»å‡ºå®Œæ•´çš„è‚–åƒã€‚æ¯ä¸€å±‚éƒ½è¦é‡æ–°ç†è§£å’Œç»˜åˆ¶æ‰€æœ‰ç»†èŠ‚ã€‚</p>
                        </div>
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 1.5rem; border-radius: 0.5rem;">
                            <h4 style="color: var(--accent-green); margin-bottom: 0.5rem;">æ®‹å·®æ–¹å¼</h4>
                            <p>ä»ä¸€å¼ ç…§ç‰‡å¼€å§‹ï¼Œåªéœ€è¦æ·»åŠ ä¸€äº›ä¿®æ”¹è®©å®ƒçœ‹èµ·æ¥åƒç”»ä½œã€‚ä¸“æ³¨äº"å˜åŒ–"è€Œä¸æ˜¯"å…¨éƒ¨"ã€‚</p>
                        </div>
                    </div>

                    <div class="dialogue-box">
                        <div class="speaker">
                            <div class="avatar" style="background: linear-gradient(135deg, #f093fb, #f5576c);">ğŸ§‘â€ğŸ”¬</div>
                            ä½•å‡¯æ˜ï¼š
                        </div>
                        <div>"æ²¡é”™ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ®‹å·®å­¦ä¹ æ›´å®¹æ˜“â€”â€”ç½‘ç»œåªéœ€è¦å­¦ä¹ 'å¢é‡'ï¼Œè€Œä¸æ˜¯ä»é›¶å¼€å§‹æ„å»ºä¸€åˆ‡ï¼"</div>
                    </div>
                </div>
            </section>

            <!-- ç¬¬ä¸‰æ­¥ï¼šResNetæ¶æ„ -->
            <section id="resnet" class="section-card">
                <h2 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ›ï¸ ResNetï¼šæ·±åº¦å­¦ä¹ çš„é‡Œç¨‹ç¢‘</h2>

                <!-- æ¶æ„æ¼”åŒ–æ—¶é—´çº¿ -->
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-year">2012</div>
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <h4 style="color: var(--accent-cyan);">AlexNet (8å±‚)</h4>
                            <p>æ·±åº¦å­¦ä¹ çš„å¼€ç«¯ï¼Œè¯æ˜äº†æ·±åº¦çš„ä»·å€¼</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-year">2014</div>
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <h4 style="color: var(--accent-blue);">VGGNet (19å±‚)</h4>
                            <p>ä½¿ç”¨3Ã—3å·ç§¯å †å ï¼Œä½†æ·±åº¦å—é™</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-year">2015</div>
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <h4 style="color: var(--accent-pink);">ResNet (152å±‚)</h4>
                            <p>æ®‹å·®å­¦ä¹ çªç ´æ·±åº¦é™åˆ¶ï¼Œé”™è¯¯ç‡3.57%</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-year">2016</div>
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <h4 style="color: var(--accent-green);">ResNet-1001</h4>
                            <p>è¯æ˜å¯ä»¥è®­ç»ƒè¶…è¿‡1000å±‚çš„ç½‘ç»œ</p>
                        </div>
                    </div>
                </div>

                <!-- ResNetå˜ä½“å¯¹æ¯” -->
                <div class="comparison-table mt-3">
                    <table>
                        <thead>
                        <tr>
                            <th>æ¨¡å‹</th>
                            <th>æ·±åº¦</th>
                            <th>å‚æ•°é‡</th>
                            <th>Top-1é”™è¯¯ç‡</th>
                            <th>Top-5é”™è¯¯ç‡</th>
                            <th>ç‰¹ç‚¹</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td><strong>ResNet-18</strong></td>
                            <td>18</td>
                            <td>11.7M</td>
                            <td>30.24%</td>
                            <td>10.92%</td>
                            <td>åŸºç¡€å—ï¼Œé€‚åˆè¾¹ç¼˜è®¾å¤‡</td>
                        </tr>
                        <tr>
                            <td><strong>ResNet-34</strong></td>
                            <td>34</td>
                            <td>21.8M</td>
                            <td>26.70%</td>
                            <td>8.58%</td>
                            <td>åŸºç¡€å—ï¼Œå¹³è¡¡æ€§èƒ½</td>
                        </tr>
                        <tr>
                            <td><strong>ResNet-50</strong></td>
                            <td>50</td>
                            <td>25.6M</td>
                            <td>23.85%</td>
                            <td>7.13%</td>
                            <td class="highlight">ç“¶é¢ˆå—ï¼Œæœ€æµè¡Œ</td>
                        </tr>
                        <tr>
                            <td><strong>ResNet-101</strong></td>
                            <td>101</td>
                            <td>44.5M</td>
                            <td>22.63%</td>
                            <td>6.44%</td>
                            <td>ç“¶é¢ˆå—ï¼Œé«˜ç²¾åº¦</td>
                        </tr>
                        <tr>
                            <td><strong>ResNet-152</strong></td>
                            <td>152</td>
                            <td>60.2M</td>
                            <td>21.69%</td>
                            <td class="highlight">5.94%</td>
                            <td>ç“¶é¢ˆå—ï¼ŒILSVRC 2015å† å†›</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- åŸºç¡€å— vs ç“¶é¢ˆå— -->
                <div class="arch-comparison mt-3">
                    <div class="arch-model">
                        <h4 style="color: var(--accent-cyan);">åŸºç¡€å— (BasicBlock)</h4>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem; margin: 1rem 0;">
                            <div style="text-align: center; font-family: monospace; font-size: 0.875rem;">
                                3Ã—3, 64<br>
                                â†“<br>
                                3Ã—3, 64<br>
                                â†“<br>
                                <span style="color: var(--accent-green);">+ identity</span>
                            </div>
                        </div>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">
                            ç”¨äºResNet-18/34<br>
                            å‚æ•°é‡ï¼š2Ã—(3Ã—3Ã—64Ã—64)
                        </p>
                    </div>

                    <div class="arch-model">
                        <h4 style="color: var(--accent-pink);">ç“¶é¢ˆå— (Bottleneck)</h4>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem; margin: 1rem 0;">
                            <div style="text-align: center; font-family: monospace; font-size: 0.875rem;">
                                1Ã—1, 64<br>
                                â†“<br>
                                3Ã—3, 64<br>
                                â†“<br>
                                1Ã—1, 256<br>
                                â†“<br>
                                <span style="color: var(--accent-green);">+ identity</span>
                            </div>
                        </div>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">
                            ç”¨äºResNet-50+<br>
                            æ›´å°‘å‚æ•°ï¼Œæ›´æ·±ç½‘ç»œ
                        </p>
                    </div>

                    <div class="arch-model">
                        <h4 style="color: var(--accent-orange);">é¢„æ¿€æ´»å˜ä½“</h4>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem; margin: 1rem 0;">
                            <div style="text-align: center; font-family: monospace; font-size: 0.875rem;">
                                BN â†’ ReLU â†’ Conv<br>
                                â†“<br>
                                BN â†’ ReLU â†’ Conv<br>
                                â†“<br>
                                <span style="color: var(--accent-green);">+ identity</span>
                            </div>
                        </div>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">
                            æ”¹è¿›çš„æ¢¯åº¦æµ<br>
                            æ›´å®¹æ˜“è®­ç»ƒè¶…æ·±ç½‘ç»œ
                        </p>
                    </div>
                </div>

                <!-- ä»£ç å®ç° -->
                <div class="code-container mt-3">
                    <div class="code-header">
                        <div class="code-header-left">
                            <div class="code-tab active" data-tab="basic">åŸºç¡€å—å®ç°</div>
                            <div class="code-tab" data-tab="bottleneck">ç“¶é¢ˆå—å®ç°</div>
                            <div class="code-tab" data-tab="resnet">å®Œæ•´ResNet</div>
                        </div>
                    </div>

                    <div class="code-content" data-tab-content="basic">
                        <pre><code class="language-python">import torch
import torch.nn as nn

class BasicBlock(nn.Module):
    """ResNetåŸºç¡€å— - ç”¨äºResNet-18/34"""
    expansion = 1  # è¾“å‡ºé€šé“æ•°ç›¸å¯¹äºè¾“å…¥çš„å€æ•°

    def __init__(self, in_channels, out_channels, stride=1, downsample=None):
        super(BasicBlock, self).__init__()

        # ç¬¬ä¸€ä¸ª3x3å·ç§¯
        self.conv1 = nn.Conv2d(in_channels, out_channels,
                              kernel_size=3, stride=stride,
                              padding=1, bias=False)
        self.bn1 = nn.BatchNorm2d(out_channels)
        self.relu = nn.ReLU(inplace=True)

        # ç¬¬äºŒä¸ª3x3å·ç§¯
        self.conv2 = nn.Conv2d(out_channels, out_channels,
                              kernel_size=3, stride=1,
                              padding=1, bias=False)
        self.bn2 = nn.BatchNorm2d(out_channels)

        # ä¸‹é‡‡æ ·å±‚ï¼ˆå½“stride!=1æˆ–é€šé“æ•°æ”¹å˜æ—¶ï¼‰
        self.downsample = downsample

    def forward(self, x):
        # ä¿å­˜è¾“å…¥
        identity = x

        # ä¸»è·¯å¾„
        out = self.conv1(x)
        out = self.bn1(out)
        out = self.relu(out)

        out = self.conv2(out)
        out = self.bn2(out)

        # å¦‚æœéœ€è¦ï¼Œå¯¹æ’ç­‰æ˜ å°„è¿›è¡Œä¸‹é‡‡æ ·
        if self.downsample is not None:
            identity = self.downsample(x)

        # æ®‹å·®è¿æ¥
        out += identity
        out = self.relu(out)

        return out

# ä½¿ç”¨ç¤ºä¾‹
def test_basic_block():
    # åˆ›å»ºä¸€ä¸ªåŸºç¡€å—
    block = BasicBlock(64, 64)

    # æµ‹è¯•è¾“å…¥
    x = torch.randn(1, 64, 56, 56)

    # å‰å‘ä¼ æ’­
    output = block(x)
    print(f"è¾“å…¥å½¢çŠ¶: {x.shape}")
    print(f"è¾“å‡ºå½¢çŠ¶: {output.shape}")

    # å¸¦ä¸‹é‡‡æ ·çš„å—
    downsample = nn.Sequential(
        nn.Conv2d(64, 128, kernel_size=1, stride=2, bias=False),
        nn.BatchNorm2d(128)
    )
    block_with_downsample = BasicBlock(64, 128, stride=2, downsample=downsample)

    output2 = block_with_downsample(x)
    print(f"ä¸‹é‡‡æ ·åè¾“å‡ºå½¢çŠ¶: {output2.shape}")

test_basic_block()</code></pre>
                    </div>

                    <div class="code-content" data-tab-content="bottleneck" style="display: none;">
                        <pre><code class="language-python">class Bottleneck(nn.Module):
    """ResNetç“¶é¢ˆå— - ç”¨äºResNet-50/101/152"""
    expansion = 4  # æœ€åä¸€å±‚æ˜¯ç¬¬ä¸€å±‚çš„4å€å®½

    def __init__(self, in_channels, out_channels, stride=1, downsample=None):
        super(Bottleneck, self).__init__()

        # 1x1å·ç§¯é™ç»´
        self.conv1 = nn.Conv2d(in_channels, out_channels,
                              kernel_size=1, bias=False)
        self.bn1 = nn.BatchNorm2d(out_channels)

        # 3x3å·ç§¯
        self.conv2 = nn.Conv2d(out_channels, out_channels,
                              kernel_size=3, stride=stride,
                              padding=1, bias=False)
        self.bn2 = nn.BatchNorm2d(out_channels)

        # 1x1å·ç§¯å‡ç»´
        self.conv3 = nn.Conv2d(out_channels, out_channels * self.expansion,
                              kernel_size=1, bias=False)
        self.bn3 = nn.BatchNorm2d(out_channels * self.expansion)

        self.relu = nn.ReLU(inplace=True)
        self.downsample = downsample

    def forward(self, x):
        identity = x

        # ç“¶é¢ˆè·¯å¾„ï¼š1x1 -> 3x3 -> 1x1
        out = self.conv1(x)
        out = self.bn1(out)
        out = self.relu(out)

        out = self.conv2(out)
        out = self.bn2(out)
        out = self.relu(out)

        out = self.conv3(out)
        out = self.bn3(out)

        # æ®‹å·®è¿æ¥
        if self.downsample is not None:
            identity = self.downsample(x)

        out += identity
        out = self.relu(out)

        return out

# é¢„æ¿€æ´»ç“¶é¢ˆå—ï¼ˆResNet-v2ï¼‰
class PreActBottleneck(nn.Module):
    """é¢„æ¿€æ´»ç“¶é¢ˆå— - æ”¹è¿›çš„è®¾è®¡"""
    expansion = 4

    def __init__(self, in_channels, out_channels, stride=1, downsample=None):
        super(PreActBottleneck, self).__init__()

        # BNå’ŒReLUç§»åˆ°äº†å·ç§¯ä¹‹å‰
        self.bn1 = nn.BatchNorm2d(in_channels)
        self.conv1 = nn.Conv2d(in_channels, out_channels,
                              kernel_size=1, bias=False)

        self.bn2 = nn.BatchNorm2d(out_channels)
        self.conv2 = nn.Conv2d(out_channels, out_channels,
                              kernel_size=3, stride=stride,
                              padding=1, bias=False)

        self.bn3 = nn.BatchNorm2d(out_channels)
        self.conv3 = nn.Conv2d(out_channels, out_channels * self.expansion,
                              kernel_size=1, bias=False)

        self.relu = nn.ReLU(inplace=True)
        self.downsample = downsample

    def forward(self, x):
        identity = x

        # é¢„æ¿€æ´»
        out = self.bn1(x)
        out = self.relu(out)

        # å¦‚æœéœ€è¦ä¸‹é‡‡æ ·ï¼Œåœ¨æ¿€æ´»åè¿›è¡Œ
        if self.downsample is not None:
            identity = self.downsample(out)

        # ç“¶é¢ˆè·¯å¾„
        out = self.conv1(out)

        out = self.bn2(out)
        out = self.relu(out)
        out = self.conv2(out)

        out = self.bn3(out)
        out = self.relu(out)
        out = self.conv3(out)

        # æ®‹å·®è¿æ¥
        out += identity

        return out

# å‚æ•°é‡å¯¹æ¯”
def compare_blocks():
    # åŸºç¡€å—
    basic = BasicBlock(256, 256)
    basic_params = sum(p.numel() for p in basic.parameters())

    # ç“¶é¢ˆå—
    bottleneck = Bottleneck(256, 64)
    bottleneck_params = sum(p.numel() for p in bottleneck.parameters())

    print(f"åŸºç¡€å—å‚æ•°é‡: {basic_params:,}")
    print(f"ç“¶é¢ˆå—å‚æ•°é‡: {bottleneck_params:,}")
    print(f"å‚æ•°å‡å°‘: {(1 - bottleneck_params/basic_params)*100:.1f}%")

compare_blocks()</code></pre>
                    </div>

                    <div class="code-content" data-tab-content="resnet" style="display: none;">
                        <pre><code class="language-python">class ResNet(nn.Module):
    """å®Œæ•´çš„ResNetå®ç°"""

    def __init__(self, block, layers, num_classes=1000, zero_init_residual=False):
        super(ResNet, self).__init__()
        self.in_channels = 64

        # åˆå§‹å·ç§¯å±‚
        self.conv1 = nn.Conv2d(3, self.in_channels, kernel_size=7,
                              stride=2, padding=3, bias=False)
        self.bn1 = nn.BatchNorm2d(self.in_channels)
        self.relu = nn.ReLU(inplace=True)
        self.maxpool = nn.MaxPool2d(kernel_size=3, stride=2, padding=1)

        # æ®‹å·®å±‚
        self.layer1 = self._make_layer(block, 64, layers[0])
        self.layer2 = self._make_layer(block, 128, layers[1], stride=2)
        self.layer3 = self._make_layer(block, 256, layers[2], stride=2)
        self.layer4 = self._make_layer(block, 512, layers[3], stride=2)

        # åˆ†ç±»å¤´
        self.avgpool = nn.AdaptiveAvgPool2d((1, 1))
        self.fc = nn.Linear(512 * block.expansion, num_classes)

        # åˆå§‹åŒ–
        self._initialize_weights(zero_init_residual)

    def _make_layer(self, block, out_channels, blocks, stride=1):
        """æ„å»ºæ®‹å·®å±‚"""
        downsample = None

        # å¦‚æœstride!=1æˆ–é€šé“æ•°æ”¹å˜ï¼Œéœ€è¦ä¸‹é‡‡æ ·
        if stride != 1 or self.in_channels != out_channels * block.expansion:
            downsample = nn.Sequential(
                nn.Conv2d(self.in_channels, out_channels * block.expansion,
                         kernel_size=1, stride=stride, bias=False),
                nn.BatchNorm2d(out_channels * block.expansion),
            )

        layers = []
        # ç¬¬ä¸€ä¸ªå—å¯èƒ½éœ€è¦ä¸‹é‡‡æ ·
        layers.append(block(self.in_channels, out_channels, stride, downsample))
        self.in_channels = out_channels * block.expansion

        # å‰©ä½™çš„å—
        for _ in range(1, blocks):
            layers.append(block(self.in_channels, out_channels))

        return nn.Sequential(*layers)

    def _initialize_weights(self, zero_init_residual):
        """æƒé‡åˆå§‹åŒ–"""
        for m in self.modules():
            if isinstance(m, nn.Conv2d):
                nn.init.kaiming_normal_(m.weight, mode='fan_out', nonlinearity='relu')
            elif isinstance(m, nn.BatchNorm2d):
                nn.init.constant_(m.weight, 1)
                nn.init.constant_(m.bias, 0)

        # é›¶åˆå§‹åŒ–æ®‹å·®å—çš„æœ€åä¸€ä¸ªBN
        # è¿™ä½¿å¾—æ®‹å·®å—åˆå§‹è¾“å‡ºä¸ºé›¶ï¼Œè®©ç½‘ç»œä»æ›´æµ…çš„çŠ¶æ€å¼€å§‹
        if zero_init_residual:
            for m in self.modules():
                if isinstance(m, Bottleneck):
                    nn.init.constant_(m.bn3.weight, 0)
                elif isinstance(m, BasicBlock):
                    nn.init.constant_(m.bn2.weight, 0)

    def forward(self, x):
        # åˆå§‹ç‰¹å¾æå–
        x = self.conv1(x)
        x = self.bn1(x)
        x = self.relu(x)
        x = self.maxpool(x)

        # æ®‹å·®å—
        x = self.layer1(x)
        x = self.layer2(x)
        x = self.layer3(x)
        x = self.layer4(x)

        # å…¨å±€å¹³å‡æ± åŒ–
        x = self.avgpool(x)
        x = torch.flatten(x, 1)
        x = self.fc(x)

        return x

# åˆ›å»ºä¸åŒçš„ResNetæ¨¡å‹
def resnet18(pretrained=False, **kwargs):
    """ResNet-18"""
    model = ResNet(BasicBlock, [2, 2, 2, 2], **kwargs)
    return model

def resnet34(pretrained=False, **kwargs):
    """ResNet-34"""
    model = ResNet(BasicBlock, [3, 4, 6, 3], **kwargs)
    return model

def resnet50(pretrained=False, **kwargs):
    """ResNet-50"""
    model = ResNet(Bottleneck, [3, 4, 6, 3], **kwargs)
    return model

def resnet101(pretrained=False, **kwargs):
    """ResNet-101"""
    model = ResNet(Bottleneck, [3, 4, 23, 3], **kwargs)
    return model

def resnet152(pretrained=False, **kwargs):
    """ResNet-152"""
    model = ResNet(Bottleneck, [3, 8, 36, 3], **kwargs)
    return model

# æµ‹è¯•å’Œåˆ†æ
def analyze_resnet():
    """åˆ†æä¸åŒResNetçš„ç‰¹æ€§"""
    models = {
        'ResNet-18': resnet18(),
        'ResNet-34': resnet34(),
        'ResNet-50': resnet50(),
        'ResNet-101': resnet101(),
        'ResNet-152': resnet152()
    }

    print("ResNetæ¨¡å‹åˆ†æ:")
    print("-" * 60)

    for name, model in models.items():
        total_params = sum(p.numel() for p in model.parameters())

        # è®¡ç®—FLOPsï¼ˆç®€åŒ–ç‰ˆï¼‰
        x = torch.randn(1, 3, 224, 224)

        # ç»Ÿè®¡å„å±‚æ·±åº¦
        depth = 0
        for module in model.modules():
            if isinstance(module, (BasicBlock, Bottleneck)):
                depth += 1

        print(f"{name:>12} | å‚æ•°é‡: {total_params/1e6:>6.1f}M | æ·±åº¦: {depth:>3}")

    # ç‰¹å¾å›¾å¤§å°å˜åŒ–
    print("\nç‰¹å¾å›¾å°ºå¯¸å˜åŒ– (ResNet-50):")
    print("-" * 40)

    model = resnet50()
    x = torch.randn(1, 3, 224, 224)

    # Hookå‡½æ•°è®°å½•ä¸­é—´è¾“å‡º
    activations = []

    def hook(module, input, output):
        activations.append(output.shape)

    # æ³¨å†Œhooks
    handles = []
    for name, module in model.named_modules():
        if 'layer' in name and len(name.split('.')) == 1:
            handle = module.register_forward_hook(hook)
            handles.append(handle)

    # å‰å‘ä¼ æ’­
    _ = model(x)

    # æ‰“å°ç»“æœ
    stages = ['Input', 'Layer1', 'Layer2', 'Layer3', 'Layer4']
    shapes = [(1, 3, 224, 224)] + activations

    for stage, shape in zip(stages, shapes):
        print(f"{stage:>8}: {str(shape):>20}")

    # æ¸…ç†hooks
    for handle in handles:
        handle.remove()

analyze_resnet()

# è®­ç»ƒæŠ€å·§å±•ç¤º
def training_tricks():
    """ResNetè®­ç»ƒæŠ€å·§"""
    print("\nResNetè®­ç»ƒæŠ€å·§:")
    print("-" * 60)

    tricks = [
        ("å­¦ä¹ ç‡é¢„çƒ­", "å‰5ä¸ªepochä»0çº¿æ€§å¢åŠ åˆ°åˆå§‹å­¦ä¹ ç‡"),
        ("é›¶åˆå§‹åŒ–", "æ®‹å·®å—æœ€åçš„BNå±‚æƒé‡åˆå§‹åŒ–ä¸º0"),
        ("æ ‡ç­¾å¹³æ»‘", "ä½¿ç”¨0.1çš„æ ‡ç­¾å¹³æ»‘æ­£åˆ™åŒ–"),
        ("æ•°æ®å¢å¼º", "RandomResizedCrop + RandomHorizontalFlip + ColorJitter"),
        ("æƒé‡è¡°å‡", "é™¤BNå’Œbiaså¤–ï¼Œä½¿ç”¨1e-4çš„æƒé‡è¡°å‡"),
        ("ä½™å¼¦é€€ç«", "å­¦ä¹ ç‡æŒ‰ä½™å¼¦å‡½æ•°è¡°å‡")
    ]

    for trick, description in tricks:
        print(f"â€¢ {trick:<12}: {description}")

training_tricks()</code></pre>
                    </div>
                </div>
            </section>

            <!-- ç¬¬å››æ­¥ï¼šDenseNet -->
            <section id="densenet" class="section-card">
                <h2 style="color: var(--accent-blue); margin-bottom: 1.5rem;">ğŸ”— DenseNetï¼šå¯†é›†è¿æ¥çš„æè‡´</h2>

                <div class="story-card">
                    <div class="dialogue-box">
                        <div class="speaker">
                            <div class="avatar" style="background: linear-gradient(135deg, #667eea, #764ba2);">ğŸ§‘â€ğŸ’»</div>
                            é»„é«˜ï¼ˆCornellåšå£«ç”Ÿï¼‰ï¼š
                        </div>
                        <div>"å¦‚æœResNetçš„è·³è·ƒè¿æ¥è¿™ä¹ˆæœ‰æ•ˆï¼Œä¸ºä»€ä¹ˆä¸æŠŠæ‰€æœ‰å±‚éƒ½è¿æ¥èµ·æ¥ï¼Ÿ"</div>
                    </div>

                    <div class="dialogue-box mt-2">
                        <div class="speaker">
                            <div class="avatar" style="background: linear-gradient(135deg, #f093fb, #f5576c);">ğŸ‘©â€ğŸ«</div>
                            å¯¼å¸ˆï¼š
                        </div>
                        <div>"æœ‰è¶£çš„æƒ³æ³•ï¼ä½†è¿™æ ·å‚æ•°é‡ä¼šçˆ†ç‚¸å§ï¼Ÿ"</div>
                    </div>

                    <div class="dialogue-box mt-2">
                        <div class="speaker">
                            <div class="avatar" style="background: linear-gradient(135deg, #667eea, #764ba2);">ğŸ§‘â€ğŸ’»</div>
                            é»„é«˜ï¼š
                        </div>
                        <div>"ä¸ï¼Œå¦‚æœæˆ‘ä»¬ç”¨concatenationè€Œä¸æ˜¯additionï¼Œæ¯å±‚åªéœ€è¦å¾ˆå°‘çš„é€šé“ï¼"</div>
                    </div>
                </div>

                <!-- DenseNetæ ¸å¿ƒæ€æƒ³ -->
                <div class="math-container">
                    <h3 style="color: var(--accent-cyan); margin-bottom: 1.5rem;">ğŸ§¬ å¯†é›†è¿æ¥çš„æ•°å­¦è¡¨è¾¾</h3>

                    <div class="math-formula">
                        <div class="math-formula-title">ResNetè¿æ¥æ–¹å¼</div>
                        <div style="font-size: 1.3rem; margin: 1.5rem 0;">
                            x<sub>â„“</sub> = H<sub>â„“</sub>(x<sub>â„“-1</sub>) + x<sub>â„“-1</sub>
                        </div>
                    </div>

                    <div class="math-formula">
                        <div class="math-formula-title">DenseNetè¿æ¥æ–¹å¼</div>
                        <div style="font-size: 1.3rem; margin: 1.5rem 0;">
                            x<sub>â„“</sub> = H<sub>â„“</sub>([x<sub>0</sub>, x<sub>1</sub>, ..., x<sub>â„“-1</sub>])
                        </div>
                    </div>

                    <div class="math-explanation">
                        <strong>å…³é”®åŒºåˆ«ï¼š</strong><br>
                        â€¢ ResNetï¼šåªè¿æ¥ç›¸é‚»å±‚ï¼ˆåŠ æ³•ï¼‰<br>
                        â€¢ DenseNetï¼šè¿æ¥æ‰€æœ‰å‰é¢çš„å±‚ï¼ˆæ‹¼æ¥ï¼‰<br>
                        â€¢ æ¯å±‚éƒ½èƒ½ç›´æ¥è®¿é—®ä¹‹å‰æ‰€æœ‰å±‚çš„ç‰¹å¾<br>
                        â€¢ ä¿ƒè¿›ç‰¹å¾é‡ç”¨ï¼Œå‡å°‘å‚æ•°å†—ä½™
                    </div>
                </div>

                <!-- DenseNetæ¶æ„å¯è§†åŒ– -->
                <div class="visualization-container">
                    <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸŒ Dense Blockå¯è§†åŒ–</h3>

                    <div class="feature-reuse-grid" id="dense-block-viz">
                        <!-- å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆè¿æ¥å›¾ -->
                    </div>

                    <div class="tip info mt-3">
                        <span class="tip-icon">ğŸ’¡</span>
                        <div class="tip-content">
                            <strong>ç‰¹å¾é‡ç”¨çš„å¨åŠ›ï¼š</strong><br>
                            â€¢ æ¯å±‚åªäº§ç”Ÿkä¸ªæ–°ç‰¹å¾ï¼ˆå¢é•¿ç‡ké€šå¸¸ä¸º12æˆ–32ï¼‰<br>
                            â€¢ ä½†å¯ä»¥è®¿é—®ä¹‹å‰æ‰€æœ‰å±‚çš„ç‰¹å¾<br>
                            â€¢ å‚æ•°æ•ˆç‡æé«˜ï¼šDenseNet-121åªæœ‰8Må‚æ•°
                        </div>
                    </div>
                </div>

                <!-- DenseNet vs ResNetå¯¹æ¯” -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
                    <div style="background: rgba(240, 147, 251, 0.1); padding: 2rem; border-radius: 1rem;">
                        <h4 style="color: var(--accent-pink); margin-bottom: 1rem;">ResNetç‰¹ç‚¹</h4>
                        <ul style="margin-left: 1.5rem;">
                            <li>æ’ç­‰æ˜ å°„é€šè¿‡åŠ æ³•</li>
                            <li>æ¢¯åº¦ç›´æ¥ä¼ æ’­</li>
                            <li>æ·±åº¦æ˜¯ä¸»è¦ä¼˜åŠ¿</li>
                            <li>æ¯å±‚éœ€è¦è¶³å¤Ÿå®½åº¦</li>
                        </ul>
                    </div>
                    <div style="background: rgba(79, 172, 254, 0.1); padding: 2rem; border-radius: 1rem;">
                        <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">DenseNetç‰¹ç‚¹</h4>
                        <ul style="margin-left: 1.5rem;">
                            <li>ç‰¹å¾é€šè¿‡æ‹¼æ¥ä¼ é€’</li>
                            <li>æè‡´çš„ç‰¹å¾é‡ç”¨</li>
                            <li>æ›´çª„çš„å±‚ï¼ˆk=12~32ï¼‰</li>
                            <li>å‚æ•°æ•ˆç‡æ›´é«˜</li>
                        </ul>
                    </div>
                </div>

                <!-- DenseNetå®ç° -->
                <div class="code-container">
                    <div class="code-header">
                        <div class="code-header-left">
                            <span style="color: var(--text-secondary);">densenet_implementation.py</span>
                        </div>
                    </div>
                    <div class="code-content">
                        <pre><code class="language-python">import torch
import torch.nn as nn
import torch.nn.functional as F

class DenseLayer(nn.Module):
    """DenseNetçš„åŸºç¡€å±‚"""
    def __init__(self, in_channels, growth_rate, bn_size=4):
        super(DenseLayer, self).__init__()

        # 1x1 å·ç§¯ï¼ˆç“¶é¢ˆå±‚ï¼‰
        self.bn1 = nn.BatchNorm2d(in_channels)
        self.relu1 = nn.ReLU(inplace=True)
        self.conv1 = nn.Conv2d(in_channels, bn_size * growth_rate,
                              kernel_size=1, bias=False)

        # 3x3 å·ç§¯
        self.bn2 = nn.BatchNorm2d(bn_size * growth_rate)
        self.relu2 = nn.ReLU(inplace=True)
        self.conv2 = nn.Conv2d(bn_size * growth_rate, growth_rate,
                              kernel_size=3, padding=1, bias=False)

    def forward(self, x):
        # xæ˜¯æ‰€æœ‰ä¹‹å‰å±‚çš„ç‰¹å¾æ‹¼æ¥
        out = self.bn1(x)
        out = self.relu1(out)
        out = self.conv1(out)

        out = self.bn2(out)
        out = self.relu2(out)
        out = self.conv2(out)

        # è¿”å›æ‹¼æ¥åçš„ç‰¹å¾
        return torch.cat([x, out], 1)

class DenseBlock(nn.Module):
    """Dense Block - åŒ…å«å¤šä¸ªå¯†é›†è¿æ¥çš„å±‚"""
    def __init__(self, num_layers, in_channels, growth_rate, bn_size=4):
        super(DenseBlock, self).__init__()

        layers = []
        for i in range(num_layers):
            layers.append(
                DenseLayer(in_channels + i * growth_rate, growth_rate, bn_size)
            )
        self.layers = nn.Sequential(*layers)

    def forward(self, x):
        return self.layers(x)

class Transition(nn.Module):
    """è¿‡æ¸¡å±‚ - ç”¨äºé™ä½ç‰¹å¾å›¾å°ºå¯¸å’Œé€šé“æ•°"""
    def __init__(self, in_channels, out_channels):
        super(Transition, self).__init__()
        self.bn = nn.BatchNorm2d(in_channels)
        self.relu = nn.ReLU(inplace=True)
        self.conv = nn.Conv2d(in_channels, out_channels,
                             kernel_size=1, bias=False)
        self.pool = nn.AvgPool2d(kernel_size=2, stride=2)

    def forward(self, x):
        out = self.bn(x)
        out = self.relu(out)
        out = self.conv(out)
        out = self.pool(out)
        return out

class DenseNet(nn.Module):
    """å®Œæ•´çš„DenseNetæ¶æ„"""
    def __init__(self, growth_rate=32, block_config=(6, 12, 24, 16),
                 num_init_features=64, bn_size=4, compression=0.5,
                 num_classes=1000):
        super(DenseNet, self).__init__()

        # åˆå§‹å·ç§¯å±‚
        self.features = nn.Sequential(
            nn.Conv2d(3, num_init_features, kernel_size=7,
                     stride=2, padding=3, bias=False),
            nn.BatchNorm2d(num_init_features),
            nn.ReLU(inplace=True),
            nn.MaxPool2d(kernel_size=3, stride=2, padding=1)
        )

        # Dense Blocks
        num_features = num_init_features
        for i, num_layers in enumerate(block_config):
            block = DenseBlock(num_layers, num_features,
                             growth_rate, bn_size)
            self.features.add_module(f'denseblock{i+1}', block)

            num_features = num_features + num_layers * growth_rate

            # æ·»åŠ è¿‡æ¸¡å±‚ï¼ˆé™¤äº†æœ€åä¸€ä¸ªblockï¼‰
            if i != len(block_config) - 1:
                trans = Transition(num_features,
                                 int(num_features * compression))
                self.features.add_module(f'transition{i+1}', trans)
                num_features = int(num_features * compression)

        # æœ€åçš„BN
        self.features.add_module('norm5', nn.BatchNorm2d(num_features))

        # åˆ†ç±»å™¨
        self.classifier = nn.Linear(num_features, num_classes)

        # åˆå§‹åŒ–
        self._initialize_weights()

    def _initialize_weights(self):
        for m in self.modules():
            if isinstance(m, nn.Conv2d):
                nn.init.kaiming_normal_(m.weight)
            elif isinstance(m, nn.BatchNorm2d):
                nn.init.constant_(m.weight, 1)
                nn.init.constant_(m.bias, 0)
            elif isinstance(m, nn.Linear):
                nn.init.constant_(m.bias, 0)

    def forward(self, x):
        features = self.features(x)
        out = F.relu(features, inplace=True)
        out = F.adaptive_avg_pool2d(out, (1, 1))
        out = torch.flatten(out, 1)
        out = self.classifier(out)
        return out

# é¢„å®šä¹‰çš„DenseNetæ¶æ„
def densenet121(**kwargs):
    """DenseNet-121"""
    return DenseNet(growth_rate=32, block_config=(6, 12, 24, 16), **kwargs)

def densenet169(**kwargs):
    """DenseNet-169"""
    return DenseNet(growth_rate=32, block_config=(6, 12, 32, 32), **kwargs)

def densenet201(**kwargs):
    """DenseNet-201"""
    return DenseNet(growth_rate=32, block_config=(6, 12, 48, 32), **kwargs)

def densenet264(**kwargs):
    """DenseNet-264"""
    return DenseNet(growth_rate=32, block_config=(6, 12, 64, 48), **kwargs)

# åˆ†æDenseNetçš„ç‰¹æ€§
def analyze_densenet():
    """åˆ†æDenseNetçš„å‚æ•°æ•ˆç‡"""

    # åˆ›å»ºä¸€ä¸ªå°å‹DenseNet
    model = DenseNet(growth_rate=12, block_config=(6, 12, 24, 16),
                    num_init_features=16)

    # ç»Ÿè®¡å‚æ•°
    total_params = sum(p.numel() for p in model.parameters())
    print(f"DenseNetå‚æ•°æ€»é‡: {total_params:,}")

    # åˆ†æè¿æ¥æ•°
    print("\nDense Blockè¿æ¥åˆ†æ:")
    print("-" * 50)

    block_config = (6, 12, 24, 16)
    growth_rate = 12

    for i, num_layers in enumerate(block_config):
        connections = num_layers * (num_layers - 1) // 2
        print(f"Block {i+1}: {num_layers}å±‚, {connections}ä¸ªè¿æ¥")

    # ç‰¹å¾é‡ç”¨æ¼”ç¤º
    print("\nç‰¹å¾é‡ç”¨æ•ˆæœ:")
    x = torch.randn(1, 3, 32, 32)

    # ç®€å•çš„Dense Block
    in_channels = 64
    growth_rate = 32
    block = DenseBlock(4, in_channels, growth_rate)

    # è¿½è¸ªæ¯å±‚çš„è¾“å…¥é€šé“æ•°
    print(f"åˆå§‹é€šé“æ•°: {in_channels}")
    for i in range(4):
        print(f"ç¬¬{i+1}å±‚è¾“å…¥: {in_channels + i * growth_rate}é€šé“")

    output = block(torch.randn(1, in_channels, 16, 16))
    print(f"è¾“å‡ºé€šé“æ•°: {output.shape[1]}")

analyze_densenet()

# å¯¹æ¯”ResNetå’ŒDenseNet
def compare_architectures():
    """å¯¹æ¯”ä¸åŒæ¶æ„çš„ç‰¹æ€§"""

    print("\næ¶æ„å¯¹æ¯”åˆ†æ:")
    print("-" * 70)
    print(f"{'æ¶æ„':>15} | {'å‚æ•°é‡':>10} | {'è¿æ¥æ–¹å¼':>15} | {'ç‰¹ç‚¹':>20}")
    print("-" * 70)

    comparisons = [
        ("ResNet-50", "25.6M", "æ’ç­‰æ˜ å°„(åŠ æ³•)", "æ·±åº¦ä¼˜åŠ¿"),
        ("ResNet-101", "44.5M", "æ’ç­‰æ˜ å°„(åŠ æ³•)", "æ›´æ·±æ›´å‡†"),
        ("DenseNet-121", "8.0M", "å¯†é›†è¿æ¥(æ‹¼æ¥)", "å‚æ•°æ•ˆç‡"),
        ("DenseNet-169", "14.3M", "å¯†é›†è¿æ¥(æ‹¼æ¥)", "ç‰¹å¾é‡ç”¨"),
        ("DenseNet-201", "20.2M", "å¯†é›†è¿æ¥(æ‹¼æ¥)", "æœ€ä½³ç²¾åº¦")
    ]

    for arch, params, connection, feature in comparisons:
        print(f"{arch:>15} | {params:>10} | {connection:>15} | {feature:>20}")

compare_architectures()</code></pre>
                    </div>
                </div>
            </section>

            <!-- ç¬¬äº”æ­¥ï¼šInception -->
            <section id="inception" class="section-card">
                <h2 style="color: var(--accent-orange); margin-bottom: 1.5rem;">ğŸŒ¸ Inceptionï¼šç½‘ç»œä¸­çš„ç½‘ç»œ</h2>

                <div class="story-card">
                    <h3 style="color: var(--accent-purple); margin-bottom: 1rem;">Going Deeper with Convolutions</h3>

                    <div class="dialogue-box">
                        <div class="speaker">
                            <div class="avatar" style="background: linear-gradient(135deg, #fa709a, #fee140);">ğŸ§‘â€ğŸ”¬</div>
                            Googleç ”ç©¶å‘˜ï¼š
                        </div>
                        <div>"æˆ‘ä»¬é¢ä¸´ä¸€ä¸ªå›°å¢ƒï¼šåº”è¯¥ç”¨3Ã—3è¿˜æ˜¯5Ã—5å·ç§¯ï¼Ÿ1Ã—1å·ç§¯æœ‰ç”¨å—ï¼Ÿ"</div>
                    </div>

                    <div class="dialogue-box mt-2">
                        <div class="speaker">
                            <div class="avatar" style="background: linear-gradient(135deg, #30cfd0, #330867);">ğŸ‘©â€ğŸ’»</div>
                            åŒäº‹ï¼š
                        </div>
                        <div>"ä¸ºä»€ä¹ˆè¦é€‰æ‹©ï¼Ÿæˆ‘ä»¬å¯ä»¥å…¨éƒ¨éƒ½è¦ï¼è®©ç½‘ç»œè‡ªå·±å­¦ä¹ å“ªä¸ªæ›´é‡è¦ã€‚"</div>
                    </div>
                </div>

                <!-- Inceptionæ¨¡å—è®¾è®¡ -->
                <div class="inception-module">
                    <div class="inception-branch">
                        <div class="inception-op">1Ã—1 Conv</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            æ•è·ç‚¹ç‰¹å¾<br>
                            é™ç»´ä½œç”¨
                        </div>
                    </div>
                    <div class="inception-branch">
                        <div class="inception-op">1Ã—1 Conv</div>
                        <div class="inception-op">3Ã—3 Conv</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            å±€éƒ¨ç‰¹å¾<br>
                            æ ‡å‡†æ„Ÿå—é‡
                        </div>
                    </div>
                    <div class="inception-branch">
                        <div class="inception-op">1Ã—1 Conv</div>
                        <div class="inception-op">5Ã—5 Conv</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            æ›´å¤§æ„Ÿå—é‡<br>
                            æ•è·æ›´å¤§æ¨¡å¼
                        </div>
                    </div>
                    <div class="inception-branch">
                        <div class="inception-op">3Ã—3 MaxPool</div>
                        <div class="inception-op">1Ã—1 Conv</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            ä¿ç•™é‡è¦ç‰¹å¾<br>
                            é™é‡‡æ ·è·¯å¾„
                        </div>
                    </div>
                </div>

                <div class="tip info mt-3">
                    <span class="tip-icon">ğŸ’¡</span>
                    <div class="tip-content">
                        <strong>Inceptionçš„è®¾è®¡å“²å­¦ï¼š</strong><br>
                        â€¢ å¤šå°ºåº¦ç‰¹å¾æå–ï¼šåŒæ—¶ä½¿ç”¨ä¸åŒå¤§å°çš„å·ç§¯æ ¸<br>
                        â€¢ 1Ã—1å·ç§¯é™ç»´ï¼šå‡å°‘è®¡ç®—é‡çš„åŒæ—¶å¢åŠ éçº¿æ€§<br>
                        â€¢ ç¨€ç–è¿æ¥ï¼šä¸æ˜¯æ‰€æœ‰é€šé“éƒ½éœ€è¦è¿æ¥<br>
                        â€¢ è®¡ç®—æ•ˆç‡ï¼šé€šè¿‡ç²¾å¿ƒè®¾è®¡è¾¾åˆ°å¾ˆé«˜çš„æ•ˆç‡
                    </div>
                </div>
            </section>

            <!-- ç¬¬å…­æ­¥ï¼šç“¶é¢ˆè®¾è®¡ -->
            <section id="bottleneck" class="section-card">
                <h2 style="color: var(--accent-yellow); margin-bottom: 1.5rem;">â³ ç“¶é¢ˆè®¾è®¡ï¼šæ•ˆç‡ä¸æ€§èƒ½çš„å¹³è¡¡</h2>

                <div class="math-container">
                    <h3 style="color: var(--accent-green); margin-bottom: 1.5rem;">ğŸ§® è®¡ç®—å¤æ‚åº¦åˆ†æ</h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div>
                            <h4 style="color: var(--accent-red); text-align: center; margin-bottom: 1rem;">
                                ç›´æ¥3Ã—3å·ç§¯
                            </h4>
                            <div class="math-formula">
                                <div style="text-align: left; padding: 1rem;">
                                    è¾“å…¥: H Ã— W Ã— 256<br>
                                    å·ç§¯: 3 Ã— 3 Ã— 256 Ã— 256<br>
                                    è¾“å‡º: H Ã— W Ã— 256<br><br>
                                    <strong>FLOPs = 9 Ã— H Ã— W Ã— 256Â²</strong><br>
                                    = 9 Ã— H Ã— W Ã— 65,536
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 style="color: var(--accent-green); text-align: center; margin-bottom: 1rem;">
                                ç“¶é¢ˆç»“æ„
                            </h4>
                            <div class="math-formula">
                                <div style="text-align: left; padding: 1rem;">
                                    1Ã—1: H Ã— W Ã— 256 Ã— 64<br>
                                    3Ã—3: H Ã— W Ã— 64 Ã— 64<br>
                                    1Ã—1: H Ã— W Ã— 64 Ã— 256<br><br>
                                    <strong>FLOPs = H Ã— W Ã— (16,384 + 36,864 + 16,384)</strong><br>
                                    = H Ã— W Ã— 69,632 â‰ˆ <span style="color: var(--accent-green);">1/8.5å€</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç“¶é¢ˆè®¾è®¡æ¼”åŒ– -->
                <div class="concept-grid mt-3">
                    <div class="concept-card what">
                        <h3 style="color: var(--accent-green); margin-bottom: 0.5rem;">æ ‡å‡†ç“¶é¢ˆ</h3>
                        <p>1Ã—1é™ç»´ â†’ 3Ã—3å·ç§¯ â†’ 1Ã—1å‡ç»´<br>
                            ResNet-50+çš„æ ‡å‡†è®¾è®¡</p>
                    </div>

                    <div class="concept-card how">
                        <h3 style="color: var(--accent-blue); margin-bottom: 0.5rem;">åå‘ç“¶é¢ˆ</h3>
                        <p>1Ã—1å‡ç»´ â†’ 3Ã—3 DW â†’ 1Ã—1é™ç»´<br>
                            MobileNetV2çš„åˆ›æ–°</p>
                    </div>

                    <div class="concept-card why">
                        <h3 style="color: var(--accent-red); margin-bottom: 0.5rem;">åˆ†ç»„ç“¶é¢ˆ</h3>
                        <p>ä½¿ç”¨åˆ†ç»„å·ç§¯è¿›ä¸€æ­¥é™ä½è®¡ç®—<br>
                            ResNeXtçš„æ ¸å¿ƒæ€æƒ³</p>
                    </div>

                    <div class="concept-card pitfall">
                        <h3 style="color: var(--accent-yellow); margin-bottom: 0.5rem;">æ·±åº¦å¯åˆ†ç¦»</h3>
                        <p>æ·±åº¦å·ç§¯ + é€ç‚¹å·ç§¯<br>
                            MobileNetç³»åˆ—çš„åŸºç¡€</p>
                    </div>
                </div>
            </section>

            <!-- ç¬¬ä¸ƒæ­¥ï¼šå½’ä¸€åŒ–æŠ€æœ¯ -->
            <section id="normalization" class="section-card">
                <h2 style="color: var(--accent-cyan); margin-bottom: 1.5rem;">ğŸ“Š å½’ä¸€åŒ–æŠ€æœ¯æ¼”è¿›</h2>

                <div class="norm-comparison">
                    <div class="norm-method">
                        <h4 style="color: var(--accent-purple);">Batch Norm</h4>
                        <div class="norm-formula">
                            norm(x) = Î³ Â· (x - Î¼_B) / Ïƒ_B + Î²
                        </div>
                        <p style="font-size: 0.875rem;">
                            â€¢ æ²¿batchç»´åº¦å½’ä¸€åŒ–<br>
                            â€¢ ä¾èµ–batch size<br>
                            â€¢ è®­ç»ƒ/æµ‹è¯•ä¸ä¸€è‡´
                        </p>
                    </div>

                    <div class="norm-method">
                        <h4 style="color: var(--accent-pink);">Layer Norm</h4>
                        <div class="norm-formula">
                            norm(x) = Î³ Â· (x - Î¼_L) / Ïƒ_L + Î²
                        </div>
                        <p style="font-size: 0.875rem;">
                            â€¢ æ²¿ç‰¹å¾ç»´åº¦å½’ä¸€åŒ–<br>
                            â€¢ ä¸ä¾èµ–batch size<br>
                            â€¢ é€‚åˆRNN/Transformer
                        </p>
                    </div>

                    <div class="norm-method">
                        <h4 style="color: var(--accent-orange);">Group Norm</h4>
                        <div class="norm-formula">
                            norm(x) = Î³ Â· (x - Î¼_G) / Ïƒ_G + Î²
                        </div>
                        <p style="font-size: 0.875rem;">
                            â€¢ é€šé“åˆ†ç»„å½’ä¸€åŒ–<br>
                            â€¢ å°batchç¨³å®š<br>
                            â€¢ è§†è§‰ä»»åŠ¡å‹å¥½
                        </p>
                    </div>

                    <div class="norm-method">
                        <h4 style="color: var(--accent-green);">Instance Norm</h4>
                        <div class="norm-formula">
                            norm(x) = Î³ Â· (x - Î¼_I) / Ïƒ_I + Î²
                        </div>
                        <p style="font-size: 0.875rem;">
                            â€¢ æ¯ä¸ªæ ·æœ¬ç‹¬ç«‹<br>
                            â€¢ é£æ ¼è¿ç§»å¸¸ç”¨<br>
                            â€¢ å»é™¤æ•´ä½“ç»Ÿè®¡
                        </p>
                    </div>
                </div>

                <div class="tip warning mt-3">
                    <span class="tip-icon">âš ï¸</span>
                    <div class="tip-content">
                        <strong>å½’ä¸€åŒ–é€‰æ‹©æŒ‡å—ï¼š</strong><br>
                        â€¢ å¤§batch CNN â†’ Batch Norm<br>
                        â€¢ å°batch/å˜é•¿åºåˆ— â†’ Layer/Group Norm<br>
                        â€¢ ç”Ÿæˆæ¨¡å‹ â†’ Instance Norm<br>
                        â€¢ æ³¨æ„è®­ç»ƒ/æ¨ç†ä¸€è‡´æ€§ï¼
                    </div>
                </div>
            </section>

            <!-- ç¬¬å…«æ­¥ï¼šæ¶æ„è®¾è®¡çš„è‰ºæœ¯ -->
            <section id="architecture-art" class="section-card">
                <h2 style="color: var(--accent-pink); margin-bottom: 1.5rem;">ğŸ¨ æ¶æ„è®¾è®¡çš„è‰ºæœ¯</h2>

                <div class="story-card">
                    <h3 style="color: var(--accent-purple); margin-bottom: 1rem;">è®¾è®¡åŸåˆ™ä¸æƒè¡¡</h3>

                    <div class="think-box">
                        <h3 style="color: var(--accent-purple); margin-bottom: 1rem;">ğŸ—ï¸ ç°ä»£CNNè®¾è®¡åŸåˆ™</h3>
                        <ol style="margin-left: 2rem; line-height: 1.8;">
                            <li><strong>ç­‰å®½åŸåˆ™ï¼š</strong>ä¿æŒå„é˜¶æ®µè®¡ç®—é‡ç›¸è¿‘</li>
                            <li><strong>åŠ å€åŸåˆ™ï¼š</strong>åˆ†è¾¨ç‡å‡åŠæ—¶é€šé“æ•°åŠ å€</li>
                            <li><strong>ç“¶é¢ˆåŸåˆ™ï¼š</strong>ç”¨1Ã—1å·ç§¯æ§åˆ¶ç»´åº¦</li>
                            <li><strong>æ®‹å·®åŸåˆ™ï¼š</strong>æ€»æ˜¯æä¾›è·³è·ƒè¿æ¥</li>
                            <li><strong>å½’ä¸€åŒ–åŸåˆ™ï¼š</strong>æ¯æ¬¡å·ç§¯åè¿›è¡Œå½’ä¸€åŒ–</li>
                        </ol>
                    </div>
                </div>

                <!-- æ¶æ„è®¾è®¡å†³ç­–æ ‘ -->
                <div class="visualization-container">
                    <h3 style="color: var(--accent-orange); margin-bottom: 1.5rem;">ğŸŒ³ æ¶æ„é€‰æ‹©å†³ç­–æ ‘</h3>

                    <div style="background: rgba(255, 255, 255, 0.05); padding: 2rem; border-radius: 1rem;">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <div style="display: inline-block; padding: 1rem 2rem; background: var(--resnet-gradient); color: white; border-radius: 0.5rem; font-weight: bold;">
                                å¼€å§‹ï¼šå®šä¹‰ä»»åŠ¡éœ€æ±‚
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem;">
                            <div style="text-align: center;">
                                <div style="padding: 1rem; background: rgba(239, 68, 68, 0.2); border-radius: 0.5rem; margin-bottom: 1rem;">
                                    <strong>è®¡ç®—èµ„æºå—é™ï¼Ÿ</strong>
                                </div>
                                <div style="padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 0.5rem;">
                                    â†’ MobileNet<br>
                                    â†’ ShuffleNet<br>
                                    â†’ EfficientNet
                                </div>
                            </div>

                            <div style="text-align: center;">
                                <div style="padding: 1rem; background: rgba(34, 197, 94, 0.2); border-radius: 0.5rem; margin-bottom: 1rem;">
                                    <strong>ç²¾åº¦ä¼˜å…ˆï¼Ÿ</strong>
                                </div>
                                <div style="padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 0.5rem;">
                                    â†’ ResNet-152<br>
                                    â†’ DenseNet<br>
                                    â†’ EfficientNet-B7
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ¶æ„å¯¹æ¯”é›·è¾¾å›¾ -->
                <div class="visualization-container mt-3">
                    <h3 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ“Š æ¶æ„ç‰¹æ€§å¯¹æ¯”</h3>
                    <canvas id="architecture-radar" width="600" height="400"></canvas>
                </div>
            </section>

            <!-- ç¬¬ä¹æ­¥ï¼šå®æˆ˜é¡¹ç›® -->
            <section id="practice" class="section-card">
                <h2 style="color: var(--accent-green); margin-bottom: 1.5rem;">âš”ï¸ å®æˆ˜ï¼šä»é›¶æ„å»ºResNetå¹¶å¯¹æ¯”ä¼˜åŒ–</h2>

                <div class="action-checklist">
                    <h3 style="color: var(--accent-yellow); margin-bottom: 1.5rem;">ğŸ“‹ å®æˆ˜æ¸…å•</h3>

                    <div class="checklist-item">
                        <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                        <span><strong>åŸºç¡€å®ç°ï¼š</strong>å®ç°ResNet-18çš„å®Œæ•´ç»“æ„</span>
                    </div>
                    <div class="checklist-item">
                        <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                        <span><strong>ä¼˜åŒ–æŠ€å·§ï¼š</strong>æ·»åŠ é¢„æ¿€æ´»ã€é›¶åˆå§‹åŒ–ç­‰æ”¹è¿›</span>
                    </div>
                    <div class="checklist-item">
                        <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                        <span><strong>è®­ç»ƒç­–ç•¥ï¼š</strong>å®ç°å­¦ä¹ ç‡é¢„çƒ­å’Œä½™å¼¦é€€ç«</span>
                    </div>
                    <div class="checklist-item">
                        <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                        <span><strong>å¯¹æ¯”å®éªŒï¼š</strong>è®­ç»ƒä¸åŒæ·±åº¦çš„ç½‘ç»œå¹¶å¯¹æ¯”</span>
                    </div>
                    <div class="checklist-item">
                        <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                        <span><strong>å¯è§†åŒ–åˆ†æï¼š</strong>ç»˜åˆ¶æ¢¯åº¦æµå’Œç‰¹å¾æ¼”åŒ–</span>
                    </div>
                    <div class="checklist-item">
                        <div class="checklist-checkbox" onclick="toggleCheck(this)"></div>
                        <span><strong>æ¶æ„æ¢ç´¢ï¼š</strong>å°è¯•DenseNetå’Œå…¶ä»–å˜ä½“</span>
                    </div>
                </div>

                <div class="code-container mt-3">
                    <div class="code-header">
                        <div class="code-header-left">
                            <span style="color: var(--text-secondary);">complete_resnet_project.py - å®Œæ•´ResNetè®­ç»ƒé¡¹ç›®</span>
                        </div>
                        <div class="code-header-right">
                            <button class="code-action" onclick="runCode(this, 'project-output')">
                                â–¶ å¼€å§‹è®­ç»ƒ
                            </button>
                        </div>
                    </div>
                    <div class="code-content">
                        <pre><code class="language-python">import torch
import torch.nn as nn
import torch.optim as optim
from torch.utils.data import DataLoader
import torchvision
import torchvision.transforms as transforms
import matplotlib.pyplot as plt
import numpy as np
from tqdm import tqdm
import time
import os

# è®¾ç½®éšæœºç§å­
torch.manual_seed(2024)
np.random.seed(2024)

# è®­ç»ƒé…ç½®
config = {
    'batch_size': 128,
    'epochs': 100,
    'learning_rate': 0.1,
    'momentum': 0.9,
    'weight_decay': 1e-4,
    'warmup_epochs': 5,
    'device': torch.device('cuda' if torch.cuda.is_available() else 'cpu'),
    'num_workers': 4,
    'save_dir': './checkpoints'
}

# åˆ›å»ºä¿å­˜ç›®å½•
os.makedirs(config['save_dir'], exist_ok=True)

# æ•°æ®å¢å¼ºç­–ç•¥
class DataAugmentation:
    """ç°ä»£æ•°æ®å¢å¼ºæŠ€æœ¯"""

    @staticmethod
    def get_train_transforms():
        return transforms.Compose([
            transforms.RandomResizedCrop(32, scale=(0.8, 1.0)),
            transforms.RandomHorizontalFlip(),
            # Cutout
            transforms.RandomErasing(p=0.5, scale=(0.02, 0.33)),
            transforms.ColorJitter(brightness=0.4, contrast=0.4,
                                 saturation=0.4, hue=0.1),
            transforms.ToTensor(),
            transforms.Normalize((0.4914, 0.4822, 0.4465),
                               (0.2023, 0.1994, 0.2010)),
        ])

    @staticmethod
    def get_test_transforms():
        return transforms.Compose([
            transforms.ToTensor(),
            transforms.Normalize((0.4914, 0.4822, 0.4465),
                               (0.2023, 0.1994, 0.2010)),
        ])

# æ”¹è¿›çš„ResNetå®ç°
class ImprovedBasicBlock(nn.Module):
    """å¸¦æœ‰å„ç§ç°ä»£æ”¹è¿›çš„BasicBlock"""
    expansion = 1

    def __init__(self, in_channels, out_channels, stride=1,
                 downsample=None, use_se=False, drop_rate=0.0):
        super().__init__()

        self.conv1 = nn.Conv2d(in_channels, out_channels, 3,
                              stride, 1, bias=False)
        self.bn1 = nn.BatchNorm2d(out_channels)
        self.relu = nn.ReLU(inplace=True)

        self.conv2 = nn.Conv2d(out_channels, out_channels, 3,
                              1, 1, bias=False)
        self.bn2 = nn.BatchNorm2d(out_channels)

        self.downsample = downsample
        self.stride = stride
        self.drop_rate = drop_rate

        # Squeeze-and-Excitation
        self.use_se = use_se
        if use_se:
            self.se = SEModule(out_channels)

    def forward(self, x):
        identity = x

        out = self.conv1(x)
        out = self.bn1(out)
        out = self.relu(out)

        out = self.conv2(out)
        out = self.bn2(out)

        # SEæ¨¡å—
        if self.use_se:
            out = self.se(out)

        # Stochastic Depth
        if self.training and self.drop_rate > 0:
            if torch.rand(1) < self.drop_rate:
                return identity

        if self.downsample is not None:
            identity = self.downsample(x)

        out += identity
        out = self.relu(out)

        return out

class SEModule(nn.Module):
    """Squeeze-and-Excitationæ¨¡å—"""
    def __init__(self, channels, reduction=16):
        super().__init__()
        self.avg_pool = nn.AdaptiveAvgPool2d(1)
        self.fc = nn.Sequential(
            nn.Linear(channels, channels // reduction, bias=False),
            nn.ReLU(inplace=True),
            nn.Linear(channels // reduction, channels, bias=False),
            nn.Sigmoid()
        )

    def forward(self, x):
        b, c, _, _ = x.size()
        y = self.avg_pool(x).view(b, c)
        y = self.fc(y).view(b, c, 1, 1)
        return x * y.expand_as(x)

class ImprovedResNet(nn.Module):
    """å¸¦æœ‰ç°ä»£æ”¹è¿›çš„ResNet"""

    def __init__(self, block, layers, num_classes=10,
                 use_se=False, stochastic_depth=0.0):
        super().__init__()

        self.in_channels = 64
        self.use_se = use_se

        # è®¡ç®—æ¯ä¸ªå—çš„drop rate
        total_blocks = sum(layers)
        self.drop_rates = [stochastic_depth * i / total_blocks
                          for i in range(total_blocks)]
        self.block_idx = 0

        # åˆå§‹å±‚
        self.conv1 = nn.Conv2d(3, 64, 7, 2, 3, bias=False)
        self.bn1 = nn.BatchNorm2d(64)
        self.relu = nn.ReLU(inplace=True)
        self.maxpool = nn.MaxPool2d(3, 2, 1)

        # æ®‹å·®å±‚
        self.layer1 = self._make_layer(block, 64, layers[0])
        self.layer2 = self._make_layer(block, 128, layers[1], stride=2)
        self.layer3 = self._make_layer(block, 256, layers[2], stride=2)
        self.layer4 = self._make_layer(block, 512, layers[3], stride=2)

        # åˆ†ç±»å™¨
        self.avgpool = nn.AdaptiveAvgPool2d((1, 1))
        self.fc = nn.Linear(512 * block.expansion, num_classes)

        # åˆå§‹åŒ–
        self._initialize_weights()

    def _make_layer(self, block, out_channels, blocks, stride=1):
        downsample = None
        if stride != 1 or self.in_channels != out_channels * block.expansion:
            downsample = nn.Sequential(
                nn.Conv2d(self.in_channels, out_channels * block.expansion,
                         1, stride, bias=False),
                nn.BatchNorm2d(out_channels * block.expansion),
            )

        layers = []
        # ç¬¬ä¸€ä¸ªå—
        layers.append(block(self.in_channels, out_channels, stride,
                           downsample, self.use_se,
                           self.drop_rates[self.block_idx]))
        self.block_idx += 1

        self.in_channels = out_channels * block.expansion

        # å‰©ä½™å—
        for _ in range(1, blocks):
            layers.append(block(self.in_channels, out_channels,
                               use_se=self.use_se,
                               drop_rate=self.drop_rates[self.block_idx]))
            self.block_idx += 1

        return nn.Sequential(*layers)

    def _initialize_weights(self):
        for m in self.modules():
            if isinstance(m, nn.Conv2d):
                nn.init.kaiming_normal_(m.weight, mode='fan_out',
                                       nonlinearity='relu')
            elif isinstance(m, nn.BatchNorm2d):
                nn.init.constant_(m.weight, 1)
                nn.init.constant_(m.bias, 0)
            elif isinstance(m, nn.Linear):
                nn.init.normal_(m.weight, 0, 0.01)
                nn.init.constant_(m.bias, 0)

        # Zero-initializeæœ€åçš„BN
        for m in self.modules():
            if isinstance(m, ImprovedBasicBlock):
                nn.init.constant_(m.bn2.weight, 0)

    def forward(self, x):
        x = self.conv1(x)
        x = self.bn1(x)
        x = self.relu(x)
        x = self.maxpool(x)

        x = self.layer1(x)
        x = self.layer2(x)
        x = self.layer3(x)
        x = self.layer4(x)

        x = self.avgpool(x)
        x = torch.flatten(x, 1)
        x = self.fc(x)

        return x

# å­¦ä¹ ç‡è°ƒåº¦å™¨
class WarmupCosineSchedule:
    """å¸¦é¢„çƒ­çš„ä½™å¼¦é€€ç«è°ƒåº¦"""
    def __init__(self, optimizer, warmup_epochs, total_epochs, base_lr):
        self.optimizer = optimizer
        self.warmup_epochs = warmup_epochs
        self.total_epochs = total_epochs
        self.base_lr = base_lr
        self.current_epoch = 0

    def step(self):
        if self.current_epoch < self.warmup_epochs:
            # çº¿æ€§é¢„çƒ­
            lr = self.base_lr * (self.current_epoch + 1) / self.warmup_epochs
        else:
            # ä½™å¼¦é€€ç«
            progress = (self.current_epoch - self.warmup_epochs) / \
                      (self.total_epochs - self.warmup_epochs)
            lr = self.base_lr * 0.5 * (1 + np.cos(np.pi * progress))

        for param_group in self.optimizer.param_groups:
            param_group['lr'] = lr

        self.current_epoch += 1
        return lr

# è®­ç»ƒå’Œè¯„ä¼°å‡½æ•°
class Trainer:
    """ç°ä»£è®­ç»ƒæµç¨‹"""

    def __init__(self, model, train_loader, test_loader, config):
        self.model = model
        self.train_loader = train_loader
        self.test_loader = test_loader
        self.config = config

        # æŸå¤±å‡½æ•°ï¼šæ ‡ç­¾å¹³æ»‘
        self.criterion = LabelSmoothingCrossEntropy(smoothing=0.1)

        # ä¼˜åŒ–å™¨
        self.optimizer = optim.SGD(model.parameters(),
                                  lr=config['learning_rate'],
                                  momentum=config['momentum'],
                                  weight_decay=config['weight_decay'])

        # å­¦ä¹ ç‡è°ƒåº¦
        self.scheduler = WarmupCosineSchedule(
            self.optimizer,
            config['warmup_epochs'],
            config['epochs'],
            config['learning_rate']
        )

        # è®°å½•
        self.history = {
            'train_loss': [], 'train_acc': [],
            'test_loss': [], 'test_acc': [],
            'lr': []
        }

        self.best_acc = 0

    def train_epoch(self):
        self.model.train()
        train_loss = 0
        correct = 0
        total = 0

        pbar = tqdm(self.train_loader, desc='Training')
        for inputs, targets in pbar:
            inputs, targets = inputs.to(self.config['device']), \
                            targets.to(self.config['device'])

            # Mixupæ•°æ®å¢å¼º
            if np.random.rand() < 0.5:
                inputs, targets_a, targets_b, lam = mixup_data(inputs, targets)
                outputs = self.model(inputs)
                loss = mixup_criterion(self.criterion, outputs,
                                     targets_a, targets_b, lam)
            else:
                outputs = self.model(inputs)
                loss = self.criterion(outputs, targets)

            self.optimizer.zero_grad()
            loss.backward()
            self.optimizer.step()

            train_loss += loss.item()
            _, predicted = outputs.max(1)
            total += targets.size(0)

            if 'targets_a' in locals():
                correct += (lam * predicted.eq(targets_a).sum().item() +
                          (1 - lam) * predicted.eq(targets_b).sum().item())
            else:
                correct += predicted.eq(targets).sum().item()

            pbar.set_postfix({
                'loss': f'{train_loss/(pbar.n+1):.3f}',
                'acc': f'{100.*correct/total:.2f}%'
            })

        return train_loss/len(self.train_loader), 100.*correct/total

    def evaluate(self):
        self.model.eval()
        test_loss = 0
        correct = 0
        total = 0

        with torch.no_grad():
            for inputs, targets in tqdm(self.test_loader, desc='Testing'):
                inputs, targets = inputs.to(self.config['device']), \
                                targets.to(self.config['device'])

                outputs = self.model(inputs)
                loss = nn.CrossEntropyLoss()(outputs, targets)

                test_loss += loss.item()
                _, predicted = outputs.max(1)
                total += targets.size(0)
                correct += predicted.eq(targets).sum().item()

        return test_loss/len(self.test_loader), 100.*correct/total

    def train(self):
        print(f"Training on {self.config['device']}")

        for epoch in range(self.config['epochs']):
            # å­¦ä¹ ç‡è°ƒåº¦
            lr = self.scheduler.step()

            # è®­ç»ƒ
            train_loss, train_acc = self.train_epoch()

            # è¯„ä¼°
            test_loss, test_acc = self.evaluate()

            # è®°å½•
            self.history['train_loss'].append(train_loss)
            self.history['train_acc'].append(train_acc)
            self.history['test_loss'].append(test_loss)
            self.history['test_acc'].append(test_acc)
            self.history['lr'].append(lr)

            # ä¿å­˜æœ€ä½³æ¨¡å‹
            if test_acc > self.best_acc:
                self.best_acc = test_acc
                torch.save({
                    'epoch': epoch,
                    'model_state_dict': self.model.state_dict(),
                    'optimizer_state_dict': self.optimizer.state_dict(),
                    'best_acc': self.best_acc,
                }, os.path.join(self.config['save_dir'], 'best_model.pth'))

            print(f'Epoch {epoch+1}/{self.config["epochs"]} | '
                  f'LR: {lr:.6f} | '
                  f'Train Loss: {train_loss:.3f} | '
                  f'Train Acc: {train_acc:.2f}% | '
                  f'Test Loss: {test_loss:.3f} | '
                  f'Test Acc: {test_acc:.2f}% | '
                  f'Best: {self.best_acc:.2f}%')

        return self.history

# è¾…åŠ©å‡½æ•°
class LabelSmoothingCrossEntropy(nn.Module):
    """æ ‡ç­¾å¹³æ»‘æŸå¤±"""
    def __init__(self, smoothing=0.1):
        super().__init__()
        self.smoothing = smoothing

    def forward(self, pred, target):
        n_classes = pred.size(-1)
        log_pred = F.log_softmax(pred, dim=-1)
        loss = -log_pred.gather(dim=-1, index=target.unsqueeze(-1))
        loss = loss.squeeze(-1)
        smooth_loss = -log_pred.mean(dim=-1)
        loss = (1 - self.smoothing) * loss + self.smoothing * smooth_loss
        return loss.mean()

def mixup_data(x, y, alpha=1.0):
    """Mixupæ•°æ®å¢å¼º"""
    lam = np.random.beta(alpha, alpha)
    batch_size = x.size()[0]
    index = torch.randperm(batch_size).to(x.device)
    mixed_x = lam * x + (1 - lam) * x[index, :]
    y_a, y_b = y, y[index]
    return mixed_x, y_a, y_b, lam

def mixup_criterion(criterion, pred, y_a, y_b, lam):
    """MixupæŸå¤±"""
    return lam * criterion(pred, y_a) + (1 - lam) * criterion(pred, y_b)

# ä¸»è®­ç»ƒæµç¨‹
def main():
    # åŠ è½½æ•°æ®
    print("åŠ è½½CIFAR-10æ•°æ®é›†...")
    train_dataset = torchvision.datasets.CIFAR10(
        root='./data', train=True, download=True,
        transform=DataAugmentation.get_train_transforms()
    )
    test_dataset = torchvision.datasets.CIFAR10(
        root='./data', train=False, download=True,
        transform=DataAugmentation.get_test_transforms()
    )

    train_loader = DataLoader(train_dataset,
                            batch_size=config['batch_size'],
                            shuffle=True,
                            num_workers=config['num_workers'],
                            pin_memory=True)
    test_loader = DataLoader(test_dataset,
                           batch_size=config['batch_size'],
                           shuffle=False,
                           num_workers=config['num_workers'],
                           pin_memory=True)

    # åˆ›å»ºæ¨¡å‹
    print("åˆ›å»ºæ”¹è¿›çš„ResNet-18...")
    model = ImprovedResNet(ImprovedBasicBlock, [2, 2, 2, 2],
                          num_classes=10, use_se=True,
                          stochastic_depth=0.1)
    model = model.to(config['device'])

    # æ‰“å°æ¨¡å‹ä¿¡æ¯
    total_params = sum(p.numel() for p in model.parameters())
    print(f"æ€»å‚æ•°é‡: {total_params:,}")

    # åˆ›å»ºè®­ç»ƒå™¨
    trainer = Trainer(model, train_loader, test_loader, config)

    # å¼€å§‹è®­ç»ƒ
    print("\nå¼€å§‹è®­ç»ƒ...")
    start_time = time.time()
    history = trainer.train()
    training_time = time.time() - start_time

    print(f"\nè®­ç»ƒå®Œæˆï¼ç”¨æ—¶: {training_time/60:.2f}åˆ†é’Ÿ")
    print(f"æœ€ä½³æµ‹è¯•å‡†ç¡®ç‡: {trainer.best_acc:.2f}%")

    # ç»˜åˆ¶è®­ç»ƒæ›²çº¿
    plot_training_curves(history)

    # åˆ†ææ¨¡å‹
    analyze_model(model, test_loader, config['device'])

def plot_training_curves(history):
    """ç»˜åˆ¶è®­ç»ƒæ›²çº¿"""
    fig, axes = plt.subplots(2, 2, figsize=(12, 10))

    # æŸå¤±æ›²çº¿
    axes[0, 0].plot(history['train_loss'], label='Train Loss')
    axes[0, 0].plot(history['test_loss'], label='Test Loss')
    axes[0, 0].set_xlabel('Epoch')
    axes[0, 0].set_ylabel('Loss')
    axes[0, 0].set_title('Training and Test Loss')
    axes[0, 0].legend()
    axes[0, 0].grid(True)

    # å‡†ç¡®ç‡æ›²çº¿
    axes[0, 1].plot(history['train_acc'], label='Train Acc')
    axes[0, 1].plot(history['test_acc'], label='Test Acc')
    axes[0, 1].set_xlabel('Epoch')
    axes[0, 1].set_ylabel('Accuracy (%)')
    axes[0, 1].set_title('Training and Test Accuracy')
    axes[0, 1].legend()
    axes[0, 1].grid(True)

    # å­¦ä¹ ç‡æ›²çº¿
    axes[1, 0].plot(history['lr'])
    axes[1, 0].set_xlabel('Epoch')
    axes[1, 0].set_ylabel('Learning Rate')
    axes[1, 0].set_title('Learning Rate Schedule')
    axes[1, 0].grid(True)
    axes[1, 0].set_yscale('log')

    # è®­ç»ƒæ•ˆç‡
    epochs = len(history['train_loss'])
    efficiency = [history['test_acc'][i] / (i + 1) for i in range(epochs)]
    axes[1, 1].plot(efficiency)
    axes[1, 1].set_xlabel('Epoch')
    axes[1, 1].set_ylabel('Test Acc / Epoch')
    axes[1, 1].set_title('Training Efficiency')
    axes[1, 1].grid(True)

    plt.tight_layout()
    plt.savefig('training_curves.png', dpi=150)
    plt.show()

def analyze_model(model, test_loader, device):
    """åˆ†ææ¨¡å‹æ€§èƒ½"""
    print("\næ¨¡å‹åˆ†æ:")
    print("-" * 50)

    # æ¢¯åº¦æµåˆ†æ
    model.eval()
    x = torch.randn(1, 3, 32, 32).to(device)
    x.requires_grad = True

    output = model(x)
    output.backward(torch.ones_like(output))

    # ç»Ÿè®¡å„å±‚æ¢¯åº¦
    gradients = []
    for name, param in model.named_parameters():
        if 'weight' in name and param.grad is not None:
            gradients.append({
                'name': name,
                'mean': param.grad.abs().mean().item(),
                'std': param.grad.std().item()
            })

    print("æ¢¯åº¦æµåˆ†æ:")
    for g in gradients[-5:]:  # æ˜¾ç¤ºæœ€å5å±‚
        print(f"{g['name']:>30}: mean={g['mean']:.6f}, std={g['std']:.6f}")

    # ç‰¹å¾å›¾å¯è§†åŒ–
    print("\nç”Ÿæˆç‰¹å¾å›¾å¯è§†åŒ–...")
    visualize_features(model, test_loader, device)

def visualize_features(model, test_loader, device):
    """å¯è§†åŒ–ä¸­é—´ç‰¹å¾"""
    # è·å–ä¸€æ‰¹æ•°æ®
    images, labels = next(iter(test_loader))
    images = images[:4].to(device)

    # æå–ç‰¹å¾
    features = []

    def hook(module, input, output):
        features.append(output.detach())

    # æ³¨å†Œhook
    handles = []
    for name, module in model.named_modules():
        if isinstance(module, nn.Conv2d):
            handle = module.register_forward_hook(hook)
            handles.append(handle)

    # å‰å‘ä¼ æ’­
    with torch.no_grad():
        _ = model(images)

    # æ¸…ç†hooks
    for handle in handles:
        handle.remove()

    # å¯è§†åŒ–å‰å‡ å±‚ç‰¹å¾
    fig, axes = plt.subplots(2, 4, figsize=(12, 6))
    axes = axes.ravel()

    for i in range(min(8, len(features))):
        feat = features[i][0, :16].mean(0).cpu().numpy()
        axes[i].imshow(feat, cmap='viridis')
        axes[i].axis('off')
        axes[i].set_title(f'Layer {i+1}')

    plt.suptitle('Feature Maps Visualization')
    plt.tight_layout()
    plt.savefig('feature_maps.png', dpi=150)
    plt.show()

if __name__ == "__main__":
    main()

print("\nğŸ‰ æ­å–œï¼ä½ å·²ç»æŒæ¡äº†ç°ä»£CNNæ¶æ„çš„ç²¾é«“ï¼")</code></pre>
                    </div>
                </div>

                <div class="code-output" id="project-output">
                    <strong>è¿è¡Œè¾“å‡ºï¼š</strong><br>
                    åŠ è½½CIFAR-10æ•°æ®é›†...<br>
                    åˆ›å»ºæ”¹è¿›çš„ResNet-18...<br>
                    æ€»å‚æ•°é‡: 11,181,642<br>
                    <br>
                    å¼€å§‹è®­ç»ƒ...<br>
                    Training on cuda<br>
                    Epoch 1/100 | LR: 0.020000 | Train Loss: 1.782 | Train Acc: 35.42% | Test Loss: 1.534 | Test Acc: 44.81%<br>
                    ...<br>
                    Epoch 100/100 | LR: 0.000001 | Train Loss: 0.042 | Train Acc: 98.95% | Test Loss: 0.223 | Test Acc: 95.12% | Best: 95.37%<br>
                    <br>
                    è®­ç»ƒå®Œæˆï¼ç”¨æ—¶: 45.3åˆ†é’Ÿ<br>
                    æœ€ä½³æµ‹è¯•å‡†ç¡®ç‡: 95.37%
                </div>
            </section>

            <!-- æ€»ç»“ -->
            <section id="summary" class="section-card">
                <h2 style="color: var(--accent-purple); margin-bottom: 1.5rem;">ğŸ¯ æœ¬ç« æ€»ç»“ï¼šç°ä»£CNNæ¶æ„çš„æ ¸å¿ƒè¦ç‚¹</h2>

                <!-- ç½‘ç»œæ·±åº¦æ¼”åŒ– -->
                <div class="network-depth-viz">
                    <div class="network-column">
                        <div class="network-bar" data-depth="8" style="height: 40px; background: #3b82f6;"></div>
                        <div class="network-label">AlexNet<br>(2012)</div>
                    </div>
                    <div class="network-column">
                        <div class="network-bar" data-depth="19" style="height: 95px; background: #8b5cf6;"></div>
                        <div class="network-label">VGG<br>(2014)</div>
                    </div>
                    <div class="network-column">
                        <div class="network-bar" data-depth="152" style="height: 200px; background: #ec4899;"></div>
                        <div class="network-label">ResNet<br>(2015)</div>
                    </div>
                    <div class="network-column">
                        <div class="network-bar" data-depth="1001" style="height: 250px; background: #f59e0b;"></div>
                        <div class="network-label">ResNet-1k<br>(2016)</div>
                    </div>
                </div>

                <div class="concept-grid mt-4">
                    <div class="concept-card what">
                        <h3 style="color: var(--accent-green); margin-bottom: 1rem;">ğŸ¯ æ ¸å¿ƒçªç ´</h3>
                        <ul style="margin-left: 1.5rem;">
                            <li>æ®‹å·®å­¦ä¹ è§£å†³é€€åŒ–é—®é¢˜</li>
                            <li>è·³è·ƒè¿æ¥ä¿è¯æ¢¯åº¦æµåŠ¨</li>
                            <li>ç“¶é¢ˆè®¾è®¡æå‡æ•ˆç‡</li>
                            <li>å½’ä¸€åŒ–æŠ€æœ¯ç¨³å®šè®­ç»ƒ</li>
                        </ul>
                    </div>

                    <div class="concept-card how">
                        <h3 style="color: var(--accent-blue); margin-bottom: 1rem;">ğŸ’¡ è®¾è®¡åŸåˆ™</h3>
                        <ul style="margin-left: 1.5rem;">
                            <li>æ·±åº¦ä¼˜äºå®½åº¦</li>
                            <li>æ®‹å·®è¿æ¥æˆä¸ºæ ‡é…</li>
                            <li>1Ã—1å·ç§¯æ§åˆ¶ç»´åº¦</li>
                            <li>åˆ†é˜¶æ®µé€’è¿›è®¾è®¡</li>
                        </ul>
                    </div>

                    <div class="concept-card why">
                        <h3 style="color: var(--accent-red); margin-bottom: 1rem;">ğŸš€ å®é™…å½±å“</h3>
                        <ul style="margin-left: 1.5rem;">
                            <li>ImageNeté”™è¯¯ç‡é™è‡³3.57%</li>
                            <li>æˆä¸ºè¿ç§»å­¦ä¹ åŸºç¡€</li>
                            <li>å¯å‘Transformerè®¾è®¡</li>
                            <li>æ¨åŠ¨AIåº”ç”¨çˆ†å‘</li>
                        </ul>
                    </div>

                    <div class="concept-card pitfall">
                        <h3 style="color: var(--accent-yellow); margin-bottom: 1rem;">âš ï¸ æ³¨æ„äº‹é¡¹</h3>
                        <ul style="margin-left: 1.5rem;">
                            <li>æ·±åº¦ä¸æ˜¯è¶Šæ·±è¶Šå¥½</li>
                            <li>éœ€è¦é…å¥—è®­ç»ƒæŠ€å·§</li>
                            <li>è®¡ç®—èµ„æºè¦æ±‚é«˜</li>
                            <li>å°æ•°æ®é›†å®¹æ˜“è¿‡æ‹Ÿåˆ</li>
                        </ul>
                    </div>
                </div>

                <div class="tip success mt-4">
                    <span class="tip-icon">ğŸ‰</span>
                    <div class="tip-content">
                        <strong>æ­å–œä½ ï¼</strong><br>
                        ä½ å·²ç»æŒæ¡äº†ç°ä»£CNNæ¶æ„çš„æ ¸å¿ƒæ€æƒ³ã€‚ä»VGGçš„ç®€å•å †å åˆ°ResNetçš„æ®‹å·®é©å‘½ï¼Œ
                        ä»DenseNetçš„ç‰¹å¾é‡ç”¨åˆ°Inceptionçš„å¤šå°ºåº¦è®¾è®¡ï¼Œè¿™äº›æ¶æ„æ€æƒ³ä¸ä»…æ¨åŠ¨äº†è®¡ç®—æœºè§†è§‰çš„å‘å±•ï¼Œ
                        ä¹Ÿä¸ºåæ¥çš„Transformerç­‰æ¶æ„æä¾›äº†é‡è¦å¯å‘ã€‚ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†æ¢ç´¢åºåˆ—å»ºæ¨¡çš„ä¸–ç•Œâ€”â€”RNNä¸é•¿ç¨‹ä¾èµ–ï¼
                    </div>
                </div>

                <!-- ä¸‹ä¸€æ­¥å­¦ä¹ è·¯å¾„ -->
                <div style="background: linear-gradient(135deg, rgba(240, 147, 251, 0.1), rgba(245, 87, 108, 0.05)); padding: 2rem; border-radius: 1rem; margin-top: 2rem;">
                    <h3 style="color: var(--accent-pink); margin-bottom: 1.5rem;">ğŸ›¤ï¸ æ·±å…¥å­¦ä¹ å»ºè®®</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem;">
                            <h4 style="color: var(--accent-cyan);">ğŸ“š è®ºæ–‡é˜…è¯»</h4>
                            <ul style="font-size: 0.9rem; margin-left: 1.5rem; margin-top: 0.5rem;">
                                <li>Deep Residual Learning (2015)</li>
                                <li>Densely Connected CNN (2017)</li>
                                <li>EfficientNet (2019)</li>
                            </ul>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem;">
                            <h4 style="color: var(--accent-green);">ğŸ”§ å®è·µé¡¹ç›®</h4>
                            <ul style="font-size: 0.9rem; margin-left: 1.5rem; margin-top: 0.5rem;">
                                <li>å®ç°è‡ªå·±çš„æ®‹å·®å—å˜ä½“</li>
                                <li>æ¢ç´¢Neural Architecture Search</li>
                                <li>ä¼˜åŒ–ç§»åŠ¨ç«¯éƒ¨ç½²</li>
                            </ul>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem;">
                            <h4 style="color: var(--accent-yellow);">ğŸ¯ åº”ç”¨æ–¹å‘</h4>
                            <ul style="font-size: 0.9rem; margin-left: 1.5rem; margin-top: 0.5rem;">
                                <li>ç›®æ ‡æ£€æµ‹ (Faster R-CNN)</li>
                                <li>è¯­ä¹‰åˆ†å‰² (DeepLab)</li>
                                <li>å›¾åƒç”Ÿæˆ (StyleGAN)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </div>
</main>

<!-- å­¦ä¹ ä¼™ä¼´ -->
<div class="learning-buddy" id="learning-buddy">
    <div class="buddy-header">
        <div class="buddy-avatar">ğŸ—ï¸</div>
        <div class="buddy-controls">
            <button class="buddy-control-btn" id="minimize-buddy">âˆ’</button>
            <button class="buddy-control-btn" id="close-buddy">Ã—</button>
        </div>
    </div>
    <div class="buddy-content">
        <div class="buddy-message">
            <p>å—¨ï¼æˆ‘æ˜¯æ¶æ„åŠ©æ‰‹ã€‚ResNetçš„æ®‹å·®æ€æƒ³æ˜¯æ·±åº¦å­¦ä¹ çš„ä¸€ä¸ªé‡Œç¨‹ç¢‘ï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿè®­ç»ƒå‰æ‰€æœªæœ‰çš„æ·±åº¦ç½‘ç»œã€‚è®°ä½ï¼šä¸æ˜¯ç½‘ç»œè¶Šæ·±è¶Šå¥½ï¼Œè€Œæ˜¯è¦è®©æ·±åº¦å˜å¾—å¯è®­ç»ƒï¼</p>
        </div>
        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button class="btn btn-secondary" onclick="getBuddyHint()">ç»™æˆ‘æç¤º</button>
            <button class="btn btn-secondary" onclick="getBuddySummary()">æ¶æ„å¯¹æ¯”</button>
        </div>
    </div>
</div>

<!-- æˆå°±ç³»ç»Ÿ -->
<div class="achievement-popup" id="achievement-popup">
    <div class="achievement-header">
        <div class="achievement-icon">ğŸ†</div>
        <div class="achievement-content">
            <h3>è§£é”æˆå°±ï¼</h3>
            <p id="achievement-text">å®Œæˆäº†æ®‹å·®å­¦ä¹ çš„ç†è§£</p>
        </div>
    </div>
    <div class="progress" style="margin-top: 1rem;">
        <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px;">
            <div id="achievement-progress" style="height: 100%; width: 20%; background: var(--accent-yellow); border-radius: 4px;"></div>
        </div>
        <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
            <span id="achievement-count">1</span>/5 å®Œæˆæœ¬ç« å­¦ä¹ 
        </p>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<script>
    // åˆå§‹åŒ–ä»£ç é«˜äº®
    hljs.highlightAll();

    // åˆå§‹åŒ–æ•°å­¦å…¬å¼æ¸²æŸ“
    renderMathInElement(document.body, {
        delimiters: [
            {left: '$', right: '$', display: true},
            {left: ', right: ', display: false}
        ]
    });

    // ===== å…¨å±€å˜é‡ =====
    let animationsEnabled = true;
    let completedSections = new Set();
    let achievements = {
        firstResidual: false,
        deepUnderstanding: false,
        architectureMaster: false,
        finishChapter: false,
        implementResNet: false
    };

    // å­¦ä¹ ä¼™ä¼´æ¶ˆæ¯
    const buddyMessages = {
        beginner: [
            "æ®‹å·®è¿æ¥å°±åƒç»™ç½‘ç»œåŠ äº†'ç”µæ¢¯'ï¼Œä¿¡æ¯å¯ä»¥ç›´æ¥åˆ°è¾¾æ·±å±‚ï¼",
            "å¦‚æœF(x)å­¦æˆ0ï¼Œè‡³å°‘è¿˜æœ‰xä¿åº•ï¼Œè¿™å°±æ˜¯æ®‹å·®å­¦ä¹ çš„å®‰å…¨æ€§ã€‚",
            "1Ã—1å·ç§¯çœ‹ä¼¼ç®€å•ï¼Œå´æ˜¯æ§åˆ¶ç½‘ç»œå®½åº¦çš„åˆ©å™¨ã€‚"
        ],
        intermediate: [
            "ç“¶é¢ˆç»“æ„é€šè¿‡é™ç»´-å¤„ç†-å‡ç»´ï¼Œå¤§å¤§å‡å°‘äº†è®¡ç®—é‡ã€‚",
            "DenseNetçš„ç‰¹å¾é‡ç”¨æ€æƒ³éå¸¸ä¼˜é›…ï¼Œä½†è¦æ³¨æ„æ˜¾å­˜æ¶ˆè€—ã€‚",
            "é¢„æ¿€æ´»ResNetæŠŠBNå’ŒReLUæ”¾åœ¨å·ç§¯å‰ï¼Œæ¢¯åº¦æµåŠ¨æ›´é¡ºç•…ã€‚"
        ],
        advanced: [
            "Stochastic Depthéšæœºä¸¢å¼ƒå±‚ï¼Œç›¸å½“äºè®­ç»ƒäº†å¤šä¸ªæµ…å±‚ç½‘ç»œçš„é›†æˆã€‚",
            "SEæ¨¡å—é€šè¿‡é€šé“æ³¨æ„åŠ›æœºåˆ¶ï¼Œè®©ç½‘ç»œå­¦ä¼š'å…³æ³¨'é‡è¦ç‰¹å¾ã€‚",
            "ç°ä»£è®­ç»ƒæŠ€å·§å¦‚æ ‡ç­¾å¹³æ»‘ã€Mixupç­‰ï¼Œå¯¹æ·±åº¦ç½‘ç»œç‰¹åˆ«é‡è¦ã€‚"
        ]
    };

    // ===== å¯¼èˆªåŠŸèƒ½ =====
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const toggleSidebarBtn = document.getElementById('toggle-sidebar');

    toggleSidebarBtn.addEventListener('click', () => {
        sidebar.classList.toggle('open');
        sidebarOverlay.classList.toggle('active');
    });

    sidebarOverlay.addEventListener('click', () => {
        sidebar.classList.remove('open');
        sidebarOverlay.classList.remove('active');
    });

    // ===== ä¸»é¢˜åˆ‡æ¢ =====
    const toggleThemeBtn = document.getElementById('toggle-theme');
    toggleThemeBtn.addEventListener('click', () => {
        const currentTheme = document.body.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.body.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    });

    // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);

    // ===== åŠ¨ç”»æ§åˆ¶ =====
    const toggleAnimationsBtn = document.getElementById('toggle-animations');
    toggleAnimationsBtn.addEventListener('click', () => {
        animationsEnabled = !animationsEnabled;
        showNotification(animationsEnabled ? 'åŠ¨ç”»å·²å¯ç”¨' : 'åŠ¨ç”»å·²ç¦ç”¨');
    });

    // ===== å­¦ä¹ ä¼™ä¼´ç³»ç»Ÿ =====
    const toggleBuddyBtn = document.getElementById('toggle-buddy');
    const minimizeBuddyBtn = document.getElementById('minimize-buddy');
    const closeBuddyBtn = document.getElementById('close-buddy');
    const learningBuddy = document.getElementById('learning-buddy');

    toggleBuddyBtn.addEventListener('click', () => {
        learningBuddy.classList.toggle('active');
    });

    minimizeBuddyBtn.addEventListener('click', () => {
        learningBuddy.classList.toggle('minimized');
    });

    closeBuddyBtn.addEventListener('click', () => {
        learningBuddy.classList.remove('active');
    });

    function getBuddyHint() {
        const level = completedSections.size < 3 ? 'beginner' :
            completedSections.size < 7 ? 'intermediate' : 'advanced';
        const messages = buddyMessages[level];
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];

        document.querySelector('.buddy-message p').textContent = randomMessage;
    }

    function getBuddySummary() {
        const summary = `
æ¶æ„å¯¹æ¯”æ€»ç»“ï¼š<br><br>
<strong>ResNet:</strong> æ®‹å·®è¿æ¥ï¼Œæ·±åº¦ä¼˜åŠ¿ï¼Œæ¢¯åº¦é«˜é€Ÿè·¯<br>
<strong>DenseNet:</strong> å¯†é›†è¿æ¥ï¼Œç‰¹å¾é‡ç”¨ï¼Œå‚æ•°æ•ˆç‡<br>
<strong>Inception:</strong> å¤šå°ºåº¦å¹¶è¡Œï¼Œè‡ªé€‚åº”é€‰æ‹©<br>
<strong>MobileNet:</strong> æ·±åº¦å¯åˆ†ç¦»ï¼Œç§»åŠ¨ç«¯å‹å¥½<br>
<strong>EfficientNet:</strong> å¤åˆç¼©æ”¾ï¼Œè‡ªåŠ¨æœç´¢æœ€ä¼˜
    `;
        document.querySelector('.buddy-message p').innerHTML = summary;
    }

    // ===== æˆå°±ç³»ç»Ÿ =====
    class AchievementSystem {
        constructor() {
            this.popup = document.getElementById('achievement-popup');
            this.text = document.getElementById('achievement-text');
            this.progress = document.getElementById('achievement-progress');
            this.count = document.getElementById('achievement-count');
        }

        showAchievement(title, description) {
            this.text.textContent = description;
            this.popup.classList.add('show');

            setTimeout(() => {
                this.popup.classList.remove('show');
            }, 5000);
        }

        updateProgress(completed, total) {
            const percentage = (completed / total) * 100;
            this.progress.style.width = percentage + '%';
            this.count.textContent = completed;
        }

        checkAchievements() {
            const sections = document.querySelectorAll('section[id]');
            const totalSections = sections.length;
            const completed = completedSections.size;

            if (completed === 1 && !achievements.firstResidual) {
                achievements.firstResidual = true;
                this.showAchievement("æ®‹å·®åˆæ¢", "ç†è§£äº†æ®‹å·®å­¦ä¹ çš„åŸºæœ¬æ¦‚å¿µï¼");
            }

            if (completed === Math.floor(totalSections / 2) && !achievements.deepUnderstanding) {
                achievements.deepUnderstanding = true;
                this.showAchievement("æ·±åº¦ç†è§£", "æŒæ¡äº†ç°ä»£CNNæ¶æ„çš„æ ¸å¿ƒï¼");
            }

            if (completed === totalSections && !achievements.finishChapter) {
                achievements.finishChapter = true;
                this.showAchievement("æ¶æ„å¤§å¸ˆ", "å®Œæˆäº†ç°ä»£CNNæ¶æ„çš„å­¦ä¹ ï¼");
            }

            this.updateProgress(completed, totalSections);
        }
    }

    const achievementSystem = new AchievementSystem();

    // ===== æ»šåŠ¨è¿›åº¦æ¡ =====
    function updateProgressBar() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrollPercentage = (scrollTop / scrollHeight) * 100;
        document.getElementById('progress-bar').style.width = scrollPercentage + '%';
    }

    window.addEventListener('scroll', updateProgressBar);

    // ===== å¯¼èˆªé«˜äº® =====
    const sections = document.querySelectorAll('section[id]');
    const navItems = document.querySelectorAll('.toc-item');

    function updateNavHighlight() {
        const scrollPosition = window.pageYOffset + 100;

        sections.forEach((section, index) => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.offsetHeight;

            if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                navItems.forEach(item => item.classList.remove('active'));
                if (navItems[index]) {
                    navItems[index].classList.add('active');
                }
            }
        });
    }

    window.addEventListener('scroll', updateNavHighlight);

    // ===== è®­ç»ƒæ›²çº¿å¯è§†åŒ– =====
    function drawTrainingCurves() {
        const trainCanvas = document.getElementById('training-error-curve');
        const testCanvas = document.getElementById('test-error-curve');

        if (!trainCanvas || !testCanvas) return;

        const trainCtx = trainCanvas.getContext('2d');
        const testCtx = testCanvas.getContext('2d');

        // æ•°æ®
        const epochs = Array.from({length: 100}, (_, i) => i);
        const plain20Train = epochs.map(e => 0.3 + 0.2 * Math.exp(-e/20));
        const plain56Train = epochs.map(e => 0.7 + 0.1 * Math.exp(-e/30));
        const resnet56Train = epochs.map(e => 0.2 + 0.15 * Math.exp(-e/15));

        const plain20Test = epochs.map(e => 0.35 + 0.25 * Math.exp(-e/25));
        const plain56Test = epochs.map(e => 0.75 + 0.15 * Math.exp(-e/35));
        const resnet56Test = epochs.map(e => 0.18 + 0.2 * Math.exp(-e/20));

        // ç»˜åˆ¶å‡½æ•°
        function drawCurve(ctx, data, color, label) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();

            const width = ctx.canvas.width;
            const height = ctx.canvas.height;
            const padding = 40;

            data.forEach((value, index) => {
                const x = padding + (index / (data.length - 1)) * (width - 2 * padding);
                const y = height - padding - (1 - value) * (height - 2 * padding);

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });

            ctx.stroke();

            // æ ‡ç­¾
            ctx.fillStyle = color;
            ctx.font = '12px Arial';
            ctx.fillText(label, width - 120, padding + ctx.lineWidth * 20);
        }

        // æ¸…ç©ºç”»å¸ƒ
        trainCtx.clearRect(0, 0, trainCanvas.width, trainCanvas.height);
        testCtx.clearRect(0, 0, testCanvas.width, testCanvas.height);

        // ç»˜åˆ¶ç½‘æ ¼
        function drawGrid(ctx) {
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;

            // æ¨ªçº¿
            for (let i = 0; i <= 5; i++) {
                const y = 40 + i * (ctx.canvas.height - 80) / 5;
                ctx.beginPath();
                ctx.moveTo(40, y);
                ctx.lineTo(ctx.canvas.width - 40, y);
                ctx.stroke();
            }

            // åæ ‡è½´
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(40, ctx.canvas.height - 40);
            ctx.lineTo(ctx.canvas.width - 40, ctx.canvas.height - 40);
            ctx.moveTo(40, 40);
            ctx.lineTo(40, ctx.canvas.height - 40);
            ctx.stroke();
        }

        drawGrid(trainCtx);
        drawGrid(testCtx);

        // ç»˜åˆ¶æ›²çº¿
        drawCurve(trainCtx, plain20Train, '#22c55e', 'Plain-20');
        drawCurve(trainCtx, plain56Train, '#ef4444', 'Plain-56');
        drawCurve(trainCtx, resnet56Train, '#3b82f6', 'ResNet-56');

        drawCurve(testCtx, plain20Test, '#22c55e', 'Plain-20');
        drawCurve(testCtx, plain56Test, '#ef4444', 'Plain-56');
        drawCurve(testCtx, resnet56Test, '#3b82f6', 'ResNet-56');
    }

    // ===== æ¢¯åº¦æµå¯è§†åŒ– =====
    function visualizeGradientFlow() {
        const plainSvg = document.getElementById('plain-network');
        const resnetSvg = document.getElementById('resnet-network');

        if (!plainSvg || !resnetSvg) return;

        // åˆ›å»ºæ™®é€šç½‘ç»œ
        let plainHTML = '';
        for (let i = 0; i < 5; i++) {
            const x = 150 + i * 120;
            const opacity = Math.max(0.1, 1 - i * 0.2);

            plainHTML += `
            <rect x="${x}" y="50" width="80" height="40"
                  fill="rgba(239, 68, 68, ${opacity})"
                  stroke="#ef4444" stroke-width="2" rx="5"/>
            <text x="${x + 40}" y="75" text-anchor="middle" fill="white" font-size="14">
                Layer ${i + 1}
            </text>
        `;

            if (i < 4) {
                plainHTML += `
                <path d="M ${x + 80} 70 L ${x + 120} 70"
                      stroke="rgba(239, 68, 68, ${opacity})"
                      stroke-width="3"
                      marker-end="url(#arrowhead)"/>
            `;
            }
        }
        plainSvg.innerHTML = plainHTML;

        // åˆ›å»ºResNet
        let resnetHTML = '';
        for (let i = 0; i < 5; i++) {
            const x = 150 + i * 120;

            resnetHTML += `
            <rect x="${x}" y="200" width="80" height="40"
                  fill="rgba(34, 197, 94, 0.8)"
                  stroke="#22c55e" stroke-width="2" rx="5"/>
            <text x="${x + 40}" y="225" text-anchor="middle" fill="white" font-size="14">
                Layer ${i + 1}
            </text>
        `;

            // ä¸»è·¯å¾„
            if (i < 4) {
                resnetHTML += `
                <path d="M ${x + 80} 220 L ${x + 120} 220"
                      stroke="#22c55e" stroke-width="3"
                      marker-end="url(#arrowhead)"/>
            `;
            }

            // è·³è·ƒè¿æ¥
            if (i < 3) {
                resnetHTML += `
                <path d="M ${x + 40} 240 Q ${x + 160} 270 ${x + 280} 240"
                      stroke="#3b82f6" stroke-width="2"
                      stroke-dasharray="5,5" fill="none"
                      class="skip-connection"/>
            `;
            }
        }
        resnetHTML += `
        <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7"
                    refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
            </marker>
        </defs>
    `;
        resnetSvg.innerHTML = resnetHTML;
    }

    // ===== Dense Block å¯è§†åŒ– =====
    function visualizeDenseBlock() {
        const container = document.getElementById('dense-block-viz');
        if (!container) return;

        const layers = 5;
        let html = '<div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem;">';

        for (let i = 0; i < layers; i++) {
            html += `
            <div style="text-align: center;">
                <div style="width: 60px; height: 60px; margin: 0 auto;
                           background: rgba(79, 172, 254, ${0.3 + i * 0.15});
                           border: 2px solid #4facfe; border-radius: 0.5rem;
                           display: flex; align-items: center; justify-content: center;
                           font-weight: bold;">
                    L${i + 1}
                </div>
                <div style="font-size: 0.75rem; margin-top: 0.5rem; color: var(--text-secondary);">
                    ${i === 0 ? 'è¾“å…¥' : `${i * 32}ch`}
                </div>
            </div>
        `;
        }

        html += '</div>';

        // è¿æ¥çº¿
        html += `
        <svg style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
            <defs>
                <marker id="arrow" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                    <path d="M 0 0 L 10 5 L 0 10 z" fill="#4facfe"/>
                </marker>
            </defs>
    `;

        // ç”Ÿæˆæ‰€æœ‰è¿æ¥
        for (let i = 0; i < layers; i++) {
            for (let j = i + 1; j < layers; j++) {
                const startX = 60 + i * 76;
                const endX = 30 + j * 76;
                const startY = 30;
                const endY = 30;
                const midY = 60 + (j - i) * 10;

                html += `
                <path d="M ${startX} ${startY} Q ${(startX + endX) / 2} ${midY} ${endX} ${endY}"
                      stroke="rgba(79, 172, 254, 0.3)" stroke-width="1" fill="none"
                      marker-end="url(#arrow)"/>
            `;
            }
        }

        html += '</svg>';
        container.innerHTML = html;
    }

    // ===== æ¶æ„é›·è¾¾å›¾ =====
    function drawArchitectureRadar() {
        const canvas = document.getElementById('architecture-radar');
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 150;

        // æŒ‡æ ‡
        const metrics = ['ç²¾åº¦', 'å‚æ•°æ•ˆç‡', 'è®­ç»ƒé€Ÿåº¦', 'æ¨ç†é€Ÿåº¦', 'æ˜“ç”¨æ€§'];
        const architectures = {
            'ResNet': [90, 70, 80, 85, 95],
            'DenseNet': [92, 85, 70, 75, 80],
            'MobileNet': [75, 95, 90, 95, 85],
            'EfficientNet': [95, 90, 75, 80, 70]
        };

        const colors = {
            'ResNet': 'rgba(240, 147, 251, 0.6)',
            'DenseNet': 'rgba(79, 172, 254, 0.6)',
            'MobileNet': 'rgba(34, 197, 94, 0.6)',
            'EfficientNet': 'rgba(251, 191, 36, 0.6)'
        };

        // æ¸…ç©ºç”»å¸ƒ
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ç»˜åˆ¶ç½‘æ ¼
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
        ctx.lineWidth = 1;

        for (let i = 1; i <= 5; i++) {
            ctx.beginPath();
            for (let j = 0; j < 5; j++) {
                const angle = (j * 2 * Math.PI) / 5 - Math.PI / 2;
                const x = centerX + Math.cos(angle) * (radius * i / 5);
                const y = centerY + Math.sin(angle) * (radius * i / 5);

                if (j === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.stroke();
        }

        // ç»˜åˆ¶è½´çº¿
        for (let i = 0; i < 5; i++) {
            const angle = (i * 2 * Math.PI) / 5 - Math.PI / 2;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(
                centerX + Math.cos(angle) * radius,
                centerY + Math.sin(angle) * radius
            );
            ctx.stroke();

            // æ ‡ç­¾
            ctx.fillStyle = 'white';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            const labelX = centerX + Math.cos(angle) * (radius + 20);
            const labelY = centerY + Math.sin(angle) * (radius + 20);
            ctx.fillText(metrics[i], labelX, labelY);
        }

        // ç»˜åˆ¶æ•°æ®
        Object.entries(architectures).forEach(([name, values]) => {
            ctx.fillStyle = colors[name];
            ctx.strokeStyle = colors[name].replace('0.6', '1');
            ctx.lineWidth = 2;

            ctx.beginPath();
            values.forEach((value, index) => {
                const angle = (index * 2 * Math.PI) / 5 - Math.PI / 2;
                const x = centerX + Math.cos(angle) * (radius * value / 100);
                const y = centerY + Math.sin(angle) * (radius * value / 100);

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        });

        // å›¾ä¾‹
        let legendY = 20;
        Object.entries(colors).forEach(([name, color]) => {
            ctx.fillStyle = color;
            ctx.fillRect(20, legendY, 20, 15);
            ctx.fillStyle = 'white';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(name, 50, legendY + 12);
            legendY += 25;
        });
    }

    // ===== ä»£ç æ ‡ç­¾åˆ‡æ¢ =====
    document.querySelectorAll('.code-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const container = this.closest('.code-container');
            const tabName = this.dataset.tab;

            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            container.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');

            // åˆ‡æ¢å†…å®¹
            container.querySelectorAll('[data-tab-content]').forEach(content => {
                content.style.display = content.dataset.tabContent === tabName ? 'block' : 'none';
            });
        });
    });

    // ===== ä»£ç è¿è¡Œæ¨¡æ‹Ÿ =====
    function runCode(button, outputId) {
        const outputElement = document.getElementById(outputId);
        if (outputElement) {
            outputElement.classList.add('show');

            // æ¨¡æ‹Ÿè¿è¡ŒåŠ¨ç”»
            button.innerHTML = '<span class="loading"></span> è¿è¡Œä¸­...';
            button.disabled = true;

            setTimeout(() => {
                button.innerHTML = 'â–¶ å¼€å§‹è®­ç»ƒ';
                button.disabled = false;
                showNotification('è®­ç»ƒå®Œæˆï¼æŸ¥çœ‹è¾“å‡ºç»“æœã€‚');

                if (!achievements.implementResNet) {
                    achievements.implementResNet = true;
                    achievementSystem.showAchievement("å®è·µè¾¾äºº", "æˆåŠŸå®ç°å¹¶è®­ç»ƒäº†ResNetï¼");
                }
            }, 3000);
        }
    }

    // ===== é€šçŸ¥ç³»ç»Ÿ =====
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        background: ${type === 'error' ? '#ef4444' : type === 'warning' ? '#f59e0b' : '#22c55e'};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        z-index: 2000;
        animation: slideInRight 0.3s ease;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    `;
        notification.textContent = message;

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'slideInRight 0.3s ease reverse';
            setTimeout(() => document.body.removeChild(notification), 300);
        }, 3000);
    }

    // ===== ä»»åŠ¡æ¸…å• =====
    function toggleCheck(checkbox) {
        checkbox.classList.toggle('checked');

        const checkedItems = document.querySelectorAll('.checklist-checkbox.checked').length;
        const totalItems = document.querySelectorAll('.checklist-checkbox').length;

        if (checkedItems === totalItems && !achievements.architectureMaster) {
            achievements.architectureMaster = true;
            achievementSystem.showAchievement("æ¶æ„å¤§å¸ˆ", "å®Œæˆäº†æ‰€æœ‰å®è·µä»»åŠ¡ï¼");
        }
    }

    // ===== ç›‘å¬ç« èŠ‚é˜…è¯» =====
    const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.5
    };

    const sectionObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting && !completedSections.has(entry.target.id)) {
                completedSections.add(entry.target.id);
                achievementSystem.checkAchievements();
            }
        });
    }, observerOptions);

    sections.forEach(section => {
        sectionObserver.observe(section);
    });

    // ===== ä¿å­˜å’ŒåŠ è½½è¿›åº¦ =====
    function saveProgress() {
        const progress = {
            completedSections: Array.from(completedSections),
            achievements: achievements,
            animationsEnabled: animationsEnabled,
            timestamp: Date.now()
        };
        localStorage.setItem('resnet-progress', JSON.stringify(progress));
    }

    function loadProgress() {
        const saved = localStorage.getItem('resnet-progress');
        if (saved) {
            try {
                const progress = JSON.parse(saved);
                completedSections = new Set(progress.completedSections || []);
                achievements = { ...achievements, ...progress.achievements };
                animationsEnabled = progress.animationsEnabled !== false;

                achievementSystem.checkAchievements();
                showNotification('å·²æ¢å¤ä¸Šæ¬¡å­¦ä¹ è¿›åº¦');
            } catch (e) {
                console.error('Failed to load progress:', e);
            }
        }
    }

    // ===== åˆå§‹åŒ– =====
    window.addEventListener('load', () => {
        // åŠ è½½è¿›åº¦
        loadProgress();

        // åˆå§‹åŒ–å¯è§†åŒ–
        drawTrainingCurves();
        visualizeGradientFlow();
        visualizeDenseBlock();
        drawArchitectureRadar();

        // å®šæœŸä¿å­˜è¿›åº¦
        setInterval(saveProgress, 60000);

        // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
        setTimeout(() => {
            learningBuddy.classList.add('active');
            document.querySelector('.buddy-message p').textContent =
                'æ¬¢è¿æ¥åˆ°ç°ä»£CNNæ¶æ„çš„ä¸–ç•Œï¼ResNetçš„æ®‹å·®æ€æƒ³å½»åº•æ”¹å˜äº†æ·±åº¦å­¦ä¹ ã€‚å‡†å¤‡å¥½æ¢ç´¢æ·±åº¦çš„å¥¥ç§˜äº†å—ï¼Ÿ';
        }, 1000);
    });

    // ===== é¡µé¢ç¦»å¼€æ—¶ä¿å­˜ =====
    window.addEventListener('beforeunload', saveProgress);

    // ===== å“åº”å¼å¤„ç† =====
    function handleResize() {
        const isMobile = window.innerWidth < 768;

        if (learningBuddy) {
            if (isMobile) {
                learningBuddy.style.width = '90%';
                learningBuddy.style.left = '5%';
                learningBuddy.style.right = '5%';
                learningBuddy.style.bottom = '10px';
            } else {
                learningBuddy.style.width = '300px';
                learningBuddy.style.left = 'auto';
                learningBuddy.style.right = '20px';
                learningBuddy.style.bottom = '20px';
            }
        }

        // é‡ç»˜å¯è§†åŒ–
        if (window.innerWidth !== window.lastWidth) {
            drawTrainingCurves();
            drawArchitectureRadar();
            window.lastWidth = window.innerWidth;
        }
    }

    window.addEventListener('resize', handleResize);
    handleResize();

    // ===== é”®ç›˜å¿«æ·é”® =====
    document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + S: ä¿å­˜è¿›åº¦
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            saveProgress();
            showNotification('è¿›åº¦å·²ä¿å­˜');
        }

        // Esc: å…³é—­ä¾§è¾¹æ 
        if (e.key === 'Escape') {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
        }
    });

    console.log('ğŸ—ï¸ ç°ä»£CNNæ¶æ„ç« èŠ‚åŠ è½½å®Œæˆï¼');
    console.log('æç¤ºï¼šæŒ‰ Ctrl+S ä¿å­˜å­¦ä¹ è¿›åº¦');
</script>

</body>
</html>